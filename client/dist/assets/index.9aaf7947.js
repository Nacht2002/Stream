function y0(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const wS=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}};wS();var C={exports:{}},de={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var xh=Object.getOwnPropertySymbols,PS=Object.prototype.hasOwnProperty,DS=Object.prototype.propertyIsEnumerable;function kS(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function OS(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var r=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var E0=OS()?Object.assign:function(n,e){for(var t,r=kS(n),i,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var o in t)PS.call(t,o)&&(r[o]=t[o]);if(xh){i=xh(t);for(var a=0;a<i.length;a++)DS.call(t,i[a])&&(r[i[a]]=t[i[a]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yd=E0,Ei=60103,x0=60106;de.Fragment=60107;de.StrictMode=60108;de.Profiler=60114;var S0=60109,T0=60110,A0=60112;de.Suspense=60113;var L0=60115,I0=60116;if(typeof Symbol=="function"&&Symbol.for){var kt=Symbol.for;Ei=kt("react.element"),x0=kt("react.portal"),de.Fragment=kt("react.fragment"),de.StrictMode=kt("react.strict_mode"),de.Profiler=kt("react.profiler"),S0=kt("react.provider"),T0=kt("react.context"),A0=kt("react.forward_ref"),de.Suspense=kt("react.suspense"),L0=kt("react.memo"),I0=kt("react.lazy")}var Sh=typeof Symbol=="function"&&Symbol.iterator;function MS(n){return n===null||typeof n!="object"?null:(n=Sh&&n[Sh]||n["@@iterator"],typeof n=="function"?n:null)}function Xs(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var R0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b0={};function xi(n,e,t){this.props=n,this.context=e,this.refs=b0,this.updater=t||R0}xi.prototype.isReactComponent={};xi.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error(Xs(85));this.updater.enqueueSetState(this,n,e,"setState")};xi.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function C0(){}C0.prototype=xi.prototype;function Ed(n,e,t){this.props=n,this.context=e,this.refs=b0,this.updater=t||R0}var xd=Ed.prototype=new C0;xd.constructor=Ed;yd(xd,xi.prototype);xd.isPureReactComponent=!0;var Sd={current:null},_0=Object.prototype.hasOwnProperty,w0={key:!0,ref:!0,__self:!0,__source:!0};function P0(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)_0.call(e,r)&&!w0.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ei,type:n,key:s,ref:o,props:i,_owner:Sd.current}}function FS(n,e){return{$$typeof:Ei,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Td(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ei}function NS(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Th=/\/+/g;function Bl(n,e){return typeof n=="object"&&n!==null&&n.key!=null?NS(""+n.key):e.toString(36)}function Wo(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ei:case x0:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Bl(o,0):r,Array.isArray(i)?(t="",n!=null&&(t=n.replace(Th,"$&/")+"/"),Wo(i,e,t,"",function(u){return u})):i!=null&&(Td(i)&&(i=FS(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Th,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Array.isArray(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+Bl(s,a);o+=Wo(s,e,t,l,i)}else if(l=MS(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+Bl(s,a++),o+=Wo(s,e,t,l,i);else if(s==="object")throw e=""+n,Error(Xs(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e));return o}function ho(n,e,t){if(n==null)return n;var r=[],i=0;return Wo(n,r,"","",function(s){return e.call(t,s,i++)}),r}function BS(n){if(n._status===-1){var e=n._result;e=e(),n._status=0,n._result=e,e.then(function(t){n._status===0&&(t=t.default,n._status=1,n._result=t)},function(t){n._status===0&&(n._status=2,n._result=t)})}if(n._status===1)return n._result;throw n._result}var D0={current:null};function Sn(){var n=D0.current;if(n===null)throw Error(Xs(321));return n}var US={ReactCurrentDispatcher:D0,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:Sd,IsSomeRendererActing:{current:!1},assign:yd};de.Children={map:ho,forEach:function(n,e,t){ho(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return ho(n,function(){e++}),e},toArray:function(n){return ho(n,function(e){return e})||[]},only:function(n){if(!Td(n))throw Error(Xs(143));return n}};de.Component=xi;de.PureComponent=Ed;de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=US;de.cloneElement=function(n,e,t){if(n==null)throw Error(Xs(267,n));var r=yd({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Sd.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)_0.call(e,l)&&!w0.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ei,type:n.type,key:i,ref:s,props:r,_owner:o}};de.createContext=function(n,e){return e===void 0&&(e=null),n={$$typeof:T0,_calculateChangedBits:e,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null},n.Provider={$$typeof:S0,_context:n},n.Consumer=n};de.createElement=P0;de.createFactory=function(n){var e=P0.bind(null,n);return e.type=n,e};de.createRef=function(){return{current:null}};de.forwardRef=function(n){return{$$typeof:A0,render:n}};de.isValidElement=Td;de.lazy=function(n){return{$$typeof:I0,_payload:{_status:-1,_result:n},_init:BS}};de.memo=function(n,e){return{$$typeof:L0,type:n,compare:e===void 0?null:e}};de.useCallback=function(n,e){return Sn().useCallback(n,e)};de.useContext=function(n,e){return Sn().useContext(n,e)};de.useDebugValue=function(){};de.useEffect=function(n,e){return Sn().useEffect(n,e)};de.useImperativeHandle=function(n,e,t){return Sn().useImperativeHandle(n,e,t)};de.useLayoutEffect=function(n,e){return Sn().useLayoutEffect(n,e)};de.useMemo=function(n,e){return Sn().useMemo(n,e)};de.useReducer=function(n,e,t){return Sn().useReducer(n,e,t)};de.useRef=function(n){return Sn().useRef(n)};de.useState=function(n){return Sn().useState(n)};de.version="17.0.2";C.exports=de;var ul=C.exports,Ad=y0({__proto__:null,default:ul},[C.exports]),Ld={exports:{}},Ct={},k0={exports:{}},O0={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){var e,t,r,i;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var l=null,u=null,c=function(){if(l!==null)try{var w=n.unstable_now();l(!0,w),l=null}catch(k){throw setTimeout(c,0),k}};e=function(w){l!==null?setTimeout(e,0,w):(l=w,setTimeout(c,0))},t=function(w,k){u=setTimeout(w,k)},r=function(){clearTimeout(u)},n.unstable_shouldYield=function(){return!1},i=n.unstable_forceFrameRate=function(){}}else{var d=window.setTimeout,f=window.clearTimeout;if(typeof console!="undefined"){var p=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof p!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var h=!1,m=null,g=-1,v=5,y=0;n.unstable_shouldYield=function(){return n.unstable_now()>=y},i=function(){},n.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<w?Math.floor(1e3/w):5};var E=new MessageChannel,S=E.port2;E.port1.onmessage=function(){if(m!==null){var w=n.unstable_now();y=w+v;try{m(!0,w)?S.postMessage(null):(h=!1,m=null)}catch(k){throw S.postMessage(null),k}}else h=!1},e=function(w){m=w,h||(h=!0,S.postMessage(null))},t=function(w,k){g=d(function(){w(n.unstable_now())},k)},r=function(){f(g),g=-1}}function T(w,k){var U=w.length;w.push(k);e:for(;;){var N=U-1>>>1,V=w[N];if(V!==void 0&&0<R(V,k))w[N]=k,w[U]=V,U=N;else break e}}function L(w){return w=w[0],w===void 0?null:w}function A(w){var k=w[0];if(k!==void 0){var U=w.pop();if(U!==k){w[0]=U;e:for(var N=0,V=w.length;N<V;){var ee=2*(N+1)-1,fe=w[ee],he=ee+1,Ee=w[he];if(fe!==void 0&&0>R(fe,U))Ee!==void 0&&0>R(Ee,fe)?(w[N]=Ee,w[he]=U,N=he):(w[N]=fe,w[ee]=U,N=ee);else if(Ee!==void 0&&0>R(Ee,U))w[N]=Ee,w[he]=U,N=he;else break e}}return k}return null}function R(w,k){var U=w.sortIndex-k.sortIndex;return U!==0?U:w.id-k.id}var I=[],b=[],O=1,B=null,K=3,q=!1,j=!1,G=!1;function M(w){for(var k=L(b);k!==null;){if(k.callback===null)A(b);else if(k.startTime<=w)A(b),k.sortIndex=k.expirationTime,T(I,k);else break;k=L(b)}}function $(w){if(G=!1,M(w),!j)if(L(I)!==null)j=!0,e(z);else{var k=L(b);k!==null&&t($,k.startTime-w)}}function z(w,k){j=!1,G&&(G=!1,r()),q=!0;var U=K;try{for(M(k),B=L(I);B!==null&&(!(B.expirationTime>k)||w&&!n.unstable_shouldYield());){var N=B.callback;if(typeof N=="function"){B.callback=null,K=B.priorityLevel;var V=N(B.expirationTime<=k);k=n.unstable_now(),typeof V=="function"?B.callback=V:B===L(I)&&A(I),M(k)}else A(I);B=L(I)}if(B!==null)var ee=!0;else{var fe=L(b);fe!==null&&t($,fe.startTime-k),ee=!1}return ee}finally{B=null,K=U,q=!1}}var J=i;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(w){w.callback=null},n.unstable_continueExecution=function(){j||q||(j=!0,e(z))},n.unstable_getCurrentPriorityLevel=function(){return K},n.unstable_getFirstCallbackNode=function(){return L(I)},n.unstable_next=function(w){switch(K){case 1:case 2:case 3:var k=3;break;default:k=K}var U=K;K=k;try{return w()}finally{K=U}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=J,n.unstable_runWithPriority=function(w,k){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var U=K;K=w;try{return k()}finally{K=U}},n.unstable_scheduleCallback=function(w,k,U){var N=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?N+U:N):U=N,w){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=U+V,w={id:O++,callback:k,priorityLevel:w,startTime:U,expirationTime:V,sortIndex:-1},U>N?(w.sortIndex=U,T(b,w),L(I)===null&&w===L(b)&&(G?r():G=!0,t($,U-N))):(w.sortIndex=V,T(I,w),j||q||(j=!0,e(z))),w},n.unstable_wrapCallback=function(w){var k=K;return function(){var U=K;K=k;try{return w.apply(this,arguments)}finally{K=U}}}})(O0);k0.exports=O0;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cl=C.exports,Le=E0,He=k0.exports;function Y(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!cl)throw Error(Y(227));var M0=new Set,Ss={};function Tr(n,e){di(n,e),di(n+"Capture",e)}function di(n,e){for(Ss[n]=e,n=0;n<e.length;n++)M0.add(e[n])}var vn=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),$S=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ah=Object.prototype.hasOwnProperty,Lh={},Ih={};function VS(n){return Ah.call(Ih,n)?!0:Ah.call(Lh,n)?!1:$S.test(n)?Ih[n]=!0:(Lh[n]=!0,!1)}function GS(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function KS(n,e,t,r){if(e===null||typeof e=="undefined"||GS(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function at(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Qe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Qe[n]=new at(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Qe[e]=new at(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Qe[n]=new at(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Qe[n]=new at(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Qe[n]=new at(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Qe[n]=new at(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Qe[n]=new at(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Qe[n]=new at(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Qe[n]=new at(n,5,!1,n.toLowerCase(),null,!1,!1)});var Id=/[\-:]([a-z])/g;function Rd(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Id,Rd);Qe[e]=new at(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Id,Rd);Qe[e]=new at(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Id,Rd);Qe[e]=new at(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Qe[n]=new at(n,1,!1,n.toLowerCase(),null,!1,!1)});Qe.xlinkHref=new at("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Qe[n]=new at(n,1,!1,n.toLowerCase(),null,!0,!0)});function bd(n,e,t,r){var i=Qe.hasOwnProperty(e)?Qe[e]:null,s=i!==null?i.type===0:r?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(KS(e,t,i,r)&&(t=null),r||i===null?VS(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ar=cl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hi=60103,cr=60106,wn=60107,Cd=60108,Ji=60114,_d=60109,wd=60110,dl=60112,es=60113,ga=60120,fl=60115,Pd=60116,Dd=60121,kd=60128,F0=60129,Od=60130,Hu=60131;if(typeof Symbol=="function"&&Symbol.for){var Ge=Symbol.for;Hi=Ge("react.element"),cr=Ge("react.portal"),wn=Ge("react.fragment"),Cd=Ge("react.strict_mode"),Ji=Ge("react.profiler"),_d=Ge("react.provider"),wd=Ge("react.context"),dl=Ge("react.forward_ref"),es=Ge("react.suspense"),ga=Ge("react.suspense_list"),fl=Ge("react.memo"),Pd=Ge("react.lazy"),Dd=Ge("react.block"),Ge("react.scope"),kd=Ge("react.opaque.id"),F0=Ge("react.debug_trace_mode"),Od=Ge("react.offscreen"),Hu=Ge("react.legacy_hidden")}var Rh=typeof Symbol=="function"&&Symbol.iterator;function wi(n){return n===null||typeof n!="object"?null:(n=Rh&&n[Rh]||n["@@iterator"],typeof n=="function"?n:null)}var Ul;function Wi(n){if(Ul===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Ul=e&&e[1]||""}return`
`+Ul+n}var $l=!1;function po(n,e){if(!n||$l)return"";$l=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a])return`
`+i[o].replace(" at new "," at ");while(1<=o&&0<=a);break}}}finally{$l=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Wi(n):""}function jS(n){switch(n.tag){case 5:return Wi(n.type);case 16:return Wi("Lazy");case 13:return Wi("Suspense");case 19:return Wi("SuspenseList");case 0:case 2:case 15:return n=po(n.type,!1),n;case 11:return n=po(n.type.render,!1),n;case 22:return n=po(n.type._render,!1),n;case 1:return n=po(n.type,!0),n;default:return""}}function qr(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case wn:return"Fragment";case cr:return"Portal";case Ji:return"Profiler";case Cd:return"StrictMode";case es:return"Suspense";case ga:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case wd:return(n.displayName||"Context")+".Consumer";case _d:return(n._context.displayName||"Context")+".Provider";case dl:var e=n.render;return e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case fl:return qr(n.type);case Dd:return qr(n._render);case Pd:e=n._payload,n=n._init;try{return qr(n(e))}catch{}}return null}function zn(n){switch(typeof n){case"boolean":case"number":case"object":case"string":case"undefined":return n;default:return""}}function N0(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function HS(n){var e=N0(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t!="undefined"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function go(n){n._valueTracker||(n._valueTracker=HS(n))}function B0(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=N0(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ma(n){if(n=n||(typeof document!="undefined"?document:void 0),typeof n=="undefined")return null;try{return n.activeElement||n.body}catch{return n.body}}function Wu(n,e){var t=e.checked;return Le({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t!=null?t:n._wrapperState.initialChecked})}function bh(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=zn(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function U0(n,e){e=e.checked,e!=null&&bd(n,"checked",e,!1)}function zu(n,e){U0(n,e);var t=zn(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Yu(n,e.type,t):e.hasOwnProperty("defaultValue")&&Yu(n,e.type,zn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Ch(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Yu(n,e,t){(e!=="number"||ma(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}function WS(n){var e="";return cl.Children.forEach(n,function(t){t!=null&&(e+=t)}),e}function qu(n,e){return n=Le({children:void 0},e),(e=WS(e.children))&&(n.children=e),n}function Xr(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+zn(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Xu(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return Le({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function _h(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Y(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(Y(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:zn(t)}}function $0(n,e){var t=zn(e.value),r=zn(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function wh(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}var Qu={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function V0(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zu(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?V0(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var mo,G0=function(n){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!==Qu.svg||"innerHTML"in n)n.innerHTML=e;else{for(mo=mo||document.createElement("div"),mo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mo.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ts(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ts={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zS=["Webkit","ms","Moz","O"];Object.keys(ts).forEach(function(n){zS.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ts[e]=ts[n]})});function K0(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ts.hasOwnProperty(n)&&ts[n]?(""+e).trim():e+"px"}function j0(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=K0(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var YS=Le({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ju(n,e){if(e){if(YS[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function ec(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Md(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var tc=null,Qr=null,Zr=null;function Ph(n){if(n=Zs(n)){if(typeof tc!="function")throw Error(Y(280));var e=n.stateNode;e&&(e=yl(e),tc(n.stateNode,n.type,e))}}function H0(n){Qr?Zr?Zr.push(n):Zr=[n]:Qr=n}function W0(){if(Qr){var n=Qr,e=Zr;if(Zr=Qr=null,Ph(n),e)for(n=0;n<e.length;n++)Ph(e[n])}}function Fd(n,e){return n(e)}function z0(n,e,t,r,i){return n(e,t,r,i)}function Nd(){}var Y0=Fd,dr=!1,Vl=!1;function Bd(){(Qr!==null||Zr!==null)&&(Nd(),W0())}function qS(n,e,t){if(Vl)return n(e,t);Vl=!0;try{return Y0(n,e,t)}finally{Vl=!1,Bd()}}function As(n,e){var t=n.stateNode;if(t===null)return null;var r=yl(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Y(231,e,typeof t));return t}var nc=!1;if(vn)try{var Pi={};Object.defineProperty(Pi,"passive",{get:function(){nc=!0}}),window.addEventListener("test",Pi,Pi),window.removeEventListener("test",Pi,Pi)}catch{nc=!1}function XS(n,e,t,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var ns=!1,va=null,ya=!1,rc=null,QS={onError:function(n){ns=!0,va=n}};function ZS(n,e,t,r,i,s,o,a,l){ns=!1,va=null,XS.apply(QS,arguments)}function JS(n,e,t,r,i,s,o,a,l){if(ZS.apply(this,arguments),ns){if(ns){var u=va;ns=!1,va=null}else throw Error(Y(198));ya||(ya=!0,rc=u)}}function Lr(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,(e.flags&1026)!==0&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function q0(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Dh(n){if(Lr(n)!==n)throw Error(Y(188))}function eT(n){var e=n.alternate;if(!e){if(e=Lr(n),e===null)throw Error(Y(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return Dh(i),n;if(s===r)return Dh(i),e;s=s.sibling}throw Error(Y(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(Y(189))}}if(t.alternate!==r)throw Error(Y(190))}if(t.tag!==3)throw Error(Y(188));return t.stateNode.current===t?n:e}function X0(n){if(n=eT(n),!n)return null;for(var e=n;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===n)break;for(;!e.sibling;){if(!e.return||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function kh(n,e){for(var t=n.alternate;e!==null;){if(e===n||e===t)return!0;e=e.return}return!1}var Q0,Ud,Z0,J0,ic=!1,Yt=[],Nn=null,Bn=null,Un=null,Ls=new Map,Is=new Map,Di=[],Oh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sc(n,e,t,r,i){return{blockedOn:n,domEventName:e,eventSystemFlags:t|16,nativeEvent:i,targetContainers:[r]}}function Mh(n,e){switch(n){case"focusin":case"focusout":Nn=null;break;case"dragenter":case"dragleave":Bn=null;break;case"mouseover":case"mouseout":Un=null;break;case"pointerover":case"pointerout":Ls.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Is.delete(e.pointerId)}}function ki(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n=sc(e,t,r,i,s),e!==null&&(e=Zs(e),e!==null&&Ud(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function tT(n,e,t,r,i){switch(e){case"focusin":return Nn=ki(Nn,n,e,t,r,i),!0;case"dragenter":return Bn=ki(Bn,n,e,t,r,i),!0;case"mouseover":return Un=ki(Un,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return Ls.set(s,ki(Ls.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Is.set(s,ki(Is.get(s)||null,n,e,t,r,i)),!0}return!1}function nT(n){var e=fr(n.target);if(e!==null){var t=Lr(e);if(t!==null){if(e=t.tag,e===13){if(e=q0(t),e!==null){n.blockedOn=e,J0(n.lanePriority,function(){He.unstable_runWithPriority(n.priority,function(){Z0(t)})});return}}else if(e===3&&t.stateNode.hydrate){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function zo(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Kd(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null)return e=Zs(t),e!==null&&Ud(e),n.blockedOn=t,!1;e.shift()}return!0}function Fh(n,e,t){zo(n)&&t.delete(e)}function rT(){for(ic=!1;0<Yt.length;){var n=Yt[0];if(n.blockedOn!==null){n=Zs(n.blockedOn),n!==null&&Q0(n);break}for(var e=n.targetContainers;0<e.length;){var t=Kd(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t!==null){n.blockedOn=t;break}e.shift()}n.blockedOn===null&&Yt.shift()}Nn!==null&&zo(Nn)&&(Nn=null),Bn!==null&&zo(Bn)&&(Bn=null),Un!==null&&zo(Un)&&(Un=null),Ls.forEach(Fh),Is.forEach(Fh)}function Oi(n,e){n.blockedOn===e&&(n.blockedOn=null,ic||(ic=!0,He.unstable_scheduleCallback(He.unstable_NormalPriority,rT)))}function ev(n){function e(i){return Oi(i,n)}if(0<Yt.length){Oi(Yt[0],n);for(var t=1;t<Yt.length;t++){var r=Yt[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Nn!==null&&Oi(Nn,n),Bn!==null&&Oi(Bn,n),Un!==null&&Oi(Un,n),Ls.forEach(e),Is.forEach(e),t=0;t<Di.length;t++)r=Di[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Di.length&&(t=Di[0],t.blockedOn===null);)nT(t),t.blockedOn===null&&Di.shift()}function vo(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var $r={animationend:vo("Animation","AnimationEnd"),animationiteration:vo("Animation","AnimationIteration"),animationstart:vo("Animation","AnimationStart"),transitionend:vo("Transition","TransitionEnd")},Gl={},tv={};vn&&(tv=document.createElement("div").style,"AnimationEvent"in window||(delete $r.animationend.animation,delete $r.animationiteration.animation,delete $r.animationstart.animation),"TransitionEvent"in window||delete $r.transitionend.transition);function hl(n){if(Gl[n])return Gl[n];if(!$r[n])return n;var e=$r[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in tv)return Gl[n]=e[t];return n}var nv=hl("animationend"),rv=hl("animationiteration"),iv=hl("animationstart"),sv=hl("transitionend"),ov=new Map,$d=new Map,iT=["abort","abort",nv,"animationEnd",rv,"animationIteration",iv,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",sv,"transitionEnd","waiting","waiting"];function Vd(n,e){for(var t=0;t<n.length;t+=2){var r=n[t],i=n[t+1];i="on"+(i[0].toUpperCase()+i.slice(1)),$d.set(r,e),ov.set(r,i),Tr(i,[r])}}var sT=He.unstable_now;sT();var xe=8;function Fr(n){if((1&n)!==0)return xe=15,1;if((2&n)!==0)return xe=14,2;if((4&n)!==0)return xe=13,4;var e=24&n;return e!==0?(xe=12,e):(n&32)!==0?(xe=11,32):(e=192&n,e!==0?(xe=10,e):(n&256)!==0?(xe=9,256):(e=3584&n,e!==0?(xe=8,e):(n&4096)!==0?(xe=7,4096):(e=4186112&n,e!==0?(xe=6,e):(e=62914560&n,e!==0?(xe=5,e):n&67108864?(xe=4,67108864):(n&134217728)!==0?(xe=3,134217728):(e=805306368&n,e!==0?(xe=2,e):(1073741824&n)!==0?(xe=1,1073741824):(xe=8,n))))))}function oT(n){switch(n){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function aT(n){switch(n){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(Y(358,n))}}function Rs(n,e){var t=n.pendingLanes;if(t===0)return xe=0;var r=0,i=0,s=n.expiredLanes,o=n.suspendedLanes,a=n.pingedLanes;if(s!==0)r=s,i=xe=15;else if(s=t&134217727,s!==0){var l=s&~o;l!==0?(r=Fr(l),i=xe):(a&=s,a!==0&&(r=Fr(a),i=xe))}else s=t&~o,s!==0?(r=Fr(s),i=xe):a!==0&&(r=Fr(a),i=xe);if(r===0)return 0;if(r=31-Yn(r),r=t&((0>r?0:1<<r)<<1)-1,e!==0&&e!==r&&(e&o)===0){if(Fr(e),i<=xe)return e;xe=i}if(e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Yn(e),i=1<<t,r|=n[t],e&=~i;return r}function av(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Ea(n,e){switch(n){case 15:return 1;case 14:return 2;case 12:return n=Nr(24&~e),n===0?Ea(10,e):n;case 10:return n=Nr(192&~e),n===0?Ea(8,e):n;case 8:return n=Nr(3584&~e),n===0&&(n=Nr(4186112&~e),n===0&&(n=512)),n;case 2:return e=Nr(805306368&~e),e===0&&(e=268435456),e}throw Error(Y(358,n))}function Nr(n){return n&-n}function Kl(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function pl(n,e,t){n.pendingLanes|=e;var r=e-1;n.suspendedLanes&=r,n.pingedLanes&=r,n=n.eventTimes,e=31-Yn(e),n[e]=t}var Yn=Math.clz32?Math.clz32:cT,lT=Math.log,uT=Math.LN2;function cT(n){return n===0?32:31-(lT(n)/uT|0)|0}var dT=He.unstable_UserBlockingPriority,fT=He.unstable_runWithPriority,Yo=!0;function hT(n,e,t,r){dr||Nd();var i=Gd,s=dr;dr=!0;try{z0(i,n,e,t,r)}finally{(dr=s)||Bd()}}function pT(n,e,t,r){fT(dT,Gd.bind(null,n,e,t,r))}function Gd(n,e,t,r){if(Yo){var i;if((i=(e&4)===0)&&0<Yt.length&&-1<Oh.indexOf(n))n=sc(null,n,e,t,r),Yt.push(n);else{var s=Kd(n,e,t,r);if(s===null)i&&Mh(n,r);else{if(i){if(-1<Oh.indexOf(n)){n=sc(s,n,e,t,r),Yt.push(n);return}if(tT(s,n,e,t,r))return;Mh(n,r)}xv(n,e,r,null,t)}}}}function Kd(n,e,t,r){var i=Md(r);if(i=fr(i),i!==null){var s=Lr(i);if(s===null)i=null;else{var o=s.tag;if(o===13){if(i=q0(s),i!==null)return i;i=null}else if(o===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return xv(n,e,r,i,t),null}var Pn=null,jd=null,qo=null;function lv(){if(qo)return qo;var n,e=jd,t=e.length,r,i="value"in Pn?Pn.value:Pn.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return qo=i.slice(n,1<r?1-r:void 0)}function Xo(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function yo(){return!0}function Nh(){return!1}function xt(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?yo:Nh,this.isPropagationStopped=Nh,this}return Le(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=yo)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=yo)},persist:function(){},isPersistent:yo}),e}var Si={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hd=xt(Si),Qs=Le({},Si,{view:0,detail:0}),gT=xt(Qs),jl,Hl,Mi,gl=Le({},Qs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wd,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Mi&&(Mi&&n.type==="mousemove"?(jl=n.screenX-Mi.screenX,Hl=n.screenY-Mi.screenY):Hl=jl=0,Mi=n),jl)},movementY:function(n){return"movementY"in n?n.movementY:Hl}}),Bh=xt(gl),mT=Le({},gl,{dataTransfer:0}),vT=xt(mT),yT=Le({},Qs,{relatedTarget:0}),Wl=xt(yT),ET=Le({},Si,{animationName:0,elapsedTime:0,pseudoElement:0}),xT=xt(ET),ST=Le({},Si,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),TT=xt(ST),AT=Le({},Si,{data:0}),Uh=xt(AT),LT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bT(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=RT[n])?!!e[n]:!1}function Wd(){return bT}var CT=Le({},Qs,{key:function(n){if(n.key){var e=LT[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Xo(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?IT[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wd,charCode:function(n){return n.type==="keypress"?Xo(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Xo(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),_T=xt(CT),wT=Le({},gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$h=xt(wT),PT=Le({},Qs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wd}),DT=xt(PT),kT=Le({},Si,{propertyName:0,elapsedTime:0,pseudoElement:0}),OT=xt(kT),MT=Le({},gl,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),FT=xt(MT),NT=[9,13,27,32],zd=vn&&"CompositionEvent"in window,rs=null;vn&&"documentMode"in document&&(rs=document.documentMode);var BT=vn&&"TextEvent"in window&&!rs,uv=vn&&(!zd||rs&&8<rs&&11>=rs),Vh=String.fromCharCode(32),Gh=!1;function cv(n,e){switch(n){case"keyup":return NT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dv(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Vr=!1;function UT(n,e){switch(n){case"compositionend":return dv(e);case"keypress":return e.which!==32?null:(Gh=!0,Vh);case"textInput":return n=e.data,n===Vh&&Gh?null:n;default:return null}}function $T(n,e){if(Vr)return n==="compositionend"||!zd&&cv(n,e)?(n=lv(),qo=jd=Pn=null,Vr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uv&&e.locale!=="ko"?null:e.data;default:return null}}var VT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kh(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!VT[n.type]:e==="textarea"}function fv(n,e,t,r){H0(r),e=xa(e,"onChange"),0<e.length&&(t=new Hd("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var is=null,bs=null;function GT(n){vv(n,0)}function ml(n){var e=Kr(n);if(B0(e))return n}function KT(n,e){if(n==="change")return e}var hv=!1;if(vn){var zl;if(vn){var Yl="oninput"in document;if(!Yl){var jh=document.createElement("div");jh.setAttribute("oninput","return;"),Yl=typeof jh.oninput=="function"}zl=Yl}else zl=!1;hv=zl&&(!document.documentMode||9<document.documentMode)}function Hh(){is&&(is.detachEvent("onpropertychange",pv),bs=is=null)}function pv(n){if(n.propertyName==="value"&&ml(bs)){var e=[];if(fv(e,bs,n,Md(n)),n=GT,dr)n(e);else{dr=!0;try{Fd(n,e)}finally{dr=!1,Bd()}}}}function jT(n,e,t){n==="focusin"?(Hh(),is=e,bs=t,is.attachEvent("onpropertychange",pv)):n==="focusout"&&Hh()}function HT(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return ml(bs)}function WT(n,e){if(n==="click")return ml(e)}function zT(n,e){if(n==="input"||n==="change")return ml(e)}function YT(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Tt=typeof Object.is=="function"?Object.is:YT,qT=Object.prototype.hasOwnProperty;function Cs(n,e){if(Tt(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++)if(!qT.call(e,t[r])||!Tt(n[t[r]],e[t[r]]))return!1;return!0}function Wh(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function zh(n,e){var t=Wh(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Wh(t)}}function gv(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?gv(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Yh(){for(var n=window,e=ma();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ma(n.document)}return e}function oc(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}var XT=vn&&"documentMode"in document&&11>=document.documentMode,Gr=null,ac=null,ss=null,lc=!1;function qh(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;lc||Gr==null||Gr!==ma(r)||(r=Gr,"selectionStart"in r&&oc(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ss&&Cs(ss,r)||(ss=r,r=xa(ac,"onSelect"),0<r.length&&(e=new Hd("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Gr)))}Vd("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Vd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Vd(iT,2);for(var Xh="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),ql=0;ql<Xh.length;ql++)$d.set(Xh[ql],0);di("onMouseEnter",["mouseout","mouseover"]);di("onMouseLeave",["mouseout","mouseover"]);di("onPointerEnter",["pointerout","pointerover"]);di("onPointerLeave",["pointerout","pointerover"]);Tr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Tr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Tr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Tr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Tr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Tr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mv=new Set("cancel close invalid load scroll toggle".split(" ").concat(zi));function Qh(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,JS(r,e,void 0,n),n.currentTarget=null}function vv(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Qh(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Qh(i,a,u),s=l}}}if(ya)throw n=rc,ya=!1,rc=null,n}function Te(n,e){var t=Tv(e),r=n+"__bubble";t.has(r)||(Ev(e,n,2,!1),t.add(r))}var Zh="_reactListening"+Math.random().toString(36).slice(2);function yv(n){n[Zh]||(n[Zh]=!0,M0.forEach(function(e){mv.has(e)||Jh(e,!1,n,null),Jh(e,!0,n,null)}))}function Jh(n,e,t,r){var i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=t;if(n==="selectionchange"&&t.nodeType!==9&&(s=t.ownerDocument),r!==null&&!e&&mv.has(n)){if(n!=="scroll")return;i|=2,s=r}var o=Tv(s),a=n+"__"+(e?"capture":"bubble");o.has(a)||(e&&(i|=4),Ev(s,n,i,e),o.add(a))}function Ev(n,e,t,r){var i=$d.get(e);switch(i===void 0?2:i){case 0:i=hT;break;case 1:i=pT;break;default:i=Gd}t=i.bind(null,e,t,n),i=void 0,!nc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function xv(n,e,t,r,i){var s=r;if((e&1)===0&&(e&2)===0&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=fr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}qS(function(){var u=s,c=Md(t),d=[];e:{var f=ov.get(n);if(f!==void 0){var p=Hd,h=n;switch(n){case"keypress":if(Xo(t)===0)break e;case"keydown":case"keyup":p=_T;break;case"focusin":h="focus",p=Wl;break;case"focusout":h="blur",p=Wl;break;case"beforeblur":case"afterblur":p=Wl;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Bh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=vT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=DT;break;case nv:case rv:case iv:p=xT;break;case sv:p=OT;break;case"scroll":p=gT;break;case"wheel":p=FT;break;case"copy":case"cut":case"paste":p=TT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=$h}var m=(e&4)!==0,g=!m&&n==="scroll",v=m?f!==null?f+"Capture":null:f;m=[];for(var y=u,E;y!==null;){E=y;var S=E.stateNode;if(E.tag===5&&S!==null&&(E=S,v!==null&&(S=As(y,v),S!=null&&m.push(_s(y,S,E)))),g)break;y=y.return}0<m.length&&(f=new p(f,h,null,t,c),d.push({event:f,listeners:m}))}}if((e&7)===0){e:{if(f=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",f&&(e&16)===0&&(h=t.relatedTarget||t.fromElement)&&(fr(h)||h[Ti]))break e;if((p||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,p?(h=t.relatedTarget||t.toElement,p=u,h=h?fr(h):null,h!==null&&(g=Lr(h),h!==g||h.tag!==5&&h.tag!==6)&&(h=null)):(p=null,h=u),p!==h)){if(m=Bh,S="onMouseLeave",v="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(m=$h,S="onPointerLeave",v="onPointerEnter",y="pointer"),g=p==null?f:Kr(p),E=h==null?f:Kr(h),f=new m(S,y+"leave",p,t,c),f.target=g,f.relatedTarget=E,S=null,fr(c)===u&&(m=new m(v,y+"enter",h,t,c),m.target=E,m.relatedTarget=g,S=m),g=S,p&&h)t:{for(m=p,v=h,y=0,E=m;E;E=wr(E))y++;for(E=0,S=v;S;S=wr(S))E++;for(;0<y-E;)m=wr(m),y--;for(;0<E-y;)v=wr(v),E--;for(;y--;){if(m===v||v!==null&&m===v.alternate)break t;m=wr(m),v=wr(v)}m=null}else m=null;p!==null&&ep(d,f,p,m,!1),h!==null&&g!==null&&ep(d,g,h,m,!0)}}e:{if(f=u?Kr(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var T=KT;else if(Kh(f))if(hv)T=zT;else{T=HT;var L=jT}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(T=WT);if(T&&(T=T(n,u))){fv(d,T,t,c);break e}L&&L(n,f,u),n==="focusout"&&(L=f._wrapperState)&&L.controlled&&f.type==="number"&&Yu(f,"number",f.value)}switch(L=u?Kr(u):window,n){case"focusin":(Kh(L)||L.contentEditable==="true")&&(Gr=L,ac=u,ss=null);break;case"focusout":ss=ac=Gr=null;break;case"mousedown":lc=!0;break;case"contextmenu":case"mouseup":case"dragend":lc=!1,qh(d,t,c);break;case"selectionchange":if(XT)break;case"keydown":case"keyup":qh(d,t,c)}var A;if(zd)e:{switch(n){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Vr?cv(n,t)&&(R="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(uv&&t.locale!=="ko"&&(Vr||R!=="onCompositionStart"?R==="onCompositionEnd"&&Vr&&(A=lv()):(Pn=c,jd="value"in Pn?Pn.value:Pn.textContent,Vr=!0)),L=xa(u,R),0<L.length&&(R=new Uh(R,n,null,t,c),d.push({event:R,listeners:L}),A?R.data=A:(A=dv(t),A!==null&&(R.data=A)))),(A=BT?UT(n,t):$T(n,t))&&(u=xa(u,"onBeforeInput"),0<u.length&&(c=new Uh("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=A))}vv(d,e)})}function _s(n,e,t){return{instance:n,listener:e,currentTarget:t}}function xa(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=As(n,t),s!=null&&r.unshift(_s(n,s,i)),s=As(n,e),s!=null&&r.push(_s(n,s,i))),n=n.return}return r}function wr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function ep(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=As(t,s),l!=null&&o.unshift(_s(t,l,a))):i||(l=As(t,s),l!=null&&o.push(_s(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}function Sa(){}var Xl=null,Ql=null;function Sv(n,e){switch(n){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function uc(n,e){return n==="textarea"||n==="option"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var tp=typeof setTimeout=="function"?setTimeout:void 0,QT=typeof clearTimeout=="function"?clearTimeout:void 0;function Yd(n){n.nodeType===1?n.textContent="":n.nodeType===9&&(n=n.body,n!=null&&(n.textContent=""))}function Jr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break}return n}function np(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Zl=0;function ZT(n){return{$$typeof:kd,toString:n,valueOf:n}}var vl=Math.random().toString(36).slice(2),Dn="__reactFiber$"+vl,Ta="__reactProps$"+vl,Ti="__reactContainer$"+vl,rp="__reactEvents$"+vl;function fr(n){var e=n[Dn];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ti]||t[Dn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=np(n);n!==null;){if(t=n[Dn])return t;n=np(n)}return e}n=t,t=n.parentNode}return null}function Zs(n){return n=n[Dn]||n[Ti],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Kr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Y(33))}function yl(n){return n[Ta]||null}function Tv(n){var e=n[rp];return e===void 0&&(e=n[rp]=new Set),e}var cc=[],jr=-1;function er(n){return{current:n}}function Ae(n){0>jr||(n.current=cc[jr],cc[jr]=null,jr--)}function we(n,e){jr++,cc[jr]=n.current,n.current=e}var qn={},rt=er(qn),ft=er(!1),yr=qn;function fi(n,e){var t=n.type.contextTypes;if(!t)return qn;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ht(n){return n=n.childContextTypes,n!=null}function Aa(){Ae(ft),Ae(rt)}function ip(n,e,t){if(rt.current!==qn)throw Error(Y(168));we(rt,e),we(ft,t)}function Av(n,e,t){var r=n.stateNode;if(n=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in n))throw Error(Y(108,qr(e)||"Unknown",i));return Le({},t,r)}function Qo(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||qn,yr=rt.current,we(rt,n),we(ft,ft.current),!0}function sp(n,e,t){var r=n.stateNode;if(!r)throw Error(Y(169));t?(n=Av(n,e,yr),r.__reactInternalMemoizedMergedChildContext=n,Ae(ft),Ae(rt),we(rt,n)):Ae(ft),we(ft,t)}var qd=null,mr=null,JT=He.unstable_runWithPriority,Xd=He.unstable_scheduleCallback,dc=He.unstable_cancelCallback,e1=He.unstable_shouldYield,op=He.unstable_requestPaint,fc=He.unstable_now,t1=He.unstable_getCurrentPriorityLevel,El=He.unstable_ImmediatePriority,Lv=He.unstable_UserBlockingPriority,Iv=He.unstable_NormalPriority,Rv=He.unstable_LowPriority,bv=He.unstable_IdlePriority,Jl={},n1=op!==void 0?op:function(){},fn=null,Zo=null,eu=!1,ap=fc(),tt=1e4>ap?fc:function(){return fc()-ap};function hi(){switch(t1()){case El:return 99;case Lv:return 98;case Iv:return 97;case Rv:return 96;case bv:return 95;default:throw Error(Y(332))}}function Cv(n){switch(n){case 99:return El;case 98:return Lv;case 97:return Iv;case 96:return Rv;case 95:return bv;default:throw Error(Y(332))}}function Er(n,e){return n=Cv(n),JT(n,e)}function ws(n,e,t){return n=Cv(n),Xd(n,e,t)}function sn(){if(Zo!==null){var n=Zo;Zo=null,dc(n)}_v()}function _v(){if(!eu&&fn!==null){eu=!0;var n=0;try{var e=fn;Er(99,function(){for(;n<e.length;n++){var t=e[n];do t=t(!0);while(t!==null)}}),fn=null}catch(t){throw fn!==null&&(fn=fn.slice(n+1)),Xd(El,sn),t}finally{eu=!1}}}var r1=Ar.ReactCurrentBatchConfig;function Nt(n,e){if(n&&n.defaultProps){e=Le({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var La=er(null),Ia=null,Hr=null,Ra=null;function Qd(){Ra=Hr=Ia=null}function Zd(n){var e=La.current;Ae(La),n.type._context._currentValue=e}function wv(n,e){for(;n!==null;){var t=n.alternate;if((n.childLanes&e)===e){if(t===null||(t.childLanes&e)===e)break;t.childLanes|=e}else n.childLanes|=e,t!==null&&(t.childLanes|=e);n=n.return}}function ei(n,e){Ia=n,Ra=Hr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&e)!==0&&(Ut=!0),n.firstContext=null)}function It(n,e){if(Ra!==n&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Ra=n,e=1073741823),e={context:n,observedBits:e,next:null},Hr===null){if(Ia===null)throw Error(Y(308));Hr=e,Ia.dependencies={lanes:0,firstContext:e,responders:null}}else Hr=Hr.next=e;return n._currentValue}var Rn=!1;function Jd(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Pv(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function $n(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Vn(n,e){if(n=n.updateQueue,n!==null){n=n.shared;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}}function lp(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ps(n,e,t,r){var i=n.updateQueue;Rn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=n.alternate;if(c!==null){c=c.updateQueue;var d=c.lastBaseUpdate;d!==o&&(d===null?c.firstBaseUpdate=u:d.next=u,c.lastBaseUpdate=l)}}if(s!==null){d=i.baseState,o=0,c=u=l=null;do{a=s.lane;var f=s.eventTime;if((r&a)===a){c!==null&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=n,h=s;switch(a=e,f=t,h.tag){case 1:if(p=h.payload,typeof p=="function"){d=p.call(f,d,a);break e}d=p;break e;case 3:p.flags=p.flags&-4097|64;case 0:if(p=h.payload,a=typeof p=="function"?p.call(f,d,a):p,a==null)break e;d=Le({},d,a);break e;case 2:Rn=!0}}s.callback!==null&&(n.flags|=32,a=i.effects,a===null?i.effects=[s]:a.push(s))}else f={eventTime:f,lane:a,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,o|=a;if(s=s.next,s===null){if(a=i.shared.pending,a===null)break;s=a.next,a.next=null,i.lastBaseUpdate=a,i.shared.pending=null}}while(1);c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,eo|=o,n.lanes=o,n.memoizedState=d}}function up(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Y(191,i));i.call(r)}}}var Dv=new cl.Component().refs;function ba(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Le({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var xl={isMounted:function(n){return(n=n._reactInternals)?Lr(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=yt(),i=Gn(n),s=$n(r,i);s.payload=e,t!=null&&(s.callback=t),Vn(n,s),Kn(n,i,r)},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=yt(),i=Gn(n),s=$n(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),Vn(n,s),Kn(n,i,r)},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=yt(),r=Gn(n),i=$n(t,r);i.tag=2,e!=null&&(i.callback=e),Vn(n,i),Kn(n,r,t)}};function cp(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Cs(t,r)||!Cs(i,s):!0}function kv(n,e,t){var r=!1,i=qn,s=e.contextType;return typeof s=="object"&&s!==null?s=It(s):(i=ht(e)?yr:rt.current,r=e.contextTypes,s=(r=r!=null)?fi(n,i):qn),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=xl,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function dp(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&xl.enqueueReplaceState(e,e.state,null)}function hc(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=Dv,Jd(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=It(s):(s=ht(e)?yr:rt.current,i.context=fi(n,s)),Ps(n,t,i,r),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ba(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&xl.enqueueReplaceState(i,i.state,null),Ps(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4)}var Eo=Array.isArray;function Fi(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Y(309));var r=t.stateNode}if(!r)throw Error(Y(147,n));var i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var o=r.refs;o===Dv&&(o=r.refs={}),s===null?delete o[i]:o[i]=s},e._stringRef=i,e)}if(typeof n!="string")throw Error(Y(284));if(!t._owner)throw Error(Y(290,n))}return n}function xo(n,e){if(n.type!=="textarea")throw Error(Y(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function Ov(n){function e(g,v){if(n){var y=g.lastEffect;y!==null?(y.nextEffect=v,g.lastEffect=v):g.firstEffect=g.lastEffect=v,v.nextEffect=null,v.flags=8}}function t(g,v){if(!n)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function i(g,v){return g=Qn(g,v),g.index=0,g.sibling=null,g}function s(g,v,y){return g.index=y,n?(y=g.alternate,y!==null?(y=y.index,y<v?(g.flags=2,v):y):(g.flags=2,v)):v}function o(g){return n&&g.alternate===null&&(g.flags=2),g}function a(g,v,y,E){return v===null||v.tag!==6?(v=su(y,g.mode,E),v.return=g,v):(v=i(v,y),v.return=g,v)}function l(g,v,y,E){return v!==null&&v.elementType===y.type?(E=i(v,y.props),E.ref=Fi(g,v,y),E.return=g,E):(E=na(y.type,y.key,y.props,null,g.mode,E),E.ref=Fi(g,v,y),E.return=g,E)}function u(g,v,y,E){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=ou(y,g.mode,E),v.return=g,v):(v=i(v,y.children||[]),v.return=g,v)}function c(g,v,y,E,S){return v===null||v.tag!==7?(v=ii(y,g.mode,E,S),v.return=g,v):(v=i(v,y),v.return=g,v)}function d(g,v,y){if(typeof v=="string"||typeof v=="number")return v=su(""+v,g.mode,y),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Hi:return y=na(v.type,v.key,v.props,null,g.mode,y),y.ref=Fi(g,null,v),y.return=g,y;case cr:return v=ou(v,g.mode,y),v.return=g,v}if(Eo(v)||wi(v))return v=ii(v,g.mode,y,null),v.return=g,v;xo(g,v)}return null}function f(g,v,y,E){var S=v!==null?v.key:null;if(typeof y=="string"||typeof y=="number")return S!==null?null:a(g,v,""+y,E);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Hi:return y.key===S?y.type===wn?c(g,v,y.props.children,E,S):l(g,v,y,E):null;case cr:return y.key===S?u(g,v,y,E):null}if(Eo(y)||wi(y))return S!==null?null:c(g,v,y,E,null);xo(g,y)}return null}function p(g,v,y,E,S){if(typeof E=="string"||typeof E=="number")return g=g.get(y)||null,a(v,g,""+E,S);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Hi:return g=g.get(E.key===null?y:E.key)||null,E.type===wn?c(v,g,E.props.children,S,E.key):l(v,g,E,S);case cr:return g=g.get(E.key===null?y:E.key)||null,u(v,g,E,S)}if(Eo(E)||wi(E))return g=g.get(y)||null,c(v,g,E,S,null);xo(v,E)}return null}function h(g,v,y,E){for(var S=null,T=null,L=v,A=v=0,R=null;L!==null&&A<y.length;A++){L.index>A?(R=L,L=null):R=L.sibling;var I=f(g,L,y[A],E);if(I===null){L===null&&(L=R);break}n&&L&&I.alternate===null&&e(g,L),v=s(I,v,A),T===null?S=I:T.sibling=I,T=I,L=R}if(A===y.length)return t(g,L),S;if(L===null){for(;A<y.length;A++)L=d(g,y[A],E),L!==null&&(v=s(L,v,A),T===null?S=L:T.sibling=L,T=L);return S}for(L=r(g,L);A<y.length;A++)R=p(L,g,A,y[A],E),R!==null&&(n&&R.alternate!==null&&L.delete(R.key===null?A:R.key),v=s(R,v,A),T===null?S=R:T.sibling=R,T=R);return n&&L.forEach(function(b){return e(g,b)}),S}function m(g,v,y,E){var S=wi(y);if(typeof S!="function")throw Error(Y(150));if(y=S.call(y),y==null)throw Error(Y(151));for(var T=S=null,L=v,A=v=0,R=null,I=y.next();L!==null&&!I.done;A++,I=y.next()){L.index>A?(R=L,L=null):R=L.sibling;var b=f(g,L,I.value,E);if(b===null){L===null&&(L=R);break}n&&L&&b.alternate===null&&e(g,L),v=s(b,v,A),T===null?S=b:T.sibling=b,T=b,L=R}if(I.done)return t(g,L),S;if(L===null){for(;!I.done;A++,I=y.next())I=d(g,I.value,E),I!==null&&(v=s(I,v,A),T===null?S=I:T.sibling=I,T=I);return S}for(L=r(g,L);!I.done;A++,I=y.next())I=p(L,g,A,I.value,E),I!==null&&(n&&I.alternate!==null&&L.delete(I.key===null?A:I.key),v=s(I,v,A),T===null?S=I:T.sibling=I,T=I);return n&&L.forEach(function(O){return e(g,O)}),S}return function(g,v,y,E){var S=typeof y=="object"&&y!==null&&y.type===wn&&y.key===null;S&&(y=y.props.children);var T=typeof y=="object"&&y!==null;if(T)switch(y.$$typeof){case Hi:e:{for(T=y.key,S=v;S!==null;){if(S.key===T){switch(S.tag){case 7:if(y.type===wn){t(g,S.sibling),v=i(S,y.props.children),v.return=g,g=v;break e}break;default:if(S.elementType===y.type){t(g,S.sibling),v=i(S,y.props),v.ref=Fi(g,S,y),v.return=g,g=v;break e}}t(g,S);break}else e(g,S);S=S.sibling}y.type===wn?(v=ii(y.props.children,g.mode,E,y.key),v.return=g,g=v):(E=na(y.type,y.key,y.props,null,g.mode,E),E.ref=Fi(g,v,y),E.return=g,g=E)}return o(g);case cr:e:{for(S=y.key;v!==null;){if(v.key===S)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){t(g,v.sibling),v=i(v,y.children||[]),v.return=g,g=v;break e}else{t(g,v);break}else e(g,v);v=v.sibling}v=ou(y,g.mode,E),v.return=g,g=v}return o(g)}if(typeof y=="string"||typeof y=="number")return y=""+y,v!==null&&v.tag===6?(t(g,v.sibling),v=i(v,y),v.return=g,g=v):(t(g,v),v=su(y,g.mode,E),v.return=g,g=v),o(g);if(Eo(y))return h(g,v,y,E);if(wi(y))return m(g,v,y,E);if(T&&xo(g,y),typeof y=="undefined"&&!S)switch(g.tag){case 1:case 22:case 0:case 11:case 15:throw Error(Y(152,qr(g.type)||"Component"))}return t(g,v)}}var Ca=Ov(!0),Mv=Ov(!1),Js={},Jt=er(Js),Ds=er(Js),ks=er(Js);function hr(n){if(n===Js)throw Error(Y(174));return n}function pc(n,e){switch(we(ks,e),we(Ds,n),we(Jt,Js),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Zu(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Zu(e,n)}Ae(Jt),we(Jt,e)}function pi(){Ae(Jt),Ae(Ds),Ae(ks)}function fp(n){hr(ks.current);var e=hr(Jt.current),t=Zu(e,n.type);e!==t&&(we(Ds,n),we(Jt,t))}function ef(n){Ds.current===n&&(Ae(Jt),Ae(Ds))}var _e=er(0);function _a(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var pn=null,kn=null,en=!1;function Fv(n,e){var t=At(5,null,null,0);t.elementType="DELETED",t.type="DELETED",t.stateNode=e,t.return=n,t.flags=8,n.lastEffect!==null?(n.lastEffect.nextEffect=t,n.lastEffect=t):n.firstEffect=n.lastEffect=t}function hp(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function gc(n){if(en){var e=kn;if(e){var t=e;if(!hp(n,e)){if(e=Jr(t.nextSibling),!e||!hp(n,e)){n.flags=n.flags&-1025|2,en=!1,pn=n;return}Fv(pn,t)}pn=n,kn=Jr(e.firstChild)}else n.flags=n.flags&-1025|2,en=!1,pn=n}}function pp(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;pn=n}function So(n){if(n!==pn)return!1;if(!en)return pp(n),en=!0,!1;var e=n.type;if(n.tag!==5||e!=="head"&&e!=="body"&&!uc(e,n.memoizedProps))for(e=kn;e;)Fv(n,e),e=Jr(e.nextSibling);if(pp(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Y(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){kn=Jr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}kn=null}}else kn=pn?Jr(n.stateNode.nextSibling):null;return!0}function tu(){kn=pn=null,en=!1}var ti=[];function tf(){for(var n=0;n<ti.length;n++)ti[n]._workInProgressVersionPrimary=null;ti.length=0}var os=Ar.ReactCurrentDispatcher,Lt=Ar.ReactCurrentBatchConfig,Os=0,Fe=null,et=null,ze=null,wa=!1,as=!1;function lt(){throw Error(Y(321))}function nf(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Tt(n[t],e[t]))return!1;return!0}function rf(n,e,t,r,i,s){if(Os=s,Fe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,os.current=n===null||n.memoizedState===null?s1:o1,n=t(r,i),as){s=0;do{if(as=!1,!(25>s))throw Error(Y(301));s+=1,ze=et=null,e.updateQueue=null,os.current=a1,n=t(r,i)}while(as)}if(os.current=Oa,e=et!==null&&et.next!==null,Os=0,ze=et=Fe=null,wa=!1,e)throw Error(Y(300));return n}function pr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ze===null?Fe.memoizedState=ze=n:ze=ze.next=n,ze}function Ir(){if(et===null){var n=Fe.alternate;n=n!==null?n.memoizedState:null}else n=et.next;var e=ze===null?Fe.memoizedState:ze.next;if(e!==null)ze=e,et=n;else{if(n===null)throw Error(Y(310));et=n,n={memoizedState:et.memoizedState,baseState:et.baseState,baseQueue:et.baseQueue,queue:et.queue,next:null},ze===null?Fe.memoizedState=ze=n:ze=ze.next=n}return ze}function qt(n,e){return typeof e=="function"?e(n):e}function Ni(n){var e=Ir(),t=e.queue;if(t===null)throw Error(Y(311));t.lastRenderedReducer=n;var r=et,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){i=i.next,r=r.baseState;var a=o=s=null,l=i;do{var u=l.lane;if((Os&u)===u)a!==null&&(a=a.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===n?l.eagerState:n(r,l.action);else{var c={lane:u,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};a===null?(o=a=c,s=r):a=a.next=c,Fe.lanes|=u,eo|=u}l=l.next}while(l!==null&&l!==i);a===null?s=r:a.next=o,Tt(r,e.memoizedState)||(Ut=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=a,t.lastRenderedState=r}return[e.memoizedState,t.dispatch]}function Bi(n){var e=Ir(),t=e.queue;if(t===null)throw Error(Y(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);Tt(s,e.memoizedState)||(Ut=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function gp(n,e,t){var r=e._getVersion;r=r(e._source);var i=e._workInProgressVersionPrimary;if(i!==null?n=i===r:(n=n.mutableReadLanes,(n=(Os&n)===n)&&(e._workInProgressVersionPrimary=r,ti.push(e))),n)return t(e._source);throw ti.push(e),Error(Y(350))}function Nv(n,e,t,r){var i=ot;if(i===null)throw Error(Y(349));var s=e._getVersion,o=s(e._source),a=os.current,l=a.useState(function(){return gp(i,e,t)}),u=l[1],c=l[0];l=ze;var d=n.memoizedState,f=d.refs,p=f.getSnapshot,h=d.source;d=d.subscribe;var m=Fe;return n.memoizedState={refs:f,source:e,subscribe:r},a.useEffect(function(){f.getSnapshot=t,f.setSnapshot=u;var g=s(e._source);if(!Tt(o,g)){g=t(e._source),Tt(c,g)||(u(g),g=Gn(m),i.mutableReadLanes|=g&i.pendingLanes),g=i.mutableReadLanes,i.entangledLanes|=g;for(var v=i.entanglements,y=g;0<y;){var E=31-Yn(y),S=1<<E;v[E]|=g,y&=~S}}},[t,e,r]),a.useEffect(function(){return r(e._source,function(){var g=f.getSnapshot,v=f.setSnapshot;try{v(g(e._source));var y=Gn(m);i.mutableReadLanes|=y&i.pendingLanes}catch(E){v(function(){throw E})}})},[e,r]),Tt(p,t)&&Tt(h,e)&&Tt(d,r)||(n={pending:null,dispatch:null,lastRenderedReducer:qt,lastRenderedState:c},n.dispatch=u=af.bind(null,Fe,n),l.queue=n,l.baseQueue=null,c=gp(i,e,t),l.memoizedState=l.baseState=c),c}function Bv(n,e,t){var r=Ir();return Nv(r,n,e,t)}function Ui(n){var e=pr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n=e.queue={pending:null,dispatch:null,lastRenderedReducer:qt,lastRenderedState:n},n=n.dispatch=af.bind(null,Fe,n),[e.memoizedState,n]}function Pa(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Fe.updateQueue,e===null?(e={lastEffect:null},Fe.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function mp(n){var e=pr();return n={current:n},e.memoizedState=n}function Da(){return Ir().memoizedState}function mc(n,e,t,r){var i=pr();Fe.flags|=n,i.memoizedState=Pa(1|e,t,void 0,r===void 0?null:r)}function sf(n,e,t,r){var i=Ir();r=r===void 0?null:r;var s=void 0;if(et!==null){var o=et.memoizedState;if(s=o.destroy,r!==null&&nf(r,o.deps)){Pa(e,t,s,r);return}}Fe.flags|=n,i.memoizedState=Pa(1|e,t,s,r)}function vp(n,e){return mc(516,4,n,e)}function ka(n,e){return sf(516,4,n,e)}function Uv(n,e){return sf(4,2,n,e)}function $v(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Vv(n,e,t){return t=t!=null?t.concat([n]):null,sf(4,2,$v.bind(null,e,n),t)}function of(){}function Gv(n,e){var t=Ir();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&nf(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Kv(n,e){var t=Ir();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&nf(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function i1(n,e){var t=hi();Er(98>t?98:t,function(){n(!0)}),Er(97<t?97:t,function(){var r=Lt.transition;Lt.transition=1;try{n(!1),e()}finally{Lt.transition=r}})}function af(n,e,t){var r=yt(),i=Gn(n),s={lane:i,action:t,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(o===null?s.next=s:(s.next=o.next,o.next=s),e.pending=s,o=n.alternate,n===Fe||o!==null&&o===Fe)as=wa=!0;else{if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,l=o(a,t);if(s.eagerReducer=o,s.eagerState=l,Tt(l,a))return}catch{}finally{}Kn(n,i,r)}}var Oa={readContext:It,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useLayoutEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useMutableSource:lt,useOpaqueIdentifier:lt,unstable_isNewReconciler:!1},s1={readContext:It,useCallback:function(n,e){return pr().memoizedState=[n,e===void 0?null:e],n},useContext:It,useEffect:vp,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,mc(4,2,$v.bind(null,e,n),t)},useLayoutEffect:function(n,e){return mc(4,2,n,e)},useMemo:function(n,e){var t=pr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=pr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n=r.queue={pending:null,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},n=n.dispatch=af.bind(null,Fe,n),[r.memoizedState,n]},useRef:mp,useState:Ui,useDebugValue:of,useDeferredValue:function(n){var e=Ui(n),t=e[0],r=e[1];return vp(function(){var i=Lt.transition;Lt.transition=1;try{r(n)}finally{Lt.transition=i}},[n]),t},useTransition:function(){var n=Ui(!1),e=n[0];return n=i1.bind(null,n[1]),mp(n),[n,e]},useMutableSource:function(n,e,t){var r=pr();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:n,subscribe:t},Nv(r,n,e,t)},useOpaqueIdentifier:function(){if(en){var n=!1,e=ZT(function(){throw n||(n=!0,t("r:"+(Zl++).toString(36))),Error(Y(355))}),t=Ui(e)[1];return(Fe.mode&2)===0&&(Fe.flags|=516,Pa(5,function(){t("r:"+(Zl++).toString(36))},void 0,null)),e}return e="r:"+(Zl++).toString(36),Ui(e),e},unstable_isNewReconciler:!1},o1={readContext:It,useCallback:Gv,useContext:It,useEffect:ka,useImperativeHandle:Vv,useLayoutEffect:Uv,useMemo:Kv,useReducer:Ni,useRef:Da,useState:function(){return Ni(qt)},useDebugValue:of,useDeferredValue:function(n){var e=Ni(qt),t=e[0],r=e[1];return ka(function(){var i=Lt.transition;Lt.transition=1;try{r(n)}finally{Lt.transition=i}},[n]),t},useTransition:function(){var n=Ni(qt)[0];return[Da().current,n]},useMutableSource:Bv,useOpaqueIdentifier:function(){return Ni(qt)[0]},unstable_isNewReconciler:!1},a1={readContext:It,useCallback:Gv,useContext:It,useEffect:ka,useImperativeHandle:Vv,useLayoutEffect:Uv,useMemo:Kv,useReducer:Bi,useRef:Da,useState:function(){return Bi(qt)},useDebugValue:of,useDeferredValue:function(n){var e=Bi(qt),t=e[0],r=e[1];return ka(function(){var i=Lt.transition;Lt.transition=1;try{r(n)}finally{Lt.transition=i}},[n]),t},useTransition:function(){var n=Bi(qt)[0];return[Da().current,n]},useMutableSource:Bv,useOpaqueIdentifier:function(){return Bi(qt)[0]},unstable_isNewReconciler:!1},l1=Ar.ReactCurrentOwner,Ut=!1;function ct(n,e,t,r){e.child=n===null?Mv(e,null,t,r):Ca(e,n.child,t,r)}function yp(n,e,t,r,i){t=t.render;var s=e.ref;return ei(e,i),r=rf(n,e,t,r,s,i),n!==null&&!Ut?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~i,gn(n,e,i)):(e.flags|=1,ct(n,e,r,i),e.child)}function Ep(n,e,t,r,i,s){if(n===null){var o=t.type;return typeof o=="function"&&!hf(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,jv(n,e,o,r,i,s)):(n=na(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}return o=n.child,(i&s)===0&&(i=o.memoizedProps,t=t.compare,t=t!==null?t:Cs,t(i,r)&&n.ref===e.ref)?gn(n,e,s):(e.flags|=1,n=Qn(o,r),n.ref=e.ref,n.return=e,e.child=n)}function jv(n,e,t,r,i,s){if(n!==null&&Cs(n.memoizedProps,r)&&n.ref===e.ref)if(Ut=!1,(s&i)!==0)(n.flags&16384)!==0&&(Ut=!0);else return e.lanes=n.lanes,gn(n,e,s);return vc(n,e,t,r,s)}function nu(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((e.mode&4)===0)e.memoizedState={baseLanes:0},Ao(e,t);else if((t&1073741824)!==0)e.memoizedState={baseLanes:0},Ao(e,s!==null?s.baseLanes:t);else return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n},Ao(e,n),null;else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Ao(e,r);return ct(n,e,i,t),e.child}function Hv(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=128)}function vc(n,e,t,r,i){var s=ht(t)?yr:rt.current;return s=fi(e,s),ei(e,i),t=rf(n,e,t,r,s,i),n!==null&&!Ut?(e.updateQueue=n.updateQueue,e.flags&=-517,n.lanes&=~i,gn(n,e,i)):(e.flags|=1,ct(n,e,t,i),e.child)}function xp(n,e,t,r,i){if(ht(t)){var s=!0;Qo(e)}else s=!1;if(ei(e,i),e.stateNode===null)n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),kv(e,t,r),hc(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=It(u):(u=ht(t)?yr:rt.current,u=fi(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&dp(e,o,r,u),Rn=!1;var f=e.memoizedState;o.state=f,Ps(e,r,o,i),l=e.memoizedState,a!==r||f!==l||ft.current||Rn?(typeof c=="function"&&(ba(e,t,c,r),l=e.memoizedState),(a=Rn||cp(e,t,a,r,f,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4)):(typeof o.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4),r=!1)}else{o=e.stateNode,Pv(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Nt(e.type,a),o.props=u,d=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=It(l):(l=ht(t)?yr:rt.current,l=fi(e,l));var p=t.getDerivedStateFromProps;(c=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&dp(e,o,r,l),Rn=!1,f=e.memoizedState,o.state=f,Ps(e,r,o,i);var h=e.memoizedState;a!==d||f!==h||ft.current||Rn?(typeof p=="function"&&(ba(e,t,p,r),h=e.memoizedState),(u=Rn||cp(e,t,u,r,f,h,l))?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,h,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,h,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=h),o.props=r,o.state=h,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=256),r=!1)}return yc(n,e,t,r,s,i)}function yc(n,e,t,r,i,s){Hv(n,e);var o=(e.flags&64)!==0;if(!r&&!o)return i&&sp(e,t,!1),gn(n,e,s);r=e.stateNode,l1.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Ca(e,n.child,null,s),e.child=Ca(e,null,a,s)):ct(n,e,a,s),e.memoizedState=r.state,i&&sp(e,t,!0),e.child}function Sp(n){var e=n.stateNode;e.pendingContext?ip(n,e.pendingContext,e.pendingContext!==e.context):e.context&&ip(n,e.context,!1),pc(n,e.containerInfo)}var To={dehydrated:null,retryLane:0};function Tp(n,e,t){var r=e.pendingProps,i=_e.current,s=!1,o;return(o=(e.flags&64)!==0)||(o=n!==null&&n.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-65):n!==null&&n.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(i|=1),we(_e,i&1),n===null?(r.fallback!==void 0&&gc(e),n=r.children,i=r.fallback,s?(n=Ap(e,n,i,t),e.child.memoizedState={baseLanes:t},e.memoizedState=To,n):typeof r.unstable_expectedLoadTime=="number"?(n=Ap(e,n,i,t),e.child.memoizedState={baseLanes:t},e.memoizedState=To,e.lanes=33554432,n):(t=pf({mode:"visible",children:n},e.mode,t,null),t.return=e,e.child=t)):n.memoizedState!==null?s?(r=Ip(n,e,r.children,r.fallback,t),s=e.child,i=n.child.memoizedState,s.memoizedState=i===null?{baseLanes:t}:{baseLanes:i.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=To,r):(t=Lp(n,e,r.children,t),e.memoizedState=null,t):s?(r=Ip(n,e,r.children,r.fallback,t),s=e.child,i=n.child.memoizedState,s.memoizedState=i===null?{baseLanes:t}:{baseLanes:i.baseLanes|t},s.childLanes=n.childLanes&~t,e.memoizedState=To,r):(t=Lp(n,e,r.children,t),e.memoizedState=null,t)}function Ap(n,e,t,r){var i=n.mode,s=n.child;return e={mode:"hidden",children:e},(i&2)===0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=pf(e,i,0,null),t=ii(t,i,r,null),s.return=n,t.return=n,s.sibling=t,n.child=s,t}function Lp(n,e,t,r){var i=n.child;return n=i.sibling,t=Qn(i,{mode:"visible",children:t}),(e.mode&2)===0&&(t.lanes=r),t.return=e,t.sibling=null,n!==null&&(n.nextEffect=null,n.flags=8,e.firstEffect=e.lastEffect=n),e.child=t}function Ip(n,e,t,r,i){var s=e.mode,o=n.child;n=o.sibling;var a={mode:"hidden",children:t};return(s&2)===0&&e.child!==o?(t=e.child,t.childLanes=0,t.pendingProps=a,o=t.lastEffect,o!==null?(e.firstEffect=t.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):t=Qn(o,a),n!==null?r=Qn(n,r):(r=ii(r,s,i,null),r.flags|=2),r.return=e,t.return=e,t.sibling=r,e.child=t,r}function Rp(n,e){n.lanes|=e;var t=n.alternate;t!==null&&(t.lanes|=e),wv(n.return,e)}function ru(n,e,t,r,i,s){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i,lastEffect:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i,o.lastEffect=s)}function bp(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(ct(n,e,r.children,t),r=_e.current,(r&2)!==0)r=r&1|2,e.flags|=64;else{if(n!==null&&(n.flags&64)!==0)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Rp(n,t);else if(n.tag===19)Rp(n,t);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(we(_e,r),(e.mode&2)===0)e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&_a(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),ru(e,!1,i,t,s,e.lastEffect);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&_a(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}ru(e,!0,t,null,s,e.lastEffect);break;case"together":ru(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function gn(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),eo|=e.lanes,(t&e.childLanes)!==0){if(n!==null&&e.child!==n.child)throw Error(Y(153));if(e.child!==null){for(n=e.child,t=Qn(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Qn(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}return null}var Wv,Ec,zv,Yv;Wv=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Ec=function(){};zv=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,hr(Jt.current);var s=null;switch(t){case"input":i=Wu(n,i),r=Wu(n,r),s=[];break;case"option":i=qu(n,i),r=qu(n,r),s=[];break;case"select":i=Le({},i,{value:void 0}),r=Le({},r,{value:void 0}),s=[];break;case"textarea":i=Xu(n,i),r=Xu(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Sa)}Ju(t,r);var o;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ss.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ss.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Te("scroll",n),s||a===l||(s=[])):typeof l=="object"&&l!==null&&l.$$typeof===kd?l.toString():(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};Yv=function(n,e,t,r){t!==r&&(e.flags|=4)};function $i(n,e){if(!en)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function u1(n,e,t){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return ht(e.type)&&Aa(),null;case 3:return pi(),Ae(ft),Ae(rt),tf(),r=e.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(So(e)?e.flags|=4:r.hydrate||(e.flags|=256)),Ec(e),null;case 5:ef(e);var i=hr(ks.current);if(t=e.type,n!==null&&e.stateNode!=null)zv(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=128);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return null}if(n=hr(Jt.current),So(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[Dn]=e,r[Ta]=s,t){case"dialog":Te("cancel",r),Te("close",r);break;case"iframe":case"object":case"embed":Te("load",r);break;case"video":case"audio":for(n=0;n<zi.length;n++)Te(zi[n],r);break;case"source":Te("error",r);break;case"img":case"image":case"link":Te("error",r),Te("load",r);break;case"details":Te("toggle",r);break;case"input":bh(r,s),Te("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Te("invalid",r);break;case"textarea":_h(r,s),Te("invalid",r)}Ju(t,s),n=null;for(var o in s)s.hasOwnProperty(o)&&(i=s[o],o==="children"?typeof i=="string"?r.textContent!==i&&(n=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(n=["children",""+i]):Ss.hasOwnProperty(o)&&i!=null&&o==="onScroll"&&Te("scroll",r));switch(t){case"input":go(r),Ch(r,s,!0);break;case"textarea":go(r),wh(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Sa)}r=n,e.updateQueue=r,r!==null&&(e.flags|=4)}else{switch(o=i.nodeType===9?i:i.ownerDocument,n===Qu.html&&(n=V0(t)),n===Qu.html?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Dn]=e,n[Ta]=r,Wv(n,e,!1,!1),e.stateNode=n,o=ec(t,r),t){case"dialog":Te("cancel",n),Te("close",n),i=r;break;case"iframe":case"object":case"embed":Te("load",n),i=r;break;case"video":case"audio":for(i=0;i<zi.length;i++)Te(zi[i],n);i=r;break;case"source":Te("error",n),i=r;break;case"img":case"image":case"link":Te("error",n),Te("load",n),i=r;break;case"details":Te("toggle",n),i=r;break;case"input":bh(n,r),i=Wu(n,r),Te("invalid",n);break;case"option":i=qu(n,r);break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Le({},r,{value:void 0}),Te("invalid",n);break;case"textarea":_h(n,r),i=Xu(n,r),Te("invalid",n);break;default:i=r}Ju(t,i);var a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?j0(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&G0(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Ts(n,l):typeof l=="number"&&Ts(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ss.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Te("scroll",n):l!=null&&bd(n,s,l,o))}switch(t){case"input":go(n),Ch(n,r,!1);break;case"textarea":go(n),wh(n);break;case"option":r.value!=null&&n.setAttribute("value",""+zn(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Xr(n,!!r.multiple,s,!1):r.defaultValue!=null&&Xr(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Sa)}Sv(t,r)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(n&&e.stateNode!=null)Yv(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));t=hr(ks.current),hr(Jt.current),So(e)?(r=e.stateNode,t=e.memoizedProps,r[Dn]=e,r.nodeValue!==t&&(e.flags|=4)):(r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Dn]=e,e.stateNode=r)}return null;case 13:return Ae(_e),r=e.memoizedState,(e.flags&64)!==0?(e.lanes=t,e):(r=r!==null,t=!1,n===null?e.memoizedProps.fallback!==void 0&&So(e):t=n.memoizedState!==null,r&&!t&&(e.mode&2)!==0&&(n===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(_e.current&1)!==0?qe===0&&(qe=3):((qe===0||qe===3)&&(qe=4),ot===null||(eo&134217727)===0&&(Li&134217727)===0||ni(ot,nt))),(r||t)&&(e.flags|=4),null);case 4:return pi(),Ec(e),n===null&&yv(e.stateNode.containerInfo),null;case 10:return Zd(e),null;case 17:return ht(e.type)&&Aa(),null;case 19:if(Ae(_e),r=e.memoizedState,r===null)return null;if(s=(e.flags&64)!==0,o=r.rendering,o===null)if(s)$i(r,!1);else{if(qe!==0||n!==null&&(n.flags&64)!==0)for(n=e.child;n!==null;){if(o=_a(n),o!==null){for(e.flags|=64,$i(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),r.lastEffect===null&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return we(_e,_e.current&1|2),e.child}n=n.sibling}r.tail!==null&&tt()>Ic&&(e.flags|=64,s=!0,$i(r,!1),e.lanes=33554432)}else{if(!s)if(n=_a(o),n!==null){if(e.flags|=64,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),$i(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!en)return e=e.lastEffect=r.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*tt()-r.renderingStartTime>Ic&&t!==1073741824&&(e.flags|=64,s=!0,$i(r,!1),e.lanes=33554432);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=tt(),t.sibling=null,e=_e.current,we(_e,s?e&1|2:e&1),t):null;case 23:case 24:return ff(),n!==null&&n.memoizedState!==null!=(e.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(Y(156,e.tag))}function c1(n){switch(n.tag){case 1:ht(n.type)&&Aa();var e=n.flags;return e&4096?(n.flags=e&-4097|64,n):null;case 3:if(pi(),Ae(ft),Ae(rt),tf(),e=n.flags,(e&64)!==0)throw Error(Y(285));return n.flags=e&-4097|64,n;case 5:return ef(n),null;case 13:return Ae(_e),e=n.flags,e&4096?(n.flags=e&-4097|64,n):null;case 19:return Ae(_e),null;case 4:return pi(),null;case 10:return Zd(n),null;case 23:case 24:return ff(),null;default:return null}}function lf(n,e){try{var t="",r=e;do t+=jS(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i}}function xc(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var d1=typeof WeakMap=="function"?WeakMap:Map;function qv(n,e,t){t=$n(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Fa||(Fa=!0,Rc=r),xc(n,e)},t}function Xv(n,e,t){t=$n(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return xc(n,e),r(i)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){typeof r!="function"&&(Xt===null?Xt=new Set([this]):Xt.add(this),xc(n,e));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}var f1=typeof WeakSet=="function"?WeakSet:Set;function Cp(n){var e=n.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(t){jn(n,t)}else e.current=null}function h1(n,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&n!==null){var t=n.memoizedProps,r=n.memoizedState;n=e.stateNode,e=n.getSnapshotBeforeUpdate(e.elementType===e.type?t:Nt(e.type,t),r),n.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&Yd(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(Y(163))}function p1(n,e,t){switch(t.tag){case 0:case 11:case 15:case 22:if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{if((n.tag&3)===3){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}if(e=t.updateQueue,e=e!==null?e.lastEffect:null,e!==null){n=e=e.next;do{var i=n;r=i.next,i=i.tag,(i&4)!==0&&(i&1)!==0&&(sy(t,n),T1(t,n)),n=r}while(n!==e)}return;case 1:n=t.stateNode,t.flags&4&&(e===null?n.componentDidMount():(r=t.elementType===t.type?e.memoizedProps:Nt(t.type,e.memoizedProps),n.componentDidUpdate(r,e.memoizedState,n.__reactInternalSnapshotBeforeUpdate))),e=t.updateQueue,e!==null&&up(t,e,n);return;case 3:if(e=t.updateQueue,e!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}up(t,e,n)}return;case 5:n=t.stateNode,e===null&&t.flags&4&&Sv(t.type,t.memoizedProps)&&n.focus();return;case 6:return;case 4:return;case 12:return;case 13:t.memoizedState===null&&(t=t.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&ev(t))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(Y(163))}function _p(n,e){for(var t=n;;){if(t.tag===5){var r=t.stateNode;if(e)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=t.stateNode;var i=t.memoizedProps.style;i=i!=null&&i.hasOwnProperty("display")?i.display:null,r.style.display=K0("display",i)}}else if(t.tag===6)t.stateNode.nodeValue=e?"":t.memoizedProps;else if((t.tag!==23&&t.tag!==24||t.memoizedState===null||t===n)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}}function wp(n,e){if(mr&&typeof mr.onCommitFiberUnmount=="function")try{mr.onCommitFiberUnmount(qd,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(n=e.updateQueue,n!==null&&(n=n.lastEffect,n!==null)){var t=n=n.next;do{var r=t,i=r.destroy;if(r=r.tag,i!==void 0)if((r&4)!==0)sy(e,t);else{r=e;try{i()}catch(s){jn(r,s)}}t=t.next}while(t!==n)}break;case 1:if(Cp(e),n=e.stateNode,typeof n.componentWillUnmount=="function")try{n.props=e.memoizedProps,n.state=e.memoizedState,n.componentWillUnmount()}catch(s){jn(e,s)}break;case 5:Cp(e);break;case 4:Qv(n,e)}}function Pp(n){n.alternate=null,n.child=null,n.dependencies=null,n.firstEffect=null,n.lastEffect=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.return=null,n.updateQueue=null}function Dp(n){return n.tag===5||n.tag===3||n.tag===4}function kp(n){e:{for(var e=n.return;e!==null;){if(Dp(e))break e;e=e.return}throw Error(Y(160))}var t=e;switch(e=t.stateNode,t.tag){case 5:var r=!1;break;case 3:e=e.containerInfo,r=!0;break;case 4:e=e.containerInfo,r=!0;break;default:throw Error(Y(161))}t.flags&16&&(Ts(e,""),t.flags&=-17);e:t:for(t=n;;){for(;t.sibling===null;){if(t.return===null||Dp(t.return)){t=null;break e}t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue t;t.child.return=t,t=t.child}if(!(t.flags&2)){t=t.stateNode;break e}}r?Sc(n,t,e):Tc(n,t,e)}function Sc(n,e,t){var r=n.tag,i=r===5||r===6;if(i)n=i?n.stateNode:n.stateNode.instance,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Sa));else if(r!==4&&(n=n.child,n!==null))for(Sc(n,e,t),n=n.sibling;n!==null;)Sc(n,e,t),n=n.sibling}function Tc(n,e,t){var r=n.tag,i=r===5||r===6;if(i)n=i?n.stateNode:n.stateNode.instance,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Tc(n,e,t),n=n.sibling;n!==null;)Tc(n,e,t),n=n.sibling}function Qv(n,e){for(var t=e,r=!1,i,s;;){if(!r){r=t.return;e:for(;;){if(r===null)throw Error(Y(160));switch(i=r.stateNode,r.tag){case 5:s=!1;break e;case 3:i=i.containerInfo,s=!0;break e;case 4:i=i.containerInfo,s=!0;break e}r=r.return}r=!0}if(t.tag===5||t.tag===6){e:for(var o=n,a=t,l=a;;)if(wp(o,l),l.child!==null&&l.tag!==4)l.child.return=l,l=l.child;else{if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}s?(o=i,a=t.stateNode,o.nodeType===8?o.parentNode.removeChild(a):o.removeChild(a)):i.removeChild(t.stateNode)}else if(t.tag===4){if(t.child!==null){i=t.stateNode.containerInfo,s=!0,t.child.return=t,t=t.child;continue}}else if(wp(n,t),t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return,t.tag===4&&(r=!1)}t.sibling.return=t.return,t=t.sibling}}function iu(n,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var t=e.updateQueue;if(t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do(r.tag&3)===3&&(n=r.destroy,r.destroy=void 0,n!==void 0&&n()),r=r.next;while(r!==t)}return;case 1:return;case 5:if(t=e.stateNode,t!=null){r=e.memoizedProps;var i=n!==null?n.memoizedProps:r;n=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(t[Ta]=r,n==="input"&&r.type==="radio"&&r.name!=null&&U0(t,r),ec(n,i),e=ec(n,r),i=0;i<s.length;i+=2){var o=s[i],a=s[i+1];o==="style"?j0(t,a):o==="dangerouslySetInnerHTML"?G0(t,a):o==="children"?Ts(t,a):bd(t,o,a,e)}switch(n){case"input":zu(t,r);break;case"textarea":$0(t,r);break;case"select":n=t._wrapperState.wasMultiple,t._wrapperState.wasMultiple=!!r.multiple,s=r.value,s!=null?Xr(t,!!r.multiple,s,!1):n!==!!r.multiple&&(r.defaultValue!=null?Xr(t,!!r.multiple,r.defaultValue,!0):Xr(t,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(Y(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:t=e.stateNode,t.hydrate&&(t.hydrate=!1,ev(t.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(df=tt(),_p(e.child,!0)),Op(e);return;case 19:Op(e);return;case 17:return;case 23:case 24:_p(e,e.memoizedState!==null);return}throw Error(Y(163))}function Op(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new f1),e.forEach(function(r){var i=I1.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function g1(n,e){return n!==null&&(n=n.memoizedState,n===null||n.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var m1=Math.ceil,Ma=Ar.ReactCurrentDispatcher,uf=Ar.ReactCurrentOwner,oe=0,ot=null,$e=null,nt=0,xr=0,Ac=er(0),qe=0,Sl=null,Ai=0,eo=0,Li=0,cf=0,Lc=null,df=0,Ic=1/0;function Ii(){Ic=tt()+500}var Z=null,Fa=!1,Rc=null,Xt=null,Xn=!1,ls=null,Yi=90,bc=[],Cc=[],mn=null,us=0,_c=null,Jo=-1,hn=0,ea=0,cs=null,ta=!1;function yt(){return(oe&48)!==0?tt():Jo!==-1?Jo:Jo=tt()}function Gn(n){if(n=n.mode,(n&2)===0)return 1;if((n&4)===0)return hi()===99?1:2;if(hn===0&&(hn=Ai),r1.transition!==0){ea!==0&&(ea=Lc!==null?Lc.pendingLanes:0),n=hn;var e=4186112&~ea;return e&=-e,e===0&&(n=4186112&~n,e=n&-n,e===0&&(e=8192)),e}return n=hi(),(oe&4)!==0&&n===98?n=Ea(12,hn):(n=oT(n),n=Ea(n,hn)),n}function Kn(n,e,t){if(50<us)throw us=0,_c=null,Error(Y(185));if(n=Tl(n,e),n===null)return null;pl(n,e,t),n===ot&&(Li|=e,qe===4&&ni(n,nt));var r=hi();e===1?(oe&8)!==0&&(oe&48)===0?wc(n):(Rt(n,t),oe===0&&(Ii(),sn())):((oe&4)===0||r!==98&&r!==99||(mn===null?mn=new Set([n]):mn.add(n)),Rt(n,t)),Lc=n}function Tl(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}function Rt(n,e){for(var t=n.callbackNode,r=n.suspendedLanes,i=n.pingedLanes,s=n.expirationTimes,o=n.pendingLanes;0<o;){var a=31-Yn(o),l=1<<a,u=s[a];if(u===-1){if((l&r)===0||(l&i)!==0){u=e,Fr(l);var c=xe;s[a]=10<=c?u+250:6<=c?u+5e3:-1}}else u<=e&&(n.expiredLanes|=l);o&=~l}if(r=Rs(n,n===ot?nt:0),e=xe,r===0)t!==null&&(t!==Jl&&dc(t),n.callbackNode=null,n.callbackPriority=0);else{if(t!==null){if(n.callbackPriority===e)return;t!==Jl&&dc(t)}e===15?(t=wc.bind(null,n),fn===null?(fn=[t],Zo=Xd(El,_v)):fn.push(t),t=Jl):e===14?t=ws(99,wc.bind(null,n)):(t=aT(e),t=ws(t,Zv.bind(null,n))),n.callbackPriority=e,n.callbackNode=t}}function Zv(n){if(Jo=-1,ea=hn=0,(oe&48)!==0)throw Error(Y(327));var e=n.callbackNode;if(tr()&&n.callbackNode!==e)return null;var t=Rs(n,n===ot?nt:0);if(t===0)return null;var r=t,i=oe;oe|=16;var s=ny();(ot!==n||nt!==r)&&(Ii(),ri(n,r));do try{E1();break}catch(a){ty(n,a)}while(1);if(Qd(),Ma.current=s,oe=i,$e!==null?r=0:(ot=null,nt=0,r=qe),(Ai&Li)!==0)ri(n,0);else if(r!==0){if(r===2&&(oe|=64,n.hydrate&&(n.hydrate=!1,Yd(n.containerInfo)),t=av(n),t!==0&&(r=qi(n,t))),r===1)throw e=Sl,ri(n,0),ni(n,t),Rt(n,tt()),e;switch(n.finishedWork=n.current.alternate,n.finishedLanes=t,r){case 0:case 1:throw Error(Y(345));case 2:lr(n);break;case 3:if(ni(n,t),(t&62914560)===t&&(r=df+500-tt(),10<r)){if(Rs(n,0)!==0)break;if(i=n.suspendedLanes,(i&t)!==t){yt(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=tp(lr.bind(null,n),r);break}lr(n);break;case 4:if(ni(n,t),(t&4186112)===t)break;for(r=n.eventTimes,i=-1;0<t;){var o=31-Yn(t);s=1<<o,o=r[o],o>i&&(i=o),t&=~s}if(t=i,t=tt()-t,t=(120>t?120:480>t?480:1080>t?1080:1920>t?1920:3e3>t?3e3:4320>t?4320:1960*m1(t/1960))-t,10<t){n.timeoutHandle=tp(lr.bind(null,n),t);break}lr(n);break;case 5:lr(n);break;default:throw Error(Y(329))}}return Rt(n,tt()),n.callbackNode===e?Zv.bind(null,n):null}function ni(n,e){for(e&=~cf,e&=~Li,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Yn(e),r=1<<t;n[t]=-1,e&=~r}}function wc(n){if((oe&48)!==0)throw Error(Y(327));if(tr(),n===ot&&(n.expiredLanes&nt)!==0){var e=nt,t=qi(n,e);(Ai&Li)!==0&&(e=Rs(n,e),t=qi(n,e))}else e=Rs(n,0),t=qi(n,e);if(n.tag!==0&&t===2&&(oe|=64,n.hydrate&&(n.hydrate=!1,Yd(n.containerInfo)),e=av(n),e!==0&&(t=qi(n,e))),t===1)throw t=Sl,ri(n,0),ni(n,e),Rt(n,tt()),t;return n.finishedWork=n.current.alternate,n.finishedLanes=e,lr(n),Rt(n,tt()),null}function v1(){if(mn!==null){var n=mn;mn=null,n.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,Rt(e,tt())})}sn()}function Jv(n,e){var t=oe;oe|=1;try{return n(e)}finally{oe=t,oe===0&&(Ii(),sn())}}function ey(n,e){var t=oe;oe&=-2,oe|=8;try{return n(e)}finally{oe=t,oe===0&&(Ii(),sn())}}function Ao(n,e){we(Ac,xr),xr|=e,Ai|=e}function ff(){xr=Ac.current,Ae(Ac)}function ri(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,QT(t)),$e!==null)for(t=$e.return;t!==null;){var r=t;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Aa();break;case 3:pi(),Ae(ft),Ae(rt),tf();break;case 5:ef(r);break;case 4:pi();break;case 13:Ae(_e);break;case 19:Ae(_e);break;case 10:Zd(r);break;case 23:case 24:ff()}t=t.return}ot=n,$e=Qn(n.current,null),nt=xr=Ai=e,qe=0,Sl=null,cf=Li=eo=0}function ty(n,e){do{var t=$e;try{if(Qd(),os.current=Oa,wa){for(var r=Fe.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}wa=!1}if(Os=0,ze=et=Fe=null,as=!1,uf.current=null,t===null||t.return===null){qe=1,Sl=e,$e=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=nt,a.flags|=2048,a.firstEffect=a.lastEffect=null,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l;if((a.mode&2)===0){var c=a.alternate;c?(a.updateQueue=c.updateQueue,a.memoizedState=c.memoizedState,a.lanes=c.lanes):(a.updateQueue=null,a.memoizedState=null)}var d=(_e.current&1)!==0,f=o;do{var p;if(p=f.tag===13){var h=f.memoizedState;if(h!==null)p=h.dehydrated!==null;else{var m=f.memoizedProps;p=m.fallback===void 0?!1:m.unstable_avoidThisFallback!==!0?!0:!d}}if(p){var g=f.updateQueue;if(g===null){var v=new Set;v.add(u),f.updateQueue=v}else g.add(u);if((f.mode&2)===0){if(f.flags|=64,a.flags|=16384,a.flags&=-2981,a.tag===1)if(a.alternate===null)a.tag=17;else{var y=$n(-1,1);y.tag=2,Vn(a,y)}a.lanes|=1;break e}l=void 0,a=e;var E=s.pingCache;if(E===null?(E=s.pingCache=new d1,l=new Set,E.set(u,l)):(l=E.get(u),l===void 0&&(l=new Set,E.set(u,l))),!l.has(a)){l.add(a);var S=L1.bind(null,s,u,a);u.then(S,S)}f.flags|=4096,f.lanes=e;break e}f=f.return}while(f!==null);l=Error((qr(a.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}qe!==5&&(qe=2),l=lf(l,a),f=o;do{switch(f.tag){case 3:s=l,f.flags|=4096,e&=-e,f.lanes|=e;var T=qv(f,s,e);lp(f,T);break e;case 1:s=l;var L=f.type,A=f.stateNode;if((f.flags&64)===0&&(typeof L.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(Xt===null||!Xt.has(A)))){f.flags|=4096,e&=-e,f.lanes|=e;var R=Xv(f,s,e);lp(f,R);break e}}f=f.return}while(f!==null)}iy(t)}catch(I){e=I,$e===t&&t!==null&&($e=t=t.return);continue}break}while(1)}function ny(){var n=Ma.current;return Ma.current=Oa,n===null?Oa:n}function qi(n,e){var t=oe;oe|=16;var r=ny();ot===n&&nt===e||ri(n,e);do try{y1();break}catch(i){ty(n,i)}while(1);if(Qd(),oe=t,Ma.current=r,$e!==null)throw Error(Y(261));return ot=null,nt=0,qe}function y1(){for(;$e!==null;)ry($e)}function E1(){for(;$e!==null&&!e1();)ry($e)}function ry(n){var e=oy(n.alternate,n,xr);n.memoizedProps=n.pendingProps,e===null?iy(n):$e=e,uf.current=null}function iy(n){var e=n;do{var t=e.alternate;if(n=e.return,(e.flags&2048)===0){if(t=u1(t,e,xr),t!==null){$e=t;return}if(t=e,t.tag!==24&&t.tag!==23||t.memoizedState===null||(xr&1073741824)!==0||(t.mode&4)===0){for(var r=0,i=t.child;i!==null;)r|=i.lanes|i.childLanes,i=i.sibling;t.childLanes=r}n!==null&&(n.flags&2048)===0&&(n.firstEffect===null&&(n.firstEffect=e.firstEffect),e.lastEffect!==null&&(n.lastEffect!==null&&(n.lastEffect.nextEffect=e.firstEffect),n.lastEffect=e.lastEffect),1<e.flags&&(n.lastEffect!==null?n.lastEffect.nextEffect=e:n.firstEffect=e,n.lastEffect=e))}else{if(t=c1(e),t!==null){t.flags&=2047,$e=t;return}n!==null&&(n.firstEffect=n.lastEffect=null,n.flags|=2048)}if(e=e.sibling,e!==null){$e=e;return}$e=e=n}while(e!==null);qe===0&&(qe=5)}function lr(n){var e=hi();return Er(99,x1.bind(null,n,e)),null}function x1(n,e){do tr();while(ls!==null);if((oe&48)!==0)throw Error(Y(327));var t=n.finishedWork;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Y(177));n.callbackNode=null;var r=t.lanes|t.childLanes,i=r,s=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;for(var o=n.eventTimes,a=n.expirationTimes;0<s;){var l=31-Yn(s),u=1<<l;i[l]=0,o[l]=-1,a[l]=-1,s&=~u}if(mn!==null&&(r&24)===0&&mn.has(n)&&mn.delete(n),n===ot&&($e=ot=null,nt=0),1<t.flags?t.lastEffect!==null?(t.lastEffect.nextEffect=t,r=t.firstEffect):r=t:r=t.firstEffect,r!==null){if(i=oe,oe|=32,uf.current=null,Xl=Yo,o=Yh(),oc(o)){if("selectionStart"in o)a={start:o.selectionStart,end:o.selectionEnd};else e:if(a=(a=o.ownerDocument)&&a.defaultView||window,(u=a.getSelection&&a.getSelection())&&u.rangeCount!==0){a=u.anchorNode,s=u.anchorOffset,l=u.focusNode,u=u.focusOffset;try{a.nodeType,l.nodeType}catch{a=null;break e}var c=0,d=-1,f=-1,p=0,h=0,m=o,g=null;t:for(;;){for(var v;m!==a||s!==0&&m.nodeType!==3||(d=c+s),m!==l||u!==0&&m.nodeType!==3||(f=c+u),m.nodeType===3&&(c+=m.nodeValue.length),(v=m.firstChild)!==null;)g=m,m=v;for(;;){if(m===o)break t;if(g===a&&++p===s&&(d=c),g===l&&++h===u&&(f=c),(v=m.nextSibling)!==null)break;m=g,g=m.parentNode}m=v}a=d===-1||f===-1?null:{start:d,end:f}}else a=null;a=a||{start:0,end:0}}else a=null;Ql={focusedElem:o,selectionRange:a},Yo=!1,cs=null,ta=!1,Z=r;do try{S1()}catch(I){if(Z===null)throw Error(Y(330));jn(Z,I),Z=Z.nextEffect}while(Z!==null);cs=null,Z=r;do try{for(o=n;Z!==null;){var y=Z.flags;if(y&16&&Ts(Z.stateNode,""),y&128){var E=Z.alternate;if(E!==null){var S=E.ref;S!==null&&(typeof S=="function"?S(null):S.current=null)}}switch(y&1038){case 2:kp(Z),Z.flags&=-3;break;case 6:kp(Z),Z.flags&=-3,iu(Z.alternate,Z);break;case 1024:Z.flags&=-1025;break;case 1028:Z.flags&=-1025,iu(Z.alternate,Z);break;case 4:iu(Z.alternate,Z);break;case 8:a=Z,Qv(o,a);var T=a.alternate;Pp(a),T!==null&&Pp(T)}Z=Z.nextEffect}}catch(I){if(Z===null)throw Error(Y(330));jn(Z,I),Z=Z.nextEffect}while(Z!==null);if(S=Ql,E=Yh(),y=S.focusedElem,o=S.selectionRange,E!==y&&y&&y.ownerDocument&&gv(y.ownerDocument.documentElement,y)){for(o!==null&&oc(y)&&(E=o.start,S=o.end,S===void 0&&(S=E),"selectionStart"in y?(y.selectionStart=E,y.selectionEnd=Math.min(S,y.value.length)):(S=(E=y.ownerDocument||document)&&E.defaultView||window,S.getSelection&&(S=S.getSelection(),a=y.textContent.length,T=Math.min(o.start,a),o=o.end===void 0?T:Math.min(o.end,a),!S.extend&&T>o&&(a=o,o=T,T=a),a=zh(y,T),s=zh(y,o),a&&s&&(S.rangeCount!==1||S.anchorNode!==a.node||S.anchorOffset!==a.offset||S.focusNode!==s.node||S.focusOffset!==s.offset)&&(E=E.createRange(),E.setStart(a.node,a.offset),S.removeAllRanges(),T>o?(S.addRange(E),S.extend(s.node,s.offset)):(E.setEnd(s.node,s.offset),S.addRange(E)))))),E=[],S=y;S=S.parentNode;)S.nodeType===1&&E.push({element:S,left:S.scrollLeft,top:S.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<E.length;y++)S=E[y],S.element.scrollLeft=S.left,S.element.scrollTop=S.top}Yo=!!Xl,Ql=Xl=null,n.current=t,Z=r;do try{for(y=n;Z!==null;){var L=Z.flags;if(L&36&&p1(y,Z.alternate,Z),L&128){E=void 0;var A=Z.ref;if(A!==null){var R=Z.stateNode;switch(Z.tag){case 5:E=R;break;default:E=R}typeof A=="function"?A(E):A.current=E}}Z=Z.nextEffect}}catch(I){if(Z===null)throw Error(Y(330));jn(Z,I),Z=Z.nextEffect}while(Z!==null);Z=null,n1(),oe=i}else n.current=t;if(Xn)Xn=!1,ls=n,Yi=e;else for(Z=r;Z!==null;)e=Z.nextEffect,Z.nextEffect=null,Z.flags&8&&(L=Z,L.sibling=null,L.stateNode=null),Z=e;if(r=n.pendingLanes,r===0&&(Xt=null),r===1?n===_c?us++:(us=0,_c=n):us=0,t=t.stateNode,mr&&typeof mr.onCommitFiberRoot=="function")try{mr.onCommitFiberRoot(qd,t,void 0,(t.current.flags&64)===64)}catch{}if(Rt(n,tt()),Fa)throw Fa=!1,n=Rc,Rc=null,n;return(oe&8)!==0||sn(),null}function S1(){for(;Z!==null;){var n=Z.alternate;ta||cs===null||((Z.flags&8)!==0?kh(Z,cs)&&(ta=!0):Z.tag===13&&g1(n,Z)&&kh(Z,cs)&&(ta=!0));var e=Z.flags;(e&256)!==0&&h1(n,Z),(e&512)===0||Xn||(Xn=!0,ws(97,function(){return tr(),null})),Z=Z.nextEffect}}function tr(){if(Yi!==90){var n=97<Yi?97:Yi;return Yi=90,Er(n,A1)}return!1}function T1(n,e){bc.push(e,n),Xn||(Xn=!0,ws(97,function(){return tr(),null}))}function sy(n,e){Cc.push(e,n),Xn||(Xn=!0,ws(97,function(){return tr(),null}))}function A1(){if(ls===null)return!1;var n=ls;if(ls=null,(oe&48)!==0)throw Error(Y(331));var e=oe;oe|=32;var t=Cc;Cc=[];for(var r=0;r<t.length;r+=2){var i=t[r],s=t[r+1],o=i.destroy;if(i.destroy=void 0,typeof o=="function")try{o()}catch(l){if(s===null)throw Error(Y(330));jn(s,l)}}for(t=bc,bc=[],r=0;r<t.length;r+=2){i=t[r],s=t[r+1];try{var a=i.create;i.destroy=a()}catch(l){if(s===null)throw Error(Y(330));jn(s,l)}}for(a=n.current.firstEffect;a!==null;)n=a.nextEffect,a.nextEffect=null,a.flags&8&&(a.sibling=null,a.stateNode=null),a=n;return oe=e,sn(),!0}function Mp(n,e,t){e=lf(t,e),e=qv(n,e,1),Vn(n,e),e=yt(),n=Tl(n,1),n!==null&&(pl(n,1,e),Rt(n,e))}function jn(n,e){if(n.tag===3)Mp(n,n,e);else for(var t=n.return;t!==null;){if(t.tag===3){Mp(t,n,e);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Xt===null||!Xt.has(r))){n=lf(e,n);var i=Xv(t,n,1);if(Vn(t,i),i=yt(),t=Tl(t,1),t!==null)pl(t,1,i),Rt(t,i);else if(typeof r.componentDidCatch=="function"&&(Xt===null||!Xt.has(r)))try{r.componentDidCatch(e,n)}catch{}break}}t=t.return}}function L1(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=yt(),n.pingedLanes|=n.suspendedLanes&t,ot===n&&(nt&t)===t&&(qe===4||qe===3&&(nt&62914560)===nt&&500>tt()-df?ri(n,0):cf|=t),Rt(n,e)}function I1(n,e){var t=n.stateNode;t!==null&&t.delete(e),e=0,e===0&&(e=n.mode,(e&2)===0?e=1:(e&4)===0?e=hi()===99?1:2:(hn===0&&(hn=Ai),e=Nr(62914560&~hn),e===0&&(e=4194304))),t=yt(),n=Tl(n,e),n!==null&&(pl(n,e,t),Rt(n,t))}var oy;oy=function(n,e,t){var r=e.lanes;if(n!==null)if(n.memoizedProps!==e.pendingProps||ft.current)Ut=!0;else if((t&r)!==0)Ut=(n.flags&16384)!==0;else{switch(Ut=!1,e.tag){case 3:Sp(e),tu();break;case 5:fp(e);break;case 1:ht(e.type)&&Qo(e);break;case 4:pc(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var i=e.type._context;we(La,i._currentValue),i._currentValue=r;break;case 13:if(e.memoizedState!==null)return(t&e.child.childLanes)!==0?Tp(n,e,t):(we(_e,_e.current&1),e=gn(n,e,t),e!==null?e.sibling:null);we(_e,_e.current&1);break;case 19:if(r=(t&e.childLanes)!==0,(n.flags&64)!==0){if(r)return bp(n,e,t);e.flags|=64}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),we(_e,_e.current),r)break;return null;case 23:case 24:return e.lanes=0,nu(n,e,t)}return gn(n,e,t)}else Ut=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,i=fi(e,rt.current),ei(e,t),i=rf(null,e,r,n,i,t),e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,ht(r)){var s=!0;Qo(e)}else s=!1;e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Jd(e);var o=r.getDerivedStateFromProps;typeof o=="function"&&ba(e,r,o,n),i.updater=xl,e.stateNode=i,i._reactInternals=e,hc(e,r,n,t),e=yc(null,e,r,!0,s,t)}else e.tag=0,ct(null,e,i,t),e=e.child;return e;case 16:i=e.elementType;e:{switch(n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),n=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=b1(i),n=Nt(i,n),s){case 0:e=vc(null,e,i,n,t);break e;case 1:e=xp(null,e,i,n,t);break e;case 11:e=yp(null,e,i,n,t);break e;case 14:e=Ep(null,e,i,Nt(i.type,n),r,t);break e}throw Error(Y(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),vc(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),xp(n,e,r,i,t);case 3:if(Sp(e),r=e.updateQueue,n===null||r===null)throw Error(Y(282));if(r=e.pendingProps,i=e.memoizedState,i=i!==null?i.element:null,Pv(n,e),Ps(e,r,null,t),r=e.memoizedState.element,r===i)tu(),e=gn(n,e,t);else{if(i=e.stateNode,(s=i.hydrate)&&(kn=Jr(e.stateNode.containerInfo.firstChild),pn=e,s=en=!0),s){if(n=i.mutableSourceEagerHydrationData,n!=null)for(i=0;i<n.length;i+=2)s=n[i],s._workInProgressVersionPrimary=n[i+1],ti.push(s);for(t=Mv(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|1024,t=t.sibling}else ct(n,e,r,t),tu();e=e.child}return e;case 5:return fp(e),n===null&&gc(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,uc(r,i)?o=null:s!==null&&uc(r,s)&&(e.flags|=16),Hv(n,e),ct(n,e,o,t),e.child;case 6:return n===null&&gc(e),null;case 13:return Tp(n,e,t);case 4:return pc(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Ca(e,null,r,t):ct(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),yp(n,e,r,i,t);case 7:return ct(n,e,e.pendingProps,t),e.child;case 8:return ct(n,e,e.pendingProps.children,t),e.child;case 12:return ct(n,e,e.pendingProps.children,t),e.child;case 10:e:{r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value;var a=e.type._context;if(we(La,a._currentValue),a._currentValue=s,o!==null)if(a=o.value,s=Tt(a,s)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(a,s):1073741823)|0,s===0){if(o.children===i.children&&!ft.current){e=gn(n,e,t);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var u=l.firstContext;u!==null;){if(u.context===r&&(u.observedBits&s)!==0){a.tag===1&&(u=$n(-1,t&-t),u.tag=2,Vn(a,u)),a.lanes|=t,u=a.alternate,u!==null&&(u.lanes|=t),wv(a.return,t),l.lanes|=t;break}u=u.next}}else o=a.tag===10&&a.type===e.type?null:a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}ct(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps,r=s.children,ei(e,t),i=It(i,s.unstable_observedBits),r=r(i),e.flags|=1,ct(n,e,r,t),e.child;case 14:return i=e.type,s=Nt(i,e.pendingProps),s=Nt(i.type,s),Ep(n,e,i,s,r,t);case 15:return jv(n,e,e.type,e.pendingProps,r,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,ht(r)?(n=!0,Qo(e)):n=!1,ei(e,t),kv(e,r,i),hc(e,r,i,t),yc(null,e,r,!0,n,t);case 19:return bp(n,e,t);case 23:return nu(n,e,t);case 24:return nu(n,e,t)}throw Error(Y(156,e.tag))};function R1(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function At(n,e,t,r){return new R1(n,e,t,r)}function hf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function b1(n){if(typeof n=="function")return hf(n)?1:0;if(n!=null){if(n=n.$$typeof,n===dl)return 11;if(n===fl)return 14}return 2}function Qn(n,e){var t=n.alternate;return t===null?(t=At(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.nextEffect=null,t.firstEffect=null,t.lastEffect=null),t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function na(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")hf(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case wn:return ii(t.children,i,s,e);case F0:o=8,i|=16;break;case Cd:o=8,i|=1;break;case Ji:return n=At(12,t,e,i|8),n.elementType=Ji,n.type=Ji,n.lanes=s,n;case es:return n=At(13,t,e,i),n.type=es,n.elementType=es,n.lanes=s,n;case ga:return n=At(19,t,e,i),n.elementType=ga,n.lanes=s,n;case Od:return pf(t,i,s,e);case Hu:return n=At(24,t,e,i),n.elementType=Hu,n.lanes=s,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case _d:o=10;break e;case wd:o=9;break e;case dl:o=11;break e;case fl:o=14;break e;case Pd:o=16,r=null;break e;case Dd:o=22;break e}throw Error(Y(130,n==null?n:typeof n,""))}return e=At(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function ii(n,e,t,r){return n=At(7,n,r,e),n.lanes=t,n}function pf(n,e,t,r){return n=At(23,n,r,e),n.elementType=Od,n.lanes=t,n}function su(n,e,t){return n=At(6,n,null,e),n.lanes=t,n}function ou(n,e,t){return e=At(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function C1(n,e,t){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=t,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Kl(0),this.expirationTimes=Kl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kl(0),this.mutableSourceEagerHydrationData=null}function _1(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cr,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Na(n,e,t,r){var i=e.current,s=yt(),o=Gn(i);e:if(t){t=t._reactInternals;t:{if(Lr(t)!==t||t.tag!==1)throw Error(Y(170));var a=t;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(ht(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(a!==null);throw Error(Y(171))}if(t.tag===1){var l=t.type;if(ht(l)){t=Av(t,l,a);break e}}t=a}else t=qn;return e.context===null?e.context=t:e.pendingContext=t,e=$n(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),Vn(i,e),Kn(i,o,s),o}function au(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Fp(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function gf(n,e){Fp(n,e),(n=n.alternate)&&Fp(n,e)}function w1(){return null}function mf(n,e,t){var r=t!=null&&t.hydrationOptions!=null&&t.hydrationOptions.mutableSources||null;if(t=new C1(n,e,t!=null&&t.hydrate===!0),e=At(3,null,null,e===2?7:e===1?3:0),t.current=e,e.stateNode=t,Jd(e),n[Ti]=t.current,yv(n.nodeType===8?n.parentNode:n),r)for(n=0;n<r.length;n++){e=r[n];var i=e._getVersion;i=i(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,i]:t.mutableSourceEagerHydrationData.push(e,i)}this._internalRoot=t}mf.prototype.render=function(n){Na(n,this._internalRoot,null,null)};mf.prototype.unmount=function(){var n=this._internalRoot,e=n.containerInfo;Na(null,n,null,function(){e[Ti]=null})};function to(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function P1(n,e){if(e||(e=n?n.nodeType===9?n.documentElement:n.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var t;t=n.lastChild;)n.removeChild(t);return new mf(n,0,e?{hydrate:!0}:void 0)}function Al(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s._internalRoot;if(typeof i=="function"){var a=i;i=function(){var u=au(o);a.call(u)}}Na(e,o,n,i)}else{if(s=t._reactRootContainer=P1(t,r),o=s._internalRoot,typeof i=="function"){var l=i;i=function(){var u=au(o);l.call(u)}}ey(function(){Na(e,o,n,i)})}return au(o)}Q0=function(n){if(n.tag===13){var e=yt();Kn(n,4,e),gf(n,4)}};Ud=function(n){if(n.tag===13){var e=yt();Kn(n,67108864,e),gf(n,67108864)}};Z0=function(n){if(n.tag===13){var e=yt(),t=Gn(n);Kn(n,t,e),gf(n,t)}};J0=function(n,e){return e()};tc=function(n,e,t){switch(e){case"input":if(zu(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=yl(r);if(!i)throw Error(Y(90));B0(r),zu(r,i)}}}break;case"textarea":$0(n,t);break;case"select":e=t.value,e!=null&&Xr(n,!!t.multiple,e,!1)}};Fd=Jv;z0=function(n,e,t,r,i){var s=oe;oe|=4;try{return Er(98,n.bind(null,e,t,r,i))}finally{oe=s,oe===0&&(Ii(),sn())}};Nd=function(){(oe&49)===0&&(v1(),tr())};Y0=function(n,e){var t=oe;oe|=2;try{return n(e)}finally{oe=t,oe===0&&(Ii(),sn())}};function ay(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!to(e))throw Error(Y(200));return _1(n,e,null,t)}var D1={Events:[Zs,Kr,yl,H0,W0,tr,{current:!1}]},Vi={findFiberByHostInstance:fr,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},k1={bundleType:Vi.bundleType,version:Vi.version,rendererPackageName:Vi.rendererPackageName,rendererConfig:Vi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ar.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=X0(n),n===null?null:n.stateNode},findFiberByHostInstance:Vi.findFiberByHostInstance||w1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Lo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lo.isDisabled&&Lo.supportsFiber)try{qd=Lo.inject(k1),mr=Lo}catch{}}Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D1;Ct.createPortal=ay;Ct.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Y(188)):Error(Y(268,Object.keys(n)));return n=X0(e),n=n===null?null:n.stateNode,n};Ct.flushSync=function(n,e){var t=oe;if((t&48)!==0)return n(e);oe|=1;try{if(n)return Er(99,n.bind(null,e))}finally{oe=t,sn()}};Ct.hydrate=function(n,e,t){if(!to(e))throw Error(Y(200));return Al(null,n,e,!0,t)};Ct.render=function(n,e,t){if(!to(e))throw Error(Y(200));return Al(null,n,e,!1,t)};Ct.unmountComponentAtNode=function(n){if(!to(n))throw Error(Y(40));return n._reactRootContainer?(ey(function(){Al(null,null,n,!1,function(){n._reactRootContainer=null,n[Ti]=null})}),!0):!1};Ct.unstable_batchedUpdates=Jv;Ct.unstable_createPortal=function(n,e){return ay(n,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Ct.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!to(t))throw Error(Y(200));if(n==null||n._reactInternals===void 0)throw Error(Y(38));return Al(n,e,t,!1,r)};Ct.version="17.0.2";function ly(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ly)}catch(n){console.error(n)}}ly(),Ld.exports=Ct;var uy=Ld.exports,O1=y0({__proto__:null,default:uy},[Ld.exports]);/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ms(){return Ms=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ms.apply(this,arguments)}var On;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(On||(On={}));const Np="popstate";function M1(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return Pc("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Ba(i)}return N1(e,t,null,n)}function Ne(n,e){if(n===!1||n===null||typeof n=="undefined")throw new Error(e)}function vf(n,e){if(!n){typeof console!="undefined"&&console.warn(e);try{throw new Error(e)}catch{}}}function F1(){return Math.random().toString(36).substr(2,8)}function Bp(n,e){return{usr:n.state,key:n.key,idx:e}}function Pc(n,e,t,r){return t===void 0&&(t=null),Ms({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Ri(e):e,{state:t,key:e&&e.key||r||F1()})}function Ba(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ri(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function N1(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a=On.Pop,l=null,u=c();u==null&&(u=0,o.replaceState(Ms({},o.state,{idx:u}),""));function c(){return(o.state||{idx:null}).idx}function d(){a=On.Pop;let g=c(),v=g==null?null:g-u;u=g,l&&l({action:a,location:m.location,delta:v})}function f(g,v){a=On.Push;let y=Pc(m.location,g,v);t&&t(y,g),u=c()+1;let E=Bp(y,u),S=m.createHref(y);try{o.pushState(E,"",S)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;i.location.assign(S)}s&&l&&l({action:a,location:m.location,delta:1})}function p(g,v){a=On.Replace;let y=Pc(m.location,g,v);t&&t(y,g),u=c();let E=Bp(y,u),S=m.createHref(y);o.replaceState(E,"",S),s&&l&&l({action:a,location:m.location,delta:0})}function h(g){let v=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof g=="string"?g:Ba(g);return y=y.replace(/ $/,"%20"),Ne(v,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,v)}let m={get action(){return a},get location(){return n(i,o)},listen(g){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(Np,d),l=g,()=>{i.removeEventListener(Np,d),l=null}},createHref(g){return e(i,g)},createURL:h,encodeLocation(g){let v=h(g);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:f,replace:p,go(g){return o.go(g)}};return m}var Up;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Up||(Up={}));function B1(n,e,t){return t===void 0&&(t="/"),U1(n,e,t,!1)}function U1(n,e,t,r){let i=typeof e=="string"?Ri(e):e,s=yf(i.pathname||"/",t);if(s==null)return null;let o=cy(n);$1(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=Q1(s);a=q1(o[l],u,r)}return a}function cy(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(Ne(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=Hn([r,l.relativePath]),c=t.concat(l);s.children&&s.children.length>0&&(Ne(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),cy(s.children,e,c,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:z1(u,s.index),routesMeta:c})};return n.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let l of dy(s.path))i(s,o,l)}),e}function dy(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=dy(r.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),i&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function $1(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Y1(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const V1=/^:[\w-]+$/,G1=3,K1=2,j1=1,H1=10,W1=-2,$p=n=>n==="*";function z1(n,e){let t=n.split("/"),r=t.length;return t.some($p)&&(r+=W1),e&&(r+=K1),t.filter(i=>!$p(i)).reduce((i,s)=>i+(V1.test(s)?G1:s===""?j1:H1),r)}function Y1(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function q1(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,i={},s="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=Vp({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),f=l.route;if(!d&&u&&t&&!r[r.length-1].route.index&&(d=Vp({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),o.push({params:i,pathname:Hn([s,d.pathname]),pathnameBase:nA(Hn([s,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(s=Hn([s,d.pathnameBase]))}return o}function Vp(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=X1(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:f,isOptional:p}=c;if(f==="*"){let m=a[d]||"";o=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const h=a[d];return p&&!h?u[f]=void 0:u[f]=(h||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:n}}function X1(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),vf(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function Q1(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return vf(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function yf(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}const Z1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,J1=n=>Z1.test(n);function eA(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Ri(n):n,s;if(t)if(J1(t))s=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),vf(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?s=Gp(t.substring(1),"/"):s=Gp(t,e)}else s=e;return{pathname:s,search:rA(r),hash:iA(i)}}function Gp(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function lu(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tA(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function fy(n,e){let t=tA(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function hy(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=Ri(n):(i=Ms({},n),Ne(!i.pathname||!i.pathname.includes("?"),lu("?","pathname","search",i)),Ne(!i.pathname||!i.pathname.includes("#"),lu("#","pathname","hash",i)),Ne(!i.search||!i.search.includes("#"),lu("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=eA(i,a),u=o&&o!=="/"&&o.endsWith("/"),c=(s||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const Hn=n=>n.join("/").replace(/\/\/+/g,"/"),nA=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),rA=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,iA=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function sA(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const oA=["post","put","patch","delete"];[...oA];/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fs(){return Fs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Fs.apply(this,arguments)}const Ef=C.exports.createContext(null),aA=C.exports.createContext(null),Rr=C.exports.createContext(null),Ll=C.exports.createContext(null),nr=C.exports.createContext({outlet:null,matches:[],isDataRoute:!1}),py=C.exports.createContext(null);function lA(n,e){let{relative:t}=e===void 0?{}:e;no()||Ne(!1);let{basename:r,navigator:i}=C.exports.useContext(Rr),{hash:s,pathname:o,search:a}=vy(n,{relative:t}),l=o;return r!=="/"&&(l=o==="/"?r:Hn([r,o])),i.createHref({pathname:l,search:a,hash:s})}function no(){return C.exports.useContext(Ll)!=null}function ro(){return no()||Ne(!1),C.exports.useContext(Ll).location}function gy(n){C.exports.useContext(Rr).static||C.exports.useLayoutEffect(n)}function br(){let{isDataRoute:n}=C.exports.useContext(nr);return n?SA():uA()}function uA(){no()||Ne(!1);let n=C.exports.useContext(Ef),{basename:e,future:t,navigator:r}=C.exports.useContext(Rr),{matches:i}=C.exports.useContext(nr),{pathname:s}=ro(),o=JSON.stringify(fy(i,t.v7_relativeSplatPath)),a=C.exports.useRef(!1);return gy(()=>{a.current=!0}),C.exports.useCallback(function(u,c){if(c===void 0&&(c={}),!a.current)return;if(typeof u=="number"){r.go(u);return}let d=hy(u,JSON.parse(o),s,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Hn([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,o,s,n])}function my(){let{matches:n}=C.exports.useContext(nr),e=n[n.length-1];return e?e.params:{}}function vy(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=C.exports.useContext(Rr),{matches:i}=C.exports.useContext(nr),{pathname:s}=ro(),o=JSON.stringify(fy(i,r.v7_relativeSplatPath));return C.exports.useMemo(()=>hy(n,JSON.parse(o),s,t==="path"),[n,o,s,t])}function cA(n,e){return dA(n,e)}function dA(n,e,t,r){no()||Ne(!1);let{navigator:i}=C.exports.useContext(Rr),{matches:s}=C.exports.useContext(nr),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=ro(),c;if(e){var d;let g=typeof e=="string"?Ri(e):e;l==="/"||((d=g.pathname)==null?void 0:d.startsWith(l))||Ne(!1),c=g}else c=u;let f=c.pathname||"/",p=f;if(l!=="/"){let g=l.replace(/^\//,"").split("/"),v=f.replace(/^\//,"").split("/");p="/"+v.slice(g.length).join("/")}let h=B1(n,{pathname:p}),m=mA(h&&h.map(g=>Object.assign({},g,{params:Object.assign({},a,g.params),pathname:Hn([l,i.encodeLocation?i.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:Hn([l,i.encodeLocation?i.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),s,t,r);return e&&m?C.exports.createElement(Ll.Provider,{value:{location:Fs({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:On.Pop}},m):m}function fA(){let n=xA(),e=sA(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return C.exports.createElement(C.exports.Fragment,null,C.exports.createElement("h2",null,"Unexpected Application Error!"),C.exports.createElement("h3",{style:{fontStyle:"italic"}},e),t?C.exports.createElement("pre",{style:i},t):null,s)}const hA=C.exports.createElement(fA,null);class pA extends C.exports.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?C.exports.createElement(nr.Provider,{value:this.props.routeContext},C.exports.createElement(py.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function gA(n){let{routeContext:e,match:t,children:r}=n,i=C.exports.useContext(Ef);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),C.exports.createElement(nr.Provider,{value:e},r)}function mA(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(i=t)==null?void 0:i.errors;if(a!=null){let c=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);c>=0||Ne(!1),o=o.slice(0,Math.min(o.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<o.length;c++){let d=o[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:f,errors:p}=t,h=d.route.loader&&f[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||h){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((c,d,f)=>{let p,h=!1,m=null,g=null;t&&(p=a&&d.route.id?a[d.route.id]:void 0,m=d.route.errorElement||hA,l&&(u<0&&f===0?(TA("route-fallback",!1),h=!0,g=null):u===f&&(h=!0,g=d.route.hydrateFallbackElement||null)));let v=e.concat(o.slice(0,f+1)),y=()=>{let E;return p?E=m:h?E=g:d.route.Component?E=C.exports.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=c,C.exports.createElement(gA,{match:d,routeContext:{outlet:c,matches:v,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?C.exports.createElement(pA,{location:t.location,revalidation:t.revalidation,component:m,error:p,children:y(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):y()},null)}var yy=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(yy||{}),Ua=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Ua||{});function vA(n){let e=C.exports.useContext(Ef);return e||Ne(!1),e}function yA(n){let e=C.exports.useContext(aA);return e||Ne(!1),e}function EA(n){let e=C.exports.useContext(nr);return e||Ne(!1),e}function Ey(n){let e=EA(),t=e.matches[e.matches.length-1];return t.route.id||Ne(!1),t.route.id}function xA(){var n;let e=C.exports.useContext(py),t=yA(Ua.UseRouteError),r=Ey(Ua.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function SA(){let{router:n}=vA(yy.UseNavigateStable),e=Ey(Ua.UseNavigateStable),t=C.exports.useRef(!1);return gy(()=>{t.current=!0}),C.exports.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,Fs({fromRouteId:e},s)))},[n,e])}const Kp={};function TA(n,e,t){!e&&!Kp[n]&&(Kp[n]=!0)}function AA(n,e){n==null||n.v7_startTransition,(n==null?void 0:n.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}const LA="startTransition";Ad[LA];function Xi(n){Ne(!1)}function IA(n){let{basename:e="/",children:t=null,location:r,navigationType:i=On.Pop,navigator:s,static:o=!1,future:a}=n;no()&&Ne(!1);let l=e.replace(/^\/*/,"/"),u=C.exports.useMemo(()=>({basename:l,navigator:s,static:o,future:Fs({v7_relativeSplatPath:!1},a)}),[l,a,s,o]);typeof r=="string"&&(r=Ri(r));let{pathname:c="/",search:d="",hash:f="",state:p=null,key:h="default"}=r,m=C.exports.useMemo(()=>{let g=yf(c,l);return g==null?null:{location:{pathname:g,search:d,hash:f,state:p,key:h},navigationType:i}},[l,c,d,f,p,h,i]);return m==null?null:C.exports.createElement(Rr.Provider,{value:u},C.exports.createElement(Ll.Provider,{children:t,value:m}))}function RA(n){let{children:e,location:t}=n;return cA(Dc(e),t)}new Promise(()=>{});function Dc(n,e){e===void 0&&(e=[]);let t=[];return C.exports.Children.forEach(n,(r,i)=>{if(!C.exports.isValidElement(r))return;let s=[...e,i];if(r.type===C.exports.Fragment){t.push.apply(t,Dc(r.props.children,s));return}r.type!==Xi&&Ne(!1),!r.props.index||!r.props.children||Ne(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Dc(r.props.children,s)),t.push(o)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kc(){return kc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},kc.apply(this,arguments)}function bA(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function CA(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function _A(n,e){return n.button===0&&(!e||e==="_self")&&!CA(n)}const wA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],PA="6";try{window.__reactRouterVersion=PA}catch{}const DA="startTransition",jp=Ad[DA],kA="flushSync";O1[kA];const OA="useId";Ad[OA];function MA(n){let{basename:e,children:t,future:r,window:i}=n,s=C.exports.useRef();s.current==null&&(s.current=M1({window:i,v5Compat:!0}));let o=s.current,[a,l]=C.exports.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},c=C.exports.useCallback(d=>{u&&jp?jp(()=>l(d)):l(d)},[l,u]);return C.exports.useLayoutEffect(()=>o.listen(c),[o,c]),C.exports.useEffect(()=>AA(r),[r]),C.exports.createElement(IA,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const FA=typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement!="undefined",NA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ra=C.exports.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:s,replace:o,state:a,target:l,to:u,preventScrollReset:c,viewTransition:d}=e,f=bA(e,wA),{basename:p}=C.exports.useContext(Rr),h,m=!1;if(typeof u=="string"&&NA.test(u)&&(h=u,FA))try{let E=new URL(window.location.href),S=u.startsWith("//")?new URL(E.protocol+u):new URL(u),T=yf(S.pathname,p);S.origin===E.origin&&T!=null?u=T+S.search+S.hash:m=!0}catch{}let g=lA(u,{relative:i}),v=BA(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:i,viewTransition:d});function y(E){r&&r(E),E.defaultPrevented||v(E)}return C.exports.createElement("a",kc({},f,{href:h||g,onClick:m||s?r:y,ref:t,target:l}))});var Hp;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Hp||(Hp={}));var Wp;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Wp||(Wp={}));function BA(n,e){let{target:t,replace:r,state:i,preventScrollReset:s,relative:o,viewTransition:a}=e===void 0?{}:e,l=br(),u=ro(),c=vy(n,{relative:o});return C.exports.useCallback(d=>{if(_A(d,t)){d.preventDefault();let f=r!==void 0?r:Ba(u)===Ba(c);l(n,{replace:f,state:i,preventScrollReset:s,relative:o,viewTransition:a})}},[u,l,c,r,i,t,n,s,o,a])}var Il={exports:{}},io={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UA=C.exports,xy=60103;io.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var zp=Symbol.for;xy=zp("react.element"),io.Fragment=zp("react.fragment")}var $A=UA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,VA=Object.prototype.hasOwnProperty,GA={key:!0,ref:!0,__self:!0,__source:!0};function Sy(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)VA.call(e,r)&&!GA.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:xy,type:n,key:s,ref:o,props:i,_owner:$A.current}}io.jsx=Sy;io.jsxs=Sy;Il.exports=io;const D=Il.exports.jsx,H=Il.exports.jsxs,Oc=Il.exports.Fragment,Ty=C.exports.createContext(),Rl=()=>C.exports.useContext(Ty),KA=({children:n})=>{const[e,t]=C.exports.useState({}),[r,i]=C.exports.useState(!0),[s,o]=C.exports.useState(null),[a,l]=C.exports.useState({}),[u,c]=C.exports.useState("Initializing...");C.exports.useEffect(()=>{console.log("Fetching media..."),c("Starting fetch...");const h=(v,y={},E=5e3)=>Promise.race([fetch(v,y),new Promise((S,T)=>setTimeout(()=>T(new Error("Request timed out after "+E+"ms")),E))]),m=h("/api/media").then(v=>{if(c(y=>y+`
Media: `+v.status+" "+v.statusText),!v.ok)throw new Error("Failed to fetch media: "+v.status);return v.text().then(y=>{try{return JSON.parse(y)}catch{throw new Error("Media JSON Parse Error: "+y.substring(0,50))}})}),g=h("/api/watched").then(v=>{if(c(y=>y+`
Watched: `+v.status+" "+v.statusText),!v.ok)throw new Error("Failed to fetch watched: "+v.status);return v.json()});Promise.all([m,g]).then(([v,y])=>{console.log("Media Data Received:",v),console.log("Watched Data Received:",y),t(v),l(y),i(!1)}).catch(v=>{console.error("Error loading data:",v),c(y=>y+`
ERROR: `+v.message),o("Failed to load data: "+v.message),i(!1)})},[]);const d=(h,m,g)=>{const v=Date.now();l(y=>{var E,S;return{...y,[h]:{status:m!==void 0?m:((E=y[h])==null?void 0:E.status)||!1,lastWatched:v,currentTime:g!==void 0?g:((S=y[h])==null?void 0:S.currentTime)||0}}}),console.log(`Updating watched status for ${h}: status=${m}, time=${g}`),fetch("/api/watched",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:h,status:m,currentTime:g})}).catch(y=>console.error("Failed to sync watched status",y))},[f,p]=C.exports.useState("");return D(Ty.Provider,{value:{mediaGroups:e,loading:r,error:s,watched:a,loadingStatus:u,searchQuery:f,setSearchQuery:p,updateWatchedStatus:d},children:n})},jA=({filter:n,setFilter:e})=>H("div",{className:"filter-bar",style:{padding:"20px",display:"flex",gap:"10px",justifyContent:"center"},children:[D("button",{className:`filter-btn ${n==="all"?"active":""}`,onClick:()=>e("all"),children:"All"}),D("button",{className:`filter-btn ${n==="series"?"active":""}`,onClick:()=>e("series"),children:"Series"}),D("button",{className:`filter-btn ${n==="movies"?"active":""}`,onClick:()=>e("movies"),children:"Movies"})]});var HA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const WA=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),zA=(n,e)=>{const t=C.exports.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:o,children:a,...l},u)=>C.exports.createElement("svg",{ref:u,...HA,width:i,height:i,stroke:r,strokeWidth:o?Number(s)*24/Number(i):s,className:`lucide lucide-${WA(n)}`,...l},[...e.map(([c,d])=>C.exports.createElement(c,d)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var ke=zA;const YA=ke("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ay=ke("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Qi=ke("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Yp=ke("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),qA=ke("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ly=ke("Film",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"2.18",ry:"2.18",key:"vury4c"}],["line",{x1:"7",x2:"7",y1:"2",y2:"22",key:"t1e4qh"}],["line",{x1:"17",x2:"17",y1:"2",y2:"22",key:"1tliql"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"2",x2:"7",y1:"7",y2:"7",key:"1wdzzh"}],["line",{x1:"2",x2:"7",y1:"17",y2:"17",key:"2fufxq"}],["line",{x1:"17",x2:"22",y1:"17",y2:"17",key:"1xg577"}],["line",{x1:"17",x2:"22",y1:"7",y2:"7",key:"acrv2l"}]]),XA=ke("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),uu=ke("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),QA=ke("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),ZA=ke("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),qp=ke("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),JA=ke("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),eL=ke("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),tL=ke("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),bl=ke("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),nL=ke("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),rL=ke("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),iL=ke("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),sL=ke("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),oL=ke("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),aL=ke("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),lL=ke("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),uL=({item:n})=>{const e=br();if(!n)return null;const t=()=>{e(`/watch/${encodeURIComponent(n.id)}`)};return H("div",{className:"hero-section",style:{height:"60vh",width:"100%",position:"relative",background:`linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 60%), url(/media/${n.image}) center/cover no-repeat`,display:"flex",alignItems:"end",padding:"4rem 3rem",overflow:"hidden",marginBottom:"2rem"},children:[H("div",{className:"hero-content",style:{zIndex:1,maxWidth:"600px"},children:[D("h1",{style:{fontSize:"3.5rem",margin:"0 0 1rem 0",fontWeight:"800",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:n.group}),H("p",{style:{fontSize:"1.1rem",color:"#ccc",marginBottom:"2rem",lineHeight:"1.5"},children:["Reproduce el contenido de ",n.group," ahora mismo. Disfruta de la mejor calidad de streaming local."]}),H("div",{style:{display:"flex",gap:"1rem"},children:[H("button",{onClick:t,style:{background:"#e50914",color:"white",border:"none",padding:"0.8rem 2rem",borderRadius:"4px",fontSize:"1.1rem",fontWeight:"bold",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:r=>r.target.style.background="#b20710",onMouseLeave:r=>r.target.style.background="#e50914",children:[D(bl,{fill:"white",size:24}),"Reproducir"]}),D("button",{onClick:()=>e(`/details/${encodeURIComponent(n.group)}`),style:{background:"rgba(255,255,255,0.2)",color:"white",border:"none",padding:"0.8rem 2rem",borderRadius:"4px",fontSize:"1.1rem",fontWeight:"bold",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:r=>r.target.style.background="rgba(255,255,255,0.3)",onMouseLeave:r=>r.target.style.background="rgba(255,255,255,0.2)",children:"M\xE1s informaci\xF3n"})]})]}),D("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:"150px",background:"linear-gradient(to top, var(--bg-color), transparent)"}})]})};var Mc=function(n,e){return Mc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Mc(n,e)};function Iy(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Mc(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var W=function(){return W=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},W.apply(this,arguments)};function _t(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function cL(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function De(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function $t(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var dL="production",xf=typeof process=="undefined"||process.env===void 0?dL:"production",an=function(n){return{isEnabled:function(e){return n.some(function(t){return!!e[t]})}}},Ns={measureLayout:an(["layout","layoutId","drag"]),animation:an(["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag","whileInView"]),exit:an(["exit"]),drag:an(["drag","dragControls"]),focus:an(["whileFocus"]),hover:an(["whileHover","onHoverStart","onHoverEnd"]),tap:an(["whileTap","onTap","onTapStart","onTapCancel"]),pan:an(["onPan","onPanStart","onPanSessionStart","onPanEnd"]),inView:an(["whileInView","onViewportEnter","onViewportLeave"])};function fL(n){for(var e in n)n[e]!==null&&(e==="projectionNodeConstructor"?Ns.projectionNodeConstructor=n[e]:Ns[e].Component=n[e])}var hL=function(){},$a=function(){},Ry=C.exports.createContext({strict:!1}),by=Object.keys(Ns),pL=by.length;function gL(n,e,t){var r=[],i=C.exports.useContext(Ry);if(!e)return null;xf!=="production"&&t&&i.strict;for(var s=0;s<pL;s++){var o=by[s],a=Ns[o],l=a.isEnabled,u=a.Component;l(n)&&u&&r.push(C.exports.createElement(u,W({key:o},n,{visualElement:e})))}return r}var Sf=C.exports.createContext({transformPagePoint:function(n){return n},isStatic:!1,reducedMotion:"never"}),Cl=C.exports.createContext({});function mL(){return C.exports.useContext(Cl).visualElement}var so=C.exports.createContext(null),bi=typeof document!="undefined",Va=bi?C.exports.useLayoutEffect:C.exports.useEffect,Fc={current:null},Cy=!1;function vL(){if(Cy=!0,!!bi)if(window.matchMedia){var n=window.matchMedia("(prefers-reduced-motion)"),e=function(){return Fc.current=n.matches};n.addListener(e),e()}else Fc.current=!1}function yL(){!Cy&&vL();var n=De(C.exports.useState(Fc.current),1),e=n[0];return e}function EL(){var n=yL(),e=C.exports.useContext(Sf).reducedMotion;return e==="never"?!1:e==="always"?!0:n}function xL(n,e,t,r){var i=C.exports.useContext(Ry),s=mL(),o=C.exports.useContext(so),a=EL(),l=C.exports.useRef(void 0);r||(r=i.renderer),!l.current&&r&&(l.current=r(n,{visualState:e,parent:s,props:t,presenceId:o==null?void 0:o.id,blockInitialAnimation:(o==null?void 0:o.initial)===!1,shouldReduceMotion:a}));var u=l.current;return Va(function(){u==null||u.syncRender()}),C.exports.useEffect(function(){var c;(c=u==null?void 0:u.animationState)===null||c===void 0||c.animateChanges()}),Va(function(){return function(){return u==null?void 0:u.notifyUnmount()}},[]),u}function Wr(n){return typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function SL(n,e,t){return C.exports.useCallback(function(r){var i;r&&((i=n.mount)===null||i===void 0||i.call(n,r)),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):Wr(t)&&(t.current=r))},[e])}function _y(n){return Array.isArray(n)}function Bt(n){return typeof n=="string"||_y(n)}function TL(n){var e={};return n.forEachValue(function(t,r){return e[r]=t.get()}),e}function AL(n){var e={};return n.forEachValue(function(t,r){return e[r]=t.getVelocity()}),e}function wy(n,e,t,r,i){var s;return r===void 0&&(r={}),i===void 0&&(i={}),typeof e=="function"&&(e=e(t!=null?t:n.custom,r,i)),typeof e=="string"&&(e=(s=n.variants)===null||s===void 0?void 0:s[e]),typeof e=="function"&&(e=e(t!=null?t:n.custom,r,i)),e}function _l(n,e,t){var r=n.getProps();return wy(r,e,t!=null?t:r.custom,TL(n),AL(n))}function wl(n){var e;return typeof((e=n.animate)===null||e===void 0?void 0:e.start)=="function"||Bt(n.initial)||Bt(n.animate)||Bt(n.whileHover)||Bt(n.whileDrag)||Bt(n.whileTap)||Bt(n.whileFocus)||Bt(n.exit)}function Py(n){return Boolean(wl(n)||n.variants)}function LL(n,e){if(wl(n)){var t=n.initial,r=n.animate;return{initial:t===!1||Bt(t)?t:void 0,animate:Bt(r)?r:void 0}}return n.inherit!==!1?e:{}}function IL(n){var e=LL(n,C.exports.useContext(Cl)),t=e.initial,r=e.animate;return C.exports.useMemo(function(){return{initial:t,animate:r}},[Xp(t),Xp(r)])}function Xp(n){return Array.isArray(n)?n.join(" "):n}function oo(n){var e=C.exports.useRef(null);return e.current===null&&(e.current=n()),e.current}var ds={hasAnimatedSinceResize:!0,hasEverUpdated:!1},RL=1;function bL(){return oo(function(){if(ds.hasEverUpdated)return RL++})}var Tf=C.exports.createContext({}),Dy=C.exports.createContext({});function CL(n,e,t,r){var i,s=e.layoutId,o=e.layout,a=e.drag,l=e.dragConstraints,u=e.layoutScroll,c=C.exports.useContext(Dy);!r||!t||(t==null?void 0:t.projection)||(t.projection=new r(n,t.getLatestValues(),(i=t.parent)===null||i===void 0?void 0:i.projection),t.projection.setOptions({layoutId:s,layout:o,alwaysMeasureLayout:Boolean(a)||l&&Wr(l),visualElement:t,scheduleRender:function(){return t.scheduleRender()},animationType:typeof o=="string"?o:"both",initialPromotionConfig:c,layoutScroll:u}))}var _L=function(n){Iy(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getSnapshotBeforeUpdate=function(){return this.updateProps(),null},e.prototype.componentDidUpdate=function(){},e.prototype.updateProps=function(){var t=this.props,r=t.visualElement,i=t.props;r&&r.setProps(i)},e.prototype.render=function(){return this.props.children},e}(ul.Component);function wL(n){var e=n.preloadedFeatures,t=n.createVisualElement,r=n.projectionNodeConstructor,i=n.useRender,s=n.useVisualState,o=n.Component;e&&fL(e);function a(l,u){var c=PL(l);l=W(W({},l),{layoutId:c});var d=C.exports.useContext(Sf),f=null,p=IL(l),h=d.isStatic?void 0:bL(),m=s(l,d.isStatic);return!d.isStatic&&bi&&(p.visualElement=xL(o,m,W(W({},d),l),t),CL(h,l,p.visualElement,r||Ns.projectionNodeConstructor),f=gL(l,p.visualElement,e)),C.exports.createElement(_L,{visualElement:p.visualElement,props:W(W({},d),l)},f,C.exports.createElement(Cl.Provider,{value:p},i(o,l,h,SL(m,p.visualElement,u),m,d.isStatic,p.visualElement)))}return C.exports.forwardRef(a)}function PL(n){var e,t=n.layoutId,r=(e=C.exports.useContext(Tf))===null||e===void 0?void 0:e.id;return r&&t!==void 0?r+"-"+t:t}function DL(n){function e(r,i){return i===void 0&&(i={}),wL(n(r,i))}if(typeof Proxy=="undefined")return e;var t=new Map;return new Proxy(e,{get:function(r,i){return t.has(i)||t.set(i,e(i)),t.get(i)}})}var kL=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","svg","switch","symbol","text","tspan","use","view"];function Af(n){return typeof n!="string"||n.includes("-")?!1:!!(kL.indexOf(n)>-1||/[A-Z]/.test(n))}var Ga={};function OL(n){Object.assign(Ga,n)}var Nc=["","X","Y","Z"],ML=["translate","scale","rotate","skew"],Bs=["transformPerspective","x","y","z"];ML.forEach(function(n){return Nc.forEach(function(e){return Bs.push(n+e)})});function FL(n,e){return Bs.indexOf(n)-Bs.indexOf(e)}var NL=new Set(Bs);function ao(n){return NL.has(n)}var BL=new Set(["originX","originY","originZ"]);function ky(n){return BL.has(n)}function Oy(n,e){var t=e.layout,r=e.layoutId;return ao(n)||ky(n)||(t||r!==void 0)&&(!!Ga[n]||n==="opacity")}var yn=function(n){return Boolean(n!==null&&typeof n=="object"&&n.getVelocity)},UL={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"};function $L(n,e,t,r){var i=n.transform,s=n.transformKeys,o=e.enableHardwareAcceleration,a=o===void 0?!0:o,l=e.allowTransformNone,u=l===void 0?!0:l,c="";s.sort(FL);for(var d=!1,f=s.length,p=0;p<f;p++){var h=s[p];c+="".concat(UL[h]||h,"(").concat(i[h],") "),h==="z"&&(d=!0)}return!d&&a?c+="translateZ(0)":c=c.trim(),r?c=r(i,t?"":c):u&&t&&(c="none"),c}function VL(n){var e=n.originX,t=e===void 0?"50%":e,r=n.originY,i=r===void 0?"50%":r,s=n.originZ,o=s===void 0?0:s;return"".concat(t," ").concat(i," ").concat(o)}function My(n){return n.startsWith("--")}var GL=function(n,e){return e&&typeof n=="number"?e.transform(n):n};const Fy=(n,e)=>t=>Math.max(Math.min(t,e),n),fs=n=>n%1?Number(n.toFixed(5)):n,Us=/(-)?([\d]*\.?[\d])+/g,Bc=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,KL=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function lo(n){return typeof n=="string"}const Cr={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},hs=Object.assign(Object.assign({},Cr),{transform:Fy(0,1)}),Io=Object.assign(Object.assign({},Cr),{default:1}),uo=n=>({test:e=>lo(e)&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Ln=uo("deg"),tn=uo("%"),ie=uo("px"),jL=uo("vh"),HL=uo("vw"),Qp=Object.assign(Object.assign({},tn),{parse:n=>tn.parse(n)/100,transform:n=>tn.transform(n*100)}),Lf=(n,e)=>t=>Boolean(lo(t)&&KL.test(t)&&t.startsWith(n)||e&&Object.prototype.hasOwnProperty.call(t,e)),Ny=(n,e,t)=>r=>{if(!lo(r))return r;const[i,s,o,a]=r.match(Us);return{[n]:parseFloat(i),[e]:parseFloat(s),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},gr={test:Lf("hsl","hue"),parse:Ny("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+tn.transform(fs(e))+", "+tn.transform(fs(t))+", "+fs(hs.transform(r))+")"},WL=Fy(0,255),cu=Object.assign(Object.assign({},Cr),{transform:n=>Math.round(WL(n))}),Mn={test:Lf("rgb","red"),parse:Ny("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+cu.transform(n)+", "+cu.transform(e)+", "+cu.transform(t)+", "+fs(hs.transform(r))+")"};function zL(n){let e="",t="",r="",i="";return n.length>5?(e=n.substr(1,2),t=n.substr(3,2),r=n.substr(5,2),i=n.substr(7,2)):(e=n.substr(1,1),t=n.substr(2,1),r=n.substr(3,1),i=n.substr(4,1),e+=e,t+=t,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const Uc={test:Lf("#"),parse:zL,transform:Mn.transform},it={test:n=>Mn.test(n)||Uc.test(n)||gr.test(n),parse:n=>Mn.test(n)?Mn.parse(n):gr.test(n)?gr.parse(n):Uc.parse(n),transform:n=>lo(n)?n:n.hasOwnProperty("red")?Mn.transform(n):gr.transform(n)},By="${c}",Uy="${n}";function YL(n){var e,t,r,i;return isNaN(n)&&lo(n)&&((t=(e=n.match(Us))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((i=(r=n.match(Bc))===null||r===void 0?void 0:r.length)!==null&&i!==void 0?i:0)>0}function $y(n){typeof n=="number"&&(n=`${n}`);const e=[];let t=0;const r=n.match(Bc);r&&(t=r.length,n=n.replace(Bc,By),e.push(...r.map(it.parse)));const i=n.match(Us);return i&&(n=n.replace(Us,Uy),e.push(...i.map(Cr.parse))),{values:e,numColors:t,tokenised:n}}function Vy(n){return $y(n).values}function Gy(n){const{values:e,numColors:t,tokenised:r}=$y(n),i=e.length;return s=>{let o=r;for(let a=0;a<i;a++)o=o.replace(a<t?By:Uy,a<t?it.transform(s[a]):fs(s[a]));return o}}const qL=n=>typeof n=="number"?0:n;function XL(n){const e=Vy(n);return Gy(n)(e.map(qL))}const En={test:YL,parse:Vy,createTransformer:Gy,getAnimatableNone:XL},QL=new Set(["brightness","contrast","saturate","opacity"]);function ZL(n){let[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(Us)||[];if(!r)return n;const i=t.replace(r,"");let s=QL.has(e)?1:0;return r!==t&&(s*=100),e+"("+s+i+")"}const JL=/([a-z-]*)\(.*?\)/g,$c=Object.assign(Object.assign({},En),{getAnimatableNone:n=>{const e=n.match(JL);return e?e.map(ZL).join(" "):n}});var Zp=W(W({},Cr),{transform:Math.round}),Ky={borderWidth:ie,borderTopWidth:ie,borderRightWidth:ie,borderBottomWidth:ie,borderLeftWidth:ie,borderRadius:ie,radius:ie,borderTopLeftRadius:ie,borderTopRightRadius:ie,borderBottomRightRadius:ie,borderBottomLeftRadius:ie,width:ie,maxWidth:ie,height:ie,maxHeight:ie,size:ie,top:ie,right:ie,bottom:ie,left:ie,padding:ie,paddingTop:ie,paddingRight:ie,paddingBottom:ie,paddingLeft:ie,margin:ie,marginTop:ie,marginRight:ie,marginBottom:ie,marginLeft:ie,rotate:Ln,rotateX:Ln,rotateY:Ln,rotateZ:Ln,scale:Io,scaleX:Io,scaleY:Io,scaleZ:Io,skew:Ln,skewX:Ln,skewY:Ln,distance:ie,translateX:ie,translateY:ie,translateZ:ie,x:ie,y:ie,z:ie,perspective:ie,transformPerspective:ie,opacity:hs,originX:Qp,originY:Qp,originZ:ie,zIndex:Zp,fillOpacity:hs,strokeOpacity:hs,numOctaves:Zp};function If(n,e,t,r){var i,s=n.style,o=n.vars,a=n.transform,l=n.transformKeys,u=n.transformOrigin;l.length=0;var c=!1,d=!1,f=!0;for(var p in e){var h=e[p];if(My(p)){o[p]=h;continue}var m=Ky[p],g=GL(h,m);if(ao(p)){if(c=!0,a[p]=g,l.push(p),!f)continue;h!==((i=m.default)!==null&&i!==void 0?i:0)&&(f=!1)}else ky(p)?(u[p]=g,d=!0):s[p]=g}c?s.transform=$L(n,t,f,r):r?s.transform=r({},""):!e.transform&&s.transform&&(s.transform="none"),d&&(s.transformOrigin=VL(u))}var Rf=function(){return{style:{},transform:{},transformKeys:[],transformOrigin:{},vars:{}}};function jy(n,e,t){for(var r in e)!yn(e[r])&&!Oy(r,t)&&(n[r]=e[r])}function eI(n,e,t){var r=n.transformTemplate;return C.exports.useMemo(function(){var i=Rf();If(i,e,{enableHardwareAcceleration:!t},r);var s=i.vars,o=i.style;return W(W({},s),o)},[e])}function tI(n,e,t){var r=n.style||{},i={};return jy(i,r,n),Object.assign(i,eI(n,e,t)),n.transformValues&&(i=n.transformValues(i)),i}function nI(n,e,t){var r={},i=tI(n,e,t);return Boolean(n.drag)&&n.dragListener!==!1&&(r.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=n.drag===!0?"none":"pan-".concat(n.drag==="x"?"y":"x")),r.style=i,r}var rI=new Set(["initial","animate","exit","style","variants","transition","transformTemplate","transformValues","custom","inherit","layout","layoutId","layoutDependency","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","dragSnapToOrigin","_dragX","_dragY","dragElastic","dragMomentum","dragPropagation","dragTransition","whileDrag","onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","onHoverStart","onHoverEnd","whileFocus","whileTap","whileHover","whileInView","onViewportEnter","onViewportLeave","viewport","layoutScroll"]);function Ka(n){return rI.has(n)}var Hy=function(n){return!Ka(n)};function iI(n){!n||(Hy=function(e){return e.startsWith("on")?!Ka(e):n(e)})}try{iI(require("@emotion/is-prop-valid").default)}catch{}function sI(n,e,t){var r={};for(var i in n)(Hy(i)||t===!0&&Ka(i)||!e&&!Ka(i)||n.draggable&&i.startsWith("onDrag"))&&(r[i]=n[i]);return r}function Jp(n,e,t){return typeof n=="string"?n:ie.transform(e+t*n)}function oI(n,e,t){var r=Jp(e,n.x,n.width),i=Jp(t,n.y,n.height);return"".concat(r," ").concat(i)}var aI={offset:"stroke-dashoffset",array:"stroke-dasharray"},lI={offset:"strokeDashoffset",array:"strokeDasharray"};function uI(n,e,t,r,i){t===void 0&&(t=1),r===void 0&&(r=0),i===void 0&&(i=!0),n.pathLength=1;var s=i?aI:lI;n[s.offset]=ie.transform(-r);var o=ie.transform(e),a=ie.transform(t);n[s.array]="".concat(o," ").concat(a)}function bf(n,e,t,r){var i=e.attrX,s=e.attrY,o=e.originX,a=e.originY,l=e.pathLength,u=e.pathSpacing,c=u===void 0?1:u,d=e.pathOffset,f=d===void 0?0:d,p=_t(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]);If(n,p,t,r),n.attrs=n.style,n.style={};var h=n.attrs,m=n.style,g=n.dimensions;h.transform&&(g&&(m.transform=h.transform),delete h.transform),g&&(o!==void 0||a!==void 0||m.transform)&&(m.transformOrigin=oI(g,o!==void 0?o:.5,a!==void 0?a:.5)),i!==void 0&&(h.x=i),s!==void 0&&(h.y=s),l!==void 0&&uI(h,l,c,f,!1)}var Wy=function(){return W(W({},Rf()),{attrs:{}})};function cI(n,e){var t=C.exports.useMemo(function(){var i=Wy();return bf(i,e,{enableHardwareAcceleration:!1},n.transformTemplate),W(W({},i.attrs),{style:W({},i.style)})},[e]);if(n.style){var r={};jy(r,n.style,n),t.style=W(W({},r),t.style)}return t}function dI(n){n===void 0&&(n=!1);var e=function(t,r,i,s,o,a){var l=o.latestValues,u=Af(t)?cI:nI,c=u(r,l,a),d=sI(r,typeof t=="string",n),f=W(W(W({},d),c),{ref:s});return i&&(f["data-projection-id"]=i),C.exports.createElement(t,f)};return e}var fI=/([a-z])([A-Z])/g,hI="$1-$2",zy=function(n){return n.replace(fI,hI).toLowerCase()};function Yy(n,e,t,r){var i=e.style,s=e.vars;Object.assign(n.style,i,r&&r.getProjectionStyles(t));for(var o in s)n.style.setProperty(o,s[o])}var qy=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength"]);function Xy(n,e,t,r){Yy(n,e,void 0,r);for(var i in e.attrs)n.setAttribute(qy.has(i)?i:zy(i),e.attrs[i])}function Cf(n){var e=n.style,t={};for(var r in e)(yn(e[r])||Oy(r,n))&&(t[r]=e[r]);return t}function Qy(n){var e=Cf(n);for(var t in n)if(yn(n[t])){var r=t==="x"||t==="y"?"attr"+t.toUpperCase():t;e[r]=n[t]}return e}function _f(n){return typeof n=="object"&&typeof n.start=="function"}var $s=function(n){return Array.isArray(n)},pI=function(n){return Boolean(n&&typeof n=="object"&&n.mix&&n.toValue)},Zy=function(n){return $s(n)?n[n.length-1]||0:n};function ia(n){var e=yn(n)?n.get():n;return pI(e)?e.toValue():e}function eg(n,e,t,r){var i=n.scrapeMotionValuesFromProps,s=n.createRenderState,o=n.onMount,a={latestValues:gI(e,t,r,i),renderState:s()};return o&&(a.mount=function(l){return o(e,l,a)}),a}var Jy=function(n){return function(e,t){var r=C.exports.useContext(Cl),i=C.exports.useContext(so);return t?eg(n,e,r,i):oo(function(){return eg(n,e,r,i)})}};function gI(n,e,t,r){var i={},s=(t==null?void 0:t.initial)===!1,o=r(n);for(var a in o)i[a]=ia(o[a]);var l=n.initial,u=n.animate,c=wl(n),d=Py(n);e&&d&&!c&&n.inherit!==!1&&(l!=null||(l=e.initial),u!=null||(u=e.animate));var f=s||l===!1,p=f?u:l;if(p&&typeof p!="boolean"&&!_f(p)){var h=Array.isArray(p)?p:[p];h.forEach(function(m){var g=wy(n,m);if(!!g){var v=g.transitionEnd;g.transition;var y=_t(g,["transitionEnd","transition"]);for(var E in y){var S=y[E];if(Array.isArray(S)){var T=f?S.length-1:0;S=S[T]}S!==null&&(i[E]=S)}for(var E in v)i[E]=v[E]}})}return i}var mI={useVisualState:Jy({scrapeMotionValuesFromProps:Qy,createRenderState:Wy,onMount:function(n,e,t){var r=t.renderState,i=t.latestValues;try{r.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}bf(r,i,{enableHardwareAcceleration:!1},n.transformTemplate),Xy(e,r)}})},vI={useVisualState:Jy({scrapeMotionValuesFromProps:Cf,createRenderState:Rf})};function yI(n,e,t,r,i){var s=e.forwardMotionProps,o=s===void 0?!1:s,a=Af(n)?mI:vI;return W(W({},a),{preloadedFeatures:t,useRender:dI(o),createVisualElement:r,projectionNodeConstructor:i,Component:n})}var Se;(function(n){n.Animate="animate",n.Hover="whileHover",n.Tap="whileTap",n.Drag="whileDrag",n.Focus="whileFocus",n.InView="whileInView",n.Exit="exit"})(Se||(Se={}));function Pl(n,e,t,r){return r===void 0&&(r={passive:!0}),n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t)}}function Vc(n,e,t,r){C.exports.useEffect(function(){var i=n.current;if(t&&i)return Pl(i,e,t,r)},[n,e,t,r])}function EI(n){var e=n.whileFocus,t=n.visualElement,r=function(){var s;(s=t.animationState)===null||s===void 0||s.setActive(Se.Focus,!0)},i=function(){var s;(s=t.animationState)===null||s===void 0||s.setActive(Se.Focus,!1)};Vc(t,"focus",e?r:void 0),Vc(t,"blur",e?i:void 0)}function eE(n){return typeof PointerEvent!="undefined"&&n instanceof PointerEvent?n.pointerType==="mouse":n instanceof MouseEvent}function tE(n){var e=!!n.touches;return e}function xI(n){return function(e){var t=e instanceof MouseEvent,r=!t||t&&e.button===0;r&&n(e)}}var SI={pageX:0,pageY:0};function TI(n,e){e===void 0&&(e="page");var t=n.touches[0]||n.changedTouches[0],r=t||SI;return{x:r[e+"X"],y:r[e+"Y"]}}function AI(n,e){return e===void 0&&(e="page"),{x:n[e+"X"],y:n[e+"Y"]}}function wf(n,e){return e===void 0&&(e="page"),{point:tE(n)?TI(n,e):AI(n,e)}}var nE=function(n,e){e===void 0&&(e=!1);var t=function(r){return n(r,wf(r))};return e?xI(t):t},LI=function(){return bi&&window.onpointerdown===null},II=function(){return bi&&window.ontouchstart===null},RI=function(){return bi&&window.onmousedown===null},bI={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},CI={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function rE(n){return LI()?n:II()?CI[n]:RI()?bI[n]:n}function si(n,e,t,r){return Pl(n,rE(e),nE(t,e==="pointerdown"),r)}function ja(n,e,t,r){return Vc(n,rE(e),t&&nE(t,e==="pointerdown"),r)}function iE(n){var e=null;return function(){var t=function(){e=null};return e===null?(e=n,t):!1}}var tg=iE("dragHorizontal"),ng=iE("dragVertical");function sE(n){var e=!1;if(n==="y")e=ng();else if(n==="x")e=tg();else{var t=tg(),r=ng();t&&r?e=function(){t(),r()}:(t&&t(),r&&r())}return e}function oE(){var n=sE(!0);return n?(n(),!1):!0}function rg(n,e,t){return function(r,i){var s;!eE(r)||oE()||((s=n.animationState)===null||s===void 0||s.setActive(Se.Hover,e),t==null||t(r,i))}}function _I(n){var e=n.onHoverStart,t=n.onHoverEnd,r=n.whileHover,i=n.visualElement;ja(i,"pointerenter",e||r?rg(i,!0,e):void 0,{passive:!e}),ja(i,"pointerleave",t||r?rg(i,!1,t):void 0,{passive:!t})}var aE=function(n,e){return e?n===e?!0:aE(n,e.parentElement):!1};function Pf(n){return C.exports.useEffect(function(){return function(){return n()}},[])}const Ha=(n,e,t)=>Math.min(Math.max(t,n),e),du=.001,wI=.01,ig=10,PI=.05,DI=1;function kI({duration:n=800,bounce:e=.25,velocity:t=0,mass:r=1}){let i,s;hL(n<=ig*1e3);let o=1-e;o=Ha(PI,DI,o),n=Ha(wI,ig,n/1e3),o<1?(i=u=>{const c=u*o,d=c*n,f=c-t,p=Gc(u,o),h=Math.exp(-d);return du-f/p*h},s=u=>{const d=u*o*n,f=d*t+t,p=Math.pow(o,2)*Math.pow(u,2)*n,h=Math.exp(-d),m=Gc(Math.pow(u,2),o);return(-i(u)+du>0?-1:1)*((f-p)*h)/m}):(i=u=>{const c=Math.exp(-u*n),d=(u-t)*n+1;return-du+c*d},s=u=>{const c=Math.exp(-u*n),d=(t-u)*(n*n);return c*d});const a=5/n,l=MI(i,s,a);if(n=n*1e3,isNaN(l))return{stiffness:100,damping:10,duration:n};{const u=Math.pow(l,2)*r;return{stiffness:u,damping:o*2*Math.sqrt(r*u),duration:n}}}const OI=12;function MI(n,e,t){let r=t;for(let i=1;i<OI;i++)r=r-n(r)/e(r);return r}function Gc(n,e){return n*Math.sqrt(1-e*e)}const FI=["duration","bounce"],NI=["stiffness","damping","mass"];function sg(n,e){return e.some(t=>n[t]!==void 0)}function BI(n){let e=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},n);if(!sg(n,NI)&&sg(n,FI)){const t=kI(n);e=Object.assign(Object.assign(Object.assign({},e),t),{velocity:0,mass:1}),e.isResolvedFromDuration=!0}return e}function Df(n){var{from:e=0,to:t=1,restSpeed:r=2,restDelta:i}=n,s=_t(n,["from","to","restSpeed","restDelta"]);const o={done:!1,value:e};let{stiffness:a,damping:l,mass:u,velocity:c,duration:d,isResolvedFromDuration:f}=BI(s),p=og,h=og;function m(){const g=c?-(c/1e3):0,v=t-e,y=l/(2*Math.sqrt(a*u)),E=Math.sqrt(a/u)/1e3;if(i===void 0&&(i=Math.min(Math.abs(t-e)/100,.4)),y<1){const S=Gc(E,y);p=T=>{const L=Math.exp(-y*E*T);return t-L*((g+y*E*v)/S*Math.sin(S*T)+v*Math.cos(S*T))},h=T=>{const L=Math.exp(-y*E*T);return y*E*L*(Math.sin(S*T)*(g+y*E*v)/S+v*Math.cos(S*T))-L*(Math.cos(S*T)*(g+y*E*v)-S*v*Math.sin(S*T))}}else if(y===1)p=S=>t-Math.exp(-E*S)*(v+(g+E*v)*S);else{const S=E*Math.sqrt(y*y-1);p=T=>{const L=Math.exp(-y*E*T),A=Math.min(S*T,300);return t-L*((g+y*E*v)*Math.sinh(A)+S*v*Math.cosh(A))/S}}}return m(),{next:g=>{const v=p(g);if(f)o.done=g>=d;else{const y=h(g)*1e3,E=Math.abs(y)<=r,S=Math.abs(t-v)<=i;o.done=E&&S}return o.value=o.done?t:v,o},flipTarget:()=>{c=-c,[e,t]=[t,e],m()}}}Df.needsInterpolation=(n,e)=>typeof n=="string"||typeof e=="string";const og=n=>0,Vs=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r},Pe=(n,e,t)=>-t*n+t*e+n;function fu(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function ag({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let i=0,s=0,o=0;if(!e)i=s=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;i=fu(l,a,n+1/3),s=fu(l,a,n),o=fu(l,a,n-1/3)}return{red:Math.round(i*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:r}}const UI=(n,e,t)=>{const r=n*n,i=e*e;return Math.sqrt(Math.max(0,t*(i-r)+r))},$I=[Uc,Mn,gr],lg=n=>$I.find(e=>e.test(n)),lE=(n,e)=>{let t=lg(n),r=lg(e),i=t.parse(n),s=r.parse(e);t===gr&&(i=ag(i),t=Mn),r===gr&&(s=ag(s),r=Mn);const o=Object.assign({},i);return a=>{for(const l in o)l!=="alpha"&&(o[l]=UI(i[l],s[l],a));return o.alpha=Pe(i.alpha,s.alpha,a),t.transform(o)}},Kc=n=>typeof n=="number",VI=(n,e)=>t=>e(n(t)),Dl=(...n)=>n.reduce(VI);function uE(n,e){return Kc(n)?t=>Pe(n,e,t):it.test(n)?lE(n,e):dE(n,e)}const cE=(n,e)=>{const t=[...n],r=t.length,i=n.map((s,o)=>uE(s,e[o]));return s=>{for(let o=0;o<r;o++)t[o]=i[o](s);return t}},GI=(n,e)=>{const t=Object.assign(Object.assign({},n),e),r={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(r[i]=uE(n[i],e[i]));return i=>{for(const s in r)t[s]=r[s](i);return t}};function ug(n){const e=En.parse(n),t=e.length;let r=0,i=0,s=0;for(let o=0;o<t;o++)r||typeof e[o]=="number"?r++:e[o].hue!==void 0?s++:i++;return{parsed:e,numNumbers:r,numRGB:i,numHSL:s}}const dE=(n,e)=>{const t=En.createTransformer(e),r=ug(n),i=ug(e);return r.numHSL===i.numHSL&&r.numRGB===i.numRGB&&r.numNumbers>=i.numNumbers?Dl(cE(r.parsed,i.parsed),t):o=>`${o>0?e:n}`},KI=(n,e)=>t=>Pe(n,e,t);function jI(n){if(typeof n=="number")return KI;if(typeof n=="string")return it.test(n)?lE:dE;if(Array.isArray(n))return cE;if(typeof n=="object")return GI}function HI(n,e,t){const r=[],i=t||jI(n[0]),s=n.length-1;for(let o=0;o<s;o++){let a=i(n[o],n[o+1]);if(e){const l=Array.isArray(e)?e[o]:e;a=Dl(l,a)}r.push(a)}return r}function WI([n,e],[t]){return r=>t(Vs(n,e,r))}function zI(n,e){const t=n.length,r=t-1;return i=>{let s=0,o=!1;if(i<=n[0]?o=!0:i>=n[r]&&(s=r-1,o=!0),!o){let l=1;for(;l<t&&!(n[l]>i||l===r);l++);s=l-1}const a=Vs(n[s],n[s+1],i);return e[s](a)}}function fE(n,e,{clamp:t=!0,ease:r,mixer:i}={}){const s=n.length;$a(s===e.length),$a(!r||!Array.isArray(r)||r.length===s-1),n[0]>n[s-1]&&(n=[].concat(n),e=[].concat(e),n.reverse(),e.reverse());const o=HI(e,r,i),a=s===2?WI(n,o):zI(n,o);return t?l=>a(Ha(n[0],n[s-1],l)):a}const kl=n=>e=>1-n(1-e),kf=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,YI=n=>e=>Math.pow(e,n),hE=n=>e=>e*e*((n+1)*e-n),qI=n=>{const e=hE(n);return t=>(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))},pE=1.525,XI=4/11,QI=8/11,ZI=9/10,Of=n=>n,Mf=YI(2),JI=kl(Mf),gE=kf(Mf),mE=n=>1-Math.sin(Math.acos(n)),Ff=kl(mE),eR=kf(Ff),Nf=hE(pE),tR=kl(Nf),nR=kf(Nf),rR=qI(pE),iR=4356/361,sR=35442/1805,oR=16061/1805,Wa=n=>{if(n===1||n===0)return n;const e=n*n;return n<XI?7.5625*e:n<QI?9.075*e-9.9*n+3.4:n<ZI?iR*e-sR*n+oR:10.8*n*n-20.52*n+10.72},aR=kl(Wa),lR=n=>n<.5?.5*(1-Wa(1-n*2)):.5*Wa(n*2-1)+.5;function uR(n,e){return n.map(()=>e||gE).splice(0,n.length-1)}function cR(n){const e=n.length;return n.map((t,r)=>r!==0?r/(e-1):0)}function dR(n,e){return n.map(t=>t*e)}function sa({from:n=0,to:e=1,ease:t,offset:r,duration:i=300}){const s={done:!1,value:n},o=Array.isArray(e)?e:[n,e],a=dR(r&&r.length===o.length?r:cR(o),i);function l(){return fE(a,o,{ease:Array.isArray(t)?t:uR(o,t)})}let u=l();return{next:c=>(s.value=u(c),s.done=c>=i,s),flipTarget:()=>{o.reverse(),u=l()}}}function fR({velocity:n=0,from:e=0,power:t=.8,timeConstant:r=350,restDelta:i=.5,modifyTarget:s}){const o={done:!1,value:e};let a=t*n;const l=e+a,u=s===void 0?l:s(l);return u!==l&&(a=u-e),{next:c=>{const d=-a*Math.exp(-c/r);return o.done=!(d>i||d<-i),o.value=o.done?u:u+d,o},flipTarget:()=>{}}}const cg={keyframes:sa,spring:Df,decay:fR};function hR(n){if(Array.isArray(n.to))return sa;if(cg[n.type])return cg[n.type];const e=new Set(Object.keys(n));return e.has("ease")||e.has("duration")&&!e.has("dampingRatio")?sa:e.has("dampingRatio")||e.has("stiffness")||e.has("mass")||e.has("damping")||e.has("restSpeed")||e.has("restDelta")?Df:sa}const vE=1/60*1e3,pR=typeof performance!="undefined"?()=>performance.now():()=>Date.now(),yE=typeof window!="undefined"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(pR()),vE);function gR(n){let e=[],t=[],r=0,i=!1,s=!1;const o=new WeakSet,a={schedule:(l,u=!1,c=!1)=>{const d=c&&i,f=d?e:t;return u&&o.add(l),f.indexOf(l)===-1&&(f.push(l),d&&i&&(r=e.length)),l},cancel:l=>{const u=t.indexOf(l);u!==-1&&t.splice(u,1),o.delete(l)},process:l=>{if(i){s=!0;return}if(i=!0,[e,t]=[t,e],t.length=0,r=e.length,r)for(let u=0;u<r;u++){const c=e[u];c(l),o.has(c)&&(a.schedule(c),n())}i=!1,s&&(s=!1,a.process(l))}};return a}const mR=40;let jc=!0,Gs=!1,Hc=!1;const oi={delta:0,timestamp:0},co=["read","update","preRender","render","postRender"],Ol=co.reduce((n,e)=>(n[e]=gR(()=>Gs=!0),n),{}),Vt=co.reduce((n,e)=>{const t=Ol[e];return n[e]=(r,i=!1,s=!1)=>(Gs||yR(),t.schedule(r,i,s)),n},{}),gi=co.reduce((n,e)=>(n[e]=Ol[e].cancel,n),{}),hu=co.reduce((n,e)=>(n[e]=()=>Ol[e].process(oi),n),{}),vR=n=>Ol[n].process(oi),EE=n=>{Gs=!1,oi.delta=jc?vE:Math.max(Math.min(n-oi.timestamp,mR),1),oi.timestamp=n,Hc=!0,co.forEach(vR),Hc=!1,Gs&&(jc=!1,yE(EE))},yR=()=>{Gs=!0,jc=!0,Hc||yE(EE)},za=()=>oi;function xE(n,e,t=0){return n-e-t}function ER(n,e,t=0,r=!0){return r?xE(e+-n,e,t):e-(n-e)+t}function xR(n,e,t,r){return r?n>=e+t:n<=-t}const SR=n=>{const e=({delta:t})=>n(t);return{start:()=>Vt.update(e,!0),stop:()=>gi.update(e)}};function SE(n){var e,t,{from:r,autoplay:i=!0,driver:s=SR,elapsed:o=0,repeat:a=0,repeatType:l="loop",repeatDelay:u=0,onPlay:c,onStop:d,onComplete:f,onRepeat:p,onUpdate:h}=n,m=_t(n,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:g}=m,v,y=0,E=m.duration,S,T=!1,L=!0,A;const R=hR(m);!((t=(e=R).needsInterpolation)===null||t===void 0)&&t.call(e,r,g)&&(A=fE([0,100],[r,g],{clamp:!1}),r=0,g=100);const I=R(Object.assign(Object.assign({},m),{from:r,to:g}));function b(){y++,l==="reverse"?(L=y%2===0,o=ER(o,E,u,L)):(o=xE(o,E,u),l==="mirror"&&I.flipTarget()),T=!1,p&&p()}function O(){v.stop(),f&&f()}function B(q){if(L||(q=-q),o+=q,!T){const j=I.next(Math.max(0,o));S=j.value,A&&(S=A(S)),T=L?j.done:o<=0}h==null||h(S),T&&(y===0&&(E!=null||(E=o)),y<a?xR(o,E,u,L)&&b():O())}function K(){c==null||c(),v=s(B),v.start()}return i&&K(),{stop:()=>{d==null||d(),v.stop()}}}function TE(n,e){return e?n*(1e3/e):0}function TR({from:n=0,velocity:e=0,min:t,max:r,power:i=.8,timeConstant:s=750,bounceStiffness:o=500,bounceDamping:a=10,restDelta:l=1,modifyTarget:u,driver:c,onUpdate:d,onComplete:f,onStop:p}){let h;function m(E){return t!==void 0&&E<t||r!==void 0&&E>r}function g(E){return t===void 0?r:r===void 0||Math.abs(t-E)<Math.abs(r-E)?t:r}function v(E){h==null||h.stop(),h=SE(Object.assign(Object.assign({},E),{driver:c,onUpdate:S=>{var T;d==null||d(S),(T=E.onUpdate)===null||T===void 0||T.call(E,S)},onComplete:f,onStop:p}))}function y(E){v(Object.assign({type:"spring",stiffness:o,damping:a,restDelta:l},E))}if(m(n))y({from:n,velocity:e,to:g(n)});else{let E=i*e+n;typeof u!="undefined"&&(E=u(E));const S=g(E),T=S===t?-1:1;let L,A;const R=I=>{L=A,A=I,e=TE(I-L,za().delta),(T===1&&I>S||T===-1&&I<S)&&y({from:I,to:S,velocity:e})};v({type:"decay",from:n,velocity:e,timeConstant:s,power:i,restDelta:l,modifyTarget:u,onUpdate:m(E)?R:void 0})}return{stop:()=>h==null?void 0:h.stop()}}const Wc=n=>n.hasOwnProperty("x")&&n.hasOwnProperty("y"),dg=n=>Wc(n)&&n.hasOwnProperty("z"),Ro=(n,e)=>Math.abs(n-e);function AE(n,e){if(Kc(n)&&Kc(e))return Ro(n,e);if(Wc(n)&&Wc(e)){const t=Ro(n.x,e.x),r=Ro(n.y,e.y),i=dg(n)&&dg(e)?Ro(n.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(r,2)+Math.pow(i,2))}}const LE=(n,e)=>1-3*e+3*n,IE=(n,e)=>3*e-6*n,RE=n=>3*n,Ya=(n,e,t)=>((LE(e,t)*n+IE(e,t))*n+RE(e))*n,bE=(n,e,t)=>3*LE(e,t)*n*n+2*IE(e,t)*n+RE(e),AR=1e-7,LR=10;function IR(n,e,t,r,i){let s,o,a=0;do o=e+(t-e)/2,s=Ya(o,r,i)-n,s>0?t=o:e=o;while(Math.abs(s)>AR&&++a<LR);return o}const RR=8,bR=.001;function CR(n,e,t,r){for(let i=0;i<RR;++i){const s=bE(e,t,r);if(s===0)return e;e-=(Ya(e,t,r)-n)/s}return e}const oa=11,bo=1/(oa-1);function _R(n,e,t,r){if(n===e&&t===r)return Of;const i=new Float32Array(oa);for(let o=0;o<oa;++o)i[o]=Ya(o*bo,n,t);function s(o){let a=0,l=1;const u=oa-1;for(;l!==u&&i[l]<=o;++l)a+=bo;--l;const c=(o-i[l])/(i[l+1]-i[l]),d=a+c*bo,f=bE(d,n,t);return f>=bR?CR(o,d,n,t):f===0?d:IR(o,a,a+bo,n,t)}return o=>o===0||o===1?o:Ya(s(o),e,r)}function wR(n){var e=n.onTap,t=n.onTapStart,r=n.onTapCancel,i=n.whileTap,s=n.visualElement,o=e||t||r||i,a=C.exports.useRef(!1),l=C.exports.useRef(null),u={passive:!(t||e||r||h)};function c(){var m;(m=l.current)===null||m===void 0||m.call(l),l.current=null}function d(){var m;return c(),a.current=!1,(m=s.animationState)===null||m===void 0||m.setActive(Se.Tap,!1),!oE()}function f(m,g){!d()||(aE(s.getInstance(),m.target)?e==null||e(m,g):r==null||r(m,g))}function p(m,g){!d()||r==null||r(m,g)}function h(m,g){var v;c(),!a.current&&(a.current=!0,l.current=Dl(si(window,"pointerup",f,u),si(window,"pointercancel",p,u)),(v=s.animationState)===null||v===void 0||v.setActive(Se.Tap,!0),t==null||t(m,g))}ja(s,"pointerdown",o?h:void 0,u),Pf(c)}var fg=new Set;function PR(n,e,t){n||fg.has(e)||(console.warn(e),t&&console.warn(t),fg.add(e))}var zc=new WeakMap,pu=new WeakMap,DR=function(n){var e;(e=zc.get(n.target))===null||e===void 0||e(n)},kR=function(n){n.forEach(DR)};function OR(n){var e=n.root,t=_t(n,["root"]),r=e||document;pu.has(r)||pu.set(r,{});var i=pu.get(r),s=JSON.stringify(t);return i[s]||(i[s]=new IntersectionObserver(kR,W({root:e},t))),i[s]}function MR(n,e,t){var r=OR(e);return zc.set(n,t),r.observe(n),function(){zc.delete(n),r.unobserve(n)}}function FR(n){var e=n.visualElement,t=n.whileInView,r=n.onViewportEnter,i=n.onViewportLeave,s=n.viewport,o=s===void 0?{}:s,a=C.exports.useRef({hasEnteredView:!1,isInView:!1}),l=Boolean(t||r||i);o.once&&a.current.hasEnteredView&&(l=!1);var u=typeof IntersectionObserver=="undefined"?UR:BR;u(l,a.current,e,o)}var NR={some:0,all:1};function BR(n,e,t,r){var i=r.root,s=r.margin,o=r.amount,a=o===void 0?"some":o,l=r.once;C.exports.useEffect(function(){if(!!n){var u={root:i==null?void 0:i.current,rootMargin:s,threshold:typeof a=="number"?a:NR[a]},c=function(d){var f,p=d.isIntersecting;if(e.isInView!==p&&(e.isInView=p,!(l&&!p&&e.hasEnteredView))){p&&(e.hasEnteredView=!0),(f=t.animationState)===null||f===void 0||f.setActive(Se.InView,p);var h=t.getProps(),m=p?h.onViewportEnter:h.onViewportLeave;m==null||m(d)}};return MR(t.getInstance(),u,c)}},[n,i,s,a])}function UR(n,e,t,r){var i=r.fallback,s=i===void 0?!0:i;C.exports.useEffect(function(){!n||!s||(xf!=="production"&&PR(!1,"IntersectionObserver not available on this device. whileInView animations will trigger on mount."),requestAnimationFrame(function(){var o;e.hasEnteredView=!0;var a=t.getProps().onViewportEnter;a==null||a(null),(o=t.animationState)===null||o===void 0||o.setActive(Se.InView,!0)}))},[n])}var Fn=function(n){return function(e){return n(e),null}},$R={inView:Fn(FR),tap:Fn(wR),focus:Fn(EI),hover:Fn(_I)},VR=0,GR=function(){return VR++},CE=function(){return oo(GR)};function _E(){var n=C.exports.useContext(so);if(n===null)return[!0,null];var e=n.isPresent,t=n.onExitComplete,r=n.register,i=CE();C.exports.useEffect(function(){return r(i)},[]);var s=function(){return t==null?void 0:t(i)};return!e&&t?[!1,s]:[!0]}function wE(n,e){if(!Array.isArray(e))return!1;var t=e.length;if(t!==n.length)return!1;for(var r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}var qa=function(n){return n*1e3},KR={linear:Of,easeIn:Mf,easeInOut:gE,easeOut:JI,circIn:mE,circInOut:eR,circOut:Ff,backIn:Nf,backInOut:nR,backOut:tR,anticipate:rR,bounceIn:aR,bounceInOut:lR,bounceOut:Wa},hg=function(n){if(Array.isArray(n)){$a(n.length===4);var e=De(n,4),t=e[0],r=e[1],i=e[2],s=e[3];return _R(t,r,i,s)}else if(typeof n=="string")return KR[n];return n},jR=function(n){return Array.isArray(n)&&typeof n[0]!="number"},pg=function(n,e){return n==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&En.test(e)&&!e.startsWith("url("))},ir=function(){return{type:"spring",stiffness:500,damping:25,restSpeed:10}},Co=function(n){return{type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}},gu=function(){return{type:"keyframes",ease:"linear",duration:.3}},HR=function(n){return{type:"keyframes",duration:.8,values:n}},gg={x:ir,y:ir,z:ir,rotate:ir,rotateX:ir,rotateY:ir,rotateZ:ir,scaleX:Co,scaleY:Co,scale:Co,opacity:gu,backgroundColor:gu,color:gu,default:Co},WR=function(n,e){var t;return $s(e)?t=HR:t=gg[n]||gg.default,W({to:e},t(e))},zR=W(W({},Ky),{color:it,backgroundColor:it,outlineColor:it,fill:it,stroke:it,borderColor:it,borderTopColor:it,borderRightColor:it,borderBottomColor:it,borderLeftColor:it,filter:$c,WebkitFilter:$c}),Bf=function(n){return zR[n]};function Uf(n,e){var t,r=Bf(n);return r!==$c&&(r=En),(t=r.getAnimatableNone)===null||t===void 0?void 0:t.call(r,e)}var YR={current:!1};function qR(n){n.when,n.delay,n.delayChildren,n.staggerChildren,n.staggerDirection,n.repeat,n.repeatType,n.repeatDelay,n.from;var e=_t(n,["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from"]);return!!Object.keys(e).length}function XR(n){var e=n.ease,t=n.times,r=n.yoyo,i=n.flip,s=n.loop,o=_t(n,["ease","times","yoyo","flip","loop"]),a=W({},o);return t&&(a.offset=t),o.duration&&(a.duration=qa(o.duration)),o.repeatDelay&&(a.repeatDelay=qa(o.repeatDelay)),e&&(a.ease=jR(e)?e.map(hg):hg(e)),o.type==="tween"&&(a.type="keyframes"),(r||s||i)&&(r?a.repeatType="reverse":s?a.repeatType="loop":i&&(a.repeatType="mirror"),a.repeat=s||r||i||o.repeat),o.type!=="spring"&&(a.type="keyframes"),a}function QR(n,e){var t,r,i=$f(n,e)||{};return(r=(t=i.delay)!==null&&t!==void 0?t:n.delay)!==null&&r!==void 0?r:0}function ZR(n){return Array.isArray(n.to)&&n.to[0]===null&&(n.to=$t([],De(n.to),!1),n.to[0]=n.from),n}function JR(n,e,t){var r;return Array.isArray(e.to)&&((r=n.duration)!==null&&r!==void 0||(n.duration=.8)),ZR(e),qR(n)||(n=W(W({},n),WR(t,e.to))),W(W({},e),XR(n))}function eb(n,e,t,r,i){var s,o=$f(r,n),a=(s=o.from)!==null&&s!==void 0?s:e.get(),l=pg(n,t);a==="none"&&l&&typeof t=="string"?a=Uf(n,t):mg(a)&&typeof t=="string"?a=vg(t):!Array.isArray(t)&&mg(t)&&typeof a=="string"&&(t=vg(a));var u=pg(n,a);function c(){var f={from:a,to:t,velocity:e.getVelocity(),onComplete:i,onUpdate:function(p){return e.set(p)}};return o.type==="inertia"||o.type==="decay"?TR(W(W({},f),o)):SE(W(W({},JR(o,f,n)),{onUpdate:function(p){var h;f.onUpdate(p),(h=o.onUpdate)===null||h===void 0||h.call(o,p)},onComplete:function(){var p;f.onComplete(),(p=o.onComplete)===null||p===void 0||p.call(o)}}))}function d(){var f,p,h=Zy(t);return e.set(h),i(),(f=o==null?void 0:o.onUpdate)===null||f===void 0||f.call(o,h),(p=o==null?void 0:o.onComplete)===null||p===void 0||p.call(o),{stop:function(){}}}return!u||!l||o.type===!1?d:c}function mg(n){return n===0||typeof n=="string"&&parseFloat(n)===0&&n.indexOf(" ")===-1}function vg(n){return typeof n=="number"?0:Uf("",n)}function $f(n,e){return n[e]||n.default||n}function Vf(n,e,t,r){return r===void 0&&(r={}),YR.current&&(r={type:!1}),e.start(function(i){var s,o,a=eb(n,e,t,r,i),l=QR(r,n),u=function(){return o=a()};return l?s=window.setTimeout(u,qa(l)):u(),function(){clearTimeout(s),o==null||o.stop()}})}var tb=function(n){return/^\-?\d*\.?\d+$/.test(n)},nb=function(n){return/^0[^.\s]+$/.test(n)};function Gf(n,e){n.indexOf(e)===-1&&n.push(e)}function Kf(n,e){var t=n.indexOf(e);t>-1&&n.splice(t,1)}var ps=function(){function n(){this.subscriptions=[]}return n.prototype.add=function(e){var t=this;return Gf(this.subscriptions,e),function(){return Kf(t.subscriptions,e)}},n.prototype.notify=function(e,t,r){var i=this.subscriptions.length;if(!!i)if(i===1)this.subscriptions[0](e,t,r);else for(var s=0;s<i;s++){var o=this.subscriptions[s];o&&o(e,t,r)}},n.prototype.getSize=function(){return this.subscriptions.length},n.prototype.clear=function(){this.subscriptions.length=0},n}(),rb=function(n){return!isNaN(parseFloat(n))},ib=function(){function n(e){var t=this;this.version="6.5.1",this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new ps,this.velocityUpdateSubscribers=new ps,this.renderSubscribers=new ps,this.canTrackVelocity=!1,this.updateAndNotify=function(r,i){i===void 0&&(i=!0),t.prev=t.current,t.current=r;var s=za(),o=s.delta,a=s.timestamp;t.lastUpdated!==a&&(t.timeDelta=o,t.lastUpdated=a,Vt.postRender(t.scheduleVelocityCheck)),t.prev!==t.current&&t.updateSubscribers.notify(t.current),t.velocityUpdateSubscribers.getSize()&&t.velocityUpdateSubscribers.notify(t.getVelocity()),i&&t.renderSubscribers.notify(t.current)},this.scheduleVelocityCheck=function(){return Vt.postRender(t.velocityCheck)},this.velocityCheck=function(r){var i=r.timestamp;i!==t.lastUpdated&&(t.prev=t.current,t.velocityUpdateSubscribers.notify(t.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=rb(this.current)}return n.prototype.onChange=function(e){return this.updateSubscribers.add(e)},n.prototype.clearListeners=function(){this.updateSubscribers.clear()},n.prototype.onRenderRequest=function(e){return e(this.get()),this.renderSubscribers.add(e)},n.prototype.attach=function(e){this.passiveEffect=e},n.prototype.set=function(e,t){t===void 0&&(t=!0),!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)},n.prototype.get=function(){return this.current},n.prototype.getPrevious=function(){return this.prev},n.prototype.getVelocity=function(){return this.canTrackVelocity?TE(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0},n.prototype.start=function(e){var t=this;return this.stop(),new Promise(function(r){t.hasAnimated=!0,t.stopAnimation=e(r)}).then(function(){return t.clearAnimation()})},n.prototype.stop=function(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()},n.prototype.isAnimating=function(){return!!this.stopAnimation},n.prototype.clearAnimation=function(){this.stopAnimation=null},n.prototype.destroy=function(){this.updateSubscribers.clear(),this.renderSubscribers.clear(),this.stop()},n}();function mi(n){return new ib(n)}var PE=function(n){return function(e){return e.test(n)}},sb={test:function(n){return n==="auto"},parse:function(n){return n}},DE=[Cr,ie,tn,Ln,HL,jL,sb],Gi=function(n){return DE.find(PE(n))},ob=$t($t([],De(DE),!1),[it,En],!1),ab=function(n){return ob.find(PE(n))};function lb(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,mi(t))}function ub(n,e){var t=_l(n,e),r=t?n.makeTargetAnimatable(t,!1):{},i=r.transitionEnd,s=i===void 0?{}:i;r.transition;var o=_t(r,["transitionEnd","transition"]);o=W(W({},o),s);for(var a in o){var l=Zy(o[a]);lb(n,a,l)}}function cb(n,e,t){var r,i,s,o,a=Object.keys(e).filter(function(p){return!n.hasValue(p)}),l=a.length;if(!!l)for(var u=0;u<l;u++){var c=a[u],d=e[c],f=null;Array.isArray(d)&&(f=d[0]),f===null&&(f=(i=(r=t[c])!==null&&r!==void 0?r:n.readValue(c))!==null&&i!==void 0?i:e[c]),f!=null&&(typeof f=="string"&&(tb(f)||nb(f))?f=parseFloat(f):!ab(f)&&En.test(d)&&(f=Uf(c,d)),n.addValue(c,mi(f)),(s=(o=t)[c])!==null&&s!==void 0||(o[c]=f),n.setBaseTarget(c,f))}}function db(n,e){if(!!e){var t=e[n]||e.default||e;return t.from}}function fb(n,e,t){var r,i,s={};for(var o in n)s[o]=(r=db(o,e))!==null&&r!==void 0?r:(i=t.getValue(o))===null||i===void 0?void 0:i.get();return s}function hb(n,e,t){t===void 0&&(t={}),n.notifyAnimationStart(e);var r;if(Array.isArray(e)){var i=e.map(function(o){return Yc(n,o,t)});r=Promise.all(i)}else if(typeof e=="string")r=Yc(n,e,t);else{var s=typeof e=="function"?_l(n,e,t.custom):e;r=kE(n,s,t)}return r.then(function(){return n.notifyAnimationComplete(e)})}function Yc(n,e,t){var r;t===void 0&&(t={});var i=_l(n,e,t.custom),s=(i||{}).transition,o=s===void 0?n.getDefaultTransition()||{}:s;t.transitionOverride&&(o=t.transitionOverride);var a=i?function(){return kE(n,i,t)}:function(){return Promise.resolve()},l=!((r=n.variantChildren)===null||r===void 0)&&r.size?function(p){p===void 0&&(p=0);var h=o.delayChildren,m=h===void 0?0:h,g=o.staggerChildren,v=o.staggerDirection;return pb(n,e,m+p,g,v,t)}:function(){return Promise.resolve()},u=o.when;if(u){var c=De(u==="beforeChildren"?[a,l]:[l,a],2),d=c[0],f=c[1];return d().then(f)}else return Promise.all([a(),l(t.delay)])}function kE(n,e,t){var r,i=t===void 0?{}:t,s=i.delay,o=s===void 0?0:s,a=i.transitionOverride,l=i.type,u=n.makeTargetAnimatable(e),c=u.transition,d=c===void 0?n.getDefaultTransition():c,f=u.transitionEnd,p=_t(u,["transition","transitionEnd"]);a&&(d=a);var h=[],m=l&&((r=n.animationState)===null||r===void 0?void 0:r.getState()[l]);for(var g in p){var v=n.getValue(g),y=p[g];if(!(!v||y===void 0||m&&mb(m,g))){var E=W({delay:o},d);n.shouldReduceMotion&&ao(g)&&(E=W(W({},E),{type:!1,delay:0}));var S=Vf(g,v,y,E);h.push(S)}}return Promise.all(h).then(function(){f&&ub(n,f)})}function pb(n,e,t,r,i,s){t===void 0&&(t=0),r===void 0&&(r=0),i===void 0&&(i=1);var o=[],a=(n.variantChildren.size-1)*r,l=i===1?function(u){return u===void 0&&(u=0),u*r}:function(u){return u===void 0&&(u=0),a-u*r};return Array.from(n.variantChildren).sort(gb).forEach(function(u,c){o.push(Yc(u,e,W(W({},s),{delay:t+l(c)})).then(function(){return u.notifyAnimationComplete(e)}))}),Promise.all(o)}function gb(n,e){return n.sortNodePosition(e)}function mb(n,e){var t=n.protectedKeys,r=n.needsAnimating,i=t.hasOwnProperty(e)&&r[e]!==!0;return r[e]=!1,i}var jf=[Se.Animate,Se.InView,Se.Focus,Se.Hover,Se.Tap,Se.Drag,Se.Exit],vb=$t([],De(jf),!1).reverse(),yb=jf.length;function Eb(n){return function(e){return Promise.all(e.map(function(t){var r=t.animation,i=t.options;return hb(n,r,i)}))}}function xb(n){var e=Eb(n),t=Tb(),r={},i=!0,s=function(c,d){var f=_l(n,d);if(f){f.transition;var p=f.transitionEnd,h=_t(f,["transition","transitionEnd"]);c=W(W(W({},c),h),p)}return c};function o(c){return r[c]!==void 0}function a(c){e=c(n)}function l(c,d){for(var f,p=n.getProps(),h=n.getVariantContext(!0)||{},m=[],g=new Set,v={},y=1/0,E=function(A){var R=vb[A],I=t[R],b=(f=p[R])!==null&&f!==void 0?f:h[R],O=Bt(b),B=R===d?I.isActive:null;B===!1&&(y=A);var K=b===h[R]&&b!==p[R]&&O;if(K&&i&&n.manuallyAnimateOnMount&&(K=!1),I.protectedKeys=W({},v),!I.isActive&&B===null||!b&&!I.prevProp||_f(b)||typeof b=="boolean")return"continue";var q=Sb(I.prevProp,b),j=q||R===d&&I.isActive&&!K&&O||A>y&&O,G=Array.isArray(b)?b:[b],M=G.reduce(s,{});B===!1&&(M={});var $=I.prevResolvedValues,z=$===void 0?{}:$,J=W(W({},z),M),w=function(V){j=!0,g.delete(V),I.needsAnimating[V]=!0};for(var k in J){var U=M[k],N=z[k];v.hasOwnProperty(k)||(U!==N?$s(U)&&$s(N)?!wE(U,N)||q?w(k):I.protectedKeys[k]=!0:U!==void 0?w(k):g.add(k):U!==void 0&&g.has(k)?w(k):I.protectedKeys[k]=!0)}I.prevProp=b,I.prevResolvedValues=M,I.isActive&&(v=W(W({},v),M)),i&&n.blockInitialAnimation&&(j=!1),j&&!K&&m.push.apply(m,$t([],De(G.map(function(V){return{animation:V,options:W({type:R},c)}})),!1))},S=0;S<yb;S++)E(S);if(r=W({},v),g.size){var T={};g.forEach(function(A){var R=n.getBaseTarget(A);R!==void 0&&(T[A]=R)}),m.push({animation:T})}var L=Boolean(m.length);return i&&p.initial===!1&&!n.manuallyAnimateOnMount&&(L=!1),i=!1,L?e(m):Promise.resolve()}function u(c,d,f){var p;if(t[c].isActive===d)return Promise.resolve();(p=n.variantChildren)===null||p===void 0||p.forEach(function(g){var v;return(v=g.animationState)===null||v===void 0?void 0:v.setActive(c,d)}),t[c].isActive=d;var h=l(f,c);for(var m in t)t[m].protectedKeys={};return h}return{isAnimated:o,animateChanges:l,setActive:u,setAnimateFunction:a,getState:function(){return t}}}function Sb(n,e){return typeof e=="string"?e!==n:_y(e)?!wE(e,n):!1}function sr(n){return n===void 0&&(n=!1),{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Tb(){var n;return n={},n[Se.Animate]=sr(!0),n[Se.InView]=sr(),n[Se.Hover]=sr(),n[Se.Tap]=sr(),n[Se.Drag]=sr(),n[Se.Focus]=sr(),n[Se.Exit]=sr(),n}var Ab={animation:Fn(function(n){var e=n.visualElement,t=n.animate;e.animationState||(e.animationState=xb(e)),_f(t)&&C.exports.useEffect(function(){return t.subscribe(e)},[t])}),exit:Fn(function(n){var e=n.custom,t=n.visualElement,r=De(_E(),2),i=r[0],s=r[1],o=C.exports.useContext(so);C.exports.useEffect(function(){var a,l;t.isPresent=i;var u=(a=t.animationState)===null||a===void 0?void 0:a.setActive(Se.Exit,!i,{custom:(l=o==null?void 0:o.custom)!==null&&l!==void 0?l:e});!i&&(u==null||u.then(s))},[i])})},OE=function(){function n(e,t,r){var i=this,s=r===void 0?{}:r,o=s.transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(!!(i.lastMoveEvent&&i.lastMoveEventInfo)){var f=vu(i.lastMoveEventInfo,i.history),p=i.startEvent!==null,h=AE(f.offset,{x:0,y:0})>=3;if(!(!p&&!h)){var m=f.point,g=za().timestamp;i.history.push(W(W({},m),{timestamp:g}));var v=i.handlers,y=v.onStart,E=v.onMove;p||(y&&y(i.lastMoveEvent,f),i.startEvent=i.lastMoveEvent),E&&E(i.lastMoveEvent,f)}}},this.handlePointerMove=function(f,p){if(i.lastMoveEvent=f,i.lastMoveEventInfo=mu(p,i.transformPagePoint),eE(f)&&f.buttons===0){i.handlePointerUp(f,p);return}Vt.update(i.updatePoint,!0)},this.handlePointerUp=function(f,p){i.end();var h=i.handlers,m=h.onEnd,g=h.onSessionEnd,v=vu(mu(p,i.transformPagePoint),i.history);i.startEvent&&m&&m(f,v),g&&g(f,v)},!(tE(e)&&e.touches.length>1)){this.handlers=t,this.transformPagePoint=o;var a=wf(e),l=mu(a,this.transformPagePoint),u=l.point,c=za().timestamp;this.history=[W(W({},u),{timestamp:c})];var d=t.onSessionStart;d&&d(e,vu(l,this.history)),this.removeListeners=Dl(si(window,"pointermove",this.handlePointerMove),si(window,"pointerup",this.handlePointerUp),si(window,"pointercancel",this.handlePointerUp))}}return n.prototype.updateHandlers=function(e){this.handlers=e},n.prototype.end=function(){this.removeListeners&&this.removeListeners(),gi.update(this.updatePoint)},n}();function mu(n,e){return e?{point:e(n.point)}:n}function yg(n,e){return{x:n.x-e.x,y:n.y-e.y}}function vu(n,e){var t=n.point;return{point:t,delta:yg(t,ME(e)),offset:yg(t,Lb(e)),velocity:Ib(e,.1)}}function Lb(n){return n[0]}function ME(n){return n[n.length-1]}function Ib(n,e){if(n.length<2)return{x:0,y:0};for(var t=n.length-1,r=null,i=ME(n);t>=0&&(r=n[t],!(i.timestamp-r.timestamp>qa(e)));)t--;if(!r)return{x:0,y:0};var s=(i.timestamp-r.timestamp)/1e3;if(s===0)return{x:0,y:0};var o={x:(i.x-r.x)/s,y:(i.y-r.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function xn(n){return n.max-n.min}function Eg(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=.01),AE(n,e)<t}function xg(n,e,t,r){r===void 0&&(r=.5),n.origin=r,n.originPoint=Pe(e.min,e.max,n.origin),n.scale=xn(t)/xn(e),(Eg(n.scale,1,1e-4)||isNaN(n.scale))&&(n.scale=1),n.translate=Pe(t.min,t.max,n.origin)-n.originPoint,(Eg(n.translate)||isNaN(n.translate))&&(n.translate=0)}function gs(n,e,t,r){xg(n.x,e.x,t.x,r==null?void 0:r.originX),xg(n.y,e.y,t.y,r==null?void 0:r.originY)}function Sg(n,e,t){n.min=t.min+e.min,n.max=n.min+xn(e)}function Rb(n,e,t){Sg(n.x,e.x,t.x),Sg(n.y,e.y,t.y)}function Tg(n,e,t){n.min=e.min-t.min,n.max=n.min+xn(e)}function ms(n,e,t){Tg(n.x,e.x,t.x),Tg(n.y,e.y,t.y)}function bb(n,e,t){var r=e.min,i=e.max;return r!==void 0&&n<r?n=t?Pe(r,n,t.min):Math.max(n,r):i!==void 0&&n>i&&(n=t?Pe(i,n,t.max):Math.min(n,i)),n}function Ag(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function Cb(n,e){var t=e.top,r=e.left,i=e.bottom,s=e.right;return{x:Ag(n.x,r,s),y:Ag(n.y,t,i)}}function Lg(n,e){var t,r=e.min-n.min,i=e.max-n.max;return e.max-e.min<n.max-n.min&&(t=De([i,r],2),r=t[0],i=t[1]),{min:r,max:i}}function _b(n,e){return{x:Lg(n.x,e.x),y:Lg(n.y,e.y)}}function wb(n,e){var t=.5,r=xn(n),i=xn(e);return i>r?t=Vs(e.min,e.max-r,n.min):r>i&&(t=Vs(n.min,n.max-i,e.min)),Ha(0,1,t)}function Pb(n,e){var t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}var qc=.35;function Db(n){return n===void 0&&(n=qc),n===!1?n=0:n===!0&&(n=qc),{x:Ig(n,"left","right"),y:Ig(n,"top","bottom")}}function Ig(n,e,t){return{min:Rg(n,e),max:Rg(n,t)}}function Rg(n,e){var t;return typeof n=="number"?n:(t=n[e])!==null&&t!==void 0?t:0}var bg=function(){return{translate:0,scale:1,origin:0,originPoint:0}},vs=function(){return{x:bg(),y:bg()}},Cg=function(){return{min:0,max:0}},Je=function(){return{x:Cg(),y:Cg()}};function jt(n){return[n("x"),n("y")]}function FE(n){var e=n.top,t=n.left,r=n.right,i=n.bottom;return{x:{min:t,max:r},y:{min:e,max:i}}}function kb(n){var e=n.x,t=n.y;return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Ob(n,e){if(!e)return n;var t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function yu(n){return n===void 0||n===1}function NE(n){var e=n.scale,t=n.scaleX,r=n.scaleY;return!yu(e)||!yu(t)||!yu(r)}function In(n){return NE(n)||_g(n.x)||_g(n.y)||n.z||n.rotate||n.rotateX||n.rotateY}function _g(n){return n&&n!=="0%"}function Xa(n,e,t){var r=n-t,i=e*r;return t+i}function wg(n,e,t,r,i){return i!==void 0&&(n=Xa(n,i,r)),Xa(n,t,r)+e}function Xc(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),n.min=wg(n.min,e,t,r,i),n.max=wg(n.max,e,t,r,i)}function BE(n,e){var t=e.x,r=e.y;Xc(n.x,t.translate,t.scale,t.originPoint),Xc(n.y,r.translate,r.scale,r.originPoint)}function Mb(n,e,t,r){var i,s;r===void 0&&(r=!1);var o=t.length;if(!!o){e.x=e.y=1;for(var a,l,u=0;u<o;u++)a=t[u],l=a.projectionDelta,((s=(i=a.instance)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.display)!=="contents"&&(r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&zr(n,{x:-a.scroll.x,y:-a.scroll.y}),l&&(e.x*=l.x.scale,e.y*=l.y.scale,BE(n,l)),r&&In(a.latestValues)&&zr(n,a.latestValues))}}function bn(n,e){n.min=n.min+e,n.max=n.max+e}function Pg(n,e,t){var r=De(t,3),i=r[0],s=r[1],o=r[2],a=e[o]!==void 0?e[o]:.5,l=Pe(n.min,n.max,a);Xc(n,e[i],e[s],l,e.scale)}var Fb=["x","scaleX","originX"],Nb=["y","scaleY","originY"];function zr(n,e){Pg(n.x,e,Fb),Pg(n.y,e,Nb)}function UE(n,e){return FE(Ob(n.getBoundingClientRect(),e))}function Bb(n,e,t){var r=UE(n,t),i=e.scroll;return i&&(bn(r.x,i.x),bn(r.y,i.y)),r}var Ub=new WeakMap,$b=function(){function n(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Je(),this.visualElement=e}return n.prototype.start=function(e,t){var r=this,i=t===void 0?{}:t,s=i.snapToCursor,o=s===void 0?!1:s;if(this.visualElement.isPresent!==!1){var a=function(d){r.stopAnimation(),o&&r.snapToCursor(wf(d,"page").point)},l=function(d,f){var p,h=r.getProps(),m=h.drag,g=h.dragPropagation,v=h.onDragStart;m&&!g&&(r.openGlobalLock&&r.openGlobalLock(),r.openGlobalLock=sE(m),!r.openGlobalLock)||(r.isDragging=!0,r.currentDirection=null,r.resolveConstraints(),r.visualElement.projection&&(r.visualElement.projection.isAnimationBlocked=!0,r.visualElement.projection.target=void 0),jt(function(y){var E,S,T=r.getAxisMotionValue(y).get()||0;if(tn.test(T)){var L=(S=(E=r.visualElement.projection)===null||E===void 0?void 0:E.layout)===null||S===void 0?void 0:S.actual[y];if(L){var A=xn(L);T=A*(parseFloat(T)/100)}}r.originPoint[y]=T}),v==null||v(d,f),(p=r.visualElement.animationState)===null||p===void 0||p.setActive(Se.Drag,!0))},u=function(d,f){var p=r.getProps(),h=p.dragPropagation,m=p.dragDirectionLock,g=p.onDirectionLock,v=p.onDrag;if(!(!h&&!r.openGlobalLock)){var y=f.offset;if(m&&r.currentDirection===null){r.currentDirection=Vb(y),r.currentDirection!==null&&(g==null||g(r.currentDirection));return}r.updateAxis("x",f.point,y),r.updateAxis("y",f.point,y),r.visualElement.syncRender(),v==null||v(d,f)}},c=function(d,f){return r.stop(d,f)};this.panSession=new OE(e,{onSessionStart:a,onStart:l,onMove:u,onSessionEnd:c},{transformPagePoint:this.visualElement.getTransformPagePoint()})}},n.prototype.stop=function(e,t){var r=this.isDragging;if(this.cancel(),!!r){var i=t.velocity;this.startAnimation(i);var s=this.getProps().onDragEnd;s==null||s(e,t)}},n.prototype.cancel=function(){var e,t;this.isDragging=!1,this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!1),(e=this.panSession)===null||e===void 0||e.end(),this.panSession=void 0;var r=this.getProps().dragPropagation;!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),(t=this.visualElement.animationState)===null||t===void 0||t.setActive(Se.Drag,!1)},n.prototype.updateAxis=function(e,t,r){var i=this.getProps().drag;if(!(!r||!_o(e,i,this.currentDirection))){var s=this.getAxisMotionValue(e),o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=bb(o,this.constraints[e],this.elastic[e])),s.set(o)}},n.prototype.resolveConstraints=function(){var e=this,t=this.getProps(),r=t.dragConstraints,i=t.dragElastic,s=(this.visualElement.projection||{}).layout,o=this.constraints;r&&Wr(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&s?this.constraints=Cb(s.actual,r):this.constraints=!1,this.elastic=Db(i),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&jt(function(a){e.getAxisMotionValue(a)&&(e.constraints[a]=Pb(s.actual[a],e.constraints[a]))})},n.prototype.resolveRefConstraints=function(){var e=this.getProps(),t=e.dragConstraints,r=e.onMeasureDragConstraints;if(!t||!Wr(t))return!1;var i=t.current,s=this.visualElement.projection;if(!s||!s.layout)return!1;var o=Bb(i,s.root,this.visualElement.getTransformPagePoint()),a=_b(s.layout.actual,o);if(r){var l=r(kb(a));this.hasMutatedConstraints=!!l,l&&(a=FE(l))}return a},n.prototype.startAnimation=function(e){var t=this,r=this.getProps(),i=r.drag,s=r.dragMomentum,o=r.dragElastic,a=r.dragTransition,l=r.dragSnapToOrigin,u=r.onDragTransitionEnd,c=this.constraints||{},d=jt(function(f){var p;if(!!_o(f,i,t.currentDirection)){var h=(p=c==null?void 0:c[f])!==null&&p!==void 0?p:{};l&&(h={min:0,max:0});var m=o?200:1e6,g=o?40:1e7,v=W(W({type:"inertia",velocity:s?e[f]:0,bounceStiffness:m,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10},a),h);return t.startAxisValueAnimation(f,v)}});return Promise.all(d).then(u)},n.prototype.startAxisValueAnimation=function(e,t){var r=this.getAxisMotionValue(e);return Vf(e,r,0,t)},n.prototype.stopAnimation=function(){var e=this;jt(function(t){return e.getAxisMotionValue(t).stop()})},n.prototype.getAxisMotionValue=function(e){var t,r,i="_drag"+e.toUpperCase(),s=this.visualElement.getProps()[i];return s||this.visualElement.getValue(e,(r=(t=this.visualElement.getProps().initial)===null||t===void 0?void 0:t[e])!==null&&r!==void 0?r:0)},n.prototype.snapToCursor=function(e){var t=this;jt(function(r){var i=t.getProps().drag;if(!!_o(r,i,t.currentDirection)){var s=t.visualElement.projection,o=t.getAxisMotionValue(r);if(s&&s.layout){var a=s.layout.actual[r],l=a.min,u=a.max;o.set(e[r]-Pe(l,u,.5))}}})},n.prototype.scalePositionWithinConstraints=function(){var e=this,t,r=this.getProps(),i=r.drag,s=r.dragConstraints,o=this.visualElement.projection;if(!(!Wr(s)||!o||!this.constraints)){this.stopAnimation();var a={x:0,y:0};jt(function(u){var c=e.getAxisMotionValue(u);if(c){var d=c.get();a[u]=wb({min:d,max:d},e.constraints[u])}});var l=this.visualElement.getProps().transformTemplate;this.visualElement.getInstance().style.transform=l?l({},""):"none",(t=o.root)===null||t===void 0||t.updateScroll(),o.updateLayout(),this.resolveConstraints(),jt(function(u){if(!!_o(u,i,null)){var c=e.getAxisMotionValue(u),d=e.constraints[u],f=d.min,p=d.max;c.set(Pe(f,p,a[u]))}})}},n.prototype.addListeners=function(){var e=this,t;Ub.set(this.visualElement,this);var r=this.visualElement.getInstance(),i=si(r,"pointerdown",function(u){var c=e.getProps(),d=c.drag,f=c.dragListener,p=f===void 0?!0:f;d&&p&&e.start(u)}),s=function(){var u=e.getProps().dragConstraints;Wr(u)&&(e.constraints=e.resolveRefConstraints())},o=this.visualElement.projection,a=o.addEventListener("measure",s);o&&!o.layout&&((t=o.root)===null||t===void 0||t.updateScroll(),o.updateLayout()),s();var l=Pl(window,"resize",function(){return e.scalePositionWithinConstraints()});return o.addEventListener("didUpdate",function(u){var c=u.delta,d=u.hasLayoutChanged;e.isDragging&&d&&(jt(function(f){var p=e.getAxisMotionValue(f);!p||(e.originPoint[f]+=c[f].translate,p.set(p.get()+c[f].translate))}),e.visualElement.syncRender())}),function(){l(),i(),a()}},n.prototype.getProps=function(){var e=this.visualElement.getProps(),t=e.drag,r=t===void 0?!1:t,i=e.dragDirectionLock,s=i===void 0?!1:i,o=e.dragPropagation,a=o===void 0?!1:o,l=e.dragConstraints,u=l===void 0?!1:l,c=e.dragElastic,d=c===void 0?qc:c,f=e.dragMomentum,p=f===void 0?!0:f;return W(W({},e),{drag:r,dragDirectionLock:s,dragPropagation:a,dragConstraints:u,dragElastic:d,dragMomentum:p})},n}();function _o(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Vb(n,e){e===void 0&&(e=10);var t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}function Gb(n){var e=n.dragControls,t=n.visualElement,r=oo(function(){return new $b(t)});C.exports.useEffect(function(){return e&&e.subscribe(r)},[r,e]),C.exports.useEffect(function(){return r.addListeners()},[r])}function Kb(n){var e=n.onPan,t=n.onPanStart,r=n.onPanEnd,i=n.onPanSessionStart,s=n.visualElement,o=e||t||r||i,a=C.exports.useRef(null),l=C.exports.useContext(Sf).transformPagePoint,u={onSessionStart:i,onStart:t,onMove:e,onEnd:function(d,f){a.current=null,r&&r(d,f)}};C.exports.useEffect(function(){a.current!==null&&a.current.updateHandlers(u)});function c(d){a.current=new OE(d,u,{transformPagePoint:l})}ja(s,"pointerdown",o&&c),Pf(function(){return a.current&&a.current.end()})}var jb={pan:Fn(Kb),drag:Fn(Gb)},wo=["LayoutMeasure","BeforeLayoutMeasure","LayoutUpdate","ViewportBoxUpdate","Update","Render","AnimationComplete","LayoutAnimationComplete","AnimationStart","LayoutAnimationStart","SetAxisTarget","Unmount"];function Hb(){var n=wo.map(function(){return new ps}),e={},t={clearAllListeners:function(){return n.forEach(function(r){return r.clear()})},updatePropListeners:function(r){wo.forEach(function(i){var s,o="on"+i,a=r[o];(s=e[i])===null||s===void 0||s.call(e),a&&(e[i]=t[o](a))})}};return n.forEach(function(r,i){t["on"+wo[i]]=function(s){return r.add(s)},t["notify"+wo[i]]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return r.notify.apply(r,$t([],De(s),!1))}}),t}function Wb(n,e,t){var r;for(var i in e){var s=e[i],o=t[i];if(yn(s))n.addValue(i,s);else if(yn(o))n.addValue(i,mi(s));else if(o!==s)if(n.hasValue(i)){var a=n.getValue(i);!a.hasAnimated&&a.set(s)}else n.addValue(i,mi((r=n.getStaticValue(i))!==null&&r!==void 0?r:s))}for(var i in t)e[i]===void 0&&n.removeValue(i);return e}var $E=function(n){var e=n.treeType,t=e===void 0?"":e,r=n.build,i=n.getBaseTarget,s=n.makeTargetAnimatable,o=n.measureViewportBox,a=n.render,l=n.readValueFromInstance,u=n.removeValueFromRenderState,c=n.sortNodePosition,d=n.scrapeMotionValuesFromProps;return function(f,p){var h=f.parent,m=f.props,g=f.presenceId,v=f.blockInitialAnimation,y=f.visualState,E=f.shouldReduceMotion;p===void 0&&(p={});var S=!1,T=y.latestValues,L=y.renderState,A,R=Hb(),I=new Map,b=new Map,O={},B=W({},T),K;function q(){!A||!S||(j(),a(A,L,m.style,U.projection))}function j(){r(U,L,T,p,m)}function G(){R.notifyUpdate(T)}function M(N,V){var ee=V.onChange(function(he){T[N]=he,m.onUpdate&&Vt.update(G,!1,!0)}),fe=V.onRenderRequest(U.scheduleRender);b.set(N,function(){ee(),fe()})}var $=d(m);for(var z in $){var J=$[z];T[z]!==void 0&&yn(J)&&J.set(T[z],!1)}var w=wl(m),k=Py(m),U=W(W({treeType:t,current:null,depth:h?h.depth+1:0,parent:h,children:new Set,presenceId:g,shouldReduceMotion:E,variantChildren:k?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(h==null?void 0:h.isMounted()),blockInitialAnimation:v,isMounted:function(){return Boolean(A)},mount:function(N){S=!0,A=U.current=N,U.projection&&U.projection.mount(N),k&&h&&!w&&(K=h==null?void 0:h.addVariantChild(U)),I.forEach(function(V,ee){return M(ee,V)}),h==null||h.children.add(U),U.setProps(m)},unmount:function(){var N;(N=U.projection)===null||N===void 0||N.unmount(),gi.update(G),gi.render(q),b.forEach(function(V){return V()}),K==null||K(),h==null||h.children.delete(U),R.clearAllListeners(),A=void 0,S=!1},addVariantChild:function(N){var V,ee=U.getClosestVariantNode();if(ee)return(V=ee.variantChildren)===null||V===void 0||V.add(N),function(){return ee.variantChildren.delete(N)}},sortNodePosition:function(N){return!c||t!==N.treeType?0:c(U.getInstance(),N.getInstance())},getClosestVariantNode:function(){return k?U:h==null?void 0:h.getClosestVariantNode()},getLayoutId:function(){return m.layoutId},getInstance:function(){return A},getStaticValue:function(N){return T[N]},setStaticValue:function(N,V){return T[N]=V},getLatestValues:function(){return T},setVisibility:function(N){U.isVisible!==N&&(U.isVisible=N,U.scheduleRender())},makeTargetAnimatable:function(N,V){return V===void 0&&(V=!0),s(U,N,m,V)},measureViewportBox:function(){return o(A,m)},addValue:function(N,V){U.hasValue(N)&&U.removeValue(N),I.set(N,V),T[N]=V.get(),M(N,V)},removeValue:function(N){var V;I.delete(N),(V=b.get(N))===null||V===void 0||V(),b.delete(N),delete T[N],u(N,L)},hasValue:function(N){return I.has(N)},getValue:function(N,V){var ee=I.get(N);return ee===void 0&&V!==void 0&&(ee=mi(V),U.addValue(N,ee)),ee},forEachValue:function(N){return I.forEach(N)},readValue:function(N){var V;return(V=T[N])!==null&&V!==void 0?V:l(A,N,p)},setBaseTarget:function(N,V){B[N]=V},getBaseTarget:function(N){if(i){var V=i(m,N);if(V!==void 0&&!yn(V))return V}return B[N]}},R),{build:function(){return j(),L},scheduleRender:function(){Vt.render(q,!1,!0)},syncRender:q,setProps:function(N){(N.transformTemplate||m.transformTemplate)&&U.scheduleRender(),m=N,R.updatePropListeners(N),O=Wb(U,d(m),O)},getProps:function(){return m},getVariant:function(N){var V;return(V=m.variants)===null||V===void 0?void 0:V[N]},getDefaultTransition:function(){return m.transition},getTransformPagePoint:function(){return m.transformPagePoint},getVariantContext:function(N){if(N===void 0&&(N=!1),N)return h==null?void 0:h.getVariantContext();if(!w){var V=(h==null?void 0:h.getVariantContext())||{};return m.initial!==void 0&&(V.initial=m.initial),V}for(var ee={},fe=0;fe<zb;fe++){var he=VE[fe],Ee=m[he];(Bt(Ee)||Ee===!1)&&(ee[he]=Ee)}return ee}});return U}},VE=$t(["initial"],De(jf),!1),zb=VE.length;function Qc(n){return typeof n=="string"&&n.startsWith("var(--")}var GE=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Yb(n){var e=GE.exec(n);if(!e)return[,];var t=De(e,3),r=t[1],i=t[2];return[r,i]}function Zc(n,e,t){var r=De(Yb(n),2),i=r[0],s=r[1];if(!!i){var o=window.getComputedStyle(e).getPropertyValue(i);return o?o.trim():Qc(s)?Zc(s,e):s}}function qb(n,e,t){var r,i=_t(e,[]),s=n.getInstance();if(!(s instanceof Element))return{target:i,transitionEnd:t};t&&(t=W({},t)),n.forEachValue(function(u){var c=u.get();if(!!Qc(c)){var d=Zc(c,s);d&&u.set(d)}});for(var o in i){var a=i[o];if(!!Qc(a)){var l=Zc(a,s);!l||(i[o]=l,t&&((r=t[o])!==null&&r!==void 0||(t[o]=a)))}}return{target:i,transitionEnd:t}}var Xb=new Set(["width","height","top","left","right","bottom","x","y"]),KE=function(n){return Xb.has(n)},Qb=function(n){return Object.keys(n).some(KE)},jE=function(n,e){n.set(e,!1),n.set(e)},Dg=function(n){return n===Cr||n===ie},kg;(function(n){n.width="width",n.height="height",n.left="left",n.right="right",n.top="top",n.bottom="bottom"})(kg||(kg={}));var Og=function(n,e){return parseFloat(n.split(", ")[e])},Mg=function(n,e){return function(t,r){var i=r.transform;if(i==="none"||!i)return 0;var s=i.match(/^matrix3d\((.+)\)$/);if(s)return Og(s[1],e);var o=i.match(/^matrix\((.+)\)$/);return o?Og(o[1],n):0}},Zb=new Set(["x","y","z"]),Jb=Bs.filter(function(n){return!Zb.has(n)});function eC(n){var e=[];return Jb.forEach(function(t){var r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e.length&&n.syncRender(),e}var Fg={width:function(n,e){var t=n.x,r=e.paddingLeft,i=r===void 0?"0":r,s=e.paddingRight,o=s===void 0?"0":s;return t.max-t.min-parseFloat(i)-parseFloat(o)},height:function(n,e){var t=n.y,r=e.paddingTop,i=r===void 0?"0":r,s=e.paddingBottom,o=s===void 0?"0":s;return t.max-t.min-parseFloat(i)-parseFloat(o)},top:function(n,e){var t=e.top;return parseFloat(t)},left:function(n,e){var t=e.left;return parseFloat(t)},bottom:function(n,e){var t=n.y,r=e.top;return parseFloat(r)+(t.max-t.min)},right:function(n,e){var t=n.x,r=e.left;return parseFloat(r)+(t.max-t.min)},x:Mg(4,13),y:Mg(5,14)},tC=function(n,e,t){var r=e.measureViewportBox(),i=e.getInstance(),s=getComputedStyle(i),o=s.display,a={};o==="none"&&e.setStaticValue("display",n.display||"block"),t.forEach(function(u){a[u]=Fg[u](r,s)}),e.syncRender();var l=e.measureViewportBox();return t.forEach(function(u){var c=e.getValue(u);jE(c,a[u]),n[u]=Fg[u](l,s)}),n},nC=function(n,e,t,r){t===void 0&&(t={}),r===void 0&&(r={}),e=W({},e),r=W({},r);var i=Object.keys(e).filter(KE),s=[],o=!1,a=[];if(i.forEach(function(c){var d=n.getValue(c);if(!!n.hasValue(c)){var f=t[c],p=Gi(f),h=e[c],m;if($s(h)){var g=h.length,v=h[0]===null?1:0;f=h[v],p=Gi(f);for(var y=v;y<g;y++)m?$a(Gi(h[y])===m):m=Gi(h[y])}else m=Gi(h);if(p!==m)if(Dg(p)&&Dg(m)){var E=d.get();typeof E=="string"&&d.set(parseFloat(E)),typeof h=="string"?e[c]=parseFloat(h):Array.isArray(h)&&m===ie&&(e[c]=h.map(parseFloat))}else(p==null?void 0:p.transform)&&(m==null?void 0:m.transform)&&(f===0||h===0)?f===0?d.set(m.transform(f)):e[c]=p.transform(h):(o||(s=eC(n),o=!0),a.push(c),r[c]=r[c]!==void 0?r[c]:e[c],jE(d,h))}}),a.length){var l=a.indexOf("height")>=0?window.pageYOffset:null,u=tC(e,n,a);return s.length&&s.forEach(function(c){var d=De(c,2),f=d[0],p=d[1];n.getValue(f).set(p)}),n.syncRender(),l!==null&&window.scrollTo({top:l}),{target:u,transitionEnd:r}}else return{target:e,transitionEnd:r}};function rC(n,e,t,r){return Qb(e)?nC(n,e,t,r):{target:e,transitionEnd:r}}var iC=function(n,e,t,r){var i=qb(n,e,r);return e=i.target,r=i.transitionEnd,rC(n,e,t,r)};function sC(n){return window.getComputedStyle(n)}var HE={treeType:"dom",readValueFromInstance:function(n,e){if(ao(e)){var t=Bf(e);return t&&t.default||0}else{var r=sC(n);return(My(e)?r.getPropertyValue(e):r[e])||0}},sortNodePosition:function(n,e){return n.compareDocumentPosition(e)&2?1:-1},getBaseTarget:function(n,e){var t;return(t=n.style)===null||t===void 0?void 0:t[e]},measureViewportBox:function(n,e){var t=e.transformPagePoint;return UE(n,t)},resetTransform:function(n,e,t){var r=t.transformTemplate;e.style.transform=r?r({},""):"none",n.scheduleRender()},restoreTransform:function(n,e){n.style.transform=e.style.transform},removeValueFromRenderState:function(n,e){var t=e.vars,r=e.style;delete t[n],delete r[n]},makeTargetAnimatable:function(n,e,t,r){var i=t.transformValues;r===void 0&&(r=!0);var s=e.transition,o=e.transitionEnd,a=_t(e,["transition","transitionEnd"]),l=fb(a,s||{},n);if(i&&(o&&(o=i(o)),a&&(a=i(a)),l&&(l=i(l))),r){cb(n,a,l);var u=iC(n,a,l,o);o=u.transitionEnd,a=u.target}return W({transition:s,transitionEnd:o},a)},scrapeMotionValuesFromProps:Cf,build:function(n,e,t,r,i){n.isVisible!==void 0&&(e.style.visibility=n.isVisible?"visible":"hidden"),If(e,t,r,i.transformTemplate)},render:Yy},oC=$E(HE),aC=$E(W(W({},HE),{getBaseTarget:function(n,e){return n[e]},readValueFromInstance:function(n,e){var t;return ao(e)?((t=Bf(e))===null||t===void 0?void 0:t.default)||0:(e=qy.has(e)?e:zy(e),n.getAttribute(e))},scrapeMotionValuesFromProps:Qy,build:function(n,e,t,r,i){bf(e,t,r,i.transformTemplate)},render:Xy})),lC=function(n,e){return Af(n)?aC(e,{enableHardwareAcceleration:!1}):oC(e,{enableHardwareAcceleration:!0})};function Ng(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}var Ki={correct:function(n,e){if(!e.target)return n;if(typeof n=="string")if(ie.test(n))n=parseFloat(n);else return n;var t=Ng(n,e.target.x),r=Ng(n,e.target.y);return"".concat(t,"% ").concat(r,"%")}},Bg="_$css",uC={correct:function(n,e){var t=e.treeScale,r=e.projectionDelta,i=n,s=n.includes("var("),o=[];s&&(n=n.replace(GE,function(m){return o.push(m),Bg}));var a=En.parse(n);if(a.length>5)return i;var l=En.createTransformer(n),u=typeof a[0]!="number"?1:0,c=r.x.scale*t.x,d=r.y.scale*t.y;a[0+u]/=c,a[1+u]/=d;var f=Pe(c,d,.5);typeof a[2+u]=="number"&&(a[2+u]/=f),typeof a[3+u]=="number"&&(a[3+u]/=f);var p=l(a);if(s){var h=0;p=p.replace(Bg,function(){var m=o[h];return h++,m})}return p}},cC=function(n){Iy(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){var t=this,r=this.props,i=r.visualElement,s=r.layoutGroup,o=r.switchLayoutGroup,a=r.layoutId,l=i.projection;OL(fC),l&&(s!=null&&s.group&&s.group.add(l),(o==null?void 0:o.register)&&a&&o.register(l),l.root.didUpdate(),l.addEventListener("animationComplete",function(){t.safeToRemove()}),l.setOptions(W(W({},l.options),{onExitComplete:function(){return t.safeToRemove()}}))),ds.hasEverUpdated=!0},e.prototype.getSnapshotBeforeUpdate=function(t){var r=this,i=this.props,s=i.layoutDependency,o=i.visualElement,a=i.drag,l=i.isPresent,u=o.projection;return u&&(u.isPresent=l,a||t.layoutDependency!==s||s===void 0?u.willUpdate():this.safeToRemove(),t.isPresent!==l&&(l?u.promote():u.relegate()||Vt.postRender(function(){var c;!((c=u.getStack())===null||c===void 0)&&c.members.length||r.safeToRemove()}))),null},e.prototype.componentDidUpdate=function(){var t=this.props.visualElement.projection;t&&(t.root.didUpdate(),!t.currentAnimation&&t.isLead()&&this.safeToRemove())},e.prototype.componentWillUnmount=function(){var t=this.props,r=t.visualElement,i=t.layoutGroup,s=t.switchLayoutGroup,o=r.projection;o&&(o.scheduleCheckAfterUnmount(),i!=null&&i.group&&i.group.remove(o),s!=null&&s.deregister&&s.deregister(o))},e.prototype.safeToRemove=function(){var t=this.props.safeToRemove;t==null||t()},e.prototype.render=function(){return null},e}(ul.Component);function dC(n){var e=De(_E(),2),t=e[0],r=e[1],i=C.exports.useContext(Tf);return D(cC,{...W({},n,{layoutGroup:i,switchLayoutGroup:C.exports.useContext(Dy),isPresent:t,safeToRemove:r})})}var fC={borderRadius:W(W({},Ki),{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:Ki,borderTopRightRadius:Ki,borderBottomLeftRadius:Ki,borderBottomRightRadius:Ki,boxShadow:uC},hC={measureLayout:dC};function pC(n,e,t){t===void 0&&(t={});var r=yn(n)?n:mi(n);return Vf("",r,e,t),{stop:function(){return r.stop()},isAnimating:function(){return r.isAnimating()}}}var WE=["TopLeft","TopRight","BottomLeft","BottomRight"],gC=WE.length,Ug=function(n){return typeof n=="string"?parseFloat(n):n},$g=function(n){return typeof n=="number"||ie.test(n)};function mC(n,e,t,r,i,s){var o,a,l,u;i?(n.opacity=Pe(0,(o=t.opacity)!==null&&o!==void 0?o:1,vC(r)),n.opacityExit=Pe((a=e.opacity)!==null&&a!==void 0?a:1,0,yC(r))):s&&(n.opacity=Pe((l=e.opacity)!==null&&l!==void 0?l:1,(u=t.opacity)!==null&&u!==void 0?u:1,r));for(var c=0;c<gC;c++){var d="border".concat(WE[c],"Radius"),f=Vg(e,d),p=Vg(t,d);if(!(f===void 0&&p===void 0)){f||(f=0),p||(p=0);var h=f===0||p===0||$g(f)===$g(p);h?(n[d]=Math.max(Pe(Ug(f),Ug(p),r),0),(tn.test(p)||tn.test(f))&&(n[d]+="%")):n[d]=p}}(e.rotate||t.rotate)&&(n.rotate=Pe(e.rotate||0,t.rotate||0,r))}function Vg(n,e){var t;return(t=n[e])!==null&&t!==void 0?t:n.borderRadius}var vC=zE(0,.5,Ff),yC=zE(.5,.95,Of);function zE(n,e,t){return function(r){return r<n?0:r>e?1:t(Vs(n,e,r))}}function Gg(n,e){n.min=e.min,n.max=e.max}function Ot(n,e){Gg(n.x,e.x),Gg(n.y,e.y)}function Kg(n,e,t,r,i){return n-=e,n=Xa(n,1/t,r),i!==void 0&&(n=Xa(n,1/i,r)),n}function EC(n,e,t,r,i,s,o){if(e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r=.5),s===void 0&&(s=n),o===void 0&&(o=n),tn.test(e)){e=parseFloat(e);var a=Pe(o.min,o.max,e/100);e=a-o.min}if(typeof e=="number"){var l=Pe(s.min,s.max,r);n===s&&(l-=e),n.min=Kg(n.min,e,t,l,i),n.max=Kg(n.max,e,t,l,i)}}function jg(n,e,t,r,i){var s=De(t,3),o=s[0],a=s[1],l=s[2];EC(n,e[o],e[a],e[l],e.scale,r,i)}var xC=["x","scaleX","originX"],SC=["y","scaleY","originY"];function Hg(n,e,t,r){jg(n.x,e,xC,t==null?void 0:t.x,r==null?void 0:r.x),jg(n.y,e,SC,t==null?void 0:t.y,r==null?void 0:r.y)}function Wg(n){return n.translate===0&&n.scale===1}function YE(n){return Wg(n.x)&&Wg(n.y)}function qE(n,e){return n.x.min===e.x.min&&n.x.max===e.x.max&&n.y.min===e.y.min&&n.y.max===e.y.max}var TC=function(){function n(){this.members=[]}return n.prototype.add=function(e){Gf(this.members,e),e.scheduleRender()},n.prototype.remove=function(e){if(Kf(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){var t=this.members[this.members.length-1];t&&this.promote(t)}},n.prototype.relegate=function(e){var t=this.members.findIndex(function(o){return e===o});if(t===0)return!1;for(var r,i=t;i>=0;i--){var s=this.members[i];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1},n.prototype.promote=function(e,t){var r,i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,t&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues,e.snapshot.isShared=!0),!((r=e.root)===null||r===void 0)&&r.isUpdating&&(e.isLayoutDirty=!0);var s=e.options.crossfade;s===!1&&i.hide()}},n.prototype.exitAnimationComplete=function(){this.members.forEach(function(e){var t,r,i,s,o;(r=(t=e.options).onExitComplete)===null||r===void 0||r.call(t),(o=(i=e.resumingFrom)===null||i===void 0?void 0:(s=i.options).onExitComplete)===null||o===void 0||o.call(s)})},n.prototype.scheduleRender=function(){this.members.forEach(function(e){e.instance&&e.scheduleRender(!1)})},n.prototype.removeLeadSnapshot=function(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)},n}(),AC="translate3d(0px, 0px, 0) scale(1, 1) scale(1, 1)";function zg(n,e,t){var r=n.x.translate/e.x,i=n.y.translate/e.y,s="translate3d(".concat(r,"px, ").concat(i,"px, 0) ");if(s+="scale(".concat(1/e.x,", ").concat(1/e.y,") "),t){var o=t.rotate,a=t.rotateX,l=t.rotateY;o&&(s+="rotate(".concat(o,"deg) ")),a&&(s+="rotateX(".concat(a,"deg) ")),l&&(s+="rotateY(".concat(l,"deg) "))}var u=n.x.scale*e.x,c=n.y.scale*e.y;return s+="scale(".concat(u,", ").concat(c,")"),s===AC?"none":s}var LC=function(n,e){return n.depth-e.depth},IC=function(){function n(){this.children=[],this.isDirty=!1}return n.prototype.add=function(e){Gf(this.children,e),this.isDirty=!0},n.prototype.remove=function(e){Kf(this.children,e),this.isDirty=!0},n.prototype.forEach=function(e){this.isDirty&&this.children.sort(LC),this.isDirty=!1,this.children.forEach(e)},n}(),Yg=1e3;function XE(n){var e=n.attachResizeListener,t=n.defaultParent,r=n.measureScroll,i=n.checkIsScrollRoot,s=n.resetTransform;return function(){function o(a,l,u){var c=this;l===void 0&&(l={}),u===void 0&&(u=t==null?void 0:t()),this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.potentialNodes=new Map,this.checkUpdateFailed=function(){c.isUpdating&&(c.isUpdating=!1,c.clearAllSnapshots())},this.updateProjection=function(){c.nodes.forEach(PC),c.nodes.forEach(DC)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.id=a,this.latestValues=l,this.root=u?u.root||u:this,this.path=u?$t($t([],De(u.path),!1),[u],!1):[],this.parent=u,this.depth=u?u.depth+1:0,a&&this.root.registerPotentialNode(a,this);for(var d=0;d<this.path.length;d++)this.path[d].shouldResetTransform=!0;this.root===this&&(this.nodes=new IC)}return o.prototype.addEventListener=function(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new ps),this.eventHandlers.get(a).add(l)},o.prototype.notifyListeners=function(a){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var c=this.eventHandlers.get(a);c==null||c.notify.apply(c,$t([],De(l),!1))},o.prototype.hasListeners=function(a){return this.eventHandlers.has(a)},o.prototype.registerPotentialNode=function(a,l){this.potentialNodes.set(a,l)},o.prototype.mount=function(a,l){var u=this,c;if(l===void 0&&(l=!1),!this.instance){this.isSVG=a instanceof SVGElement&&a.tagName!=="svg",this.instance=a;var d=this.options,f=d.layoutId,p=d.layout,h=d.visualElement;if(h&&!h.getInstance()&&h.mount(a),this.root.nodes.add(this),(c=this.parent)===null||c===void 0||c.children.add(this),this.id&&this.root.potentialNodes.delete(this.id),l&&(p||f)&&(this.isLayoutDirty=!0),e){var m,g=function(){return u.root.updateBlockedByResize=!1};e(a,function(){u.root.updateBlockedByResize=!0,clearTimeout(m),m=window.setTimeout(g,250),ds.hasAnimatedSinceResize&&(ds.hasAnimatedSinceResize=!1,u.nodes.forEach(wC))})}f&&this.root.registerSharedNode(f,this),this.options.animate!==!1&&h&&(f||p)&&this.addEventListener("didUpdate",function(v){var y,E,S,T,L,A=v.delta,R=v.hasLayoutChanged,I=v.hasRelativeTargetChanged,b=v.layout;if(u.isTreeAnimationBlocked()){u.target=void 0,u.relativeTarget=void 0;return}var O=(E=(y=u.options.transition)!==null&&y!==void 0?y:h.getDefaultTransition())!==null&&E!==void 0?E:NC,B=h.getProps(),K=B.onLayoutAnimationStart,q=B.onLayoutAnimationComplete,j=!u.targetLayout||!qE(u.targetLayout,b)||I,G=!R&&I;if(((S=u.resumeFrom)===null||S===void 0?void 0:S.instance)||G||R&&(j||!u.currentAnimation)){u.resumeFrom&&(u.resumingFrom=u.resumeFrom,u.resumingFrom.resumingFrom=void 0),u.setAnimationOrigin(A,G);var M=W(W({},$f(O,"layout")),{onPlay:K,onComplete:q});h.shouldReduceMotion&&(M.delay=0,M.type=!1),u.startAnimation(M)}else!R&&u.animationProgress===0&&u.finishAnimation(),u.isLead()&&((L=(T=u.options).onExitComplete)===null||L===void 0||L.call(T));u.targetLayout=b})}},o.prototype.unmount=function(){var a,l;this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this),(a=this.getStack())===null||a===void 0||a.remove(this),(l=this.parent)===null||l===void 0||l.children.delete(this),this.instance=void 0,gi.preRender(this.updateProjection)},o.prototype.blockUpdate=function(){this.updateManuallyBlocked=!0},o.prototype.unblockUpdate=function(){this.updateManuallyBlocked=!1},o.prototype.isUpdateBlocked=function(){return this.updateManuallyBlocked||this.updateBlockedByResize},o.prototype.isTreeAnimationBlocked=function(){var a;return this.isAnimationBlocked||((a=this.parent)===null||a===void 0?void 0:a.isTreeAnimationBlocked())||!1},o.prototype.startUpdate=function(){var a;this.isUpdateBlocked()||(this.isUpdating=!0,(a=this.nodes)===null||a===void 0||a.forEach(kC))},o.prototype.willUpdate=function(a){var l,u,c;if(a===void 0&&(a=!0),this.root.isUpdateBlocked()){(u=(l=this.options).onExitComplete)===null||u===void 0||u.call(l);return}if(!this.root.isUpdating&&this.root.startUpdate(),!this.isLayoutDirty){this.isLayoutDirty=!0;for(var d=0;d<this.path.length;d++){var f=this.path[d];f.shouldResetTransform=!0,f.updateScroll()}var p=this.options,h=p.layoutId,m=p.layout;if(!(h===void 0&&!m)){var g=(c=this.options.visualElement)===null||c===void 0?void 0:c.getProps().transformTemplate;this.prevTransformTemplateValue=g==null?void 0:g(this.latestValues,""),this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}}},o.prototype.didUpdate=function(){var a=this.isUpdateBlocked();if(a){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(qg);return}!this.isUpdating||(this.isUpdating=!1,this.potentialNodes.size&&(this.potentialNodes.forEach(BC),this.potentialNodes.clear()),this.nodes.forEach(_C),this.nodes.forEach(RC),this.nodes.forEach(bC),this.clearAllSnapshots(),hu.update(),hu.preRender(),hu.render())},o.prototype.clearAllSnapshots=function(){this.nodes.forEach(CC),this.sharedNodes.forEach(OC)},o.prototype.scheduleUpdateProjection=function(){Vt.preRender(this.updateProjection,!1,!0)},o.prototype.scheduleCheckAfterUnmount=function(){var a=this;Vt.postRender(function(){a.isLayoutDirty?a.root.didUpdate():a.root.checkUpdateFailed()})},o.prototype.updateSnapshot=function(){if(!(this.snapshot||!this.instance)){var a=this.measure(),l=this.removeTransform(this.removeElementScroll(a));Jg(l),this.snapshot={measured:a,layout:l,latestValues:{}}}},o.prototype.updateLayout=function(){var a;if(!!this.instance&&(this.updateScroll(),!(!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))){if(this.resumeFrom&&!this.resumeFrom.instance)for(var l=0;l<this.path.length;l++){var u=this.path[l];u.updateScroll()}var c=this.measure();Jg(c);var d=this.layout;this.layout={measured:c,actual:this.removeElementScroll(c)},this.layoutCorrected=Je(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.actual),(a=this.options.visualElement)===null||a===void 0||a.notifyLayoutMeasure(this.layout.actual,d==null?void 0:d.actual)}},o.prototype.updateScroll=function(){this.options.layoutScroll&&this.instance&&(this.isScrollRoot=i(this.instance),this.scroll=r(this.instance))},o.prototype.resetTransform=function(){var a;if(!!s){var l=this.isLayoutDirty||this.shouldResetTransform,u=this.projectionDelta&&!YE(this.projectionDelta),c=(a=this.options.visualElement)===null||a===void 0?void 0:a.getProps().transformTemplate,d=c==null?void 0:c(this.latestValues,""),f=d!==this.prevTransformTemplateValue;l&&(u||In(this.latestValues)||f)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}},o.prototype.measure=function(){var a=this.options.visualElement;if(!a)return Je();var l=a.measureViewportBox(),u=this.root.scroll;return u&&(bn(l.x,u.x),bn(l.y,u.y)),l},o.prototype.removeElementScroll=function(a){var l=Je();Ot(l,a);for(var u=0;u<this.path.length;u++){var c=this.path[u],d=c.scroll,f=c.options,p=c.isScrollRoot;if(c!==this.root&&d&&f.layoutScroll){if(p){Ot(l,a);var h=this.root.scroll;h&&(bn(l.x,-h.x),bn(l.y,-h.y))}bn(l.x,d.x),bn(l.y,d.y)}}return l},o.prototype.applyTransform=function(a,l){l===void 0&&(l=!1);var u=Je();Ot(u,a);for(var c=0;c<this.path.length;c++){var d=this.path[c];!l&&d.options.layoutScroll&&d.scroll&&d!==d.root&&zr(u,{x:-d.scroll.x,y:-d.scroll.y}),In(d.latestValues)&&zr(u,d.latestValues)}return In(this.latestValues)&&zr(u,this.latestValues),u},o.prototype.removeTransform=function(a){var l,u=Je();Ot(u,a);for(var c=0;c<this.path.length;c++){var d=this.path[c];if(!!d.instance&&!!In(d.latestValues)){NE(d.latestValues)&&d.updateSnapshot();var f=Je(),p=d.measure();Ot(f,p),Hg(u,d.latestValues,(l=d.snapshot)===null||l===void 0?void 0:l.layout,f)}}return In(this.latestValues)&&Hg(u,this.latestValues),u},o.prototype.setTargetDelta=function(a){this.targetDelta=a,this.root.scheduleUpdateProjection()},o.prototype.setOptions=function(a){var l;this.options=W(W(W({},this.options),a),{crossfade:(l=a.crossfade)!==null&&l!==void 0?l:!0})},o.prototype.clearMeasurements=function(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1},o.prototype.resolveTargetDelta=function(){var a,l=this.options,u=l.layout,c=l.layoutId;!this.layout||!(u||c)||(!this.targetDelta&&!this.relativeTarget&&(this.relativeParent=this.getClosestProjectingParent(),this.relativeParent&&this.relativeParent.layout&&(this.relativeTarget=Je(),this.relativeTargetOrigin=Je(),ms(this.relativeTargetOrigin,this.layout.actual,this.relativeParent.layout.actual),Ot(this.relativeTarget,this.relativeTargetOrigin))),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Je(),this.targetWithTransforms=Je()),this.relativeTarget&&this.relativeTargetOrigin&&((a=this.relativeParent)===null||a===void 0?void 0:a.target)?Rb(this.target,this.relativeTarget,this.relativeParent.target):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.actual):Ot(this.target,this.layout.actual),BE(this.target,this.targetDelta)):Ot(this.target,this.layout.actual),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,this.relativeParent=this.getClosestProjectingParent(),this.relativeParent&&Boolean(this.relativeParent.resumingFrom)===Boolean(this.resumingFrom)&&!this.relativeParent.options.layoutScroll&&this.relativeParent.target&&(this.relativeTarget=Je(),this.relativeTargetOrigin=Je(),ms(this.relativeTargetOrigin,this.target,this.relativeParent.target),Ot(this.relativeTarget,this.relativeTargetOrigin)))))},o.prototype.getClosestProjectingParent=function(){if(!(!this.parent||In(this.parent.latestValues)))return(this.parent.relativeTarget||this.parent.targetDelta)&&this.parent.layout?this.parent:this.parent.getClosestProjectingParent()},o.prototype.calcProjection=function(){var a,l=this.options,u=l.layout,c=l.layoutId;if(this.isTreeAnimating=Boolean(((a=this.parent)===null||a===void 0?void 0:a.isTreeAnimating)||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!(!this.layout||!(u||c))){var d=this.getLead();Ot(this.layoutCorrected,this.layout.actual),Mb(this.layoutCorrected,this.treeScale,this.path,Boolean(this.resumingFrom)||this!==d);var f=d.target;if(!!f){this.projectionDelta||(this.projectionDelta=vs(),this.projectionDeltaWithTransform=vs());var p=this.treeScale.x,h=this.treeScale.y,m=this.projectionTransform;gs(this.projectionDelta,this.layoutCorrected,f,this.latestValues),this.projectionTransform=zg(this.projectionDelta,this.treeScale),(this.projectionTransform!==m||this.treeScale.x!==p||this.treeScale.y!==h)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}}},o.prototype.hide=function(){this.isVisible=!1},o.prototype.show=function(){this.isVisible=!0},o.prototype.scheduleRender=function(a){var l,u,c;a===void 0&&(a=!0),(u=(l=this.options).scheduleRender)===null||u===void 0||u.call(l),a&&((c=this.getStack())===null||c===void 0||c.scheduleRender()),this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)},o.prototype.setAnimationOrigin=function(a,l){var u=this,c;l===void 0&&(l=!1);var d=this.snapshot,f=(d==null?void 0:d.latestValues)||{},p=W({},this.latestValues),h=vs();this.relativeTarget=this.relativeTargetOrigin=void 0,this.attemptToResolveRelativeTarget=!l;var m=Je(),g=d==null?void 0:d.isShared,v=(((c=this.getStack())===null||c===void 0?void 0:c.members.length)||0)<=1,y=Boolean(g&&!v&&this.options.crossfade===!0&&!this.path.some(FC));this.animationProgress=0,this.mixTargetDelta=function(E){var S,T=E/1e3;Xg(h.x,a.x,T),Xg(h.y,a.y,T),u.setTargetDelta(h),u.relativeTarget&&u.relativeTargetOrigin&&u.layout&&((S=u.relativeParent)===null||S===void 0?void 0:S.layout)&&(ms(m,u.layout.actual,u.relativeParent.layout.actual),MC(u.relativeTarget,u.relativeTargetOrigin,m,T)),g&&(u.animationValues=p,mC(p,f,u.latestValues,T,y,v)),u.root.scheduleUpdateProjection(),u.scheduleRender(),u.animationProgress=T},this.mixTargetDelta(0)},o.prototype.startAnimation=function(a){var l=this,u,c;this.notifyListeners("animationStart"),(u=this.currentAnimation)===null||u===void 0||u.stop(),this.resumingFrom&&((c=this.resumingFrom.currentAnimation)===null||c===void 0||c.stop()),this.pendingAnimation&&(gi.update(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Vt.update(function(){ds.hasAnimatedSinceResize=!0,l.currentAnimation=pC(0,Yg,W(W({},a),{onUpdate:function(d){var f;l.mixTargetDelta(d),(f=a.onUpdate)===null||f===void 0||f.call(a,d)},onComplete:function(){var d;(d=a.onComplete)===null||d===void 0||d.call(a),l.completeAnimation()}})),l.resumingFrom&&(l.resumingFrom.currentAnimation=l.currentAnimation),l.pendingAnimation=void 0})},o.prototype.completeAnimation=function(){var a;this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0),(a=this.getStack())===null||a===void 0||a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")},o.prototype.finishAnimation=function(){var a;this.currentAnimation&&((a=this.mixTargetDelta)===null||a===void 0||a.call(this,Yg),this.currentAnimation.stop()),this.completeAnimation()},o.prototype.applyTransformsToTarget=function(){var a=this.getLead(),l=a.targetWithTransforms,u=a.target,c=a.layout,d=a.latestValues;!l||!u||!c||(Ot(l,u),zr(l,d),gs(this.projectionDeltaWithTransform,this.layoutCorrected,l,d))},o.prototype.registerSharedNode=function(a,l){var u,c,d;this.sharedNodes.has(a)||this.sharedNodes.set(a,new TC);var f=this.sharedNodes.get(a);f.add(l),l.promote({transition:(u=l.options.initialPromotionConfig)===null||u===void 0?void 0:u.transition,preserveFollowOpacity:(d=(c=l.options.initialPromotionConfig)===null||c===void 0?void 0:c.shouldPreserveFollowOpacity)===null||d===void 0?void 0:d.call(c,l)})},o.prototype.isLead=function(){var a=this.getStack();return a?a.lead===this:!0},o.prototype.getLead=function(){var a,l=this.options.layoutId;return l?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this},o.prototype.getPrevLead=function(){var a,l=this.options.layoutId;return l?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0},o.prototype.getStack=function(){var a=this.options.layoutId;if(a)return this.root.sharedNodes.get(a)},o.prototype.promote=function(a){var l=a===void 0?{}:a,u=l.needsReset,c=l.transition,d=l.preserveFollowOpacity,f=this.getStack();f&&f.promote(this,d),u&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})},o.prototype.relegate=function(){var a=this.getStack();return a?a.relegate(this):!1},o.prototype.resetRotation=function(){var a=this.options.visualElement;if(!!a){for(var l=!1,u={},c=0;c<Nc.length;c++){var d=Nc[c],f="rotate"+d;!a.getStaticValue(f)||(l=!0,u[f]=a.getStaticValue(f),a.setStaticValue(f,0))}if(!!l){a==null||a.syncRender();for(var f in u)a.setStaticValue(f,u[f]);a.scheduleRender()}}},o.prototype.getProjectionStyles=function(a){var l,u,c,d,f,p;a===void 0&&(a={});var h={};if(!this.instance||this.isSVG)return h;if(this.isVisible)h.visibility="";else return{visibility:"hidden"};var m=(l=this.options.visualElement)===null||l===void 0?void 0:l.getProps().transformTemplate;if(this.needsReset)return this.needsReset=!1,h.opacity="",h.pointerEvents=ia(a.pointerEvents)||"",h.transform=m?m(this.latestValues,""):"none",h;var g=this.getLead();if(!this.projectionDelta||!this.layout||!g.target){var v={};return this.options.layoutId&&(v.opacity=(u=this.latestValues.opacity)!==null&&u!==void 0?u:1,v.pointerEvents=ia(a.pointerEvents)||""),this.hasProjected&&!In(this.latestValues)&&(v.transform=m?m({},""):"none",this.hasProjected=!1),v}var y=g.animationValues||g.latestValues;this.applyTransformsToTarget(),h.transform=zg(this.projectionDeltaWithTransform,this.treeScale,y),m&&(h.transform=m(y,h.transform));var E=this.projectionDelta,S=E.x,T=E.y;h.transformOrigin="".concat(S.origin*100,"% ").concat(T.origin*100,"% 0"),g.animationValues?h.opacity=g===this?(d=(c=y.opacity)!==null&&c!==void 0?c:this.latestValues.opacity)!==null&&d!==void 0?d:1:this.preserveOpacity?this.latestValues.opacity:y.opacityExit:h.opacity=g===this?(f=y.opacity)!==null&&f!==void 0?f:"":(p=y.opacityExit)!==null&&p!==void 0?p:0;for(var L in Ga)if(y[L]!==void 0){var A=Ga[L],R=A.correct,I=A.applyTo,b=R(y[L],g);if(I)for(var O=I.length,B=0;B<O;B++)h[I[B]]=b;else h[L]=b}return this.options.layoutId&&(h.pointerEvents=g===this?ia(a.pointerEvents)||"":"none"),h},o.prototype.clearSnapshot=function(){this.resumeFrom=this.snapshot=void 0},o.prototype.resetTree=function(){this.root.nodes.forEach(function(a){var l;return(l=a.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(qg),this.root.sharedNodes.clear()},o}()}function RC(n){n.updateLayout()}function bC(n){var e,t,r,i,s=(t=(e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)!==null&&t!==void 0?t:n.snapshot;if(n.isLead()&&n.layout&&s&&n.hasListeners("didUpdate")){var o=n.layout,a=o.actual,l=o.measured;n.options.animationType==="size"?jt(function(y){var E=s.isShared?s.measured[y]:s.layout[y],S=xn(E);E.min=a[y].min,E.max=E.min+S}):n.options.animationType==="position"&&jt(function(y){var E=s.isShared?s.measured[y]:s.layout[y],S=xn(a[y]);E.max=E.min+S});var u=vs();gs(u,a,s.layout);var c=vs();s.isShared?gs(c,n.applyTransform(l,!0),s.measured):gs(c,a,s.layout);var d=!YE(u),f=!1;if(!n.resumeFrom&&(n.relativeParent=n.getClosestProjectingParent(),n.relativeParent&&!n.relativeParent.resumeFrom)){var p=n.relativeParent,h=p.snapshot,m=p.layout;if(h&&m){var g=Je();ms(g,s.layout,h.layout);var v=Je();ms(v,a,m.actual),qE(g,v)||(f=!0)}}n.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:c,layoutDelta:u,hasLayoutChanged:d,hasRelativeTargetChanged:f})}else n.isLead()&&((i=(r=n.options).onExitComplete)===null||i===void 0||i.call(r));n.options.transition=void 0}function CC(n){n.clearSnapshot()}function qg(n){n.clearMeasurements()}function _C(n){var e=n.options.visualElement;e!=null&&e.getProps().onBeforeLayoutMeasure&&e.notifyBeforeLayoutMeasure(),n.resetTransform()}function wC(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0}function PC(n){n.resolveTargetDelta()}function DC(n){n.calcProjection()}function kC(n){n.resetRotation()}function OC(n){n.removeLeadSnapshot()}function Xg(n,e,t){n.translate=Pe(e.translate,0,t),n.scale=Pe(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function Qg(n,e,t,r){n.min=Pe(e.min,t.min,r),n.max=Pe(e.max,t.max,r)}function MC(n,e,t,r){Qg(n.x,e.x,t.x,r),Qg(n.y,e.y,t.y,r)}function FC(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}var NC={duration:.45,ease:[.4,0,.1,1]};function BC(n,e){for(var t=n.root,r=n.path.length-1;r>=0;r--)if(Boolean(n.path[r].instance)){t=n.path[r];break}var i=t&&t!==n.root?t.instance:document,s=i.querySelector('[data-projection-id="'.concat(e,'"]'));s&&n.mount(s,!0)}function Zg(n){n.min=Math.round(n.min),n.max=Math.round(n.max)}function Jg(n){Zg(n.x),Zg(n.y)}var UC=XE({attachResizeListener:function(n,e){return Pl(n,"resize",e)},measureScroll:function(){return{x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}},checkIsScrollRoot:function(){return!0}}),Eu={current:void 0},$C=XE({measureScroll:function(n){return{x:n.scrollLeft,y:n.scrollTop}},defaultParent:function(){if(!Eu.current){var n=new UC(0,{});n.mount(window),n.setOptions({layoutScroll:!0}),Eu.current=n}return Eu.current},resetTransform:function(n,e){n.style.transform=e!=null?e:"none"},checkIsScrollRoot:function(n){return Boolean(window.getComputedStyle(n).position==="fixed")}}),VC=W(W(W(W({},Ab),$R),jb),hC),je=DL(function(n,e){return yI(n,e,VC,lC,$C)});function QE(){var n=C.exports.useRef(!1);return Va(function(){return n.current=!0,function(){n.current=!1}},[]),n}function GC(){var n=QE(),e=De(C.exports.useState(0),2),t=e[0],r=e[1],i=C.exports.useCallback(function(){n.current&&r(t+1)},[t]),s=C.exports.useCallback(function(){return Vt.postRender(i)},[i]);return[s,t]}var xu=function(n){var e=n.children,t=n.initial,r=n.isPresent,i=n.onExitComplete,s=n.custom,o=n.presenceAffectsLayout,a=oo(KC),l=CE(),u=C.exports.useMemo(function(){return{id:l,initial:t,isPresent:r,custom:s,onExitComplete:function(c){var d,f;a.set(c,!0);try{for(var p=cL(a.values()),h=p.next();!h.done;h=p.next()){var m=h.value;if(!m)return}}catch(g){d={error:g}}finally{try{h&&!h.done&&(f=p.return)&&f.call(p)}finally{if(d)throw d.error}}i==null||i()},register:function(c){return a.set(c,!1),function(){return a.delete(c)}}}},o?void 0:[r]);return C.exports.useMemo(function(){a.forEach(function(c,d){return a.set(d,!1)})},[r]),C.exports.useEffect(function(){!r&&!a.size&&(i==null||i())},[r]),C.exports.createElement(so.Provider,{value:u},e)};function KC(){return new Map}var Br=function(n){return n.key||""};function jC(n,e){n.forEach(function(t){var r=Br(t);e.set(r,t)})}function HC(n){var e=[];return C.exports.Children.forEach(n,function(t){C.exports.isValidElement(t)&&e.push(t)}),e}var Qa=function(n){var e=n.children,t=n.custom,r=n.initial,i=r===void 0?!0:r,s=n.onExitComplete,o=n.exitBeforeEnter,a=n.presenceAffectsLayout,l=a===void 0?!0:a,u=De(GC(),1),c=u[0],d=C.exports.useContext(Tf).forceRender;d&&(c=d);var f=QE(),p=HC(e),h=p,m=new Set,g=C.exports.useRef(h),v=C.exports.useRef(new Map).current,y=C.exports.useRef(!0);if(Va(function(){y.current=!1,jC(p,v),g.current=h}),Pf(function(){y.current=!0,v.clear(),m.clear()}),y.current)return C.exports.createElement(C.exports.Fragment,null,h.map(function(R){return C.exports.createElement(xu,{key:Br(R),isPresent:!0,initial:i?void 0:!1,presenceAffectsLayout:l},R)}));h=$t([],De(h),!1);for(var E=g.current.map(Br),S=p.map(Br),T=E.length,L=0;L<T;L++){var A=E[L];S.indexOf(A)===-1&&m.add(A)}return o&&m.size&&(h=[]),m.forEach(function(R){if(S.indexOf(R)===-1){var I=v.get(R);if(!!I){var b=E.indexOf(R),O=function(){v.delete(R),m.delete(R);var B=g.current.findIndex(function(K){return K.key===R});if(g.current.splice(B,1),!m.size){if(g.current=p,f.current===!1)return;c(),s&&s()}};h.splice(b,0,C.exports.createElement(xu,{key:Br(I),isPresent:!1,onExitComplete:O,custom:t,presenceAffectsLayout:l},I))}}}),h=h.map(function(R){var I=R.key;return m.has(I)?R:C.exports.createElement(xu,{key:Br(R),isPresent:!0,presenceAffectsLayout:l},R)}),xf!=="production"&&o&&h.length>1&&console.warn("You're attempting to animate multiple children within AnimatePresence, but its exitBeforeEnter prop is set to true. This will lead to odd visual behaviour."),C.exports.createElement(C.exports.Fragment,null,m.size?h:h.map(function(R){return C.exports.cloneElement(R)}))};const WC=({group:n,items:e})=>{var r;const t=((r=e.find(i=>i.image))==null?void 0:r.image)||null;return D(je.div,{whileHover:{scale:1.05,zIndex:10},transition:{type:"spring",stiffness:300,damping:20},children:H(ra,{to:`/details/${encodeURIComponent(n)}`,className:"media-card group-card",style:{cursor:"pointer",position:"relative",aspectRatio:"2/3",borderRadius:"8px",overflow:"hidden",display:"block",textDecoration:"none",color:"inherit",boxShadow:"0 4px 6px rgba(0,0,0,0.3)",background:"#1a1a1a"},children:[t?D("img",{src:`/media/${t}`,alt:n,style:{width:"100%",height:"100%",objectFit:"cover"}}):H("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#444"},children:[D(Ly,{size:48,style:{marginBottom:"10px"}}),D("span",{style:{fontSize:"0.8rem",textAlign:"center",padding:"0 10px"},children:n})]}),H("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",background:"linear-gradient(transparent, rgba(0,0,0,0.95))",padding:"20px 12px 12px"},children:[D("h3",{style:{margin:0,fontSize:"0.95rem",fontWeight:"600",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n}),D("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"4px"},children:H("span",{style:{fontSize:"0.75rem",color:"#aaa"},children:[e.length," \xEDtems"]})})]})]})})},zC=()=>{const{mediaGroups:n,loading:e,error:t,loadingStatus:r,searchQuery:i,watched:s}=Rl(),[o,a]=C.exports.useState("all"),l=br(),u=C.exports.useMemo(()=>{if(!n)return[];let f=Object.entries(n);if(i){const p=i.toLowerCase();f=f.filter(([h,m])=>{const g=h.toLowerCase().includes(p),v=m.some(y=>y.name.toLowerCase().includes(p));return g||v})}return f.filter(([p,h])=>{if(o==="all")return!0;const m=h[0];if(!m)return!1;const g=m.id.toLowerCase();return o==="series"?g.startsWith("series")||g.includes("/series/"):o==="movies"?g.startsWith("movies")||g.startsWith("peliculas")||g.includes("/movies/")||g.includes("/peliculas/"):!0})},[n,o,i]),c=C.exports.useMemo(()=>{if(!n||!s)return[];const f=Object.values(n).flat().filter(h=>{const m=s[h.id];return m&&(typeof m=="object"?m.status:m)}),p={};return f.forEach(h=>{const m=s[h.id],g=typeof m=="object"?m.lastWatched:0;if(!p[h.group])p[h.group]={item:h,timestamp:g};else{const v=p[h.group];g>v.timestamp?p[h.group]={item:h,timestamp:g}:g===v.timestamp&&h.name.localeCompare(v.item.name,void 0,{numeric:!0})>0&&(p[h.group]={item:h,timestamp:g})}}),Object.values(p).sort((h,m)=>m.timestamp-h.timestamp).map(h=>h.item).slice(0,10)},[n,s]),d=C.exports.useMemo(()=>{const f=Object.values(n);if(f.length===0)return null;const p=f.filter(g=>g.some(v=>v.image)),h=p.length>0?p:f;return h[Math.floor(Math.random()*h.length)][0]},[n]);return e?H("div",{style:{padding:"2rem",textAlign:"center",color:"#fff",background:"#111",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center"},children:[D("h2",{children:"Cargando biblioteca..."}),D("div",{style:{textAlign:"left",maxWidth:"600px",margin:"20px auto",fontFamily:"monospace",background:"#000",padding:"20px",borderRadius:"8px",border:"1px solid #333"},children:D("pre",{style:{whiteSpace:"pre-wrap",color:"#0f0"},children:r})})]}):t?H("div",{style:{padding:"2rem",textAlign:"center",color:"red"},children:["Error: ",t]}):H("div",{className:"home-page",style:{paddingBottom:"5rem"},children:[!i&&D(uL,{item:d}),H("div",{className:"content-wrap",style:{padding:i?"120px 3rem 0":"0 3rem"},children:[!i&&c.length>0&&H("div",{className:"continue-watching",style:{marginBottom:"3rem"},children:[D("h2",{style:{fontSize:"1.4rem",fontWeight:"700",marginBottom:"1.2rem",display:"flex",alignItems:"center",gap:"10px"},children:"Continuar viendo"}),D("div",{style:{display:"flex",gap:"1rem",overflowX:"auto",paddingBottom:"10px"},className:"no-scrollbar",children:c.map(f=>H("div",{onClick:()=>l(`/watch/${encodeURIComponent(f.id)}`),style:{minWidth:"240px",aspectRatio:"16/9",background:"#1a1a1a",borderRadius:"8px",position:"relative",cursor:"pointer",overflow:"hidden"},children:[D("img",{src:`/api/thumbnail?id=${encodeURIComponent(f.id)}`,alt:f.name,onError:p=>{p.target.onerror=null,p.target.src=f.image?`/media/${f.image}`:"https://images.unsplash.com/photo-1594908900066-3f47337549d8?q=80&w=400&auto=format&fit=crop"},style:{width:"100%",height:"100%",objectFit:"cover",opacity:.7}}),D("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transition:"opacity 0.2s"},onMouseEnter:p=>p.target.style.opacity=1,onMouseLeave:p=>p.target.style.opacity=0,children:D(bl,{fill:"white",size:32})}),H("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"10px",background:"linear-gradient(transparent, black)"},children:[D("div",{style:{fontSize:"0.85rem",fontWeight:"600",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:f.name}),D("div",{style:{fontSize:"0.7rem",color:"#aaa"},children:f.group})]})]},f.id))})]}),H("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[D("h2",{style:{fontSize:"1.4rem",fontWeight:"700",margin:0},children:i?`Resultados para "${i}"`:"Explorar Cat\xE1logo"}),D(jA,{filter:o,setFilter:a})]}),u.length===0?H("div",{style:{textAlign:"center",marginTop:"5rem",color:"#666"},children:[D("h3",{children:"No se encontr\xF3 contenido"}),D("p",{children:"Prueba con otros t\xE9rminos de b\xFAsqueda o filtros."})]}):D("div",{className:"media-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"2rem"},children:u.map(([f,p])=>D(WC,{group:f,items:p},f))})]})]})},em=({item:n,isWatched:e})=>{const[t,r]=C.exports.useState(!1);return D("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:t?D("video",{src:`/api/stream?id=${encodeURIComponent(n.id)}`,autoPlay:!0,muted:!0,loop:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):(n.image,H("div",{style:{width:"100%",height:"100%",position:"relative"},children:[D("img",{src:n.image?`/media/${n.image}`:`/api/thumbnail?id=${encodeURIComponent(n.id)}`,alt:n.name,onError:i=>{i.target.onerror=null,i.target.src="https://images.unsplash.com/photo-1594908900066-3f47337549d8?q=80&w=400&auto=format&fit=crop"},style:{width:"100%",height:"100%",objectFit:"cover",opacity:e?.5:1}}),D("div",{className:"media-card-content",style:{position:"absolute",bottom:0,left:0,width:"100%",background:"rgba(0,0,0,0.7)"},children:D("div",{className:"media-title",children:n.name})})]}))})},YC=()=>{const{group:n}=my(),e=br(),{mediaGroups:t,watched:r,updateWatchedStatus:i}=Rl(),[s,o]=C.exports.useState(null),a=decodeURIComponent(n);if(!t||Object.keys(t).length===0)return D("div",{style:{color:"white",padding:"100px 3rem"},children:"Cargando..."});const l=t[a];if(!l)return D("div",{style:{color:"white",padding:"100px 3rem"},children:"Grupo no encontrado"});const u=l.reduce((h,m)=>{const g=m.id.split("/");let v="General";return g.length>3&&(v=g[2]),h[v]||(h[v]=[]),h[v].push(m),h},{}),c=Object.keys(u).sort(),d=c.length>1||c.length===1&&c[0]!=="General",f=h=>{e(`/watch/${encodeURIComponent(h.id)}`)},p=()=>{s?o(null):e("/")};return H(je.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"details-view",style:{padding:"100px 3rem 3rem"},children:[H("div",{className:"details-header",style:{marginBottom:"2.5rem",display:"flex",alignItems:"center",gap:"1.5rem"},children:[H("button",{onClick:p,className:"back-button",style:{position:"static"},children:[D(Ay,{size:20})," Volver"]}),D("h1",{style:{margin:0,fontSize:"2.5rem",fontWeight:"800"},children:a})]}),D("div",{className:"episodes-container",children:D(Qa,{mode:"wait",children:d?s?H(je.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[D("h2",{style:{marginTop:0,marginBottom:"2rem",color:"var(--text-secondary)",fontSize:"1.5rem",fontWeight:"700"},children:s}),D("div",{className:"episodes-list",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:"1.5rem"},children:u[s].map((h,m)=>H(je.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:m*.03},className:"episode-item",onClick:()=>f(h),style:{display:"flex",gap:"1rem",background:"rgba(255,255,255,0.05)",padding:"12px",borderRadius:"8px",cursor:"pointer",alignItems:"center",transition:"background 0.2s"},onMouseEnter:g=>g.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:g=>g.currentTarget.style.background="rgba(255,255,255,0.05)",children:[D("div",{className:"episode-thumbnail",style:{width:"140px",height:"80px",flexShrink:0,position:"relative",borderRadius:"4px",overflow:"hidden"},children:D(em,{item:h,isWatched:r[h.id]})}),H("div",{className:"episode-info",style:{flex:1,overflow:"hidden"},children:[D("h4",{style:{margin:"0 0 4px 0",fontSize:"1rem",fontWeight:"600",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:h.name}),D("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:r[h.id]&&H("span",{style:{fontSize:"0.8rem",color:"#4caf50",display:"flex",alignItems:"center",gap:"4px"},children:[D(Qi,{size:14})," Visto"]})})]}),D("button",{onClick:g=>{g.stopPropagation(),i(h.id,!r[h.id])},style:{background:"transparent",border:"none",cursor:"pointer",padding:"8px",color:r[h.id]?"#4caf50":"#444"},children:D(Qi,{size:24})})]},h.id))})]},`episodes-${s}`):D(je.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"season-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"2rem"},children:c.map(h=>{var v,y;const m=u[h],g=((v=m.find(E=>E.image))==null?void 0:v.image)||((y=l.find(E=>E.image))==null?void 0:y.image)||null;return H(je.div,{whileHover:{scale:1.05},onClick:()=>o(h),style:{cursor:"pointer",position:"relative",aspectRatio:"2/3",borderRadius:"12px",overflow:"hidden",background:"#1a1a1a"},children:[g?D("img",{src:`/media/${g}`,alt:h,style:{width:"100%",height:"100%",objectFit:"cover"}}):D("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#444"},children:D(Ly,{size:48,style:{marginBottom:"10px"}})}),H("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",background:"linear-gradient(transparent, rgba(0,0,0,0.95))",padding:"30px 15px 15px"},children:[D("h3",{style:{margin:0,fontSize:"1.2rem",fontWeight:"700"},children:h}),H("span",{style:{fontSize:"0.85rem",color:"#aaa"},children:[m.length," episodios"]})]})]},h)})},"season-grid"):D(je.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"episodes-list",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:"1.5rem"},children:l.map((h,m)=>H(je.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:m*.05},className:"episode-item",onClick:()=>f(h),style:{display:"flex",gap:"1rem",background:"rgba(255,255,255,0.05)",padding:"12px",borderRadius:"8px",cursor:"pointer",alignItems:"center",transition:"background 0.2s"},onMouseEnter:g=>g.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:g=>g.currentTarget.style.background="rgba(255,255,255,0.05)",children:[D("div",{className:"episode-thumbnail",style:{width:"140px",height:"80px",flexShrink:0,position:"relative",borderRadius:"4px",overflow:"hidden"},children:D(em,{item:h,isWatched:r[h.id]})}),H("div",{className:"episode-info",style:{flex:1,overflow:"hidden"},children:[D("h4",{style:{margin:"0 0 4px 0",fontSize:"1rem",fontWeight:"600",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:h.name}),D("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:r[h.id]&&H("span",{style:{fontSize:"0.8rem",color:"#4caf50",display:"flex",alignItems:"center",gap:"4px"},children:[D(Qi,{size:14})," Visto"]})})]}),D("button",{onClick:g=>{g.stopPropagation(),i(h.id,!r[h.id])},style:{background:"transparent",border:"none",cursor:"pointer",padding:"8px",color:r[h.id]?"#4caf50":"#444"},children:D(Qi,{size:24})})]},h.id))},"simple-list")})})]})},X=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},qC=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=XC},XC=Number.MAX_SAFE_INTEGER||9007199254740991;let te=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),P=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),x=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var ce={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Q={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Pr{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class QC{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Pr(e),this.fast_=new Pr(t),this.defaultTTFB_=i,this.ttfb_=new Pr(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Pr(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Pr(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Pr(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function ZC(n,e,t){return(e=e_(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function me(){return me=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},me.apply(null,arguments)}function tm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function pe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tm(Object(t),!0).forEach(function(r){ZC(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):tm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function JC(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function e_(n){var e=JC(n,"string");return typeof e=="symbol"?e:e+""}class wt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Cn,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Cn=function(){},t_={trace:Cn,debug:Cn,log:Cn,warn:Cn,info:Cn,error:Cn};function Jc(){return me({},t_)}function n_(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Cn}function nm(n,e,t){return e[n]?e[n].bind(e):n_(n,t)}const ed=Jc();function r_(n,e,t){const r=Jc();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{r[s]=nm(s,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Jc()}i.forEach(s=>{ed[s]=nm(s,n)})}else me(ed,r);return r}const ge=ed;function Zn(n=!0){return typeof self=="undefined"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function i_(n){return typeof self!="undefined"&&n===self.ManagedMediaSource}function ZE(n,e){const t=Object.keys(n),r=Object.keys(e),i=t.length,s=r.length;return!i||!s||i===s&&!t.some(o=>r.indexOf(o)===-1)}function Et(n,e=!1){if(typeof TextDecoder!="undefined"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let r,i,s,o="",a=0;for(;a<t;){if(r=n[a++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:i=n[a++],o+=String.fromCharCode((r&31)<<6|i&63);break;case 14:i=n[a++],s=n[a++],o+=String.fromCharCode((r&15)<<12|(i&63)<<6|(s&63)<<0);break}}return o}function Ye(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function JE(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function s_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Su={exports:{}},rm;function o_(){return rm||(rm=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):u;var p=a.parseURL(l);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var h=i.exec(p.path);p.netLoc=h[1],p.path=h[2]}p.netLoc&&!p.path&&(p.path="/");var m={scheme:p.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(m.netLoc=p.netLoc,f.path[0]!=="/"))if(!f.path)m.path=p.path,f.params||(m.params=p.params,f.query||(m.query=p.query));else{var g=p.path,v=g.substring(0,g.lastIndexOf("/")+1)+f.path;m.path=a.normalizePath(v)}return m.path===null&&(m.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(m)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(Su)),Su.exports}var Hf=o_();class Wf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ve={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class ex{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,l_(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ve.AUDIO]:null,[ve.VIDEO]:null,[ve.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Wf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Hf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ve.AUDIO]=null,e[ve.VIDEO]=null,e[ve.AUDIOVIDEO]=null}}function Me(n){return n.sn!=="initSegment"}class Tu extends ex{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(X(e)&&X(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const i=this._decryptdata=t[r[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=X(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!X(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Me(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const i=t[e];i&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)}}class a_ extends ex{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function tx(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||tx(t,e)}}function l_(n,e){const t=tx(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const im=Math.pow(2,32)-1,u_=[].push,nx={video:1,audio:2,id3:3,text:4};function Be(n){return String.fromCharCode.apply(null,n)}function rx(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function se(n,e){const t=ix(n,e);return t<0?4294967296+t:t}function sm(n,e){let t=se(n,e);return t*=Math.pow(2,32),t+=se(n,e+4),t}function ix(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function c_(n){const e=n.byteLength;for(let t=0;t<e;){const r=se(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function ue(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=se(n,i),o=Be(n.subarray(i+4,i+8)),a=s>1?i+s:r;if(o===e[0])if(e.length===1)t.push(n.subarray(i+8,a));else{const l=ue(n.subarray(i+8,a),e.slice(1));l.length&&u_.apply(t,l)}i=a}return t}function d_(n){const e=[],t=n[0];let r=8;const i=se(n,r);r+=4;let s=0,o=0;t===0?(s=se(n,r),o=se(n,r+4),r+=8):(s=sm(n,r),o=sm(n,r+8),r+=16),r+=2;let a=n.length+o;const l=rx(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=se(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return ge.warn("SIDX has hierarchical references (not supported)"),null;const h=se(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:h,info:{duration:h/i,start:a,end:a+f-1}}),a+=f,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:l,references:e}}function sx(n){const e=[],t=ue(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],o=ue(s,["tkhd"])[0];if(o){let a=o[0];const l=se(o,a===0?12:20),u=ue(s,["mdia","mdhd"])[0];if(u){a=u[0];const c=se(u,a===0?12:20),d=ue(s,["mdia","hdlr"])[0];if(d){const f=Be(d.subarray(8,12)),p={soun:ve.AUDIO,vide:ve.VIDEO}[f],h=ue(s,["mdia","minf","stbl","stsd"])[0],m=f_(h);p?(e[l]={timescale:c,type:p,stsd:m},e[p]=pe({timescale:c,id:l},m)):e[l]={timescale:c,type:f,stsd:m}}}}}return ue(n,["moov","mvex","trex"]).forEach(i=>{const s=se(i,4),o=e[s];o&&(o.default={duration:se(i,12),flags:se(i,20)})}),e}function f_(n){const e=n.subarray(8),t=e.subarray(8+78),r=Be(e.subarray(4,8));let i=r,s;const o=r==="enca"||r==="encv";if(o){const u=ue(e,[r])[0].subarray(r==="enca"?28:78);ue(u,["sinf"]).forEach(d=>{const f=ue(d,["schm"])[0];if(f){const p=Be(f.subarray(4,8));if(p==="cbcs"||p==="cenc"){const h=ue(d,["frma"])[0];h&&(i=Be(h))}}})}const a=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const l=ue(t,["avcC"])[0];l&&l.length>3&&(i+="."+Do(l[1])+Do(l[2])+Do(l[3]),s=Po(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=ue(e,[r])[0],u=ue(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Au(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Au(u,c);const f=u[c++];if(f===64)i+="."+Do(f);else break;if(c+=12,u[c++]!==5)break;c=Au(u,c);const p=u[c++];let h=(p&248)>>3;h===31&&(h+=1+((p&7)<<3)+((u[c]&224)>>5)),i+="."+h}break}case"hvc1":case"hev1":{const l=ue(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,f=se(l,2),p=(u&32)>>5?"H":"L",h=l[12],m=l.subarray(6,12);i+="."+c+d,i+="."+h_(f).toString(16).toUpperCase(),i+="."+p+h;let g="";for(let v=m.length;v--;){const y=m[v];if(y||g){const E=y.toString(16).toUpperCase();g="."+E+g}}i+=g}s=Po(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Po(i,t)||i;break}case"vp09":{const l=ue(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;i+="."+Ht(u)+"."+Ht(c)+"."+Ht(d)}break}case"av01":{const l=ue(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,p=(l[2]&32)>>5,h=u===2&&f?p?12:10:f?10:8,m=(l[2]&16)>>4,g=(l[2]&8)>>3,v=(l[2]&4)>>2,y=l[2]&3,E=1,S=1,T=1,L=0;i+="."+u+"."+Ht(c)+d+"."+Ht(h)+"."+m+"."+g+v+y+"."+Ht(E)+"."+Ht(S)+"."+Ht(T)+"."+L,s=Po("dav1",t)}break}}return{codec:i,encrypted:o,supplemental:s}}function Po(n,e){const t=ue(e,["dvvC"]),r=t.length?t[0]:ue(e,["dvcC"])[0];if(r){const i=r[2]>>1&127,s=r[2]<<5&32|r[3]>>3&31;return n+"."+Ht(i)+"."+Ht(s)}}function h_(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<32-1-t;return e>>>0}function Au(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Do(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Ht(n){return(n<10?"0":"")+n}function p_(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&ox(n,(r,i)=>{const s=r.subarray(8,24);s.some(o=>o!==0)||(ge.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Ye(s)} -> ${Ye(t)}`),r.set(t,8))})}function g_(n){const e=[];return ox(n,t=>e.push(t.subarray(8,24))),e}function ox(n,e){ue(n,["moov","trak"]).forEach(r=>{const i=ue(r,["mdia","minf","stbl","stsd"])[0];if(!i)return;const s=i.subarray(8);let o=ue(s,["enca"]);const a=o.length>0;a||(o=ue(s,["encv"])),o.forEach(l=>{const u=a?l.subarray(28):l.subarray(78);ue(u,["sinf"]).forEach(d=>{const f=ax(d);f&&e(f,a)})})})}function ax(n){const e=ue(n,["schm"])[0];if(e){const t=Be(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=ue(n,["schi","tenc"])[0];if(r)return r}}}function m_(n,e,t){const r={},i=ue(n,["moof","traf"]);for(let s=0;s<i.length;s++){const o=i[s],a=ue(o,["tfhd"])[0],l=se(a,4),u=e[l];if(!u)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=r[l],d=ue(o,["tfdt"])[0];if(d){const E=d[0];let S=se(d,4);E===1&&(S===im?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(S*=im+1,S+=se(d,8))),X(S)&&(!X(c.start)||S<c.start)&&(c.start=S)}const f=u.default,p=se(a,0)|(f==null?void 0:f.flags);let h=(f==null?void 0:f.duration)||0;p&8&&(p&2?h=se(a,12):h=se(a,8));const m=ue(o,["trun"]);let g=c.start||0,v=0,y=h;for(let E=0;E<m.length;E++){const S=m[E],T=se(S,4),L=c.sampleCount;c.sampleCount+=T;const A=S[3]&1,R=S[3]&4,I=S[2]&1,b=S[2]&2,O=S[2]&4,B=S[2]&8;let K=8,q=T;for(A&&(K+=4),R&&T&&(!(S[K+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=L),K+=4,I?(y=se(S,K),K+=4):y=h,b&&(K+=4),B&&(K+=4),g+=y,v+=y,q--);q--;)I?(y=se(S,K),K+=4):y=h,b&&(K+=4),O&&(S[K+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(q+1),c.keyFrameStart=g),K+=4),B&&(K+=4),g+=y,v+=y;!v&&h&&(v+=h*T)}c.duration+=v}if(!Object.keys(r).some(s=>r[s].duration)){let s=1/0,o=0;const a=ue(n,["sidx"]);for(let l=0;l<a.length;l++){const u=d_(a[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,f)=>d+f.info.duration||0,0);o=Math.max(o,c+u.earliestPresentationTime/u.timescale)}}o&&X(o)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=o*r[l].timescale-r[l].start)})}return r}function v_(n){const e={valid:null,remainder:null},t=ue(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function bt(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function om(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return ue(r,["moof"]).map(l=>{const u=l.byteOffset-8;ue(l,["traf"]).map(d=>{const f=ue(d,["tfdt"]).map(p=>{const h=p[0];let m=se(p,4);return h===1&&(m*=Math.pow(2,32),m+=se(p,8)),m/i})[0];return f!==void 0&&(n=f),ue(d,["tfhd"]).map(p=>{const h=se(p,4),m=se(p,0)&16777215,g=(m&1)!==0,v=(m&2)!==0,y=(m&8)!==0;let E=0;const S=(m&16)!==0;let T=0;const L=(m&32)!==0;let A=8;h===s&&(g&&(A+=8),v&&(A+=4),y&&(E=se(p,A),A+=4),S&&(T=se(p,A),A+=4),L&&(A+=4),e.type==="video"&&(o=Ml(e.codec)),ue(d,["trun"]).map(R=>{const I=R[0],b=se(R,0)&16777215,O=(b&1)!==0;let B=0;const K=(b&4)!==0,q=(b&256)!==0;let j=0;const G=(b&512)!==0;let M=0;const $=(b&1024)!==0,z=(b&2048)!==0;let J=0;const w=se(R,4);let k=8;O&&(B=se(R,k),k+=4),K&&(k+=4);let U=B+u;for(let N=0;N<w;N++){if(q?(j=se(R,k),k+=4):j=E,G?(M=se(R,k),k+=4):M=T,$&&(k+=4),z&&(I===0?J=se(R,k):J=ix(R,k),k+=4),e.type===ve.VIDEO){let V=0;for(;V<M;){const ee=se(r,U);if(U+=4,y_(o,r[U])){const fe=r.subarray(U,U+ee);zf(fe,o?2:1,n+J/i,t)}U+=ee,V+=ee+4}}n+=j/i}}))})})}),t}function Ml(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function y_(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function zf(n,e,t,r){const i=lx(n);let s=0;s+=e;let o=0,a=0,l=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(l===255);a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(l===255);const u=i.length-s;let c=s;if(a<u)s+=a;else if(a>u){ge.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(i[c++]===181){const f=rx(i,c);if(c+=2,f===49){const p=se(i,c);if(c+=4,p===1195456820){const h=i[c++];if(h===3){const m=i[c++],g=31&m,v=64&m,y=v?2+g*3:0,E=new Uint8Array(y);if(v){E[0]=m;for(let S=1;S<y;S++)E[S]=i[c++]}r.push({type:h,payloadType:o,pts:t,bytes:E})}}}}}else if(o===5&&a>16){const d=[];for(let h=0;h<16;h++){const m=i[c++].toString(16);d.push(m.length==1?"0"+m:m),(h===3||h===5||h===7||h===9)&&d.push("-")}const f=a-16,p=new Uint8Array(f);for(let h=0;h<f;h++)p[h]=i[c++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:Et(p),userDataBytes:p})}}}function lx(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===t[0]&&(o++,t.shift()),s[r]=n[o];return s}function E_(n){const e=n[0];let t="",r="",i=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;Be(n.subarray(u,u+1))!=="\0";)t+=Be(n.subarray(u,u+1)),u+=1;for(t+=Be(n.subarray(u,u+1)),u+=1;Be(n.subarray(u,u+1))!=="\0";)r+=Be(n.subarray(u,u+1)),u+=1;r+=Be(n.subarray(u,u+1)),u+=1,i=se(n,12),s=se(n,16),a=se(n,20),l=se(n,24),u=28}else if(e===1){u+=4,i=se(n,u),u+=4;const d=se(n,u);u+=4;const f=se(n,u);for(u+=4,o=2**32*d+f,qC(o)||(o=Number.MAX_SAFE_INTEGER,ge.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=se(n,u),u+=4,l=se(n,u),u+=4;Be(n.subarray(u,u+1))!=="\0";)t+=Be(n.subarray(u,u+1)),u+=1;for(t+=Be(n.subarray(u,u+1)),u+=1;Be(n.subarray(u,u+1))!=="\0";)r+=Be(n.subarray(u,u+1)),u+=1;r+=Be(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:c}}function x_(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function S_(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),x_([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,o,t)}function T_(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=A_(i);e.push(s),r+=s.size}}return e}function A_(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=n.buffer,a=Ye(new Uint8Array(o,t+12,16));let l=null,u=null,c=0;if(s===0)c=28;else{const f=n.getUint32(28);if(!f||r<32+f*16)return{offset:t,size:e};l=[];for(let p=0;p<f;p++)l.push(new Uint8Array(o,t+32+p*16,16));c=32+f*16}if(!c)return{offset:t,size:e};const d=n.getUint32(c);return e-32<d?{offset:t,size:e}:(u=new Uint8Array(o,t+c+4,d),{version:s,systemId:a,kids:l,data:u,offset:t,size:e})}const ux=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),vi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Yf(n,e){const t=vi[e];return!!t&&!!t[n.slice(0,4)]}function Ks(n,e,t=!0){return!n.split(",").some(r=>!qf(r,e,t))}function qf(n,e,t=!0){var r;const i=Zn(t);return(r=i==null?void 0:i.isTypeSupported(js(n,e)))!=null?r:!1}function js(n,e){return`${e}/mp4;codecs=${n}`}function am(n){if(n){const e=n.substring(0,4);return vi.video[e]}return 2}function Za(n){const e=ux();return n.split(",").reduce((t,r)=>{const s=e&&Ml(r)?9:vi.video[r];return s?(s*2+t)/(t?3:2):(vi.audio[r]+t)/(t?2:1)},0)}const Lu={};function L_(n,e=!0){if(Lu[n])return Lu[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var r;if(qf(t[i],"audio",e))return Lu[n]=t[i],t[i];if(t[i]==="mp3"&&(r=Zn(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const I_=/flac|opus|mp4a\.40\.34/i;function Ja(n,e=!0){return n.replace(I_,t=>L_(t.toLowerCase(),e))}function R_(n,e){const t=[];if(n){const r=n.split(",");for(let i=0;i<r.length;i++)Yf(r[i],"video")||t.push(r[i])}return e&&t.push(e),t.join(",")}function aa(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(lm(n,"audio")||lm(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function lm(n,e){return Yf(n,e)&&qf(n,e)}function b_(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function C_(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function um(n){const e=Zn(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function td(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const __={supported:!0,powerEfficient:!0,smooth:!0},w_={supported:!1,smooth:!1,powerEfficient:!1},cx={supported:!0,configurations:[],decodingInfoResults:[__]};function dx(n,e){return{supported:!1,configurations:e,decodingInfoResults:[w_],error:n}}function P_(n,e,t,r,i,s){const o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=s==null?void 0:s.audioCodec,u=s==null?void 0:s.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((f,p)=>{if(p){const h=e.groups[p];if(!h)throw new Error(`Audio track group ${p} not found`);Object.keys(h.channels).forEach(m=>{f[m]=(f[m]||0)+h.channels[m]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>Ml(f))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!d&&X(c)&&Object.keys(d).some(f=>parseInt(f)>c)}function fx(n,e,t,r={}){const i=n.videoCodec;if(!i&&!n.audioCodec||!t)return Promise.resolve(cx);const s=[],o=D_(n),a=o.length,l=k_(n,e,a>0),u=l.length;for(let c=a||1*u||1;c--;){const d={type:"media-source"};if(a&&(d.video=o[c%a]),u){d.audio=l[c%u];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}s.push(d)}if(i){const c=navigator.userAgent;if(i.split(",").some(d=>Ml(d))&&ux())return Promise.resolve(dx(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),s))}return Promise.all(s.map(c=>{const d=M_(c);return r[d]||(r[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:s,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:s,decodingInfoResults:[],error:c}))}function D_(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=hx(n),i=n.width||640,s=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:js(C_(l),"video"),width:i,height:s,bitrate:r,framerate:o};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function k_(n,e,t){var r;const i=(r=n.audioCodec)==null?void 0:r.split(","),s=hx(n);return i&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;const u=a?(l=e.groups[a])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===a){const f=parseFloat(d.channels||"");i.forEach(p=>{const h={contentType:js(p,"audio"),bitrate:t?O_(p,s):s};f&&(h.channels=""+f),c.push(h)})}return c},o):o},[]):[]}function O_(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function hx(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function M_(n){let e="";const{audio:t,video:r}=n;if(r&&(e+=`${td(r.contentType)}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`),t){const i=td(t.contentType);e+=`${r?"_":""}${i}_c${t.channels}`}return e}const nd=["NONE","TYPE-0","TYPE-1",null];function F_(n){return nd.indexOf(n)>-1}const el=["SDR","PQ","HLG"];function N_(n){return!!n&&el.indexOf(n)>-1}var la={No:"",Yes:"YES",v2:"v2"};function cm(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?la.v2:la.Yes:la.No}class dm{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Hs{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return fm(this._audioGroups,e)}hasSubtitleGroup(e){return fm(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(!!t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function fm(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function B_(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function U_(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||el.slice(0);const i=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&B_(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const $_=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},ye=(n,e)=>JSON.stringify(n,$_(e));function V_(n,e,t,r,i){const s=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,l=i==null?void 0:i.videoCodec,u=o&&parseInt(o)===2;let c=!1,d=!1,f=1/0,p=1/0,h=1/0,m=1/0,g=0,v=[];const{preferHDR:y,allowedVideoRanges:E}=U_(e,i);for(let R=s.length;R--;){const I=n[s[R]];c||(c=I.channels[2]>0),f=Math.min(f,I.minHeight),p=Math.min(p,I.minFramerate),h=Math.min(h,I.minBitrate),E.filter(O=>I.videoRanges[O]>0).length>0&&(d=!0)}f=X(f)?f:0,p=X(p)?p:0;const S=Math.max(1080,f),T=Math.max(30,p);h=X(h)?h:t,t=Math.max(h,t),d||(e=void 0);const L=s.length>1;return{codecSet:s.reduce((R,I)=>{const b=n[I];if(I===R)return R;if(v=d?E.filter(O=>b.videoRanges[O]>0):[],L){if(b.minBitrate>t)return Gt(I,`min bitrate of ${b.minBitrate} > current estimate of ${t}`),R;if(!b.hasDefaultAudio)return Gt(I,"no renditions with default or auto-select sound found"),R;if(a&&I.indexOf(a.substring(0,4))%5!==0)return Gt(I,`audio codec preference "${a}" not found`),R;if(o&&!u){if(!b.channels[o])return Gt(I,`no renditions with ${o} channel sound found (channels options: ${Object.keys(b.channels)})`),R}else if((!a||u)&&c&&b.channels[2]===0)return Gt(I,"no renditions with stereo sound found"),R;if(b.minHeight>S)return Gt(I,`min resolution of ${b.minHeight} > maximum of ${S}`),R;if(b.minFramerate>T)return Gt(I,`min framerate of ${b.minFramerate} > maximum of ${T}`),R;if(!v.some(O=>b.videoRanges[O]>0))return Gt(I,`no variants with VIDEO-RANGE of ${ye(v)} found`),R;if(l&&I.indexOf(l.substring(0,4))%5!==0)return Gt(I,`video codec preference "${l}" not found`),R;if(b.maxScore<g)return Gt(I,`max score of ${b.maxScore} < selected max of ${g}`),R}return R&&(Za(I)>=Za(R)||b.fragmentError>n[R].fragmentError)?R:(m=b.minIndex,g=b.maxScore,I)},void 0),videoRanges:v,preferHDR:y,minFramerate:p,minBitrate:h,minIndex:m}}function Gt(n,e){ge.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function px(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function G_(n,e,t,r){return n.slice(t,r+1).reduce((i,s,o)=>{if(!s.codecSet)return i;const a=s.audioGroups;let l=i[s.codecSet];l||(i[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const d=e.groups[c];!d||(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),i},{})}function hm(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}}function Qt(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(vr(n,i,t))return r}return-1}function vr(n,e,t){const{groupId:r,name:i,lang:s,assocLang:o,default:a}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||K_(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||j_(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function K_(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function j_(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function ur(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function H_(n,e,t,r,i){const s=e[r],a=e.reduce((f,p,h)=>{const m=p.uri;return(f[m]||(f[m]=[])).push(h),f},{})[s.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=pm(e,r,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const p=f.audioGroups,h=t.filter(m=>!p||p.indexOf(m.groupId)!==-1);return Qt(n,h,i)>-1});return d>-1?d:pm(e,r,f=>{const p=f.audioGroups,h=t.filter(m=>!p||p.indexOf(m.groupId)!==-1);return Qt(n,h,i)>-1})}function pm(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function tl(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class W_ extends wt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:i,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!i||!l)return;const u=performance.now(),c=s?s.stats:i.stats,d=s?s.duration:i.duration,f=u-c.loading.start,p=o.minAutoLevel,h=i.level,m=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||h<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const g=m>-1&&m!==h,v=!!t||g;if(!v&&(l.paused||!l.playbackRate||!l.readyState))return;const y=o.mainForwardBufferInfo;if(!v&&y===null)return;const E=this.bwEstimator.getEstimateTTFB(),S=Math.abs(l.playbackRate);if(f<=Math.max(E,1e3*(d/(S*2))))return;const T=y?y.len/S:0,L=c.loading.first?c.loading.first-c.loading.start:-1,A=c.loaded&&L>-1,R=this.getBwEstimate(),I=o.levels,b=I[h],O=Math.max(c.loaded,Math.round(d*(i.bitrate||b.averageBitrate)/8));let B=A?f-L:f;B<1&&A&&(B=Math.min(f,c.loaded*8/R));const K=A?c.loaded*1e3/B:0,q=E/1e3,j=K?(O-c.loaded)/K:O*8/R+q;if(j<=T)return;const G=K?K*8:R,M=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,$=this.hls.config.abrBandWidthUpFactor;let z=Number.POSITIVE_INFINITY,J;for(J=h-1;J>p;J--){const N=I[J].maxBitrate,V=!I[J].details||M;if(z=this.getTimeToLoadFrag(q,G,d*N,V),z<Math.min(T,d+q))break}if(z>=j||z>d*10)return;A?this.bwEstimator.sample(f-Math.min(E,L),c.loaded):this.bwEstimator.sampleTTFB(f);const w=I[J].maxBitrate;this.getBwEstimate()*$>w&&this.resetEstimator(w);const k=this.findBestLevel(w,p,J,0,T,1,1);k>-1&&(J=k),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${h} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${T.toFixed(3)} s
      Estimated load time for current fragment: ${j.toFixed(3)} s
      Estimated load time for down switch fragment: ${z.toFixed(3)} s
      TTFB estimate: ${L|0} ms
      Current BW estimate: ${X(R)?R|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${J} @ ${w|0} bps`),o.nextLoadLevel=o.nextAutoLevel=J,this.clearTimer();const U=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===J&&J>0){const N=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${J>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${N.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,J>p){let V=this.findBestLevel(this.hls.levels[p].bitrate,p,J,0,N,1,1);V===-1&&(V=p),this.hls.nextLoadLevel=this.hls.nextAutoLevel=V,this.resetEstimator(this.hls.levels[V].bitrate)}}};g||j>z*2?U():this.timer=self.setInterval(U,z*1e3),o.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new QC(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;!e||(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case P.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const o=performance.now(),a=s?s.stats:r.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,o=i?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;X(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===Q.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+i.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(x.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Q.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const g=this.findBestLevel(l,o,i,u,0,c,d);if(g>=0)return this.rebufferNotice=-1,g}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const g=this.bitrateTestDelay;g&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-g,this.info(`bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const p=this.findBestLevel(l,o,i,u,f,c,d);if(this.rebufferNotice!==p&&(this.rebufferNotice=p,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${p}`)),p>-1)return p;const h=r.levels[o],m=r.loadLevelObj;return m&&(h==null?void 0:h.bitrate)<m.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,o,a){var l;const u=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:p}=this,{levels:h,allAudioTracks:m,loadLevel:g,config:v}=this.hls;if(h.length===1)return 0;const y=h[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),S=g===-1||c===-1;let T,L="SDR",A=(y==null?void 0:y.frameRate)||0;const{audioPreference:R,videoPreference:I}=v,b=this.audioTracksByGroup||(this.audioTracksByGroup=px(m));let O=-1;if(S){if(this.firstSelection!==-1)return this.firstSelection;const G=this.codecTiers||(this.codecTiers=G_(h,b,t,r)),M=V_(G,L,e,R,I),{codecSet:$,videoRanges:z,minFramerate:J,minBitrate:w,minIndex:k,preferHDR:U}=M;O=k,T=$,L=U?z[z.length-1]:z[0],A=J,e=Math.max(e,w),this.log(`picked start tier ${ye(M)}`)}else T=y==null?void 0:y.codecSet,L=y==null?void 0:y.videoRange;const B=p?p.duration:f?f.duration:0,K=this.bwEstimator.getEstimateTTFB()/1e3,q=[];for(let G=r;G>=t;G--){var j;const M=h[G],$=G>d;if(!M)continue;if(v.useMediaCapabilities&&!M.supportedResult&&!M.supportedPromise){const V=navigator.mediaCapabilities;typeof(V==null?void 0:V.decodingInfo)=="function"&&P_(M,b,L,A,e,R)?(M.supportedPromise=fx(M,b,V,this.supportedCache),M.supportedPromise.then(ee=>{if(!this.hls)return;M.supportedResult=ee;const fe=this.hls.levels,he=fe.indexOf(M);ee.error?this.warn(`MediaCapabilities decodingInfo error: "${ee.error}" for level ${he} ${ye(ee)}`):ee.supported?ee.decodingInfoResults.some(Ee=>Ee.smooth===!1||Ee.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${he} not smooth or powerEfficient: ${ye(ee)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${he} ${ye(ee)}`),he>-1&&fe.length>1&&(this.log(`Removing unsupported level ${he}`),this.hls.removeLevel(he),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ee=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ee}`)})):M.supportedResult=cx}if((T&&M.codecSet!==T||L&&M.videoRange!==L||$&&A>M.frameRate||!$&&A>0&&A<M.frameRate||(j=M.supportedResult)!=null&&(j=j.decodingInfoResults)!=null&&j.some(V=>V.smooth===!1))&&(!S||G!==O)){q.push(G);continue}const z=M.details,J=(p?z==null?void 0:z.partTarget:z==null?void 0:z.averagetargetduration)||B;let w;$?w=a*e:w=o*e;const k=B&&i>=B*2&&s===0?M.averageBitrate:M.maxBitrate,U=this.getTimeToLoadFrag(K,w,k*J,z===void 0);if(w>=k&&(G===c||M.loadError===0&&M.fragmentError===0)&&(U<=K||!X(U)||E&&!this.bitrateTestDelay||U<u)){const V=this.forcedAutoLevel;return G!==g&&(V===-1||V!==g)&&(q.length&&this.trace(`Skipped level(s) ${q.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${h[q[0]].codecs}" ${h[q[0]].videoRange}; not compatible with "${T}" ${L}`),this.info(`switch candidate:${d}->${G} adjustedbw(${Math.round(w)})-bitrate=${Math.round(w-k)} ttfb:${K.toFixed(1)} avgDuration:${J.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${U.toFixed(1)} firstSelection:${S} codecSet:${M.codecSet} videoRange:${M.videoRange} hls.loadLevel:${g}`)),S&&(this.firstSelection=G),G}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const gx={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const o=e(s);if(o>0)t=i+1;else if(o<0)r=i-1;else return s}return null}};function z_(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!X(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<n.length;++s){const o=n[s];if(q_(e,t,o))return o}return null}function Sr(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&gm(t,r,s)===0||Y_(s,n,Math.min(i,r))))return s;const o=gx.search(e,gm.bind(null,t,r));return o&&(o!==n||!s)?o:s}function Y_(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function gm(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function q_(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function mx(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:i}=n;i&&(r=r.concat(i));let s;return gx.search(r,o=>o.cc<e?1:o.cc>e?-1:(s=o,o.end<=t?1:o.start>t?-1:0)),s||null}return null}function nl(n){switch(n.details){case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_TIMEOUT:case P.LEVEL_LOAD_TIMEOUT:case P.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function vx(n){return n.details.startsWith("key")}function yx(n){return vx(n)&&!!n.frag&&!n.frag.decryptdata}function mm(n,e){const t=nl(e);return n.default[`${t?"timeout":"error"}Retry`]}function Xf(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function vm(n){return pe(pe({},n),{errorRetry:null,timeoutRetry:null})}function rl(n,e,t,r){if(!n)return!1;const i=r==null?void 0:r.code,s=e<n.maxNumRetry&&(X_(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function X_(n){return rd(n)||!!n&&(n<400||n>499)}function rd(n){return n===0&&navigator.onLine===!1}var We={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},gt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class Q_ extends wt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;!e||(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Q.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(o=>i.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case P.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=ai();return}case P.FRAG_GAP:case P.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=We.SendAlternateToPenaltyBox;return}case P.LEVEL_EMPTY_ERROR:case P.LEVEL_PARSING_ERROR:{var o;const l=t.parent===Q.MAIN?t.level:i.loadLevel;t.details===P.LEVEL_EMPTY_ERROR&&!!((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case P.LEVEL_LOAD_ERROR:case P.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case P.AUDIO_TRACK_LOAD_ERROR:case P.AUDIO_TRACK_LOAD_TIMEOUT:case P.SUBTITLE_LOAD_ERROR:case P.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=i.loadLevelObj;if(l&&(s.type===ce.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===ce.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=We.SendAlternateToPenaltyBox,t.errorAction.flags=gt.MoveAllAlternatesMatchingHost;return}}return;case P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:We.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingHDCP};return;case P.KEY_SYSTEM_SESSION_UPDATE_FAILED:case P.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case P.KEY_SYSTEM_NO_SESSION:t.errorAction={action:We.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingKey};return;case P.BUFFER_ADD_CODEC_ERROR:case P.REMUX_ALLOC_ERROR:case P.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:i.loadLevel)}return;case P.INTERNAL_EXCEPTION:case P.BUFFER_APPENDING_ERROR:case P.BUFFER_FULL_ERROR:case P.LEVEL_SWITCH_ERROR:case P.BUFFER_STALLED_ERROR:case P.BUFFER_SEEK_OVER_HOLE:case P.BUFFER_NUDGE_ON_STALL:t.errorAction=ai();return}t.type===te.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ai())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=mm(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(rl(i,s,nl(e),e.response))return{action:We.RetryRequest,flags:gt.None,retryConfig:i,retryCount:s};const a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=mm(vx(e)?o:s,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==P.FRAG_GAP&&i.fragmentError++,!yx(e)&&rl(a,l,nl(e),e.response)))return{action:We.RetryRequest,flags:gt.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,o;const u=e.details;i.loadError++,u===P.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:p,maxAutoLevel:h}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const m=(s=e.frag)==null?void 0:s.type,v=(m===Q.AUDIO&&u===P.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===P.BUFFER_ADD_CODEC_ERROR||u===P.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:L})=>i.audioCodec!==L),E=e.sourceBufferName==="video"&&(u===P.BUFFER_ADD_CODEC_ERROR||u===P.BUFFER_APPEND_ERROR)&&d.some(({codecSet:L,audioCodec:A})=>i.codecSet!==L&&i.audioCodec===A),{type:S,groupId:T}=(o=e.context)!=null?o:{};for(let L=d.length;L--;){const A=(L+f)%d.length;if(A!==f&&A>=p&&A<=h&&d[A].loadError===0){var a,l;const R=d[A];if(u===P.FRAG_GAP&&m===Q.MAIN&&e.frag){const I=d[A].details;if(I){const b=Sr(e.frag,I.fragments,e.frag.start);if(b!=null&&b.gap)continue}}else{if(S===ce.AUDIO_TRACK&&R.hasAudioGroup(T)||S===ce.SUBTITLE_TRACK&&R.hasSubtitleGroup(T))continue;if(m===Q.AUDIO&&(a=i.audioGroups)!=null&&a.some(I=>R.hasAudioGroup(I))||m===Q.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(I=>R.hasSubtitleGroup(I))||v&&i.audioCodec===R.audioCodec||E&&i.codecSet===R.codecSet||!v&&i.codecSet!==R.codecSet)continue}c=A;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:We.SendAlternateToPenaltyBox,flags:gt.None,nextAutoLevel:c}}return{action:We.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case We.DoNothing:break;case We.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==P.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i}=r,s=r.nextAutoLevel;switch(i){case gt.None:this.switchLevel(e,s);break;case gt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(r.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=nd[nd.indexOf(c)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case gt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let f=c;f--;)if(this.variantHasKey(u[f],l)){var o,a;this.log(`Banned key found in level ${f} (${u[f].bitrate}bps) or audio group "${(o=u[f].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Ye(l.keyId||[])}`),u[f].fragmentError++,u[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<c)r.resolved=!0;else if(d&&d.type!==Q.MAIN){const f=d.decryptdata;f&&!l.matches(f)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===P.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=td(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${s} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(s))}}}function ai(n){const e={action:We.DoNothing,flags:gt.None};return n&&(e.resolved=!0),e}var Ue={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Z_{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:i}=this,s=Object.keys(i);for(let o=s.length;o--;){const a=i[s[o]];if((a==null?void 0:a.body.type)===t&&(!r||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,i,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===r&&this.removeFragment(l.body);return}const u=l.range[e];if(!!u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,i=Dr(r),s=this.fragments[i];if(!s||s.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(a=>{const l=r.elementaryStreams[a];if(!l)return;const u=t[a],c=o||l.partial===!0;s.range[a]=this.getBufferedTimes(r,e.part,c,u)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,r),ko(s)||this.removeParts(r.sn-1,r.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];!r||(this.activePartLists[t]=ym(r,i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=Dr(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,f=i.end(c)+this.bufferPadding;if(u>=d&&l<=f){s.time.push({startPTS:Math.max(o,i.start(c)),endPTS:Math.min(a,i.end(c))});break}else if(o<f&&a>d){const p=Math.max(o,i.start(c)),h=Math.min(a,i.end(c));h>p&&(s.partial=!0,s.time.push({startPTS:p,endPTS:h}))}else if(a<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];!c||ko(c)&&(i=c.body.start-a,s=c.body.end+a,e>=i&&e<=s&&(r=Math.min(e-i,s-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ko(t))}getState(e){const t=Dr(e),r=this.fragments[t];return r?r.buffered?ko(r)?Ue.PARTIAL:Ue.OK:Ue.APPENDING:Ue.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,s=r.end(o)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,i=t.part?null:t,s=Dr(r);this.fragments[s]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s,type:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(i){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(i)}this.timeRanges=s;const l=s[o];this.detectEvictedFragments(o,l,a,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Dr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let i=r.length;i--;){const s=t[r[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=Dr(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=ym(r,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function ko(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Dr(n){return`${n.type}_${n.level}_${n.sn}`}function ym(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Jn={cbc:0,ctr:1};class J_{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Jn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Jn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function ew(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class tw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],o=r[2],a=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],p=new Uint32Array(256);let h=0,m=0,g=0;for(g=0;g<256;g++)g<128?p[g]=g<<1:p[g]=g<<1^283;for(g=0;g<256;g++){let v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^v&255^99,e[h]=v,t[v]=h;const y=p[h],E=p[y],S=p[E];let T=p[v]*257^v*16843008;i[h]=T<<24|T>>>8,s[h]=T<<16|T>>>16,o[h]=T<<8|T>>>24,a[h]=T,T=S*16843009^E*65537^y*257^h*16843008,u[v]=T<<24|T>>>8,c[v]=T<<16|T>>>16,d[v]=T<<8|T>>>24,f[v]=T,h?(h=y^p[p[p[S^y]]],m^=p[p[m]]):h=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,p=this.invSubMix,h=p[0],m=p[1],g=p[2],v=p[3];let y,E;for(a=0;a<o;a++){if(a<s){y=u[a]=t[a];continue}E=y,a%s===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=f[a/s|0]<<24):s>6&&a%s===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[a]=y=(u[a-s]^E)>>>0}for(l=0;l<o;l++)a=o-l,l&3?E=u[a]:E=u[a-4],l<4||a<=4?c[l]=E:c[l]=h[d[E>>>24]]^m[d[E>>>16&255]]^g[d[E>>>8&255]]^v[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let p=f[0],h=f[1],m=f[2],g=f[3];const v=new Int32Array(e),y=new Int32Array(v.length);let E,S,T,L,A,R,I,b,O,B,K,q,j,G;const M=this.networkToHostOrderSwap;for(;t<v.length;){for(O=M(v[t]),B=M(v[t+1]),K=M(v[t+2]),q=M(v[t+3]),A=O^s[0],R=q^s[1],I=K^s[2],b=B^s[3],j=4,G=1;G<i;G++)E=l[A>>>24]^u[R>>16&255]^c[I>>8&255]^d[b&255]^s[j],S=l[R>>>24]^u[I>>16&255]^c[b>>8&255]^d[A&255]^s[j+1],T=l[I>>>24]^u[b>>16&255]^c[A>>8&255]^d[R&255]^s[j+2],L=l[b>>>24]^u[A>>16&255]^c[R>>8&255]^d[I&255]^s[j+3],A=E,R=S,I=T,b=L,j=j+4;E=o[A>>>24]<<24^o[R>>16&255]<<16^o[I>>8&255]<<8^o[b&255]^s[j],S=o[R>>>24]<<24^o[I>>16&255]<<16^o[b>>8&255]<<8^o[A&255]^s[j+1],T=o[I>>>24]<<24^o[b>>16&255]<<16^o[A>>8&255]<<8^o[R&255]^s[j+2],L=o[b>>>24]<<24^o[A>>16&255]<<16^o[R>>8&255]<<8^o[I&255]^s[j+3],y[t]=M(E^p),y[t+1]=M(L^h),y[t+2]=M(T^m),y[t+3]=M(S^g),p=O,h=B,m=K,g=q,t=t+4}return y.buffer}}class nw{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=rw(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function rw(n){switch(n){case Jn.cbc:return"AES-CBC";case Jn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const iw=16;class Qf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?ew(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,i){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,r,i);const l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)}softwareDecrypt(e,t,r,i){const{currentIV:s,currentResult:o,remainderData:a}=this;if(i!==Jn.cbc||t.byteLength!==16)return ge.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=bt(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(r=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new tw),u.expandKey(t);const c=o;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new nw(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new J_(this.subtle,new Uint8Array(r),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(ge.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r,i)))}onWebCryptoError(e,t,r,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%iw;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){!this.logEnabled||(ge.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Em=Math.pow(2,17);class sw{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new cn({type:te.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(h=>h[0]==="GAP")){l(Sm(e));return}else e.gap=!1;const u=this.loader=s?new s(i):new o(i),c=xm(e);e.loader=u;const d=vm(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Em};e.stats=u.stats;const p={onSuccess:(h,m,g,v)=>{this.resetLoader(e,u);let y=h.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),a({frag:e,part:null,payload:y,networkDetails:v})},onError:(h,m,g,v)=>{this.resetLoader(e,u),l(new cn({type:te.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:pe({url:r,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:v}))},onAbort:(h,m,g)=>{this.resetLoader(e,u),l(new cn({type:te.NETWORK_ERROR,details:P.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,m,g)=>{this.resetLoader(e,u),l(new cn({type:te.NETWORK_ERROR,details:P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}};t&&(p.onProgress=(h,m,g,v)=>t({frag:e,part:null,payload:g,networkDetails:v})),u.load(c,f,p)})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Sm(e,t));return}const u=this.loader=s?new s(i):new o(i),c=xm(e,t);e.loader=u;const d=vm(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Em};t.stats=u.stats,u.load(c,f,{onSuccess:(p,h,m,g)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const v={frag:e,part:t,payload:p.data,networkDetails:g};r(v),a(v)},onError:(p,h,m,g)=>{this.resetLoader(e,u),l(new cn({type:te.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:pe({url:c.url,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:m,stats:g}))},onAbort:(p,h,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new cn({type:te.NETWORK_ERROR,details:P.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:p}))},onTimeout:(p,h,m)=>{this.resetLoader(e,u),l(new cn({type:te.NETWORK_ERROR,details:P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:p}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/s),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=i.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function xm(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(X(i)&&X(s)){var o;let a=i,l=s;if(n.sn==="initSegment"&&ow((o=n.decryptdata)==null?void 0:o.method)){const u=s-i;u%16&&(l=s+(16-u%16)),i!==0&&(r.resetIV=!0,a=i-16)}r.rangeStart=a,r.rangeEnd=l}return r}function Sm(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:te.MEDIA_ERROR,details:P.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new cn(r)}function ow(n){return n==="AES-128"||n==="AES-256"}class cn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Ex extends wt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Zf{constructor(e,t,r,i=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Oo(),this.buffering={audio:Oo(),video:Oo(),audiovideo:Oo()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=o}}function Oo(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Tm={length:0,start:()=>0,end:()=>0};class ae{static isBuffered(e,t){if(e){const r=ae.getBuffered(e);for(let i=r.length;i--;)if(t>=r.start(i)&&t<=r.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=ae.getBuffered(e);return ae.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const i=ae.bufferedRanges(e);if(i.length)return ae.bufferedInfo(i,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,s=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=s.length;if(d){const f=s[d-1].end;e[c].start-f<r?e[c].end>f&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let o=0,a,l=t,u=t;for(let c=0;c<s.length;c++){const d=s[c].start,f=s[c].end;if(i===-1&&t>=d&&t<=f&&(i=c),t+r>=d&&t<f)l=d,u=f,o=u-t;else if(t+r<d){a=d;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Tm}catch(t){return ge.log("failed to get media.buffered",t),Tm}}}const xx=/\{\$([a-zA-Z0-9-_]+)\}/g;function Am(n){return xx.test(n)}function id(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(xx,r=>{const i=r.substring(2,r.length-1),s=t==null?void 0:t[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function Lm(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(i))s=o.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function aw(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const lw=/^(\d+)x(\d+)$/,Im=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Re{constructor(e,t){typeof e=="string"&&(e=Re.parseAttrList(e,t)),me(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=lw.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const i={},s='"';for(Im.lastIndex=0;(r=Im.exec(e))!==null;){const o=r[1].trim();let a=r[2];const l=a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1;let u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=id(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ge.warn(`${e}: attribute ${o} is missing quotes`)}i[o]=a}return i}}const uw="com.apple.hls.interstitial";function cw(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function dw(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Sx{constructor(e,t,r=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:r,t){const s=t.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){ge.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=me(new Re({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);X(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(ge.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(X(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===uw}get isValid(){return!!this.id&&!this._badValueForSameId&&X(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const fw=10;class hw{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?X(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||fw}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function il(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function Rm(n,e){return!n&&!e?!0:!n||!e?!1:il(n,e)}function li(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Jf(n){switch(n){case"AES-128":case"AES-256":return Jn.cbc;case"AES-256-CTR":return Jn.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function eh(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function sd(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function pw(n){const e=sd(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Tx(n){const e=function(r,i,s){const o=r[i];r[i]=r[s],r[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function Ax(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",o=i[1];s?(r.splice(-1,1),t=eh(o)):t=pw(o)}}return t}const sl=typeof self!="undefined"?self:void 0;var be={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Xe={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ua(n){switch(n){case Xe.FAIRPLAY:return be.FAIRPLAY;case Xe.PLAYREADY:return be.PLAYREADY;case Xe.WIDEVINE:return be.WIDEVINE;case Xe.CLEARKEY:return be.CLEARKEY}}function Iu(n){switch(n){case be.FAIRPLAY:return Xe.FAIRPLAY;case be.PLAYREADY:return Xe.PLAYREADY;case be.WIDEVINE:return Xe.WIDEVINE;case be.CLEARKEY:return Xe.CLEARKEY}}function Zi(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[be.FAIRPLAY,be.WIDEVINE,be.PLAYREADY,be.CLEARKEY].filter(i=>!!e[i]):[];return!r[be.WIDEVINE]&&t&&r.push(be.WIDEVINE),r}const Lx=function(n){return sl!=null&&(n=sl.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function gw(n,e,t,r){let i;switch(n){case be.FAIRPLAY:i=["cenc","sinf"];break;case be.WIDEVINE:case be.PLAYREADY:i=["cenc"];break;case be.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return mw(i,e,t,r)}function mw(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function vw(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Ix(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=eh(a).subarray(0,16);return Tx(l),l}}return null}let kr={};class Wn{static clearKeyUriToKeyIdMap(){kr={}}static setKeyIdForUri(e,t){kr[e]=t}static addKeyIdForUri(e){const t=Object.keys(kr).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),kr[e]=r,r}constructor(e,t,r,i=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!li(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(JE(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&il(e.keyFormatVersions,this.keyFormatVersions)&&Rm(e.iv,this.iv)&&Rm(e.keyId,this.keyId)}isSupported(){if(this.method){if(li(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Xe.FAIRPLAY:case Xe.WIDEVINE:case Xe.PLAYREADY:case Xe.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(li(this.method)){let s=this.iv;return s||(typeof e!="number"&&(ge.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=Ew(e)),new Wn(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=kr[this.uri];if(s&&!il(this.keyId,s)&&Wn.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=Ax(this.uri);if(r)switch(this.keyFormat){case Xe.WIDEVINE:if(this.pssh=r,!this.keyId){const s=T_(r.buffer);if(s.length){var i;const o=s[0];this.keyId=(i=o.kids)!=null&&i.length?o.kids[0]:null}}this.keyId||(this.keyId=bm(t));break;case Xe.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=S_(s,null,r),this.keyId=Ix(r);break}default:{let s=r.subarray(0,16);if(s.length!==16){const o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=yw(t),s||(s=bm(t),s||(s=kr[this.uri])),s&&(this.keyId=s,Wn.setKeyIdForUri(this.uri,s))}return this}}function yw(n){const e=n==null?void 0:n[Xe.WIDEVINE];return e?e.keyId:null}function bm(n){const e=n==null?void 0:n[Xe.PLAYREADY];if(e){const t=Ax(e.uri);if(t)return Ix(t)}return null}function Ew(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Cm=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,_m=/#EXT-X-MEDIA:(.*)/g,xw=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ru=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Sw=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Zt{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return Hf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return xw.test(e)}static parseMasterPlaylist(e,t){const r=Am(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];if(Cm.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let o;for(;(o=Cm.exec(e))!=null;)if(o[1]){var a;const u=new Re(o[1],i),c=id(i,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Zt.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),Dm(u.CODECS,d);const p=u["SUPPLEMENTAL-CODECS"];p&&(d.supplemental={},Dm(p,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||s.push(d),i.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new Re(c,i),f=d["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=d);break}case"SESSION-KEY":{const d=wm(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):ge.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new Re(c,i);Lm(i,d,t)}break}case"CONTENT-STEERING":{const d=new Re(c,i);i.contentSteering={uri:Zt.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Pm(c);break}}}const l=s.length>0&&s.length<i.levels.length;return i.levels=l?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},o=r.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(_m.lastIndex=0;(i=_m.exec(e))!==null;){const u=new Re(i[1],r),c=u.TYPE;if(c){const d=a[c],f=s[c]||[];s[c]=f;const p=u.LANGUAGE,h=u["ASSOC-LANGUAGE"],m=u.CHANNELS,g=u.CHARACTERISTICS,v=u["INSTREAM-ID"],y={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||p||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:p,url:u.URI?Zt.resolve(u.URI,t):""};if(h&&(y.assocLang=h),m&&(y.channels=m),g&&(y.characteristics=g),v&&(y.instreamId=v),d!=null&&d.length){const E=Zt.findGroup(d,y.groupId)||d[0];km(y,E,"audioCodec"),km(y,E,"textCodec")}f.push(y)}}return s}static parseLevelPlaylist(e,t,r,i,s,o){var a;const l={url:t},u=new hw(t),c=u.fragments,d=[];let f=null,p=0,h=0,m=0,g=0,v=0,y=null,E=new Tu(i,l),S,T,L,A=-1,R=!1,I=null,b;if(Ru.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Am(e),((a=Ru.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(S=Ru.exec(e))!==null;){R&&(R=!1,E=new Tu(i,l),E.playlistOffset=m,E.setStart(m),E.sn=p,E.cc=g,v&&(E.bitrate=v),E.level=r,f&&(E.initSegment=f,f.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),I&&(E.setByteRange(I),I=null)));const q=S[1];if(q){E.duration=parseFloat(q);const j=(" "+S[2]).slice(1);E.title=j||null,E.tagList.push(j?["INF",q,j]:["INF",q])}else if(S[3]){if(X(E.duration)){E.playlistOffset=m,E.setStart(m),L&&Mm(E,L,u),E.sn=p,E.level=r,E.cc=g,c.push(E);const j=(" "+S[3]).slice(1);E.relurl=id(u,j),od(E,y,d),y=E,m+=E.duration,p++,h=0,R=!0}}else{if(S=S[0].match(Sw),!S){ge.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<S.length&&S[T]===void 0;T++);const j=(" "+S[T]).slice(1),G=(" "+S[T+1]).slice(1),M=S[T+2]?(" "+S[T+2]).slice(1):null;switch(j){case"BYTERANGE":y?E.setByteRange(G,y):E.setByteRange(G);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=G,E.tagList.push(["PROGRAM-DATE-TIME",G]),A===-1&&(A=c.length);break;case"PLAYLIST-TYPE":u.type&&ln(u,j,S),u.type=G.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?ln(u,j,S):c.length>0&&Fm(u,j,S),p=u.startSN=parseInt(G);break;case"SKIP":{u.skippedSegments&&ln(u,j,S);const $=new Re(G,u),z=$.decimalInteger("SKIPPED-SEGMENTS");if(X(z)){u.skippedSegments+=z;for(let w=z;w--;)c.push(null);p+=z}const J=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");J&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(J.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&ln(u,j,S),u.targetduration=Math.max(parseInt(G),1);break;case"VERSION":u.version!==null&&ln(u,j,S),u.version=parseInt(G);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||ln(u,j,S),u.live=!1;break;case"#":(G||M)&&E.tagList.push(M?[G,M]:[G]);break;case"DISCONTINUITY":g++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([j]);break;case"BITRATE":E.tagList.push([j,G]),v=parseInt(G)*1e3,X(v)?E.bitrate=v:v=0;break;case"DATERANGE":{const $=new Re(G,u),z=new Sx($,u.dateRanges[$.ID],u.dateRangeTagCount);u.dateRangeTagCount++,z.isValid||u.skippedSegments?u.dateRanges[z.id]=z:ge.warn(`Ignoring invalid DATERANGE tag: "${G}"`),E.tagList.push(["EXT-X-DATERANGE",G]);break}case"DEFINE":{{const $=new Re(G,u);"IMPORT"in $?aw(u,$,o):Lm(u,$,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?ln(u,j,S):c.length>0&&Fm(u,j,S),u.startCC=g=parseInt(G);break;case"KEY":{const $=wm(G,t,u);if($.isSupported()){if($.method==="NONE"){L=void 0;break}L||(L={});const z=L[$.keyFormat];z!=null&&z.matches($)||(z&&(L=me({},L)),L[$.keyFormat]=$)}else ge.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${G}"`);break}case"START":u.startTimeOffset=Pm(G);break;case"MAP":{const $=new Re(G,u);if(E.duration){const z=new Tu(i,l);Om(z,$,r,L),f=z,E.initSegment=f,f.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime)}else{const z=E.byteRangeEndOffset;if(z){const J=E.byteRangeStartOffset;I=`${z-J}@${J}`}else I=null;Om(E,$,r,L),f=E,R=!0}f.cc=g;break}case"SERVER-CONTROL":{b&&ln(u,j,S),b=new Re(G),u.canBlockReload=b.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=b.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&b.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=b.optionalFloat("PART-HOLD-BACK",0),u.holdBack=b.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&ln(u,j,S);const $=new Re(G);u.partTarget=$.decimalFloatingPoint("PART-TARGET");break}case"PART":{let $=u.partList;$||($=u.partList=[]);const z=h>0?$[$.length-1]:void 0,J=h++,w=new Re(G,u),k=new a_(w,E,l,J,z);$.push(k),E.duration+=k.duration;break}case"PRELOAD-HINT":{const $=new Re(G,u);u.preloadHint=$;break}case"RENDITION-REPORT":{const $=new Re(G,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push($);break}default:ge.warn(`line parsed but not handled: ${S}`);break}}}y&&!y.relurl?(c.pop(),m-=y.duration,u.partList&&(u.fragmentHint=y)):u.partList&&(od(E,y,d),E.cc=g,u.fragmentHint=E,L&&Mm(E,L,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const O=c.length,B=c[0],K=c[O-1];if(m+=u.skippedSegments*u.targetduration,m>0&&O&&K){u.averagetargetduration=m/O;const q=K.sn;u.endSN=q!=="initSegment"?q:0,u.live||(K.endList=!0),A>0&&(Aw(c,A),B&&d.unshift(B))}return u.fragmentHint&&(m+=u.fragmentHint.duration),u.totalduration=m,d.length&&u.dateRangeTagCount&&B&&Rx(d,u),u.endCC=g,u}}function Rx(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];n.push(a),t++}else return;const r=n[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const l=e.dateRanges[s[a]],u=l.startDate.getTime();l.tagAnchor=r.ref;for(let c=t;c--;){var o;if(((o=n[c])==null?void 0:o.sn)<e.startSN)break;const d=Tw(e,u,n,c,i);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function Tw(n,e,t,r,i){const s=t[r];if(s){const a=s.programDateTime;if(e>=a||r===0){var o;const l=(((o=t[r+1])==null?void 0:o.start)||i)-s.start;if(e<=a+l*1e3){const u=t[r].sn-n.startSN;if(u<0)return-1;const c=n.fragments;if(c.length>t.length){const f=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let p=f;p>u;p--){const h=c[p].programDateTime;if(e>=h&&e<h+c[p].duration*1e3)return p}}return u}}}return-1}function wm(n,e,t){var r,i;const s=new Re(n,t),o=(r=s.METHOD)!=null?r:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";a&&s.IV&&!l&&ge.error(`Invalid IV: ${s.IV}`);const d=a?Zt.resolve(a,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Wn(o,d,c,f,l,s.KEYID)}function Pm(n){const t=new Re(n).decimalFloatingPoint("TIME-OFFSET");return X(t)?t:null}function Dm(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>Yf(s,r));i.length&&(e[`${r}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function km(n,e,t){const r=e[t];r&&(n[t]=r)}function Aw(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function od(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function Om(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function Mm(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}function ln(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Fm(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function bu(n,e){const t=e.startPTS;if(X(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&i.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function bx(n,e,t,r,i,s,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let l=t,u=r;const c=e.startPTS,d=e.endPTS;if(X(c)){const v=Math.abs(c-t);n&&v>n.totalduration?o.warn(`media timestamps and playlist times differ by ${v}s for level ${e.level} ${n.url}`):X(e.deltaPTS)?e.deltaPTS=Math.max(v,e.deltaPTS):e.deltaPTS=v,l=Math.max(t,c),t=Math.min(t,c),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,u=Math.min(r,d),r=Math.max(r,d),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=i,e.endPTS=r,e.minEndPTS=u,e.endDTS=s;const p=e.sn;if(!n||p<n.startSN||p>n.endSN)return 0;let h;const m=p-n.startSN,g=n.fragments;for(g[m]=e,h=m;h>0;h--)bu(g[h],g[h-1]);for(h=m;h<g.length-1;h++)bu(g[h],g[h+1]);return n.fragmentHint&&bu(g[g.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function Lw(n,e,t){if(n===e)return;let r=null;const i=n.fragments;for(let c=i.length-1;c>=0;c--){const d=i[c].initSegment;if(d){r=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;bw(n,e,(c,d,f,p)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const h=c.cc-d.cc;for(let m=f;m<p.length;m++)p[m].cc+=h;e.endCC=p[p.length-1].cc}X(c.startPTS)&&X(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(s=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,r=c.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&a.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=r)==null?void 0:d.relurl))&&(c.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Iw(n.dateRanges,e,t));const c=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<a.length;d++)a[d].programDateTime===null&&od(a[d],a[d-1],c);Rx(c,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const c=wx(n,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:o[0].cc}Rw(n.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),s?bx(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):Cx(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function Iw(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:i}=e,s=me({},n);i&&i.forEach(l=>{delete s[l]});const a=Object.keys(s).length;return a?(Object.keys(r).forEach(l=>{const u=s[l],c=new Sx(r[l].attr,u);c.isValid?(s[l]=c,u||(c.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ye(r[l].attr)}"`)}),s):r}function Rw(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const o=n[i],a=e[i+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function bw(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=s;u++){const c=l[o+u];let d=a[u];if(r&&!d&&c&&(d=e.fragments[u]=c),c&&d){t(c,d,u,a);const f=c.relurl,p=d.relurl;if(f&&Cw(f,p)){e.playlistParsingError=Nm(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=Nm(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function Nm(n,e,t,r,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Cx(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,s=r>=0;let o=0;if(s&&r<i.length)o=i[r].start;else if(s&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(s&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;ad(e,o)}function ad(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function _x(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments,i=4;if(r.length&&t*i>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function wx(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function Bm(n,e,t){return n?Px(n.partList,e,t):null}function Px(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function Dx(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function Cw(n,e){return n!==e&&e?Um(n)!==Um(e):!1}function Um(n){return n.replace(/\?[^?]*$/,"")}function ys(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function _w(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function $m(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function kx(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)$m(t[r],n);e.fragmentHint&&$m(e.fragmentHint,n),e.alignedSliding=!0}function ww(n,e){!n||(Ox(e,n),e.alignedSliding||ol(e,n),!e.alignedSliding&&!e.skippedSegments&&Cx(n,e,!1))}function Ox(n,e){if(!_w(e,n))return;const t=Math.min(e.endCC,n.endCC),r=ys(e.fragments,t),i=ys(n.fragments,t);if(!r||!i)return;ge.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=r.start-i.start;kx(s,n)}function ol(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(i=ys(r,o),s=ys(t,o)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=ys(t,i.cc)||t[Math.floor(t.length/2)]);const a=i.programDateTime,l=s.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(s.start-i.start);kx(u,n)}function st(n,e,t){dt(n,e,t),n.addEventListener(e,t)}function dt(n,e,t){n.removeEventListener(e,t)}const Pw={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},F={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class th extends Ex{constructor(e,t,r,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=F.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,f=ae.bufferInfo(u||l,d,o.maxBufferHole),p=!f.len;if(this.log(`Media seeking to ${X(d)?d.toFixed(3):d}, state: ${c}, ${p?"out of":"in"} buffer`),this.state===F.ENDED)this.resetLoadingState();else if(a){const h=o.maxFragLookUpTolerance,m=a.start-h,g=a.start+a.duration+h;if(p||g<f.start||m>f.end){const v=d>g;(d<m||v)&&(v&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const h=this.lastCurrentTime;if(d>h&&(this.lastCurrentTime=d),!this.loadingParts){const m=Math.max(f.end,d),g=this.shouldLoadParts(this.getLevelDetails(),m);g&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${m.toFixed(2)}`),this.loadingParts=g)}}this.hls.hasEnoughToStart||(this.log(`Setting ${p?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,p&&(this.startPosition=d)),p&&this.state===F.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new sw(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Qf(e.config)}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===F.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=F.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,i=this.config.timelineOffset||0;if(r<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=ae.bufferedInfo(s,e.start,0));const o=e.nextStart;if(o&&o>i&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return ae.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;st(r,"seeking",this.onMediaSeeking),st(r,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===F.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),dt(i,"seeking",this.onMediaSeeking),dt(i,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=F.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{const o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===F.FRAG_LOADING||!this.fragCurrent&&o===F.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=F.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(x.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===F.STOPPED||this.state===F.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Ue.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Ue.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(x.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{frag:s,payload:o}=r,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&li(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,Jf(a.method)).catch(u=>{throw i.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const c=self.performance.now();return i.trigger(x.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:c}}),r.payload=u,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===F.STOPPED||this.state===F.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==F.STOPPED&&(this.state=F.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,i;const s=e.tracks;if(s&&!t.encrypted&&((r=s.audio)!=null&&r.encrypted||(i=s.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(x.ERROR,{type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?Pw.toString(ae.getBuffered(r)):"(detached)"})`),Me(e)){var i;if(e.type!==Q.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=F.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=F.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Zf(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=F.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(x.KEY_LOADED,f),this.state===F.KEY_LOADING&&(this.state=F.IDLE),f}),this.hls.trigger(x.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Me(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(r=Math.max(e.start,r||0),this.loadingParts&&Me(e)){const f=o.partList;if(f&&i){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const p=this.getNextPart(f,e,r);if(p>-1){const h=f[p];e=this.fragCurrent=h.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${h.index} (${p}/${f.length-1}) of ${this.fragInfo(e,!1,h)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=F.FRAG_LOADING;let m;return a?m=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,h,t,i)).catch(g=>this.handleFragLoadError(g)):m=this.doFragPartsLoad(e,h,t,i).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:h,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(f,r))return Promise.resolve(null)}}if(Me(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),X(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=F.FRAG_LOADING;const c=this.config.progressive&&e.type!==Q.SUBTITLE;let d;return c&&a?d=a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,i)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,c?i:void 0),a]).then(([f])=>(!c&&i&&i(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,r,i){return new Promise((s,o)=>{var a;const l=[],u=(a=r.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(f=>{l[d.index]=f;const p=f.part;this.hls.trigger(x.FRAG_LOADED,f);const h=Bm(r.details,e.sn,d.index+1)||Px(u,e.sn,d.index+1);if(h)c(h);else return s({frag:e,part:p,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===P.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===te.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==F.PARSING){!this.fragCurrent&&this.state!==F.STOPPED&&this.state!==F.ERROR&&(this.state=F.IDLE);return}const{frag:r,part:i,level:s}=t,o=self.performance.now();r.stats.parsing.end=o,i&&(i.stats.parsing.end=o);const a=this.getLevelDetails(),u=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(r,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const s=e.partList[0];if(s.fragment.type===Q.SUBTITLE)return!1;const o=s.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:o}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const a=t[i],l=a.details,u=o>-1?Bm(l,s,o):null,c=u?u.fragment:wx(l,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:u,level:a}):null}bufferFragmentData(e,t,r,i,s){if(this.state!==F.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=bt(o,a)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:t,part:r,chunkMeta:i,offset:c,parent:t.type,data:l};if(this.hls.trigger(x.BUFFER_APPENDING,d),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ae.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=ae.bufferInfo(t,r,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,i.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var r;const i=this.getLoadPosition();if(!X(i))return null;const o=this.lastCurrentTime>i||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,o)}getFwdBufferInfoAtPos(e,t,r,i){const s=ae.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-t,i);return ae.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Q.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,o=r[0].start,a=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,p=this.hls.liveSyncPosition,h=l?(f!==-1&&f>=o?f:p)||l.start:e;this.log(`Setting startPosition to ${h} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${p} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=h}}else e<=o&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Ue.OK||r===Ue.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i,0);if(a!==null&&r.len+a.len>=s){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Vm(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Vm(this.config)&&e.type!==Q.SUBTITLE){const r=this.hls.interstitialsManager,i=r==null?void 0:r.bufferingItem;if(i){const o=i.event;if(o){if(o.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=r==null?void 0:r.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,i>-1&&r<u.start)break;const c=u.loaded;c?i=-1:(s||(u.independent||o)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${u.start}`),i=a),s=c}return i}loadedEndOfParts(e,t){let r;for(let i=e.length;i--;){if(r=e[i],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=z_(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];r.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=mx(e,r.cc,r.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=i,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var p;const m=e<this.lastCurrentTime||e>t-u||(p=this.media)!=null&&p.paused||!this.startFragRequested?0:u;f=Sr(s,o,e,m)}else f=o[o.length-1];if(f){const h=f.sn-r.startSN,m=this.fragmentTracker.getState(f);if((m===Ue.OK||m===Ue.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn||!r.live)&&f.level===s.level){const v=o[h+1];f.sn<a&&this.fragmentTracker.getState(v)!==Ue.OK?f=v:f=null}}return f}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,o=!t,a=e.alignedSliding&&X(s);if(o||!a&&!s){ww(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const i=this.timelineOffset;if(r===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&X(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+i}this.nextLoadPosition=r+i}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Me(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==F.FRAG_LOADING_WAITING_RETRY)&&(this.state=F.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const v=this.getCurrentContext(t.chunkMeta);v&&(t.frag=v.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const o=t.details===P.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(i,!0);const a=t.errorAction;if(!a){this.state=F.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=a,f=!!d,p=f&&l===We.RetryRequest,h=f&&!a.resolved&&u===gt.MoveAllAlternatesMatchingHost,m=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!p&&h&&Me(i)&&!i.endList&&m&&!yx(t))this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((p||h)&&c<d.maxNumRetry){var g;const v=rd((g=t.response)==null?void 0:g.code),y=Xf(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+y,this.state=F.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,v){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${y}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!o&&l!==We.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===We.SendAlternateToPenaltyBox?this.state=F.WAITING_LEVEL:this.state=F.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!rd(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=F.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===F.PARSING||this.state===F.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===Q.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==F.STOPPED&&(this.state=F.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=ae.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===F.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==F.STOPPED&&(this.state=F.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){const s=r.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=i?0:bx(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:s,level:r,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((r.fragmentError===0||l&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=F.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Q.MAIN?"level":"track"}fragInfo(e,t=!0,r){var i,s;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((i=t&&!r?e.startPTS:(r||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!r?e.endPTS:(r||e).end)!=null?s:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Vm(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class Mx{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=Dw(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function Dw(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}var Cu={exports:{}},Gm;function kw(){return Gm||(Gm=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new i(c,d||l,f),h=t?t+u:u;return l._events[h]?l._events[h].fn?l._events[h]=[l._events[h],p]:l._events[h].push(p):(l._events[h]=p,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,p=d.length,h=new Array(p);f<p;f++)h[f]=d[f].fn;return h},a.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,f,p,h){var m=t?t+u:u;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,y,E;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,f),!0;case 5:return g.fn.call(g.context,c,d,f,p),!0;case 6:return g.fn.call(g.context,c,d,f,p,h),!0}for(E=1,y=new Array(v-1);E<v;E++)y[E-1]=arguments[E];g.fn.apply(g.context,y)}else{var S=g.length,T;for(E=0;E<S;E++)switch(g[E].once&&this.removeListener(u,g[E].fn,void 0,!0),v){case 1:g[E].fn.call(g[E].context);break;case 2:g[E].fn.call(g[E].context,c);break;case 3:g[E].fn.call(g[E].context,c,d);break;case 4:g[E].fn.call(g[E].context,c,d,f);break;default:if(!y)for(T=1,y=new Array(v-1);T<v;T++)y[T-1]=arguments[T];g[E].fn.apply(g[E].context,y)}}return!0},a.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,f){var p=t?t+u:u;if(!this._events[p])return this;if(!c)return o(this,p),this;var h=this._events[p];if(h.fn)h.fn===c&&(!f||h.once)&&(!d||h.context===d)&&o(this,p);else{for(var m=0,g=[],v=h.length;m<v;m++)(h[m].fn!==c||f&&!h[m].once||d&&h[m].context!==d)&&g.push(h[m]);g.length?this._events[p]=g.length===1?g[0]:g:o(this,p)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(Cu)),Cu.exports}var Ow=kw(),nh=s_(Ow);const Ws="1.6.15",yi={};function Mw(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Fw(){const n=yi[Ws];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return yi[Ws]=i,i}function Nw(n){const e=yi[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return yi[n]=i,i}function Bw(n){const e=yi[n||Ws];if(e&&e.clientCount--===1){const{worker:r,objectURL:i}=e;delete yi[n||Ws],i&&self.URL.revokeObjectURL(i),r.terminate()}}function Fx(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function rh(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Fl(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function zs(n,e){const t=e;let r=0;for(;rh(n,e);)r+=10,r+=Fl(n,e+6),Fx(n,e+10)&&(r+=10),e+=r;if(r>0)return n.subarray(t,t+r)}function Uw(n,e,t,r){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){const p=new Error(`invalid ADTS sampling index:${o}`);n.emit(x.ERROR,x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}const a=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+a,c=i[o];let d=o;(a===5||a===29)&&(d-=3);const f=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return ge.log(`manifest codec:${r}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:r}}function Nx(n,e){return n[e]===255&&(n[e+1]&246)===240}function Bx(n,e){return n[e+1]&1?7:9}function ih(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function $w(n,e){return e+5<n.length}function al(n,e){return e+1<n.length&&Nx(n,e)}function Vw(n,e){return $w(n,e)&&Nx(n,e)&&ih(n,e)<=n.length-e}function Gw(n,e){if(al(n,e)){const t=Bx(n,e);if(e+t>=n.length)return!1;const r=ih(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||al(n,i)}return!1}function Ux(n,e,t,r,i){if(!n.samplerate){const s=Uw(e,t,r,i);if(!s)return;me(n,s)}}function $x(n){return 1024*9e4/n}function Kw(n,e){const t=Bx(n,e);if(e+t<=n.length){const r=ih(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Vx(n,e,t,r,i){const s=$x(n.samplerate),o=r+i*s,a=Kw(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,p=f+d,h=Math.max(0,t+p-e.length);h?(l=new Uint8Array(p-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+p);const m={unit:l,pts:o};return h||n.samples.push(m),{sample:m,length:p,missing:h}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function jw(n,e){return rh(n,e)&&Fl(n,e+6)+10<=n.length-e}function Hw(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function _u(n,e=0,t=1/0){return Ww(n,e,t,Uint8Array)}function Ww(n,e,t,r){const i=zw(n);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const o=Yw(n)?n.byteOffset:0,a=(o+n.byteLength)/s,l=(o+e)/s,u=Math.floor(Math.max(0,Math.min(l,a))),c=Math.floor(Math.min(u+Math.max(t,0),a));return new r(i,u,c-u)}function zw(n){return n instanceof ArrayBuffer?n:n.buffer}function Yw(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function qw(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const i=Et(_u(n.data,1,r)),s=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const a=Et(_u(n.data,3+r,o));let l;return i==="-->"?l=Et(_u(n.data,4+r+o)):l=Hw(n.data.subarray(4+r+o)),e.mimeType=i,e.pictureType=s,e.description=a,e.data=l,e}function Xw(n){if(n.size<2)return;const e=Et(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function Qw(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Et(n.data.subarray(t),!0);t+=r.length+1;const i=Et(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=Et(n.data.subarray(1));return{key:n.type,info:"",data:e}}function Zw(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Et(n.data.subarray(t),!0);t+=r.length+1;const i=Et(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=Et(n.data);return{key:n.type,info:"",data:e}}function Jw(n){return n.type==="PRIV"?Xw(n):n.type[0]==="W"?Zw(n):n.type==="APIC"?qw(n):Qw(n)}function eP(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Fl(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Mo=10,tP=10;function Gx(n){let e=0;const t=[];for(;rh(n,e);){const r=Fl(n,e+6);n[e+5]>>6&1&&(e+=Mo),e+=Mo;const i=e+r;for(;e+tP<i;){const s=eP(n.subarray(e)),o=Jw(s);o&&t.push(o),e+=s.size+Mo}Fx(n,e)&&(e+=Mo)}return t}function Kx(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function nP(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function sh(n){const e=Gx(n);for(let t=0;t<e.length;t++){const r=e[t];if(Kx(r))return nP(r)}}let vt=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Wt(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class oh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=bt(this.cachedData,e),this.cachedData=null);let r=zs(e,0),i=r?r.length:0,s;const o=this._audioTrack,a=this._id3Track,l=r?sh(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&X(l))&&(this.basePTS=rP(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:vt.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const c=this.appendFrame(o,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=u}else jw(e,i)?(r=zs(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:vt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===u&&s!==u){const c=e.slice(s);this.cachedData?this.cachedData=bt(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:Wt(),id3Track:a,textTrack:Wt()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Wt(),id3Track:this._id3Track,textTrack:Wt()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const rP=(n,e,t)=>{if(X(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Fo=null;const iP=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],sP=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],oP=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],aP=[0,1,1,4];function jx(n,e,t,r,i){if(t+24>e.length)return;const s=Hx(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=r+i*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function Hx(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=iP[l*14+i-1]*1e3,d=sP[(t===3?0:t===2?1:2)*3+s],f=a===3?1:2,p=oP[t][r],h=aP[r],m=p*8*h,g=Math.floor(p*u/d+o)*h;if(Fo===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Fo=E?parseInt(E[1]):0}return!!Fo&&Fo<=87&&r===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:g,samplesPerFrame:m}}}function ah(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Wx(n,e){return e+1<n.length&&ah(n,e)}function lP(n,e){return ah(n,e)&&4<=n.length-e}function zx(n,e){if(e+1<n.length&&ah(n,e)){const r=Hx(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||Wx(n,s)}return!1}class uP extends oh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=zs(e,0);let i=(r==null?void 0:r.length)||0;if(zx(e,i))return!1;for(let s=e.length;i<s;i++)if(Gw(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Vw(e,t)}appendFrame(e,t,r){Ux(e,this.observer,t,r,e.manifestCodec);const i=Vx(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const Yx=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;s[0]=4278190080>>>24+l<<l,i[0]=(o[0]&s[0])>>l,t=t?t<<a|i[0]:i[0],e+=1,r-=a}return t};class cP extends oh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=qx(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=zs(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&sh(t)!==void 0&&Yx(e,r)<16}}function qx(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const p=(e[t+6]<<8|e[t+7])>>12-f&1,m=[2,1,2,3,3,4,4,5][d]+p,g=e[t+5]>>3,v=e[t+5]&7,y=new Uint8Array([s<<6|g<<1|v>>2,(v&3)<<6|d<<3|p<<2|l>>4,l<<4&224]),E=1536/a*9e4,S=r+i*E,T=e.subarray(t,t+c);return n.config=y,n.channelCount=m,n.samplerate=a,n.samples.push({unit:T,pts:S}),c}class dP extends oh{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=zs(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&sh(t)!==void 0&&Yx(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(zx(e,r))return ge.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return lP(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return jx(e,t,r,this.basePTS,this.frameIndex)}}const fP=/\/emsg[-/]ID3/i;class hP{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=Wt("video",1),o=this.audioTrack=Wt("audio",1),a=this.txtTrack=Wt("text",1);if(this.id3Track=Wt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=sx(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:f}=l.video;s.id=u,s.timescale=a.timescale=c,s.codec=d,s.supplemental=f}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=nx.text,s.sampleDuration=0,s.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return c_(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=bt(this.remainderData,e));const a=v_(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;const o=this.extractID3Track(i,t);return s.samples=om(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=om(e,t),{videoTrack:t,audioTrack:Wt(),id3Track:i,textTrack:Wt()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=ue(e.samples,["emsg"]);i&&i.forEach(s=>{const o=E_(s);if(fP.test(o.schemeIdUri)){const a=Km(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:vt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=Km(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:vt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Km(n,e){return X(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class pP{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Qf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Jn.cbc)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const o=lx(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)}).catch(i)}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const o=s[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,i,o),!this.decrypter.isSync()))return}}}}class Xx{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const i=t.byteLength;let s=e.naluState||0;const o=s,a=[];let l=0,u,c,d,f=-1,p=0;for(s===-1&&(f=0,p=this.getNALuType(t,0),s=0,l=1);l<i;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(c=l-s-1,f>=0){const h={data:t.subarray(f,c),type:p};a.push(h)}else{const h=this.getLastNalUnit(e.samples);h&&(o&&l<=4-o&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-o)),c>0&&(h.data=bt(h.data,t.subarray(0,c)),h.state=0))}l<i?(d=this.getNALuType(t,l),f=l,p=d,s=0):s=-1}else s=0}if(f>=0&&s>=0){const h={data:t.subarray(f,i),type:p,state:s};a.push(h)}if(a.length===0){const h=this.getLastNalUnit(e.samples);h&&(h.data=bt(h.data,t))}return e.naluState=s,a}}class Es{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&ge.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class gP extends Xx{parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let o=this.VideoSample,a,l=!1;r.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(u=>{var c,d;switch(u.type){case 1:{let m=!1;a=!0;const g=u.data;if(l&&g.length>4){const v=this.readSliceType(g);(v===2||v===4||v===7||v===9)&&(m=!0)}if(m){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=m;break}case 5:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,zf(u.data,1,r.pts,t.samples);break}case 7:{var p,h;a=!0,l=!0;const m=u.data,g=this.readSPS(m);if(!e.sps||e.width!==g.width||e.height!==g.height||((p=e.pixelRatio)==null?void 0:p[0])!==g.pixelRatio[0]||((h=e.pixelRatio)==null?void 0:h[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[m];const v=m.subarray(1,4);let y="avc1.";for(let E=0;E<3;E++){let S=v[E].toString(16);S.length<2&&(S="0"+S),y+=S}e.codec=y}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Es(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,i=8,s;for(let o=0;o<e;o++)i!==0&&(s=t.readEG(),i=(r+s+256)%256),r=i===0?r:i}readSPS(e){const t=new Es(e);let r=0,i=0,s=0,o=0,a,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),p=t.readBoolean.bind(t),h=t.skipBits.bind(t),m=t.skipEG.bind(t),g=t.skipUEG.bind(t),v=this.skipScalingList.bind(this);c();const y=c();if(d(5),h(3),c(),g(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const R=f();if(R===3&&h(1),g(),g(),h(1),p())for(l=R!==3?8:12,u=0;u<l;u++)p()&&(u<6?v(16,t):v(64,t))}g();const E=f();if(E===0)f();else if(E===1)for(h(1),m(),m(),a=f(),u=0;u<a;u++)m();g(),h(1);const S=f(),T=f(),L=d(1);L===0&&h(1),h(1),p()&&(r=f(),i=f(),s=f(),o=f());let A=[1,1];if(p()&&p())switch(c()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((S+1)*16-r*2-i*2),height:(2-L)*(T+1)*16-(L?2:4)*(s+o),pixelRatio:A}}}class mP extends Xx{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let o=this.VideoSample,a,l=!1;r.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,zf(u.data,2,r.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=me(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const p=this.readSPS(u.data);e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.codec=p.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const h in p.params)e.params[h]=p.params[h]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const p=this.readPPS(u.data);for(const h in p)e.params[h]=p[h]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[r]=e[i],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Es(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:i}}readSPS(e){const t=new Es(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),p=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),v=t.readUByte(),y=[],E=[];for(let le=0;le<r;le++)y.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let le=r;le<8;le++)t.readBits(2);for(let le=0;le<r;le++)y[le]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[le]&&t.readUByte();t.readUEG();const S=t.readUEG();S==3&&t.skipBits(1);const T=t.readUEG(),L=t.readUEG(),A=t.readBoolean();let R=0,I=0,b=0,O=0;A&&(R+=t.readUEG(),I+=t.readUEG(),b+=t.readUEG(),O+=t.readUEG());const B=t.readUEG(),K=t.readUEG(),q=t.readUEG(),j=t.readBoolean();for(let le=j?0:r;le<=r;le++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Oe=0;Oe<4;Oe++)for(let Ze=0;Ze<(Oe===3?2:6);Ze++)if(!t.readBoolean())t.readUEG();else{const Dt=Math.min(64,1<<4+(Oe<<1));Oe>1&&t.readEG();for(let _r=0;_r<Dt;_r++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const $=t.readUEG();let z=0;for(let le=0;le<$;le++){let Oe=!1;if(le!==0&&(Oe=t.readBoolean()),Oe){le===$&&t.readUEG(),t.readBoolean(),t.readUEG();let Ze=0;for(let on=0;on<=z;on++){const Dt=t.readBoolean();let _r=!1;Dt||(_r=t.readBoolean()),(Dt||_r)&&Ze++}z=Ze}else{const Ze=t.readUEG(),on=t.readUEG();z=Ze+on;for(let Dt=0;Dt<Ze;Dt++)t.readUEG(),t.readBoolean();for(let Dt=0;Dt<on;Dt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const le=t.readUEG();for(let Oe=0;Oe<le;Oe++){for(let Ze=0;Ze<q+4;Ze++)t.readBits(1);t.readBits(1)}}let w=0,k=1,U=1,N=!0,V=1,ee=0;t.readBoolean(),t.readBoolean();let fe=!1;if(t.readBoolean()){if(t.readBoolean()){const rr=t.readUByte(),gh=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],fo=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];rr>0&&rr<16?(k=gh[rr-1],U=fo[rr-1]):rr===255&&(k=t.readBits(16),U=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),fe=t.readBoolean(),fe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(V=t.readBits(32),ee=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const fo=t.readBoolean(),mh=t.readBoolean();let Ci=!1;(fo||mh)&&(Ci=t.readBoolean(),Ci&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ci&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let vh=0;vh<=r;vh++){N=t.readBoolean();const _S=N||t.readBoolean();let yh=!1;_S?t.readEG():yh=t.readBoolean();const Eh=yh?1:t.readUEG()+1;if(fo)for(let _i=0;_i<Eh;_i++)t.readUEG(),t.readUEG(),Ci&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(mh)for(let _i=0;_i<Eh;_i++)t.readUEG(),t.readUEG(),Ci&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),w=t.readUEG())}let Ee=T,St=L;if(A){let le=1,Oe=1;S===1?le=Oe=2:S==2&&(le=2),Ee=T-le*I-le*R,St=L-Oe*O-Oe*b}const ne=i?["A","B","C"][i]:"",re=a<<24|l<<16|u<<8|c;let Ie=0;for(let le=0;le<32;le++)Ie=(Ie|(re>>le&1)<<31-le)>>>0;let Ve=Ie.toString(16);return o===1&&Ve==="2"&&(Ve="6"),{codecString:`hvc1.${ne}${o}.${Ve}.${s?"H":"L"}${v}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:i,general_profile_compatibility_flags:[a,l,u,c],general_constraint_indicator_flags:[d,f,p,h,m,g],general_level_idc:v,bit_depth:B+8,bit_depth_luma_minus8:B,bit_depth_chroma_minus8:K,min_spatial_segmentation_idc:w,chroma_format_idc:S,frame_rate:{fixed:N,fps:ee/V}},width:Ee,height:St,pixelRatio:[k,U]}}readPPS(e){const t=new Es(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let o=1;return s&&i?o=0:s?o=3:i&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ke=188;class _n{constructor(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}static probe(e,t){const r=_n.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Ke*5,t-Ke)+1,i=0;for(;i<r;){let s=!1,o=-1,a=0;for(let l=i;l<t;l+=Ke)if(e[l]===71&&(t-l===Ke||e[l+Ke]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+Ke*99,e.length-Ke)+1)),s||(s=ld(e,l)===0),s&&a>1&&(o===0&&a>2||l+Ke>r))return o}else{if(a)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:nx[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=_n.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=_n.createTrack("audio",i),this._id3Track=_n.createTrack("id3"),this._txtTrack=_n.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,p=l.pid,h=a.pesData,m=l.pesData,g=null,v=this.pmtParsed,y=this._pmtId,E=e.length;if(this.remainderData&&(e=bt(this.remainderData,e),E=e.length,this.remainderData=null),E<Ke&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const S=Math.max(0,_n.syncOffset(e));E-=(E-S)%Ke,E<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let T=0;for(let A=S;A<E;A+=Ke)if(e[A]===71){const R=!!(e[A+1]&64),I=ld(e,A),b=(e[A+3]&48)>>4;let O;if(b>1){if(O=A+5+e[A+4],O===A+Ke)continue}else O=A+4;switch(I){case c:R&&(d&&(s=Or(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(O,A+Ke)),d.size+=A+Ke-O);break;case f:if(R){if(h&&(s=Or(h,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}h={data:[],size:0}}h&&(h.data.push(e.subarray(O,A+Ke)),h.size+=A+Ke-O);break;case p:R&&(m&&(s=Or(m,this.logger))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(O,A+Ke)),m.size+=A+Ke-O);break;case 0:R&&(O+=e[O]+1),y=this._pmtId=vP(e,O);break;case y:{R&&(O+=e[O]+1);const B=yP(e,O,this.typeSupported,r,this.observer,this.logger);c=B.videoPid,c>0&&(o.pid=c,o.segmentCodec=B.segmentVideoCodec),f=B.audioPid,f>0&&(a.pid=f,a.segmentCodec=B.segmentAudioCodec),p=B.id3Pid,p>0&&(l.pid=p),g!==null&&!v&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${g}'. Backtracking to sync byte @${S} to parse all TS packets.`),g=null,A=S-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=I;break}}else T++;T>0&&ud(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=h,l.pesData=m;const L={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return i&&this.extractRemainingSamples(L),L}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,o=r.pesData,a=t.pesData,l=i.pesData;let u;if(o&&(u=Or(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,s,u,!0),r.pesData=null)):r.pesData=o,a&&(u=Or(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=Or(l,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new pP(this.observer,this.config,t);return this.decrypt(i,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new gP:e==="hevc"&&(this.videoParser=new mP))}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,f=i.sample.unit.byteLength;if(d===-1)s=bt(i.sample.unit,s);else{const p=f-d;i.sample.unit.set(s.subarray(0,d),p),e.samples.push(i.sample),r=i.missing}}let o,a;for(o=r,a=s.length;o<a-1&&!al(s,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",ud(this.observer,new Error(d),f,this.logger),!f)return}Ux(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const d=$x(e.samplerate);l=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=Vx(e,s,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!al(s,o);o++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<i;)if(Wx(r,o)){const l=jx(e,r,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let o=0,a=0,l;for(;a<s&&(l=qx(e,r,a,i,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=me({},t,{type:this._videoTrack?vt.emsg:vt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function ld(n,e){return((n[e+1]&31)<<8)+n[e+2]}function vP(n,e){return(n[e+10]&31)<<8|n[e+11]}function yP(n,e,t,r,i,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=ld(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){wu("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=c);break;case 21:o.id3Pid===-1&&(o.id3Pid=c);break;case 219:if(!r){wu("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="mp3");break;case 193:if(!r){wu("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let f=e+5,p=d;for(;p>2;){switch(n[f]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=c,o.segmentAudioCodec="ac3");break}const m=n[f+1]+2;f+=m,p-=m}}break;case 194:case 135:return ud(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=c,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return o}function ud(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(x.ERROR,x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function wu(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Or(n,e){let t=0,r,i,s,o,a;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=bt(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(i=(r[4]<<8)+r[5],i&&i>n.size-6)return null;const c=r[7];c&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(a=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=r[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let p=0,h=l.length;p<h;p++){r=l[p];let m=r.byteLength;if(d)if(d>m){d-=m;continue}else r=r.subarray(d),m-=d,d=0;f.set(r,t),t+=m}return i&&(i-=s+3),{data:f,pts:o,dts:a,len:i}}return null}class EP{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Tn=Math.pow(2,32)-1;class _{static init(){_.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in _.types)_.types.hasOwnProperty(e)&&(_.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);_.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);_.STTS=_.STSC=_.STCO=s,_.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),_.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),_.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),_.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);_.FTYP=_.box(_.types.ftyp,o,l,o,a),_.DINF=_.box(_.types.dinf,_.box(_.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),i=0,r=8;i<s;i++)o.set(t[i],r),r+=t[i].byteLength;return o}static hdlr(e){return _.box(_.types.hdlr,_.HDLR_TYPES[e])}static mdat(e){return _.box(_.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Tn+1)),i=Math.floor(t%(Tn+1));return _.box(_.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return _.box(_.types.mdia,_.mdhd(e.timescale||0,e.duration||0),_.hdlr(e.type),_.minf(e))}static mfhd(e){return _.box(_.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?_.box(_.types.minf,_.box(_.types.smhd,_.SMHD),_.DINF,_.stbl(e)):_.box(_.types.minf,_.box(_.types.vmhd,_.VMHD),_.DINF,_.stbl(e))}static moof(e,t,r){return _.box(_.types.moof,_.mfhd(e),_.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=_.trak(e[t]);return _.box.apply(null,[_.types.moov,_.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(_.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=_.trex(e[t]);return _.box.apply(null,[_.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Tn+1)),i=Math.floor(t%(Tn+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return _.box(_.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return _.box(_.types.sdtp,r)}static stbl(e){return _.box(_.types.stbl,_.stsd(e),_.box(_.types.stts,_.STTS),_.box(_.types.stsc,_.STSC),_.box(_.types.stsz,_.STSZ),_.box(_.types.stco,_.STCO))}static avc1(e){let t=[],r=[],i,s,o;for(i=0;i<e.sps.length;i++)s=e.sps[i],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],o=s.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(s));const a=_.box(_.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return _.box(_.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,_.box(_.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_.box(_.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return _.box(_.types.mp4a,_.audioStsd(e),_.box(_.types.esds,_.esds(e)))}static mp3(e){return _.box(_.types[".mp3"],_.audioStsd(e))}static ac3(e){return _.box(_.types["ac-3"],_.audioStsd(e),_.box(_.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return _.box(_.types.stsd,_.STSD,_.mp4a(e));if(t==="ac3"&&e.config)return _.box(_.types.stsd,_.STSD,_.ac3(e));if(t==="mp3"&&e.codec==="mp3")return _.box(_.types.stsd,_.STSD,_.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return _.box(_.types.stsd,_.STSD,_.avc1(e));if(t==="hevc"&&e.vps)return _.box(_.types.stsd,_.STSD,_.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,o=Math.floor(r/(Tn+1)),a=Math.floor(r%(Tn+1));return _.box(_.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=_.sdtp(e),i=e.id,s=Math.floor(t/(Tn+1)),o=Math.floor(t%(Tn+1));return _.box(_.types.traf,_.box(_.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),_.box(_.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),_.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,_.box(_.types.trak,_.tkhd(e),_.mdia(e))}static trex(e){const t=e.id;return _.box(_.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,o=new Uint8Array(s);let a,l,u,c,d,f;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<i;a++)l=r[a],u=l.duration,c=l.size,d=l.flags,f=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return _.box(_.types.trun,o)}static initSegment(e){_.types||_.init();const t=_.moov(e);return bt(_.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=s.length;for(let h=0;h<r.length;h+=1){o+=3;for(let m=0;m<r[h].length;m+=1)o+=2+r[h][m].length}const a=new Uint8Array(o);a.set(s,0),o=s.length;const l=r.length-1;for(let h=0;h<r.length;h+=1){a.set(new Uint8Array([32+h|(h===l?128:0),0,r[h].length]),o),o+=3;for(let m=0;m<r[h].length;m+=1)a.set(new Uint8Array([r[h][m].length>>8,r[h][m].length&255]),o),o+=2,a.set(r[h][m],o),o+=r[h][m].length}const u=_.box(_.types.hvcC,a),c=e.width,d=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return _.box(_.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,_.box(_.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_.box(_.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}}_.types=void 0;_.HDLR_TYPES=void 0;_.STTS=void 0;_.STSC=void 0;_.STCO=void 0;_.STSZ=void 0;_.VMHD=void 0;_.SMHD=void 0;_.STSD=void 0;_.FTYP=void 0;_.DINF=void 0;const Qx=9e4;function lh(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function xP(n,e,t=1,r=!1){return lh(n,e,1/t,r)}function ji(n,e=!1){return lh(n,1e3,1/Qx,e)}function SP(n,e=1){return lh(n,Qx,1/e)}function jm(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const TP=10*1e3,AP=1024,LP=1152,IP=1536;let Mr=null,Pu=null;function Hm(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class ca extends wt{constructor(e,t,r,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Mr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Mr=o?parseInt(o[1]):0}if(Pu===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Pu=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&jm(t)} > ${e&&jm(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=mt(a,r),l=a-s),l>0?s:a},r);return t&&this.debug("PTS rollover detected"),i}remux(e,t,r,i,s,o,a,l){let u,c,d,f,p,h,m=s,g=s;const v=e.pid>-1,y=t.pid>-1,E=t.samples.length,S=e.samples.length>0,T=a&&E>0||E>1;if((!v||S)&&(!y||T)||this.ISGenerated||a){if(this.ISGenerated){var A,R,I,b;const q=this.videoTrackConfig;(q&&(t.width!==q.width||t.height!==q.height||((A=t.pixelRatio)==null?void 0:A[0])!==((R=q.pixelRatio)==null?void 0:R[0])||((I=t.pixelRatio)==null?void 0:I[1])!==((b=q.pixelRatio)==null?void 0:b[1]))||!q&&T||this.nextAudioTs===null&&S)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,o));const O=this.isVideoContiguous;let B=-1,K;if(T&&(B=RP(t.samples),!O&&this.config.forceKeyFrameOnDiscontinuity))if(h=!0,B>0){this.warn(`Dropped ${B} out of ${E} video samples due to a missing keyframe`);const q=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(B),t.dropped+=B,g+=(t.samples[0].pts-q)/t.inputTimeScale,K=g}else B===-1&&(this.warn(`No keyframe found out of ${E} video samples`),h=!1);if(this.ISGenerated){if(S&&T){const q=this.getVideoStartPts(t.samples),G=(mt(e.samples[0].pts,q)-q)/t.inputTimeScale;m+=Math.max(0,G),g+=Math.max(0,-G)}if(S){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,o)),c=this.remuxAudio(e,m,this.isAudioContiguous,o,y||T||l===Q.AUDIO?g:void 0),T){const q=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,o)),u=this.remuxVideo(t,g,O,q)}}else T&&(u=this.remuxVideo(t,g,O,0));u&&(u.firstKeyFrame=B,u.independent=B!==-1,u.firstKeyFramePTS=K)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(p=Zx(r,s,this._initPTS,this._initDTS)),i.samples.length&&(f=Jx(i,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:h,text:f,id3:p}}computeInitPts(e,t,r,i){const s=Math.round(r*t);let o=mt(e,s);if(o<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/t} ${i}`);o<s+t;)o+=8589934592;return o-s}generateIS(e,t,r,i){const s=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||i,d="audio/mp4",f,p,h,m=-1;if(c&&(f=p=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):_.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.id,h=e.inputTimeScale,!u||h!==u.timescale?f=p=this.computeInitPts(s[0].pts,h,r,"audio"):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:_.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(m=t.id,h=t.inputTimeScale,!u||h!==u.timescale){const g=this.getVideoStartPts(o),v=mt(o[0].dts,g),y=this.computeInitPts(v,h,r,"video"),E=this.computeInitPts(g,h,r,"video");p=Math.min(p,y),f=Math.min(f,E)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${r} ${f/h} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${f/h} (${f}/${h}) trackId: ${m}`),this._initPTS={baseTime:f,timescale:h,trackId:m},this._initDTS={baseTime:p,timescale:h,trackId:m}):f=h=void 0,{tracks:l,initPTS:f,timescale:h,trackId:m}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS,c=u.baseTime*s/u.timescale;let d=this.nextVideoTs,f=8,p=this.videoSampleDuration,h,m,g=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,y=!1;if(!r||d===null){const w=c+t*s,k=o[0].pts-mt(o[0].dts,o[0].pts);Mr&&d!==null&&Math.abs(w-k-(d+c))<15e3?r=!0:d=w-k-c}const E=d+c;for(let w=0;w<l;w++){const k=o[w];k.pts=mt(k.pts,E),k.dts=mt(k.dts,E),k.dts<o[w>0?w-1:w].dts&&(y=!0)}y&&o.sort(function(w,k){const U=w.dts-k.dts,N=w.pts-k.pts;return U||N}),h=o[0].dts,m=o[o.length-1].dts;const S=m-h,T=S?Math.round(S/(l-1)):p||e.inputTimeScale/30;if(r){const w=h-E,k=w>T,U=w<-1;if((k||U)&&(k?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ji(w,!0)} ms (${w}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ji(-w,!0)} ms (${w}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!U||E>=o[0].pts||Mr)){h=E;const N=o[0].pts-w;if(k)o[0].dts=h,o[0].pts=N;else{let V=!0;for(let ee=0;ee<o.length&&!(o[ee].dts>N&&V);ee++){const fe=o[ee].pts;if(o[ee].dts-=w,o[ee].pts-=w,ee<o.length-1){const he=o[ee+1].pts,Ee=o[ee].pts,St=he<=Ee,ne=he<=fe;V=St==ne}}}this.log(`Video: Initial PTS/DTS adjusted: ${ji(N,!0)}/${ji(h,!0)}, delta: ${ji(w,!0)} ms`)}}h=Math.max(0,h);let L=0,A=0,R=h;for(let w=0;w<l;w++){const k=o[w],U=k.units,N=U.length;let V=0;for(let ee=0;ee<N;ee++)V+=U[ee].data.length;A+=V,L+=N,k.length=V,k.dts<R?(k.dts=R,R+=T/4|0||1):R=k.dts,g=Math.min(k.pts,g),v=Math.max(k.pts,v)}m=o[l-1].dts;const I=A+4*L+8;let b;try{b=new Uint8Array(I)}catch(w){this.observer.emit(x.ERROR,x.ERROR,{type:te.MUX_ERROR,details:P.REMUX_ALLOC_ERROR,fatal:!1,error:w,bytes:I,reason:`fail allocating video mdat ${I}`});return}const O=new DataView(b.buffer);O.setUint32(0,I),b.set(_.types.mdat,4);let B=!1,K=Number.POSITIVE_INFINITY,q=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,G=Number.NEGATIVE_INFINITY;for(let w=0;w<l;w++){const k=o[w],U=k.units;let N=0;for(let fe=0,he=U.length;fe<he;fe++){const Ee=U[fe],St=Ee.data,ne=Ee.data.byteLength;O.setUint32(f,ne),f+=4,b.set(St,f),f+=ne,N+=4+ne}let V;if(w<l-1)p=o[w+1].dts-k.dts,V=o[w+1].pts-k.pts;else{const fe=this.config,he=w>0?k.dts-o[w-1].dts:T;if(V=w>0?k.pts-o[w-1].pts:T,fe.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ee=Math.floor(fe.maxBufferHole*s),St=(i?g+i*s:this.nextAudioTs+c)-k.pts;St>Ee?(p=St-he,p<0?p=he:B=!0,this.log(`It is approximately ${St/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=he}else p=he}const ee=Math.round(k.pts-k.dts);K=Math.min(K,p),j=Math.max(j,p),q=Math.min(q,V),G=Math.max(G,V),a.push(Hm(k.key,p,N,ee))}if(a.length){if(Mr){if(Mr<70){const w=a[0].flags;w.dependsOn=2,w.isNonSync=0}}else if(Pu&&G-q<j-K&&T/j<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let w=h;for(let k=0,U=a.length;k<U;k++){const N=w+a[k].duration,V=w+a[k].cts;if(k<U-1){const ee=N+a[k+1].cts;a[k].duration=ee-V}else a[k].duration=k?a[k-1].duration:T;a[k].cts=0,w=N}}}p=B||!p?T:p;const M=m+p;this.nextVideoTs=d=M-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const $=_.moof(e.sequenceNumber++,h,me(e,{samples:a})),z="video",J={data1:$,data2:b,startPTS:(g-c)/s,endPTS:(v+p-c)/s,startDTS:(h-c)/s,endDTS:d/s,type:z,hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,J}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return LP;case"ac3":return IP;default:return AP}}remuxAudio(e,t,r,i,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,p=[],h=s!==void 0;let m=e.samples,g=f?0:8,v=this.nextAudioTs||-1;const y=d.baseTime*o/d.timescale,E=y+t*o;if(this.isAudioContiguous=r=r||m.length&&v>0&&(i&&Math.abs(E-(v+y))<9e3||Math.abs(mt(m[0].pts,E)-(v+y))<20*c),m.forEach(function(G){G.pts=mt(G.pts,E)}),!r||v<0){const G=m.length;if(m=m.filter(M=>M.pts>=0),G!==m.length&&this.warn(`Removed ${m.length-G} of ${G} samples (initPTS ${y} / ${o})`),!m.length)return;s===0?v=0:i&&!h?v=Math.max(0,E-y):v=m[0].pts-y}if(e.segmentCodec==="aac"){const G=this.config.maxAudioFramesDrift;for(let M=0,$=v+y;M<m.length;M++){const z=m[M],J=z.pts,w=J-$,k=Math.abs(1e3*w/o);if(w<=-G*c&&h)M===0&&(this.warn(`Audio frame @ ${(J/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*w/o)} ms.`),this.nextAudioTs=v=J-y,$=J);else if(w>=G*c&&k<TP&&h){let U=Math.round(w/c);for($=J-U*c;$<0&&U&&c;)U--,$+=c;M===0&&(this.nextAudioTs=v=$-y),this.warn(`Injecting ${U} audio frames @ ${(($-y)/o).toFixed(3)}s due to ${Math.round(1e3*w/o)} ms gap.`);for(let N=0;N<U;N++){let V=EP.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);V||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),V=z.unit.subarray()),m.splice(M,0,{unit:V,pts:$}),$+=c,M++}}z.pts=$,$+=c}}let S=null,T=null,L,A=0,R=m.length;for(;R--;)A+=m[R].unit.byteLength;for(let G=0,M=m.length;G<M;G++){const $=m[G],z=$.unit;let J=$.pts;if(T!==null){const k=p[G-1];k.duration=Math.round((J-T)/l)}else if(r&&e.segmentCodec==="aac"&&(J=v+y),S=J,A>0){A+=g;try{L=new Uint8Array(A)}catch(k){this.observer.emit(x.ERROR,x.ERROR,{type:te.MUX_ERROR,details:P.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:A,reason:`fail allocating audio mdat ${A}`});return}f||(new DataView(L.buffer).setUint32(0,A),L.set(_.types.mdat,4))}else return;L.set(z,g);const w=z.byteLength;g+=w,p.push(Hm(!0,u,w,0)),T=J}const I=p.length;if(!I)return;const b=p[p.length-1];v=T-y,this.nextAudioTs=v+l*b.duration;const O=f?new Uint8Array(0):_.moof(e.sequenceNumber++,S/l,me({},e,{samples:p}));e.samples=[];const B=(S-y)/o,K=this.nextAudioTs/o,j={data1:O,data2:L,startPTS:B,endPTS:K,startDTS:B,endDTS:K,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,j}}function mt(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function RP(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Zx(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let a=0;a<i;a++){const l=n.samples[a];l.pts=mt(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=mt(l.dts-r.baseTime*s/r.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function Jx(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=mt(a.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}class bP extends wt{constructor(e,t,r,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:o}=this.initData=sx(e);if(t)p_(e,t);else{const l=s||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(r=Wm(s,ve.AUDIO,this)),o&&(i=Wm(o,ve.VIDEO,this));const a={};s&&o?a.audiovideo={container:"video/mp4",codec:r+","+i,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:r,encrypted:s.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:i,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,r,i,s,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};X(c)||(c=this.lastEndTime=s||0);const f=t.samples;if(!f.length)return d;const p={initPTS:void 0,timescale:void 0,trackId:void 0};let h=this.initData;if((a=h)!=null&&a.length||(this.generateInitSegment(f),h=this.initData),!((l=h)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);const m=m_(f,h,this),g=h.audio?m[h.audio.id]:null,v=h.video?m[h.video.id]:null,y=No(v,1/0),E=No(g,1/0),S=No(v,0,!0),T=No(g,0,!0);let L=s,A=0;const R=g&&(!v||!u&&E<y||u&&u.trackId===h.audio.id),I=R?g:v;if(I){const $=I.timescale,z=I.start-s*$,J=R?h.audio.id:h.video.id;L=I.start/$,A=R?T-E:S-y,(o||!u)&&(CP(u,L,s,A)||$!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${z/$} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${L-s} (${z}/${$}) trackId: ${J}`),u=null,p.initPTS=z,p.timescale=$,p.trackId=J)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);u?(p.initPTS=u.baseTime,p.timescale=u.timescale,p.trackId=u.trackId):((!p.timescale||p.trackId===void 0||p.initPTS===void 0)&&(this.warn("Could not set initPTS"),p.initPTS=L,p.timescale=1,p.trackId=-1),this.initPTS=u={baseTime:p.initPTS,timescale:p.timescale,trackId:p.trackId});const b=L-u.baseTime/u.timescale,O=b+A;A>0?this.lastEndTime=O:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const B=!!h.audio,K=!!h.video;let q="";B&&(q+="audio"),K&&(q+="video");const j=(h.audio?h.audio.encrypted:!1)||(h.video?h.video.encrypted:!1),G={data1:f,startPTS:b,startDTS:b,endPTS:O,endDTS:O,type:q,hasAudio:B,hasVideo:K,nb:1,dropped:0,encrypted:j};d.audio=B&&!K?G:void 0,d.video=K?G:void 0;const M=v==null?void 0:v.sampleCount;if(M){const $=v.keyFrameIndex,z=$!==-1;G.nb=M,G.dropped=$===0||this.isVideoContiguous?0:z?$:M,G.independent=z,G.firstKeyFrame=$,z&&v.keyFrameStart&&(G.firstKeyFramePTS=(v.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=z),this.isVideoContiguous||(this.isVideoContiguous=z),G.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${$}/${M} dropped: ${G.dropped} start: ${G.firstKeyFramePTS||"NA"}`)}return d.initSegment=p,d.id3=Zx(r,s,u,u),i.samples.length&&(d.text=Jx(i,s,u)),d}}function No(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function CP(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function Wm(n,e,t){const r=n.codec;return r&&r.length>4?r:e===ve.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?Ja(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let dn;try{dn=self.performance.now.bind(self.performance)}catch{dn=Date.now}const da=[{demux:hP,remux:bP},{demux:_n,remux:ca},{demux:uP,remux:ca},{demux:dP,remux:ca}];da.splice(2,0,{demux:cP,remux:ca});class zm{constructor(e,t,r,i,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=dn();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:p,initSegmentChange:h}=i||a,{audioCodec:m,videoCodec:g,defaultInitPts:v,duration:y,initSegmentData:E}=l,S=_P(o,t);if(S&&li(S.method)){const R=this.getDecrypter(),I=Jf(S.method);if(R.isSync()){let b=R.softwareDecrypt(o,S.key.buffer,S.iv.buffer,I);if(r.part>-1){const B=R.flush();b=B&&B.buffer}if(!b)return s.executeEnd=dn(),Du(r);o=new Uint8Array(b)}else return this.asyncResult=!0,this.decryptionPromise=R.webCryptoDecrypt(o,S.key.buffer,S.iv.buffer,I).then(b=>{const O=this.push(b,null,r);return this.decryptionPromise=null,O}),this.decryptionPromise}const T=this.needsProbing(c,d);if(T){const R=this.configureTransmuxer(o);if(R)return this.logger.warn(`[transmuxer] ${R.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),s.executeEnd=dn(),Du(r)}(c||d||h||T)&&this.resetInitSegment(E,m,g,y,t),(c||h||T)&&this.resetInitialTimestamp(v),u||this.resetContiguity();const L=this.transmux(o,S,p,f,r);this.asyncResult=Ys(L);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=dn(),L}flush(e){const t=e.transmuxing;t.executeStart=dn();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const o=[],{timeOffset:a}=i;if(r){const d=r.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=dn();const d=[Du(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(a);return Ys(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,c,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===Q.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(i,s,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=dn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,i,s):o=this.transmuxUnencrypted(e,r,i,s),o}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i}=this;let s;for(let d=0,f=da.length;d<f;d++){var o;if((o=da[d].demux)!=null&&o.probe(e,this.logger)){s=da[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(r,t,i,this.logger)),(!a||!(a instanceof c))&&(this.demuxer=new c(r,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Qf(this.config)),e}}function _P(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Du=n=>({remuxResult:{},chunkMeta:n});function Ys(n){return"then"in n&&n.then instanceof Function}class wP{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class PP{constructor(e,t,r,i,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=o}}let Ym=0;class eS{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Ym++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===x.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new nh,this.observer.on(x.FRAG_DECRYPTED,o),this.observer.on(x.ERROR,o);const a=um(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker!="undefined"){const l=this.hls.logger;if(s.workerPath||Mw()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Nw(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Fw());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:ye(s)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new zm(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new zm(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Ym++;const t=this.hls.config,r=um(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:ye(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Bw(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,i,s,o,a,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{instanceNo:p,transmuxer:h}=this,m=o?o.start:s.start,g=s.decryptdata,v=this.frag,y=!(v&&s.cc===v.cc),E=!(v&&u.level===v.level),S=v?u.sn-v.sn:-1,T=this.part?u.part-this.part.index:-1,L=S===0&&u.id>1&&u.id===(v==null?void 0:v.stats.chunkCount),A=!E&&(S===1||S===0&&(T===1||L&&T<=0)),R=self.performance.now();(E||S||s.stats.parsing.start===0)&&(s.stats.parsing.start=R),o&&(T||!A)&&(o.stats.parsing.start=R);const I=!(v&&((d=s.initSegment)==null?void 0:d.url)===((f=v.initSegment)==null?void 0:f.url)),b=new PP(y,A,l,E,m,I);if(!A||y||I){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===Q.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${y}
        trackSwitch: ${E}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${I}`);const O=new wP(r,i,t,a,c);this.configureTransmuxer(O)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:p,cmd:"demux",data:e,decryptdata:g,chunkMeta:u,state:b},e instanceof ArrayBuffer?[e]:[]);else if(h){const O=h.push(e,g,u,b);Ys(O)?O.then(B=>{this.handleTransmuxComplete(B)}).catch(B=>{this.transmuxerError(B,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(O)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const i=r.flush(e);Ys(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,r){!this.hls||(this.error=e,this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const qm=100;class DP extends th{constructor(e,t,r){super(e,t,r,"audio-stream-controller",Q.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;!e||(super.unregisterListeners(),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s,trackId:o}){if(r===Q.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:i,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${i/s} (${i}/${s}) trackId: ${o}`),this.mainAnchor=t,this.state===F.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==a)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===F.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const i=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=mx(o,s,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===F.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=F.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(qm),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=F.IDLE):this.state=F.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case F.IDLE:this.doTickIdle();break;case F.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],i=r==null?void 0:r.details;if(i&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(i))break;this.state=F.WAITING_INIT_PTS}break}case F.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case F.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:i,complete:s}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=F.FRAG_LOADING;const a=i.flush().buffer,l={frag:t,part:r,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=F.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;!(e!=null&&e.readyState)||(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:i,trackId:s}=this,o=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[s]))return;const a=r[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=F.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,ve.AUDIO,Q.AUDIO));const c=this.getFwdBufferInfo(u,Q.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=F.ENDED;return}const d=c.len,f=t.maxBufferLength,p=l.fragments,h=p[0].start,m=this.getLoadPosition(),g=this.flushing?m:c.end;if(this.switchingTrack&&i){const E=m;l.PTSKnown&&E<h&&(c.end>h||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=h+.05)}if(d>=f&&!this.switchingTrack&&g<p[p.length-1].start)return;let v=this.getNextFragment(g,l);if(v&&this.isLoopLoading(v,g)&&(v=this.getNextFragmentLoopLoading(v,l,c,Q.MAIN,f)),!v){this.bufferFlushed=!0;return}let y=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&Me(v)&&!v.endList&&(!l.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===Ue.OK&&(this.mainFragLoading=y=null),y&&Me(y))){if(v.start>y.end){const S=this.fragmentTracker.getFragAtPos(g,Q.MAIN);S&&S.end>y.end&&(y=S,this.mainFragLoading={frag:S,targetBufferTime:null})}if(v.start>y.end)return}this.loadFragment(v,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Hs(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==F.STOPPED&&(this.setInterval(qm),this.state=F.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:i}=this,{details:s,id:o,groupId:a,track:l}=t;if(!i){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==F.STOPPED&&(this.state=F.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[o];let d=0;if(s.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(s,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(Ox(s,u),s.alignedSliding||ol(s,u),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===F.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=F.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new eS(this.hls,Q.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const p=this.initPTS[r.cc],h=(t=r.initSegment)==null?void 0:t.data;if(p!==void 0){const g=i?i.index:-1,v=g!==-1,y=new Zf(r.level,r.sn,r.stats.chunkCount,s.byteLength,g,v);f.push(s,h,d,"",r,i,c.totalduration,!1,y,p)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:m}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new Mx,complete:!1};m.push(new Uint8Array(s)),this.state!==F.STOPPED&&(this.state=F.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Q.MAIN&&Me(t.frag)&&(this.mainFragLoading=t,this.state===F.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==Q.AUDIO){!this.audioOnly&&r.type===Q.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Me(r)){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,pe({},s)))}this.fragBufferedComplete(r,i),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=F.ERROR;return}switch(t.details){case P.FRAG_GAP:case P.FRAG_PARSING_ERROR:case P.FRAG_DECRYPT_ERROR:case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Q.AUDIO,t);break;case P.AUDIO_TRACK_LOAD_ERROR:case P.AUDIO_TRACK_LOAD_TIMEOUT:case P.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===F.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===ce.AUDIO_TRACK&&(this.state=F.IDLE);break;case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case P.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case P.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ve.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ve.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===F.ENDED&&(this.state=F.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Q.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:f,text:p,id3:h,initSegment:m}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=F.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const g=l.initSegment||l;if(this.unhandledEncryptionError(m,l))return;this._bufferInitSegment(c,m.tracks,g,o),i.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:m.tracks})}if(f){const{startPTS:g,endPTS:v,startDTS:y,endDTS:E}=f;u&&(u.elementaryStreams[ve.AUDIO]={startPTS:g,endPTS:v,startDTS:y,endDTS:E}),l.setElementaryStreamInfo(ve.AUDIO,g,v,y,E),this.bufferFragmentData(f,l,u,o)}if(h!=null&&(t=h.samples)!=null&&t.length){const g=me({id:r,frag:l,details:d},h);i.trigger(x.FRAG_PARSING_METADATA,g)}if(p){const g=me({id:r,frag:l,details:d},p);i.trigger(x.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,r,i){if(this.state!==F.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Q.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(x.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:a};this.hls.trigger(x.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===Ue.NOT_LOADED||i===Ue.PARTIAL){var s;if(!Me(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=F.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&ol(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;vr({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a},e,ur)||(tl(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(x.AUDIO_TRACK_SWITCHED,pe({},e))}}class uh extends wt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let o=0;o<i.length;o++){const a=i[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=i[s],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&cm(r);return new dm(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:i,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;i.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==i.appliedTimelineOffset){const c=Math.max(l||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(i.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(r),r&&i.fragments.length>0){Lw(r,i,this);const y=i.playlistParsingError;if(y){this.warn(y);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var u;const{networkDetails:S}=t;E.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:P.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:y,reason:y.message,level:t.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:S,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,p=(i.edge-f)*1e3,h=_x(i,p);if(i.requestScheduled+h<o?i.requestScheduled=o:i.requestScheduled+=h,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let m,g,v;if(i.canBlockReload&&i.endSN&&i.advanced){const y=this.hls.config.lowLatencyMode,E=i.lastPartSn,S=i.endSN,T=i.lastPartIndex,L=T!==-1,A=E===S;L?A?(g=S+1,v=y?0:T):(g=E,v=y?T+1:i.maxPartIndex):g=S+1;const R=i.age,I=R+i.ageHeader;let b=Math.min(I-i.partTarget,i.targetduration*1.5);if(b>0){if(I>i.targetduration*3)this.log(`Playlist last advanced ${R.toFixed(2)}s ago. Omitting segment and part directives.`),g=void 0,v=void 0;else if(r!=null&&r.tuneInGoal&&I-i.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${b} with playlist age: ${i.age}`),b=0;else{const O=Math.floor(b/i.targetduration);g+=O,v!==void 0&&(v+=Math.round(b%i.targetduration/i.partTarget)),this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${b} skip sn ${O} to part ${v}`)}i.tuneInGoal=b}if(m=this.getDeliveryDirectives(i,t.deliveryDirectives,g,v),y||!A){i.requestScheduled=o,this.loadingPlaylist(c,m);return}}else(i.canBlockReload||i.canSkipUntil)&&(m=this.getDeliveryDirectives(i,t.deliveryDirectives,g,v));m&&g!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(h-a*2,h/2)),this.scheduleLoading(c,m,i)}else this.clearTimer()}scheduleLoading(e,t,r){const i=r||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),o=i.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}const a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,r,i){let s=cm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=la.No),new dm(r,i,s)}checkRetry(e){const t=e.details,r=nl(e),i=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=i||{},l=!!i&&!!a&&(s===We.RetryRequest||!i.resolved&&s===We.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Xf(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}function tS(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!qs(n[t].attrs,e[t].attrs))return!1;return!0}function qs(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function cd(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class kP extends uh{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,p)=>{f.id=p});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Qt(l,a,ur);if(f>-1)s=a[f];else{const p=Qt(l,this.tracks);s=this.tracks[p]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ce.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&vr(e,i,ur))return i;const s=Qt(e,this.tracksInGroup,ur);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(i){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=H_(e,t.levels,r,o,ur);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Qt(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,pe({},i)),s))return;const o=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||vr(e,i,ur)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(vr({name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:l},c,ur))return u}for(let u=0;u<t.length;u++){const c=t[u];if(qs(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(qs(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;!this.shouldLoadPlaylist(t)||tl(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}}class OP{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var r;if(i.onError(s),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],i=r==null?void 0:r.buffer;return i?`SourceBuffer${i.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const Xm=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,nS="HlsJsTrackRemovedError";class MP extends Error{constructor(e){super(e),this.name=nS}}class FP extends wt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var i;!this.hls||((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{!this.hls||this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:i,mediaSource:s}=this;r&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=i_(Zn(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this),e.off(x.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?me(r,i.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(r[o]=me({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const i=Zn(this.appendSource);if(i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(o),s)this._objectUrl=r.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,Qm(r),NP(r,a),r.load()}catch{r.src=a}else r.src=a}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,i=t.tracks,s=i?Object.keys(i):null,o=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ye(r,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${ye(i,(l,u)=>l==="initSegment"?void 0:u)}}`),!ZE(i,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(l=>{const u=l,c=i[u];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,p=c.id;if(f.hasFragments(p)||f.hasParts(p)){const g=ae.getBuffered(d);f.detectEvictedFragments(u,g,p,null,!0)}const h=ku(u),m=[u,d];this.sourceBuffers[h]=m,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=s.readyState==="open";try{const l=s.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),s.removeSourceBuffer(l[u]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(i.removeAttribute("src"),this.appendSource&&Qm(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[ku(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new OP(this.tracks)}onBufferCodecs(e,t){var r;const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!i[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var u,c;const d=t[l],{id:f,codec:p,levelCodec:h,container:m,metadata:g,supplemental:v}=d;let y=i[l];const E=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],S=E!=null&&E.buffer?E:y,T=(S==null?void 0:S.pendingCodec)||(S==null?void 0:S.codec),L=S==null?void 0:S.levelCodec;y||(y=i[l]={buffer:void 0,listeners:[],codec:p,supplemental:v,container:m,levelCodec:h,metadata:g,id:f});const A=aa(T,L),R=A==null?void 0:A.replace(Xm,"$1");let I=aa(p,h);const b=(c=I)==null?void 0:c.replace(Xm,"$1");I&&A&&R!==b&&(l.slice(0,5)==="audio"&&(I=Ja(I,this.appendSource)),this.log(`switching codec ${T} to ${I}`),I!==(y.pendingCodec||y.codec)&&(y.pendingCodec=I),y.container=m,this.appendChangeType(l,m,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const i=`${t};codecs=${r}`,s={label:`change-type=${i}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),a.changeType(i),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,i=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,Q.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>i||l!=null&&l.buffer&&ae.isBuffered(l.buffer,i)||((a=this.fragmentTracker.getAppendedFrag(i,Q.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:i,type:s,parent:o,frag:a,part:l,chunkMeta:u,offset:c}=t,d=u.buffering[s],{sn:f,cc:p}=a,h=self.performance.now();d.start=h;const m=a.stats.buffering,g=l?l.stats.buffering:null;m.start===0&&(m.start=h),g&&g.start===0&&(g.start=h);const v=r.audio;let y=!1;s==="audio"&&(v==null?void 0:v.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const E=r.video,S=E==null?void 0:E.buffer;if(S&&f!=="initSegment"){const A=l||a,R=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const b=A.start+A.duration*.05,O=S.buffered,B=this.currentOp("video");!O.length&&!B?this.blockAudio(A):!B&&!ae.isBuffered(S,b)&&this.lastVideoAppendEnd<b&&this.blockAudio(A)}else if(s==="video"){const I=A.end;if(R){const b=R.frag.start;(I>b||I<this.lastVideoAppendEnd||ae.isBuffered(S,b))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}const T=(l||a).start,L={label:`append-${s}`,execute:()=>{var A;d.executeStart=self.performance.now();const R=(A=this.tracks[s])==null?void 0:A.buffer;R&&(y?this.updateTimestampOffset(R,T,.1,s,f,p):c!==void 0&&X(c)&&this.updateTimestampOffset(R,c,1e-6,s,f,p)),this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();d.executeEnd=d.end=A,m.first===0&&(m.first=A),g&&g.first===0&&(g.first=A);const R={};this.sourceBuffers.forEach(([I,b])=>{I&&(R[I]=ae.getBuffered(b))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:R})},onError:A=>{var R;const I={type:te.MEDIA_ERROR,parent:a.type,details:P.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:u,error:A,err:A,fatal:!1},b=(R=this.media)==null?void 0:R.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)I.details=P.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!b)I.errorAction=ai(!0);else if(A.name===nS&&this.sourceBufferCount===0)I.errorAction=ai(!0);else{const O=++this.appendErrors[s];this.warn(`Failed ${O}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${b||"no media error"})`),(O>=this.hls.config.appendErrorMaxRetry||!!b)&&(I.fatal=!0)}this.hls.trigger(x.ERROR,I)}};this.log(`queuing "${s}" append sn: ${f}${l?" p: "+l.index:""} of ${a.type===Q.MAIN?"level":"track"} ${a.level} cc: ${p}`),this.append(L,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:r,startOffset:i,endOffset:s}=t;r?this.append(this.getFlushOp(r,i,s),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,i,s),o)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],o=i?i.elementaryStreams:r.elementaryStreams;o[ve.AUDIOVIDEO]?s.push("audiovideo"):(o[ve.AUDIO]&&s.push("audio"),o[ve.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const u=i?i.stats:r.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:r,part:i,stats:u,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const i=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){!t.fragments.length||(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();!e||this.updateMediaSource(e)})}onError(e,t){if(t.details===P.BUFFER_APPEND_ERROR&&t.frag){var r;const i=(r=t.errorAction)==null?void 0:r.nextAutoLevel;X(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const i=e.config,s=r.currentTime,o=t.levelTargetDuration,a=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(X(a)&&a>=0){const u=Math.max(a,o),c=Math.floor(s/o)*o-u;this.flushBackBuffer(s,o,c)}const l=i.frontBufferFlushThreshold;if(X(l)&&l>0){const u=Math.max(i.maxBufferLength,l),c=Math.max(u,o),d=Math.floor(s/o)*o+c;this.flushFrontBuffer(s,o,d)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=ae.getBuffered(s);if(a.length>0&&r>a.start(0)){var o;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[i];if((o=this.details)!=null&&o.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:i})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=ae.getBuffered(s),a=o.length;if(a<2)return;const l=o.start(a-1),u=o.end(a-1);if(r>l||e>=l&&e<=u)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&!!r.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,i);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return X(s)?{duration:s}:null;const o=this.media.duration,a=X(r.duration)?r.duration:0;return i>a&&i>o||!X(o)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:r}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(X(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${r}.`),i.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ye(r)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const i=this.tracks[t];e[t]={buffer:r,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const o=s,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${ye(a)}`);try{const c=r.addSourceBuffer(u),d=ku(o),f=[o,c];t[d]=f,a.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(o),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[o],this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let i=e.codec;r&&(t==="video"||t==="audiovideo")&&Ks(r,"video")&&(i=R_(i,r));const s=aa(i,e.levelCodec);return s?t.slice(0,5)==="audio"?Ja(s,this.appendSource):s:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);!t||t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);!r||(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}updateTimestampOffset(e,t,r,i,s,o){const a=t-e.timestampOffset;Math.abs(a)>=r&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:i,mediaSource:s}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!i||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=X(i.duration)?i.duration:1/0,u=X(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],i=r==null?void 0:r.buffer;if(!i)throw new MP(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const i=(r=this.tracks[t])==null?void 0:r.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const o=r.bind(this,e);i.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;!r||(t.listeners.forEach(i=>{r.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function Qm(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function NP(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function ku(n){return n==="audio"?1:0}class ch{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&X(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,ch.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&i(l,e[a+1])){s=a;break}}return s}}const BP={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ut=BP,UP={HLS:"h"},$P=UP;class nn{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof nn?r:new nn(r))),this.value=e,this.params=t}}const VP="Dict";function GP(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function KP(n,e,t,r){return new Error(`failed to ${n} "${GP(e)}" as ${t}`,{cause:r})}function rn(n,e,t){return KP("serialize",n,e,t)}class rS{constructor(e){this.description=e}}const Zm="Bare Item",jP="Boolean";function HP(n){if(typeof n!="boolean")throw rn(n,jP);return n?"?1":"?0"}function WP(n){return btoa(String.fromCharCode(...n))}const zP="Byte Sequence";function YP(n){if(ArrayBuffer.isView(n)===!1)throw rn(n,zP);return`:${WP(n)}:`}const qP="Integer";function XP(n){return n<-999999999999999||999999999999999<n}function iS(n){if(XP(n))throw rn(n,qP);return n.toString()}function QP(n){return`@${iS(n.getTime()/1e3)}`}function sS(n,e){if(n<0)return-sS(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const ZP="Decimal";function JP(n){const e=sS(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw rn(n,ZP);const t=e.toString();return t.includes(".")?t:`${t}.0`}const eD="String",tD=/[\x00-\x1f\x7f]+/;function nD(n){if(tD.test(n))throw rn(n,eD);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function rD(n){return n.description||n.toString().slice(7,-1)}const iD="Token";function Jm(n){const e=rD(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw rn(e,iD);return e}function dd(n){switch(typeof n){case"number":if(!X(n))throw rn(n,Zm);return Number.isInteger(n)?iS(n):JP(n);case"string":return nD(n);case"symbol":return Jm(n);case"boolean":return HP(n);case"object":if(n instanceof Date)return QP(n);if(n instanceof Uint8Array)return YP(n);if(n instanceof rS)return Jm(n);default:throw rn(n,Zm)}}const sD="Key";function fd(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw rn(n,sD);return n}function dh(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${fd(e)}`:`;${fd(e)}=${dd(t)}`).join("")}function oS(n){return n instanceof nn?`${dd(n.value)}${dh(n.params)}`:dd(n)}function oD(n){return`(${n.value.map(oS).join(" ")})${dh(n.params)}`}function aD(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw rn(n,VP);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof nn||(s=new nn(s));let o=fd(i);return s.value===!0?o+=dh(s.params):(o+="=",Array.isArray(s.value)?o+=oD(s):o+=oS(s)),o}).join(`,${r}`)}function aS(n,e){return aD(n,e)}const Kt="CMCD-Object",Ce="CMCD-Request",or="CMCD-Session",An="CMCD-Status",lD={br:Kt,ab:Kt,d:Kt,ot:Kt,tb:Kt,tpb:Kt,lb:Kt,tab:Kt,lab:Kt,url:Kt,pb:Ce,bl:Ce,tbl:Ce,dl:Ce,ltc:Ce,mtp:Ce,nor:Ce,nrr:Ce,rc:Ce,sn:Ce,sta:Ce,su:Ce,ttfb:Ce,ttfbb:Ce,ttlb:Ce,cmsdd:Ce,cmsds:Ce,smrt:Ce,df:Ce,cs:Ce,ts:Ce,cid:or,pr:or,sf:or,sid:or,st:or,v:or,msd:or,bs:An,bsd:An,cdn:An,rtp:An,bg:An,pt:An,ec:An,e:An},uD={REQUEST:Ce};function cD(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(i=>e[i]=t),e},{})}function dD(n,e){const t={};if(!n)return t;const r=Object.keys(n),i=e?cD(e):{};return r.reduce((s,o)=>{var a;const l=lD[o]||i[o]||uD.REQUEST,u=(a=s[l])!==null&&a!==void 0?a:s[l]={};return u[o]=n[o],s},t)}function fD(n){return["ot","sf","st","e","sta"].includes(n)}function hD(n){return typeof n=="number"?X(n):n!=null&&n!==""&&n!==!1}const lS="event";function pD(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const fa=n=>Math.round(n),hd=(n,e)=>Array.isArray(n)?n.map(t=>hd(t,e)):n instanceof nn&&typeof n.value=="string"?new nn(hd(n.value,e),n.params):(e.baseUrl&&(n=pD(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Bo=n=>fa(n/100)*100,gD=(n,e)=>{let t=n;return e.version>=2&&(n instanceof nn&&typeof n.value=="string"?t=new nn([n]):typeof n=="string"&&(t=[n])),hd(t,e)},mD={br:fa,d:fa,bl:Bo,dl:Bo,mtp:Bo,nor:gD,rtp:Bo,tb:fa},uS="request",cS="response",fh=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],vD=["e"],yD=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Nl(n){return yD.test(n)}function ED(n){return fh.includes(n)||vD.includes(n)||Nl(n)}const dS=["d","dl","nor","ot","rtp","su"];function xD(n){return fh.includes(n)||dS.includes(n)||Nl(n)}const SD=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function TD(n){return fh.includes(n)||dS.includes(n)||SD.includes(n)||Nl(n)}const AD=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function LD(n){return AD.includes(n)||Nl(n)}const ID={[cS]:TD,[lS]:ED,[uS]:xD};function fS(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,i=e.reportingMode||uS,s=r===1?LD:ID[i];let o=Object.keys(n).filter(s);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=i===cS||i===lS;l&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const u=me({},mD,e.formatters),c={version:r,reportingMode:i,baseUrl:e.baseUrl};return o.sort().forEach(d=>{let f=n[d];const p=u[d];if(typeof p=="function"&&(f=p(f,c)),d==="v"){if(r===1)return;f=r}d=="pr"&&f===1||(l&&d==="ts"&&!X(f)&&(f=Date.now()),hD(f)&&(fD(d)&&typeof f=="string"&&(f=new rS(f)),t[d]=f))}),t}function RD(n,e={}){const t={};if(!n)return t;const r=fS(n,e),i=dD(r,e==null?void 0:e.customHeaderMap);return Object.entries(i).reduce((s,[o,a])=>{const l=aS(a,{whitespace:!1});return l&&(s[o]=l),s},t)}function bD(n,e,t){return me(n,RD(e,t))}const CD="CMCD";function _D(n,e={}){return n?aS(fS(n,e),{whitespace:!1}):""}function wD(n,e={}){if(!n)return"";const t=_D(n,e);return encodeURIComponent(t)}function PD(n,e={}){if(!n)return"";const t=wD(n,e);return`${CD}=${t}`}const e0=/CMCD=[^&#]+/;function DD(n,e,t){const r=PD(e,t);if(!r)return n;if(e0.test(n))return n.replace(e0,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class kD{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:ut.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:o}=i,a=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(o||s).duration*1e3,ot:l};(l===ut.VIDEO||l===ut.AUDIO||l==ut.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=o?this.getNextPart(o):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(u.nor=c.url),this.apply(i,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:$P.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){me(t,this.createData());const r=t.ot===ut.INIT||t.ot===ut.VIDEO||t.ot===ut.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((o,a)=>(i.includes(a)&&(o[a]=t[a]),o),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),bD(e.headers,t,s)):e.url=DD(e.url,t,s)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const i=e.sn-r.startSN;return r.fragments[i+1]}}getNextPart(e){var t;const{index:r,fragment:i}=e,s=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:o}=i;for(let a=s.length-1;a>=0;a--){const l=s[a];if(l.index===r&&l.fragment.sn===o)return s[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ut.TIMED_TEXT;if(e.sn==="initSegment")return ut.INIT;if(t==="audio")return ut.AUDIO;if(t==="main")return this.hls.audioTracks.length?ut.VIDEO:ut.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===ut.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,o=s>-1?s+1:i.levels.length;r=i.levels.slice(0,o)}return r.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===ut.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ae.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const OD=3e5;class MD extends wt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;!e||(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===We.SendAlternateToPenaltyBox&&r.flags===gt.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&i?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==o),t.details===P.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${i&&i.length} priorities: ${ye(s)} penalized: ${ye(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>OD&&delete r[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Dx(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===ce.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===ce.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new Re(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,p=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),p&&(i[d.SUBTITLES]=p,d.SUBTITLES=p);const h=hS(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new Hs({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:h,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let g=1;g<c.audioGroups.length;g++)m.addGroupId("audio",`${c.audioGroups[g]}_clone_${o}`);if(c.subtitleGroups)for(let g=1;g<c.subtitleGroups.length;g++)m.addGroupId("text",`${c.subtitleGroups[g]}_clone_${o}`);return m});t.push(...u),t0(this.audioTracks,r,l,o),t0(this.subtitleTracks,i,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,f,p)=>{this.log(`Loaded steering manifest: "${i}"`);const h=c.data;if((h==null?void 0:h.VERSION)!==1){this.log(`Steering VERSION ${h.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=h.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":v}=h;if(m)try{this.uri=new self.URL(m,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||f.url),g&&this.clonePathways(g);const y={steeringManifest:h,url:i.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,y),v&&this.updatePathwayPriority(v)},onError:(c,d,f,p)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let h=this.timeToLoad*1e3;if(c.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const g=m.getResponseHeader("Retry-After");g&&(h=parseFloat(g)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,h)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function t0(n,e,t,r){!n||Object.keys(e).forEach(i=>{const s=n.filter(o=>o.groupId===i).map(o=>{const a=me({},o);return a.details=void 0,a.attrs=new Re(a.attrs),a.url=a.attrs.URI=hS(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[i],a.attrs["PATHWAY-ID"]=r,a});n.push(...s)})}function hS(n,e,t,r){const{HOST:i,PARAMS:s,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return i&&!a&&(l.host=i),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}class ui extends wt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ui.CDMCleanupPromise?[ui.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Zi(this.config));const a=o.map(Iu).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=ua(o);if(r!=="sinf"||a!==be.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}let l;try{const p=Be(new Uint8Array(i)),h=eh(JSON.parse(p).sinf),m=ax(h);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(m.subarray(8,24))}catch(p){this.warn(`${s} Failed to parse sinf: ${p}`);return}const u=Ye(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let f=c[u];for(let p=0;p<d.length;p++){const h=d[p],m=h.decryptdata;if(!m.keyId)continue;const g=Ye(m.keyId);if(il(l,m.keyId)||m.uri.replace(/-/g,"").indexOf(u)!==-1){if(f=c[g],!f)continue;if(m.pssh)break;delete c[g],m.pssh=new Uint8Array(i),m.keyId=l,f=c[u]=f.then(()=>this.generateRequestWithPreferredKeySession(h,r,i,"encrypted-event-key-match")),f.catch(v=>this.handleError(v));break}}f||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(x.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t==null?void 0:t[e];if(i)return i.licenseUrl;if(e===be.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,i=t.map(o=>o.audioCodec).filter(r),s=t.map(o=>o.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,i,s).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof pt?a(d):a(new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return Lx===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){var i;const s=gw(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(i=o)==null?void 0:i.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ye(s)}`),a=this.requestMediaKeySystemAccess(e,s);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),a.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(p=>p?this.setMediaKeysServerCertificate(f,e,p):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Ye(e.keyId||[])} keyUri: ${e.uri}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=Uo(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Ye(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Iu(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=Iu(i);s?t(s):r(new Error(`Unable to find format for key-system "${i}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Zi(this.config),r=e.map(ua).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const i=FD(e,t[r]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,r=Uo(t),i=this.bannedKeyIds[r];if(i||this.getKeyStatus(t)==="internal-error"){const a=n0(i||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[r]=a,a}return o.catch(a=>{if(a instanceof pt){const l=pe({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new pt(l,a.message);this.handleError(u,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(!!this.hls)if(e instanceof pt){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${Ye(r.keyId||[])})`:""}`),this.hls.trigger(x.ERROR,e.data)}else this.error(e.message),this.hls.trigger(x.ERROR,{type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Uo(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=ua(e.keyFormat),s=i?[i]:Zi(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Zi(this.config)),e.length===0)throw new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ye({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s;const o=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(o)try{const h=o.call(this.hls,t,r,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,r=h.initData?h.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(h){if(this.warn(h.message),this.hls&&this.hls.config.debug)throw h}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const a=Uo(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${r.byteLength})`);const u=new nh,c=e._onmessage=h=>{const m=e.mediaKeysSession;if(!m){u.emit("error",new Error("invalid state"));return}const{messageType:g,message:v}=h;this.log(`"${g}" message event for session "${m.sessionId}" message size: ${v.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(e,v).catch(y=>{u.eventNames().length?u.emit("error",y):this.handleError(y)}):g==="license-release"?e.keySystem===be.FAIRPLAY&&this.updateKeySession(e,sd("acknowledged")).then(()=>this.removeSession(e)).catch(y=>this.handleError(y)):this.warn(`unhandled media key message type "${g}"`)},d=(h,m)=>{m.keyStatus=h;let g;h.startsWith("usable")?u.emit("resolved"):h==="internal-error"||h==="output-restricted"||h==="output-downscaled"?g=n0(h,m.decryptdata):h==="expired"?g=new Error(`key expired (keyId: ${a})`):h==="released"?g=new Error("key released"):h==="status-pending"||this.warn(`unhandled key status change "${h}" (keyId: ${a})`),g&&(u.eventNames().length?u.emit("error",g):this.handleError(g))},f=e._onkeystatuseschange=h=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const g=this.getKeyStatuses(e);if(!Object.keys(g).some(S=>g[S]!=="status-pending"))return;if(g[a]==="expired"){this.log(`Expired key ${ye(g)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let y=g[a];if(y)d(y,e);else{var E;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[a]||(E[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const T=this.getKeyStatus(e.decryptdata);if(T&&T!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${T} from other session.`),d(T,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after ${1e3}ms`),y="internal-error",d(y,e)},1e3)),this.log(`No status for keyId ${a} (${ye(g)}).`)}};st(e.mediaKeysSession,"message",c),st(e.mediaKeysSession,"keystatuseschange",f);const p=new Promise((h,m)=>{u.on("error",m),u.on("resolved",h)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(h=>{throw new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_SESSION,error:h,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>p).catch(h=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw h}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,i)=>{if(typeof i=="string"&&typeof r=="object"){const a=i;i=r,r=a}const s="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===be.PLAYREADY&&s.length===16){const a=Ye(s);t[a]=r,Tx(s)}const o=Ye(s);r==="internal-error"&&(this.bannedKeyIds[o]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,p,h,m)=>{o(f.data)},onError:(f,p,h,m)=>{a(new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:pe({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,p,h)=>{a(new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,p,h)=>{a(new Error("aborted"))}};i.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),i(e)}).catch(o=>{s(new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var o,a;c=s[d];const p=(o=c.querySelector("name"))==null?void 0:o.textContent,h=(a=c.querySelector("value"))==null?void 0:a.textContent;p&&h&&e.setRequestHeader(p,h)}}const l=i.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return sd(atob(u))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}i(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)s(new pt({type:te.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==be.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,st(r,"encrypted",this.onMediaEncrypted),st(r,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(dt(e,"encrypted",this.onMediaEncrypted),dt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Wn.clearKeyUriToKeyIdMap();const s=i.length;ui.CDMCleanupPromise=Promise.all(i.map(o=>this.removeSession(o)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ye((i==null?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(u=>self.clearTimeout(o[u]));const{drmSystemOptions:a}=this.config;return(vw(a)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}ui.CDMCleanupPromise=void 0;function Uo(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Ye(n.keyId)}function FD(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class pt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function n0(n,e){const t=n==="output-restricted",r=t?P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:P.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new pt({type:te.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class ND{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(x.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function pS(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function gS(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){ge.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){ge.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function Yr(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function pd(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=UD(n.cues,e,t);for(let o=0;o<s.length;o++)(!r||r(s[o]))&&n.removeCue(s[o])}i==="disabled"&&(n.mode=i)}function BD(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t,s;for(;r<=i;)if(s=Math.floor((i+r)/2),e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s;return n[r].startTime-e<e-n[i].startTime?r:i}function UD(n,e,t){const r=[],i=BD(n,e);if(i>-1)for(let s=i,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function ha(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class $D extends uh{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=ha(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;ha(r.textTracks).forEach(o=>{Yr(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const c=Qt(a,o);if(c>-1)s=o[c];else{const d=Qt(a,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||vr(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(qs(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(qs(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(cd(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ce.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&vr(e,r))return r;const i=Qt(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=Qt(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ha(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>cd(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!X(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=i;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(d)}}function VD(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function xs(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const ci=.025;let ll=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function GD(n,e,t){return`${n.identifier}-${t+1}-${xs(e)}`}class KD{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ou(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Ou(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=X(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ou(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ci))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ll.Range:ll.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return jD(this)}}function Ou(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<ci)?e.start:e.start+e.duration}function mS(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Mu(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function jD(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ur(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class HD{constructor(e,t,r,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=r,this.assetItem=i;const o=()=>{this.hasDetails=!0};s.once(x.LEVEL_LOADED,o),s.once(x.AUDIO_TRACK_LOADED,o),s.once(x.SUBTITLE_TRACK_LOADED,o),s.on(x.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(x.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,s.trigger(x.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(!!e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=mS(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=ae.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ae.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,r){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,r){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ur(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const r0=.033;class WD extends wt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(s=i[r])!=null&&s.event;){var s;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let i=0;i<r.length;i++){let s=r[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let i=e;i<=t&&r[i];i++){const s=r[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var r;if(((r=t[i].event)==null?void 0:r.identifier)===e)return i}return-1}findAssetIndex(e,t){const r=e.assetList,i=r.length;if(i>1)for(let s=0;s<i;s++){const o=r[s];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||s===i-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,i=r[r.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:i}=r,s=this.events,o=this.parseDateRanges(i,{url:r.url},t),a=Object.keys(i),l=s?s.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,c)=>{const d=u.cue.pre,f=u.cue.post,p=c.cue.pre,h=c.cue.post;if(d&&!p)return-1;if(p&&!d||f&&!h)return 1;if(h&&!f)return-1;if(!d&&!p&&!f&&!h){const m=u.startTime,g=c.startTime;if(m!==g)return m-g}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],r=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,o=this.parseSchedule(i,e);(r||t.length||(s==null?void 0:s.length)!==o.length||o.some((l,u)=>Math.abs(l.playout.start-s[u].playout.start)>.005||Math.abs(l.playout.end-s[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,r){const i=[],s=Object.keys(e);for(let o=0;o<s.length;o++){const a=s[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new KD(l,t),this.eventMap[a]=u,r===!1&&(u.appendInPlace=r)),i.push(u)}}return i}parseSchedule(e,t){const r=[],i=t.main.details,s=i.live?1/0:i.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const f=c.cue.pre,p=c.cue.post,h=e[d-1]||null,m=c.appendInPlace,g=p?s:c.startOffset,v=c.duration,y=c.timelineOccupancy===ll.Range?v:0,E=c.resumptionOffset,S=(h==null?void 0:h.startTime)===g,T=g+c.cumulativeDuration;let L=m?T+v:g+E;if(f||!p&&g<=0){const R=u;u+=y,c.timelineStart=T;const I=o;o+=v,r.push({event:c,start:T,end:L,playout:{start:I,end:o},integrated:{start:R,end:u}})}else if(g<=s){if(!S){const b=g-l;if(b>r0){const O=l,B=u;u+=b;const K=o;o+=b;const q={previousEvent:e[d-1]||null,nextEvent:c,start:O,end:O+b,playout:{start:K,end:o},integrated:{start:B,end:u}};r.push(q)}else b>0&&h&&(h.cumulativeDuration+=b,r[r.length-1].end=g)}p&&(L=T),c.timelineStart=T;const R=u;u+=y;const I=o;o+=v,r.push({event:c,start:T,end:L,playout:{start:I,end:o},integrated:{start:R,end:u}})}else return;const A=c.resumeTime;p||A>s?l=s:l=A}),l<s){var a;const c=l,d=u,f=s-l;u+=f;const p=o;o+=f,r.push({previousEvent:((a=r[r.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:c+f,playout:{start:p,end:o},integrated:{start:d,end:u}})}this.setDurations(s,o,u)}else r.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,i=r.live?1/0:r.edge;let s=0,o=-1;e.forEach((a,l)=>{const u=a.cue.pre,c=a.cue.post,d=u?0:c?i:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=s:(s=0,o=d),!c&&a.snapOptions.in&&(a.resumeAnchor=Sr(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<r0&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`)),s+=X(a.resumeOffset)?a.resumeOffset:a.duration})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(r-i)>ci?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${l}`),!1;const u=Sr(null,a.fragments,r);if(!u)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const c=o==="audio"?.175:0;return Math.abs(u.start-r)<ci+c||Math.abs(u.end-r)<ci+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,i=!1,s=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+r;a.startOffset=r,a.timelineStart=l,i||(i=a.duration===null),s||(s=!!a.error),r+=a.error?0:a.duration||0}i&&!s?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Mt(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class zD{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let i;try{i=mS(r,this.hls.sessionId,e.baseUrl)}catch(f){const p=this.assignAssetListError(e,P.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(x.ERROR,p);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:i.href},u=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,p,h,m)=>{const g=f.data,v=g==null?void 0:g.ASSETS;if(!Array.isArray(v)){const y=this.assignAssetListError(e,P.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),h.url,p,m);this.hls.trigger(x.ERROR,y);return}e.assetListResponse=g,this.hls.trigger(x.ASSET_LIST_LOADED,{event:e,assetListResponse:g,networkDetails:m})},onError:(f,p,h,m)=>{const g=this.assignAssetListError(e,P.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${p.url})`),p.url,m,h);this.hls.trigger(x.ERROR,g)},onTimeout:(f,p,h)=>{const m=this.assignAssetListError(e,P.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${p.url})`),p.url,f,h);this.hls.trigger(x.ERROR,m)}};return a.load(l,c,d),this.hls.trigger(x.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,i,s,o){return e.error=r,{type:te.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:o,stats:s}}}function i0(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function $o(n,e){return`[${n}] Advancing timeline position to ${e}`}class YD extends wt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const i=r-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const o=i<=-.01;this.timelinePos=r,this.bufferedPos=r;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-i)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<a.start||r>=a.end){var l;const p=this.findItemIndex(a);let h=this.schedule.findItemIndexAtTime(r);if(h===-1&&(h=p+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${p} to ${h})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&h>p){const m=this.schedule.findJumpRestrictedIndex(p+1,h);if(m>p){this.setSchedulePosition(m);return}}this.setSchedulePosition(h);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){const p=a.event.assetList[0];p&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,p))}return}const c=u.timelineStart,d=u.duration||0;if(o&&r<c||r>=c+d){var f;(f=a.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,u)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(r>=i.end){this.timelinePos=i.end;const a=this.findItemIndex(i);this.setSchedulePosition(a+1)}const s=this.playingAsset;if(!s)return;const o=s.timelineStart+(s.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,s)},this.onScheduleUpdate=(r,i)=>{const s=this.schedule;if(!s)return;const o=this.playingItem,a=s.events||[],l=s.items||[],u=s.durations,c=r.map(m=>m.identifier),d=!!(a.length||c.length);(d||i)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(m=>Mt(m))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,p=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const h=this.bufferingItem;if(h&&(p=this.updateItem(h,this.bufferedPos),this.itemsMatch(h,p)?this.bufferingItem=p:h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))),r.forEach(m=>{m.assetList.forEach(g=>{this.clearAssetPlayer(g.identifier,null)})}),this.playerQueue.forEach(m=>{if(m.interstitial.appendInPlace){const g=m.assetItem.timelineStart,v=m.timelineOffset-g;if(v)try{m.timelineOffset=g}catch(y){Math.abs(v)>ci&&this.warn(`${y} ("${m.assetId}" ${m.timelineOffset}->${g})`)}}}),d||i){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(o)&&c.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),h&&p!==f&&this.trimInPlace(p,h),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new zD(e),this.schedule=new WD(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(x.MEDIA_ENDED,this.onMediaEnded,this),e.on(x.ERROR,this.onError,this),e.on(x.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(x.MEDIA_ENDED,this.onMediaEnded,this),e.off(x.ERROR,this.onError,this),e.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){dt(e,"play",this.onPlay),dt(e,"pause",this.onPause),dt(e,"seeking",this.onSeeking),dt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;st(r,"seeking",this.onSeeking),st(r,"timeupdate",this.onTimeupdate),st(r,"play",this.onPlay),st(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(r);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(this.media=null,!r&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),i=(d,f,p,h,m)=>{if(d){let g=d[f].start;const v=d.event;if(v){if(f==="playout"||v.timelineOccupancy!==ll.Point){const y=r(p);(y==null?void 0:y.interstitial)===v&&(g+=y.assetItem.startOffset+y[m])}}else g+=(h==="bufferedPos"?o():e[h])-d.start;return g}return 0},s=(d,f)=>{var p;if(d!==0&&f!=="primary"&&(p=e.schedule)!=null&&p.length){var h;const m=e.schedule.findItemIndexAtTime(d),g=(h=e.schedule.items)==null?void 0:h[m];if(g){const v=g[f].start-g.start;return d+v}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f,p;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((p=e.schedule)==null?void 0:p.durations[d])||0},l=(d,f)=>{var p,h;const m=e.effectivePlayingItem;if(m!=null&&(p=m.event)!=null&&p.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const g=e.effectivePlayingItem,v=e.schedule.findItemIndexAtTime(d,f),y=(h=e.schedule.items)==null?void 0:h[v],E=e.getBufferingPlayer(),S=E==null?void 0:E.interstitial,T=S==null?void 0:S.appendInPlace,L=g&&e.itemsMatch(g,y);if(g&&(T||L)){const A=r(e.playingAsset),R=(A==null?void 0:A.media)||e.primaryMedia;if(R){const I=f==="primary"?R.currentTime:i(g,f,e.playingAsset,"timelinePos","currentTime"),b=d-I,O=(T?I:R.currentTime)+b;if(O>=0&&(!A||T||O<=A.duration)){R.currentTime=O;return}}}if(y){let A=d;if(f!=="primary"){const I=y[f].start,b=d-I;A=y.start+b}const R=!e.isInterstitial(y);if((!e.isInterstitial(g)||g.event.appendInPlace)&&(R||y.event.appendInPlace)){const I=e.media||(T?E==null?void 0:E.media:null);I&&(I.currentTime=A)}else if(g){const I=e.findItemIndex(g);if(v>I){const O=e.schedule.findJumpRestrictedIndex(I+1,v);if(O>I){e.setSchedulePosition(O);return}}let b=0;if(R)e.timelinePos=A,e.checkBuffer();else{const O=y.event.assetList,B=d-(y[f]||y).start;for(let K=O.length;K--;){const q=O[K];if(q.duration&&B>=q.startOffset&&B<q.startOffset+q.duration){b=K;break}}}e.setSchedulePosition(v,b)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var p;return i(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((p=e.bufferingAsset)==null?void 0:p.startOffset)||0}return 0},get currentTime(){const d=u(),f=e.effectivePlayingItem;return f&&f===d?i(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=u(),p=e.effectivePlayingItem;p&&p===f&&l(d+p.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=u())==null?void 0:d.event.assetList;return f?f.map(p=>e.getAssetPlayer(p.identifier)):[]},get playingIndex(){var d;const f=(d=u())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const p=e.findItemIndex(d);if(f.appendInPlace){const h=d.playout.start+d.event.duration;l(h+.001,"playout")}else e.advanceAfterAssetEnded(f,p,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const s=(t=i)==null?void 0:t.currentTime;if(!(s===void 0||!X(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,i=e.media;if(r&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ye(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var r,i;if(e.media===t)return;let s=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),c="Primary";else if(u){const h=this.getBufferingPlayer();h?(s=h.transferMedia(),c=`${h}`):c="detached MediaSource"}else c="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${ye(s)}`);else if(!this.detachedData||o.media===t){const h=this.playerQueue;h.length>1&&h.forEach(m=>{if(a&&m.interstitial.appendInPlace!==l){const g=m.interstitial;this.clearInterstitial(m.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",f=d&&s?s:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const p=this.schedule;if(f===s&&p){const h=a&&e.assetId===p.assetIdAtEnd;f.overrides={duration:p.duration,endOfStream:!a||h,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,i=this.effectivePlayingItem;if(r===-1){const s=this.hls.startPosition;if(this.log($o("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const r=e.event,i=r.findAssetIndex(t),s=Mu(r,i);if(!r.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,r){const i=Mu(e,r);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const s=this.schedule.items;if(s){const o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log($o("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const s=e.assetList[i];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const i=t.parentIdentifier,s=r.getEvent(i);if(s){const o=r.findEventIndex(i),a=r.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(e,t){var r;const i=(r=this.schedule)==null?void 0:r.items;if(!i||this.playbackDisabled)return;const s=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&Mt(s)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const c=o.event,d=this.playingAsset,f=d==null?void 0:d.identifier,p=f?this.getAssetPlayer(f):null;if(p&&f&&(!this.eventItemsMatch(o,s)||t!==void 0&&f!==c.assetList[t].identifier)){var l;const h=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${h+1}/${c.assetList.length} ${Ur(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:h,event:c,schedule:i.slice(0),scheduleIndex:e,player:p}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),h);return}this.retreiveMediaSource(f,s),p.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&p.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Mt(o)}`),c.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:c,schedule:i.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const h=(u=this.schedule)==null?void 0:u.items;if(s&&h){const m=this.findItemIndex(s);this.advanceSchedule(m,h,t,o,a)}return}}this.advanceSchedule(e,i,t,o,a)}advanceSchedule(e,t,r,i,s){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,f=o.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const c=a.event;if(r===void 0){r=o.findAssetIndex(c,this.timelinePos);const h=Mu(c,r-1);if(c.isAssetPastPlayoutLimit(h)||c.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(c,e,r);return}r=h}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(c,r);if(this.eventItemsMatch(a,d||i)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Mt(a)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const p=c.assetList[r];if(!p){this.advanceAfterAssetEnded(c,e,r||0);return}if(f||(f=this.getAssetPlayer(p.identifier)),f===null||f.destroyed){const h=c.assetList.length;this.warn(`asset ${r+1}/${h} player destroyed ${c}`),f=this.createAssetPlayer(c,p,r),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(p))return;this.startAssetPlayer(f,r,t,e,l),this.shouldPlay&&i0(f.media)}else a?(this.resumePrimary(a,e,i),this.shouldPlay&&i0(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var i,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Mt(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log($o("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!r)return;const o=(s=this.schedule)==null?void 0:s.items;!o||(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Mt(e)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(r<i.fragmentStart||r>i.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ae.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log($o("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((r=i.mainForwardBufferInfo)==null?void 0:r.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const i=pe(pe({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=pe(pe({},this.altSelection),{},{audio:r});return}const s=pe(pe({},i),{},{audio:r});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=pe(pe({},this.altSelection),{},{subtitles:r});return}const s=pe(pe({},i),{},{subtitles:r});this.mediaSelection=s}onAudioTrackSwitching(e,t){const r=hm(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=hm(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var r;const o=this.schedule.findEventIndex(s.identifier),a=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const i=(r=this.schedule)==null?void 0:r.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});const r=e.end+.25,i=ae.bufferInfo(this.primaryMedia,r,0);if(i.end>r||(i.nextStart||0)>r){this.log(`trim buffered interstitial ${Mt(e)} (was ${Mt(t)})`);const s=!0;this.attachPrimary(r,null,s),this.flushFrontBuffer(r)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;!r||(t=this.schedule)==null||t.updateSchedule(r,[],e)}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const i=ae.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,r,e)}updateBufferedPos(e,t,r){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(s),d=Math.min(c+1,t.length-1),f=t[d];if((l===-1&&s&&e>=s.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(l=d),this.isInterstitial(s)){const p=s.event;if(d-a>1&&p.appendInPlace===!1||p.assetList.length===0&&p.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>a)this.bufferedToItem(f);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&f.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:i,events:s}=r;if(!i||!s)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Mt(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const u=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const f=this.getAssetPlayer(c.identifier);f&&(d===u&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,i=r.assetList.length===0&&!r.assetListLoader,s=r.cue.once;if(i||!s){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const r=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,o=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-l;f>0&&(u=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:i} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!o&&i){for(let u=t;u<i;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,i,s,o){const a={parentIdentifier:e.identifier,identifier:GD(e,o,t),duration:s,startOffset:r,timelineStart:i,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,r){const i=this.hls,s=i.userConfig;let o=s.videoPreference;const a=i.loadLevelObj||i.levels[i.currentLevel];(o||a)&&(o=me({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const S=this.timelinePos-t.timelineStart;if(S>1){const T=t.duration;T&&S<T&&(c=S)}}const d=t.identifier,f=pe(pe({},s),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const p=f.cmcd;p!=null&&p.sessionId&&p.contentId&&(f.cmcd=me({},p,{contentId:xs(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const h=new HD(this.HlsPlayerClass,f,e,t);this.playerQueue.push(h),e.assetList[r]=t;let m=!0;const g=S=>{if(S.live){var T;const R=new Error(`Interstitials MUST be VOD assets ${e}`),I={fatal:!0,type:te.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:R},b=((T=this.schedule)==null?void 0:T.findEventIndex(e.identifier))||-1;this.handleAssetItemError(I,e,b,r,R.message);return}const L=S.edge-S.fragmentStart,A=t.duration;(m||A===null||L>A)&&(m=!1,this.log(`Interstitial asset "${d}" duration change ${A} > ${L}`),t.duration=L,this.updateSchedule())};h.on(x.LEVEL_UPDATED,(S,{details:T})=>g(T)),h.on(x.LEVEL_PTS_UPDATED,(S,{details:T})=>g(T)),h.on(x.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const v=(S,T)=>{const L=this.getAssetPlayer(d);if(L&&T.tracks){L.off(x.BUFFER_CODECS,v),L.tracks=T.tracks;const A=this.primaryMedia;this.bufferingAsset===L.assetItem&&A&&!L.media&&this.bufferAssetPlayer(L,A)}};h.on(x.BUFFER_CODECS,v);const y=()=>{var S;const T=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${T}`),!T||!this.schedule)return;const L=this.schedule.findEventIndex(e.identifier),A=(S=this.schedule.items)==null?void 0:S[L];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};h.on(x.BUFFERED_TO_END,y);const E=S=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const L=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,L,S)};return h.once(x.MEDIA_ENDED,E(r)),h.once(x.PLAYOUT_LIMIT_REACHED,E(1/0)),h.on(x.ERROR,(S,T)=>{if(!this.schedule)return;const L=this.getAssetPlayer(d);if(T.details===P.BUFFER_STALLED_ERROR){if(L!=null&&L.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${T.error} ${e}`)}),h.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const T=new Error(`Asset player destroyed unexpectedly ${d}`),L={fatal:!0,type:te.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),r,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ur(t)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:h}),h}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const i=this.playerQueue[r];this.log(`clear ${i} toSegment: ${t&&Mt(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(r,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,i,s){const{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,r[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Ur(a)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var r,i;if(!this.schedule)return;const{interstitial:s,assetItem:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(r=this.schedule.items)==null?void 0:r[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const u=this.getBufferingPlayer();if(u===e)return;const c=s.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(c&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!ZE(d,e.tracks)){const f=new Error(`Asset ${Ur(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),p={fatal:!0,type:te.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},h=s.findAssetIndex(o);this.handleAssetItemError(p,s,a,h,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const i=r.currentTime,s=t.findAssetIndex(e,i),o=e.assetList[s];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||i-o.timelineStart,u=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${a} ${e} (media.currentTime: ${i})`),l&&(u/r.playbackRate<.5||a.bufferedInPlaceToEnd(r))&&a.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,i,s){if(e.details===P.BUFFER_STALLED_ERROR)return;const o=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ur(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[l]||null,c=this.schedule.items,d=me({},e,{fatal:!1,errorAction:ai(!0),asset:o,assetListIndex:i,event:t,schedule:c,scheduleIndex:r,player:u});if(this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,p=this.bufferingAsset,h=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=h),!t.assetList.some(m=>!m.error))t.error=h;else for(let m=i;m<t.assetList.length;m++)this.resetAssetPlayer(t.assetList[m].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,r,i):p&&p.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,p)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let i=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${Mt(r)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const o=this.updateItem(r,i);this.itemsMatch(r,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var r,i;const s=t.event,o=s.identifier,a=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const l=s.timelineStart,u=s.duration;let c=0;a.forEach((m,g)=>{const v=parseFloat(m.DURATION);this.createAsset(s,g,c,l+c,v,m.URI),c+=v}),s.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${s}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===o;this.updateSchedule();const p=(i=this.bufferingItem)==null?void 0:i.event;if(f){var h;const m=this.schedule.findEventIndex(o),g=(h=this.schedule.items)==null?void 0:h[m];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==m){s.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(g)}this.setSchedulePosition(m)}else if((p==null?void 0:p.identifier)===o){const m=s.assetList[0];if(m){const g=this.getAssetPlayer(m.identifier);if(p.appendInPlace){const v=this.primaryMedia;g&&v&&this.bufferAssetPlayer(g,v)}else g&&g.loadSource()}}}onError(e,t){if(!!this.schedule)switch(t.details){case P.ASSET_LIST_PARSING_ERROR:case P.ASSET_LIST_LOAD_ERROR:case P.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case P.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const s0=500;class qD extends th{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",Q.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=F.IDLE,this.setInterval(s0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragContextChanged(r)||(Me(r)&&(this.fragPrevious=r),this.state=F.IDLE),!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=r.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,s,Q.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===Q.SUBTITLE&&(t.details===P.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==F.STOPPED&&(this.state=F.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&tS(this.levels,t)){this.levels=t.map(r=>new Hs(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new Hs(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Q.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==F.STOPPED&&this.setInterval(s0)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(r=l.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(ol(o,d),u=o.fragmentStart):f&&(u=f.start,ad(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,ad(o,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=o,this.levelLastLoaded=l,a===i&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===F.IDLE&&(Sr(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&li(i.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,Jf(i.method)).catch(a=>{throw s.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(x.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=F.IDLE})}}doTick(){if(!this.media){this.state=F.IDLE;return}if(this.state===F.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:i}=this,s=this.getLoadPosition(),o=ae.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:a,len:l}=o,u=r.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,f=d.length,p=u.edge;let h=null;const m=this.fragPrevious;if(a<p){const y=i.maxFragLookUpTolerance,E=a>p-y?0:y;h=Sr(m,d,Math.max(d[0].start,a),E),!h&&m&&m.start<d[0].start&&(h=d[0])}else h=d[f-1];if(h=this.filterReplacedPrimary(h,r.details),!h)return;const g=h.sn-u.startSN,v=d[g-1];if(v&&v.cc===h.cc&&this.fragmentTracker.getState(v)===Ue.NOT_LOADED&&(h=v),this.fragmentTracker.getState(h)===Ue.NOT_LOADED){const y=this.mapToInitFragWhenRequired(h);y&&this.loadFragment(y,r,a)}}}loadFragment(e,t,r){Me(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new XD(this.tracksBuffered[this.currentTrackId]||[])}}class XD{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const QD={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},vS=n=>String.fromCharCode(QD[n]||n),Ft=15,un=100,ZD={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},JD={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ek={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},tk={25:2,26:4,29:6,30:8,31:10,27:13,28:15},nk=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class rk{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;ge.log(`${this.time} [${e}] ${r}`)}}}const ar=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class yS{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ik{constructor(){this.uchar=" ",this.penState=new yS}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class sk{constructor(e){this.chars=[],this.pos=0,this.currPenState=new yS,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<un;t++)this.chars.push(new ik);this.logger=e}equals(e){for(let t=0;t<un;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<un;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<un;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>un&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=un)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=vS(e);if(this.pos>=un){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<un;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<un;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Fu{constructor(e){this.rows=[],this.currRow=Ft-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ft;t++)this.rows.push(new sk(e));this.logger=e}reset(){for(let e=0;e<Ft;e++)this.rows[e].clear();this.currRow=Ft-1}equals(e){let t=!0;for(let r=0;r<Ft;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Ft;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ft;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ye(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Ft;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ye(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<Ft;s++){const o=this.rows[s].getTextString();o&&(i=s+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class o0{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Fu(r),this.nonDisplayedMemory=new Fu(r),this.lastOutputScreen=new Fu(r),this.currRollUpRow=this.displayedMemory.rows[Ft-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ft-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+ye(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class a0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=ak(),this.logger=void 0;const i=this.logger=new rk;this.channels=[null,new o0(e,t,i),new o0(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let o=!1,a=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+ar([t[r],t[r+1]])+"] -> ("+ar([i,s])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(ok(i,s,l)){Vo(null,null,l),this.logger.log(3,()=>"Repeated command ("+ar([i,s])+") is dropped");continue}Vo(i,s,this.cmdHistory),o=this.parseCmd(i,s),o||(o=this.parseMidrow(i,s)),o||(o=this.parsePAC(i,s)),o||(o=this.parseBackgroundAttributes(i,s))}else Vo(null,null,l);if(!o&&(a=this.parseChars(i,s),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ar([i,s])+" orig: "+ar([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ar([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?ZD[e]:ek[e]:r=o===1?JD[e]:tk[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+vS(o)+"' in channel "+r),i=[o]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+ar(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=nk[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Vo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Vo(n,e,t){t.a=n,t.b=e}function ok(n,e,t){return t.a===n&&t.b===e}function ak(){return{a:null,b:null}}var hh=function(){if(sl!=null&&sl.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return t(n,a)}function i(a){return t(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",p=!1,h=a,m=l,g=u,v=null,y="",E=!0,S="auto",T="start",L=50,A="middle",R=50,I="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(b){f=""+b}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return p},set:function(b){p=!!b}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return h},set:function(b){if(typeof b!="number")throw new TypeError("Start time must be set to a number.");h=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return m},set:function(b){if(typeof b!="number")throw new TypeError("End time must be set to a number.");m=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return g},set:function(b){g=""+b,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return v},set:function(b){v=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return y},set:function(b){const O=r(b);if(O===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=O,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return E},set:function(b){E=!!b,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return S},set:function(b){if(typeof b!="number"&&b!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");S=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return T},set:function(b){const O=i(b);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");T=O,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return L},set:function(b){if(b<0||b>100)throw new Error("Position must be between 0 and 100.");L=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return A},set:function(b){const O=i(b);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");A=O,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return R},set:function(b){if(b<0||b>100)throw new Error("Size must be between 0 and 100.");R=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return I},set:function(b){const O=i(b);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");I=O,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class lk{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ES(n){function e(r,i,s,o){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class uk{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function xS(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const o=i[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const gd=new hh(0,0,""),Go=gd.align==="middle"?"middle":"center";function ck(n,e,t){const r=n;function i(){const a=ES(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const u=new uk;xS(a,function(f,p){let h;switch(f){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===p){u.set(f,t[m].region);break}break;case"vertical":u.alt(f,p,["rl","lr"]);break;case"line":h=p.split(","),u.integer(f,h[0]),u.percent(f,h[0])&&u.set("snapToLines",!1),u.alt(f,h[0],["auto"]),h.length===2&&u.alt("lineAlign",h[1],["start",Go,"end"]);break;case"position":h=p.split(","),u.percent(f,h[0]),h.length===2&&u.alt("positionAlign",h[1],["start",Go,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,p);break;case"align":u.alt(f,p,["start",Go,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&gd.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Go);let d=u.get("position","auto");d==="auto"&&gd.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=i(),o(),s(n,e)}function SS(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class dk{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new lk,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,o=0;for(s=SS(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function i(s){xS(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const a=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new hh(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ck(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const fk=/\r\n|\n\r|\n|\r/g,Nu=function(e,t,r=0){return e.slice(r,r+t.length)===t},hk=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!X(t)||!X(r)||!X(i)||!X(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t};function ph(n,e,t){return xs(n.toString())+xs(e.toString())+xs(t)}const pk=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function gk(n,e,t,r,i,s,o){const a=new dk,l=Et(new Uint8Array(n)).trim().replace(fk,`
`).split(`
`),u=[],c=e?SP(e.baseTime,e.timescale):0;let d="00:00.000",f=0,p=0,h,m=!0;a.oncue=function(g){const v=t[r];let y=t.ccOffset;const E=(f-c)/9e4;if(v!=null&&v.new&&(p!==void 0?y=t.ccOffset=v.start:pk(t,r,E)),E){if(!e){h=new Error("Missing initPTS for VTT MPEGTS");return}y=E-t.presentationOffset}const S=g.endTime-g.startTime,T=mt((g.startTime+y-p)*9e4,i*9e4)/9e4;g.startTime=Math.max(T,0),g.endTime=Math.max(T+S,0);const L=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(L)),g.id||(g.id=ph(g.startTime,g.endTime,L)),g.endTime>0&&u.push(g)},a.onparsingerror=function(g){h=g},a.onflush=function(){if(h){o(h);return}s(u)},l.forEach(g=>{if(m)if(Nu(g,"X-TIMESTAMP-MAP=")){m=!1,g.slice(16).split(",").forEach(v=>{Nu(v,"LOCAL:")?d=v.slice(6):Nu(v,"MPEGTS:")&&(f=parseInt(v.slice(7)))});try{p=hk(d)/1e3}catch(v){h=v}return}else g===""&&(m=!1);a.parse(g+`
`)}),a.flush()}const Bu="stpp.ttml.im1t",TS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,AS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,mk={left:"start",center:"center",right:"end",start:"start",end:"end"};function l0(n,e,t,r){const i=ue(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(a=>Et(a)),o=xP(e.baseTime,1,e.timescale);try{s.forEach(a=>t(vk(a,o)))}catch(a){r(a)}}function vk(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,f)=>(d[f]=i.getAttribute(`ttp:${f}`)||s[f],d),{}),a=i.getAttribute("xml:space")!=="preserve",l=u0(Uu(i,"styling","style")),u=u0(Uu(i,"layout","region")),c=Uu(i,"body","[begin]");return[].map.call(c,d=>{const f=LS(d,a);if(!f||!d.hasAttribute("begin"))return null;const p=Vu(d.getAttribute("begin"),o),h=Vu(d.getAttribute("dur"),o);let m=Vu(d.getAttribute("end"),o);if(p===null)throw c0(d);if(m===null){if(h===null)throw c0(d);m=p+h}const g=new hh(p-e,m-e,f);g.id=ph(g.startTime,g.endTime,g.text);const v=u[d.getAttribute("region")],y=l[d.getAttribute("style")],E=yk(v,y,l),{textAlign:S}=E;if(S){const T=mk[S];T&&(g.lineAlign=T),g.align=S}return me(g,E),g}).filter(d=>d!==null)}function Uu(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function u0(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function LS(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?LS(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function yk(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(i=t[o]),s.reduce((a,l)=>{const u=$u(e,r,l)||$u(n,r,l)||$u(i,r,l);return u&&(a[l]=u),a},{})}function $u(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function c0(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Vu(n,e){if(!n)return null;let t=ES(n);return t===null&&(TS.test(n)?t=Ek(n,e):AS.test(n)&&(t=xk(n,e))),t}function Ek(n,e){const t=TS.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function xk(n,e){const t=AS.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Ko{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Sk{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ko(this,"textTrack1"),t=new Ko(this,"textTrack2"),r=new Ko(this,"textTrack3"),i=new Ko(this,"textTrack4");this.cea608Parser1=new a0(1,e,t),this.cea608Parser2=new a0(3,r,i)}addCues(e,t,r,i,s){let o=!1;for(let a=s.length;a--;){const l=s[a],u=Tk(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,u/(r-t)>.5))return}if(o||s.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,i)}else{const a=this.Cues.newCue(null,t,r,i);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s,trackId:o}){const{unparsedVttFrags:a}=this;r===Q.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(x.FRAG_LOADED,l):this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(d0(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)r[e]=a,Yr(r[e]),pS(r[e],i);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(!!i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{Yr(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Yr(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===Bu);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(tS(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?ha(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&d0(a[f],l)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)Yr(c);else{const d=IS(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,o=this.captionsProperties[s];!o||(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Q.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===Q.SUBTITLE)if(i.byteLength){const s=r.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===Bu?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;l0(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{r.logger.log(`Failed to parse IMSC1: ${i}`),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[r.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?bt(r.initSegment.data,new Uint8Array(i)).buffer:i;gk(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,i),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&a>r.cc)&&l.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||l0(t,this.initPTS[e.cc],()=>{r.textCodec=Bu,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>gS(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(x.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Q.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:i}=t;if(!(r.type===Q.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let s=0;s<i.length;s++){const o=i[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(i[s].pts,a[0]),this.cea608Parser2.addData(i[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>pd(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>pd(a[l],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const o=e[i++],a=127&e[i++],l=127&e[i++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function IS(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function d0(n,e){return!!n&&n.kind===IS(e)&&cd(e,n)}function Tk(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function f0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Ak=/\s/,Lk={newCue(n,e,t,r){const i=[];let s,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(s=r.rows[f],a=!0,l=0,u="",!s.isEmpty()){var d;for(let m=0;m<s.chars.length;m++)Ak.test(s.chars[m].uchar)&&a?l++:(u+=s.chars[m].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const p=SS(u.trim()),h=ph(e,t,p);n!=null&&(d=n.cues)!=null&&d.getCueById(h)||(o=new c(e,t,p),o.id=h,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(o))}return n&&i.length&&(i.sort((f,p)=>f.line==="auto"||p.line==="auto"?0:f.line>8&&p.line>8?p.line-f.line:f.line-p.line),i.forEach(f=>gS(n,f))),i}};function Ik(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Rk=/(\d+)-(\d+)\/(\d+)/;class h0{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||wk,this.controller=new self.AbortController,this.stats=new Wf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=bk(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&X(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Ys(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const p=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(p-i.loading.start)),!d.ok){const{status:m,statusText:g}=d;throw new Pk(g||"fetch, bad network response",m,d)}i.loading.first=p,i.total=_k(d.headers)||i.total;const h=(f=this.callbacks)==null?void 0:f.onProgress;return h&&X(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,h):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,p;const h=this.response;if(!h)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const m=d[a];m&&(i.loaded=i.total=m);const g={url:h.url,data:d,code:h.status},v=(f=this.callbacks)==null?void 0:f.onProgress;v&&!X(t.highWaterMark)&&v(i,e,d,h),(p=this.callbacks)==null||p.onSuccess(g,i,e,h)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const p=d&&d.code||0,h=d?d.message:null;(f=this.callbacks)==null||f.onError({code:p,text:h},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const o=new Mx,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<i||o.dataLength?(o.push(c),o.dataLength>=i&&s(t,r,o.flush().buffer,e)):s(t,r,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function bk(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(me({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function Ck(n){const e=Rk.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function _k(n){const e=n.get("Content-Range");if(e){const r=Ck(e);if(X(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function wk(n,e){return new self.Request(n.url,e)}class Pk extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const Dk=/^age:\s*[\d.]+\s*$/im;class RS{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Wf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:r.status,text:o.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=r.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&X(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const h=c!=null?c:t.response;if(h!=null){var o,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=t.responseType==="arraybuffer"?h.byteLength:h.length;r.loaded=r.total=m,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const g=(o=this.callbacks)==null?void 0:o.onProgress;g&&g(r,e,h,t);const v={url:t.responseURL,data:h,code:u};(a=this.callbacks)==null||a.onSuccess(v,r,e,t);return}}const d=s.loadPolicy.errorRetry,f=r.retry,p={url:e.url,data:void 0,code:u};if(rl(d,f,!1,p))this.retry(d);else{var l;ge.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(rl(e,t,!0))this.retry(e);else{var r;ge.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Xf(e,r.retry),r.retry++,ge.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Dk.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const kk={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Ok=pe(pe({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:RS,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:W_,bufferController:FP,capLevelController:ch,errorController:Q_,fpsController:ND,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Lx,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:kk},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Mk()),{},{subtitleStreamController:qD,subtitleTrackController:$D,timelineController:Sk,audioStreamController:DP,audioTrackController:kP,emeController:ui,cmcdController:kD,contentSteeringController:MD,interstitialsController:YD});function Mk(){return{cueHandler:Lk,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Fk(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=md(n),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];s.forEach(c=>{const d=`${o}Loading${c}`,f=e[d];if(f!==void 0&&l){u.push(d);const p=r[a].default;switch(e[a]={default:p},c){case"TimeOut":p.maxLoadTimeMs=f,p.maxTimeToFirstByteMs=f;break;case"MaxRetry":p.errorRetry.maxNumRetry=f,p.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":p.errorRetry.retryDelayMs=f,p.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=f,p.timeoutRetry.maxRetryDelayMs=f;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${ye(e[a])}`)}),pe(pe({},r),e)}function md(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(md):Object.keys(n).reduce((e,t)=>(e[t]=md(n[t]),e),{}):n}function Nk(n,e){const t=n.loader;t!==h0&&t!==RS?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):Ik()&&(n.loader=h0,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const pa=2,Bk=.1,Uk=.05,$k=100;class Vk extends Ex{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval($k),this.mediaSource=t.mediaSource;const r=this.media=t.media;st(r,"playing",this.onMediaPlaying),st(r,"waiting",this.onMediaWaiting),st(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(dt(r,"playing",this.onMediaPlaying),dt(r,"waiting",this.onMediaWaiting),dt(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,i;const s=(r=this.hls)==null?void 0:r.config;if(!s)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,u=!this.seeking&&a,c=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}));return}if(!ae.getBuffered(o).length){this.nudgeRetry=0;return}const d=ae.bufferInfo(o,e,0),f=d.nextStart||0,p=this.fragmentTracker;if(a&&p&&this.hls){const L=p0(this.hls.inFlightFragments,e),A=d.len>pa,R=!f||L||f-e>pa&&!p.getPartialFragment(e);if(A||R)return;this.moved=!1}const h=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){if(!(d.len>0)&&!f)return;const A=Math.max(f,d.start||0)-e,I=!!(h!=null&&h.live)?h.targetduration*2:pa,b=jo(e,p);if(A>0&&(A<=I||b)){o.paused||this._trySkipBufferHole(b);return}}const m=s.detectStallWithCurrentTimeMs,g=self.performance.now(),v=this.waiting;let y=this.stalled;if(y===null)if(v>0&&g-v<m)y=this.stalled=v;else{this.stalled=g;return}const E=g-y;if(!a&&(E>=m||v)&&this.hls){var S;if(((S=this.mediaSource)==null?void 0:S.readyState)==="ended"&&!(h!=null&&h.live)&&Math.abs(e-((h==null?void 0:h.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const T=ae.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(T,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&i&&i.length>1&&e>i.end(0)){const s=ae.bufferedInfo(ae.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const o=ae.timeRangesToArray(i),a=ae.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=ae.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,c=o[a+1].start;if((l===-1||l>a)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=jo(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const p=ae.bufferInfo(this.media,e,0);this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:p.len,bufferInfo:p})}}}}}_tryFixBufferStall(e,t,r){var i,s;const{fragmentTracker:o,media:a}=this,l=(i=this.hls)==null?void 0:i.config;if(!a||!o||!l)return;const u=(s=this.hls)==null?void 0:s.latestLevelDetails,c=jo(r,o);if((c||u!=null&&u.live&&r<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,i=e.nextStart;if(r&&i){const s=r.getFragAtPos(t,Q.MAIN),o=r.getFragAtPos(i,Q.MAIN);if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:i,stalled:s}=this;if(!i&&s!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${ye(e)})`);this.warn(o.message),t.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!r||!s)return 0;const o=i.currentTime,a=ae.bufferInfo(i,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const c=a.len<=s.maxBufferHole,d=a.len>0&&a.len<1&&i.readyState<3,f=l-o;if(f>0&&(c||d)){if(f>s.maxBufferHole){let h=!1;if(o===0){const m=r.getAppendedFrag(0,Q.MAIN);m&&l<m.end&&(h=!0)}if(!h&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||p0(this.hls.inFlightFragments,l))return 0;let g=!1,v=e.end;for(;v<l;){const y=jo(v,r);if(y)v+=y.duration;else{g=!0;break}}if(g)return 0}}const p=Math.max(l+Uk,o+Bk);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${p}`),this.moved=!0,i.currentTime=p,!(e!=null&&e.gap)){const h=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${p}`),m={type:te.MEDIA_ERROR,details:P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?m.part=e:m.frag=e),this.hls.trigger(x.ERROR,m)}return p}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!r||!s)return 0;const o=r.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const a=o+(i+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),r.currentTime=a,t.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function p0(n,e){const t=g0(n.main);if(t&&t.start<=e)return t;const r=g0(n.audio);return r&&r.start<=e?r:null}function g0(n){if(!n)return null;switch(n.state){case F.IDLE:case F.STOPPED:case F.ENDED:case F.ERROR:return null}return n.frag}function jo(n,e){return e.getAppendedFrag(n,Q.MAIN)||e.getPartialFragment(n)}const Gk=.25;function vd(){if(typeof self!="undefined")return self.VTTCue||self.TextTrackCue}function Gu(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,ye(i?pe({type:i},r):r))}return s}const Ho=(()=>{const n=vd();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Kk{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{!this.hls||this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Yr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(!!this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return pS(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:i}=this.hls.config;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=vd();if(!!o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===vt.emsg&&!r||!i)continue;const u=Gx(s[a].data),c=s[a].pts;let d=c+s[a].duration;d>Ho&&(d=Ho),d-c<=0&&(d=c+Gk);for(let p=0;p<u.length;p++){const h=u[p];if(!Kx(h)){this.updateId3CueEnds(c,l);const m=Gu(o,c,d,h,l);m&&this.id3Track.addCue(m)}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const o=i[s];o.type===t&&o.startTime<e&&o.endTime===Ho&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;i==="audio"?u=c=>c.type===vt.audioId3&&l:i==="video"?u=c=>c.type===vt.emsg&&a:u=c=>c.type===vt.audioId3&&l||c.type===vt.emsg&&a,pd(s,t,r,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:i,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;const a=vd();if(r&&i&&!o){const{fragmentStart:m,fragmentEnd:g}=e;let v=this.assetCue;v?(v.startTime=m,v.endTime=g):a&&(v=this.assetCue=Gu(a,m,g,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),v&&(v.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(v),v.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const m=Object.keys(d).filter(g=>!c.includes(g));for(let g=m.length;g--;){var p;const v=m[g],y=(p=d[v])==null?void 0:p.cues;delete d[v],y&&Object.keys(y).forEach(E=>{const S=y[E];if(S){S.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(S)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const h=e.fragments[e.fragments.length-1];if(!(c.length===0||!X(h==null?void 0:h.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let m=0;m<c.length;m++){const g=c[m],v=u[g],y=v.startTime,E=d[g],S=(E==null?void 0:E.cues)||{};let T=(E==null?void 0:E.durationKnown)||!1,L=Ho;const{duration:A,endDate:R}=v;if(R&&A!==null)L=y+A,T=!0;else if(v.endOnNext&&!T){const b=c.reduce((O,B)=>{if(B!==v.id){const K=u[B];if(K.class===v.class&&K.startDate>v.startDate&&(!O||v.startDate<O.startDate))return K}return O},null);b&&(L=b.startTime,T=!0)}const I=Object.keys(v.attr);for(let b=0;b<I.length;b++){const O=I[b];if(!cw(O))continue;const B=S[O];if(B)T&&!(E!=null&&E.durationKnown)?B.endTime=L:Math.abs(B.startTime-y)>.01&&(B.startTime=y,B.endTime=L);else if(a){let K=v.attr[O];dw(O)&&(K=JE(K));const j=Gu(a,y,L,{key:O,data:K},vt.dateRange);j&&(j.id=g,this.id3Track.addCue(j),S[O]=j,o&&(O==="X-ASSET-LIST"||O==="X-ASSET-URL")&&j.addEventListener("enter",this.onEventCueEnter))}}d[g]={cues:S,dateRange:v,durationKnown:T}}}}}class jk{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!r.live)return;const a=this.targetLatency;if(a===null)return;const l=i-a,u=Math.min(this.maxLatency,a+r.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,p=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,p)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*i);const c=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,o=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;!e||(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;!e||(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===P.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,i;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class Hk extends uh{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:f,videoCodec:p}=c;f&&(c.audioCodec=f=Ja(f,r)||void 0),p&&(p=c.videoCodec=b_(p));const{width:h,height:m,unknownCodecs:g}=c,v=(g==null?void 0:g.length)||0;if(a||(a=!!(h&&m)),l||(l=!!p),u||(u=!!f),v||f&&!this.isAudioSupported(f)||p&&!this.isVideoSupported(p)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:y,"FRAME-RATE":E,"HDCP-LEVEL":S,"PATHWAY-ID":T,RESOLUTION:L,"VIDEO-RANGE":A}=d,I=`${`${T||"."}-`}${c.bitrate}-${L}-${E}-${y}-${A}-${S}`;if(s[I])if(s[I].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const b=o[I]+=1;c.attrs["PATHWAY-ID"]=new Array(b+1).join(".");const O=this.createLevel(c);s[I]=O,i.push(O)}else s[I].addGroupId("audio",d.AUDIO),s[I].addGroupId("text",d.SUBTITLES);else{const b=this.createLevel(c);s[I]=b,o[I]=1,i.push(b)}}),this.filterAndSortMediaOptions(i,t,a,l,u)}createLevel(e){const t=new Hs(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(i.message),t.supportedResult=dx(i,[])}return t}isAudioSupported(e){return Ks(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ks(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,i,s){var o;let a=[],l=[],u=e;const c=((o=t.stats)==null?void 0:o.parsing)||{};if((r||i)&&s&&(u=u.filter(({videoCodec:y,videoRange:E,width:S,height:T})=>(!!y||!!(S&&T))&&N_(E))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",E=y;t.levels.length&&(E=`one or more CODECS in variant not supported: ${ye(t.levels.map(T=>T.attrs.CODECS).filter((T,L,A)=>A.indexOf(T)===L))}`,this.warn(E),y+=` (${E})`);const S=new Error(y);this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:P.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:S,reason:E})}}),c.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),m0(a)),t.subtitles&&(l=t.subtitles,m0(l));const d=u.slice(0);u.sort((y,E)=>{if(y.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&y.height!==E.height)return y.height-E.height;if(y.frameRate!==E.frameRate)return y.frameRate-E.frameRate;if(y.videoRange!==E.videoRange)return el.indexOf(y.videoRange)-el.indexOf(E.videoRange);if(y.videoCodec!==E.videoCodec){const S=am(y.videoCodec),T=am(E.videoCodec);if(S!==T)return T-S}if(y.uri===E.uri&&y.codecSet!==E.codecSet){const S=Za(y.codecSet),T=Za(E.codecSet);if(S!==T)return T-S}return y.averageBitrate!==E.averageBitrate?y.averageBitrate-E.averageBitrate:0});let f=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let y=0;y<d.length;y++)if(d[y].pathwayId===u[0].pathwayId){f=d[y];break}}this._levels=u;for(let y=0;y<u.length;y++)if(u[y]===f){var p;this._firstLevel=y;const E=f.bitrate,S=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${E}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const T=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);T>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const h=s&&!i,m=this.hls.config,g=!!(m.audioStreamController&&m.audioTrackController),v={levels:u,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:g&&!h&&a.some(y=>!!y.url)};c.end=performance.now(),this.hls.trigger(x.MANIFEST_PARSED,v)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&i&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,i==null?void 0:i.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===ce.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Q.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${i}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(i,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(x.LEVEL_LOADING,{url:r,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));Dx(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=r.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(x.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function m0(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function bS(){return self.SourceBuffer||self.WebKitSourceBuffer}function CS(){if(!Zn())return!1;const e=bS();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Wk(){if(!CS())return!1;const n=Zn();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(js(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(js(e,"audio"))))}function zk(){var n;const e=bS();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const Yk=100;class qk extends th{constructor(e,t,r){super(e,t,r,"stream-controller",Q.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!X(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(i,s,Q.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:i}=this;if(this.stopLoad(),this.setInterval(Yk),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=F.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=F.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case F.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],i=r==null?void 0:r.details;if(i&&(!i.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(i))break;this.state=F.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=F.IDLE;break}break}case F.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===F.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const o=r[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(x.BUFFER_EOS,m),this.state=F.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=o.details;if(!u||this.state===F.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=F.WAITING_LEVEL,this.startFragRequested=!1;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let p=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&p&&Me(p)&&this.fragmentTracker.getState(p)!==Ue.OK){var h;const g=((h=this.backtrackFragment)!=null?h:p).sn-u.startSN,v=u.fragments[g-1];v&&p.cc===v.cc&&(p=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,f)){if(!p.gap){const g=this.audioOnly&&!this.altAudio?ve.AUDIO:ve.VIDEO,v=(g===ve.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;v&&this.afterBufferFlushed(v,g,Q.MAIN)}p=this.getNextFragmentLoopLoading(p,u,a,Q.MAIN,d)}!p||(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,o,f))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);i===Ue.NOT_LOADED||i===Ue.PARTIAL?Me(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Q.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case F.KEY_LOADING:case F.FRAG_LOADING:case F.FRAG_LOADING_WAITING_RETRY:case F.PARSING:case F.PARSED:this.state=F.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;st(r,"playing",this.onMediaPlaying),st(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(dt(r,"playing",this.onMediaPlaying),dt(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,i=!1;for(let s=0;s<t.levels.length;s++){const o=t.levels[s].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,i=i||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&i&&!zk(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==F.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=F.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i,startFragRequested:s}=this,o=t.level,a=t.details,l=a.totalduration;if(!i){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===F.FRAG_LOADING||this.state===F.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||(r=u.details)!=null&&r.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(u.details=a,this.levelLastLoaded=u,s||this.setStartPosition(a,d),this.hls.trigger(x.LEVEL_UPDATED,{details:a,level:o}),this.state===F.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=F.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(i!==null&&r.duration>i&&(s<i||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||s<a-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),r.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=ae.bufferInfo(r,i,0);if(!((u=d.buffered)!=null&&u.length)){r.currentTime=i;return}if(d.start<=s){r.currentTime=i;return}const{nextStart:p}=ae.bufferedInfo(d.buffered,s,0);p&&(r.currentTime=p)}else r.currentTime=i}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level];if(!a){this.warn(`Level ${r.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),p=this.transmuxer=this.transmuxer||new eS(this.hls,Q.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=i?i.index:-1,m=h!==-1,g=new Zf(r.level,r.sn,r.stats.chunkCount,s.byteLength,h,m),v=this.initPTS[r.cc];p.push(s,d,f,u,r,i,l.totalduration,c,g,v)}onAudioTrackSwitching(e,t){const r=this.hls,i=this.altAudio!==0;if(tl(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(x.BUFFER_FLUSHED,()=>{!this.hls||this.hls.trigger(x.AUDIO_TRACK_SWITCHED,t)}),r.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(x.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=tl(t.url,this.hls);if(r){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(s=a,i=l,a==="video"){const u=r[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t,s=r.type===Q.MAIN;if(s){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===F.PARSED&&(this.state=F.IDLE);return}const a=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Me(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}const o=this.media;!o||(!this._hasEnoughToStart&&ae.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=F.ERROR;return}switch(t.details){case P.FRAG_GAP:case P.FRAG_PARSING_ERROR:case P.FRAG_DECRYPT_ERROR:case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Q.MAIN,t);break;case P.LEVEL_LOAD_ERROR:case P.LEVEL_LOAD_TIMEOUT:case P.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===F.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===ce.LEVEL&&(this.state=F.IDLE);break;case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case P.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case P.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=F.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ve.AUDIO||!this.altAudio){const r=(t===ve.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,Q.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&r&&(r+=i);const s=this.getLevelDetails(),o=ae.getBuffered(e),a=o.length?o.start(0):0,l=a-r,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${a}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this,s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=F.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),i.trigger(x.FRAG_LOADED,r),s.bitrateTest=!1}).catch(r=>{this.state===F.STOPPED||this.state===F.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:i,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o){this.resetWhenMissingContext(s);return}const{frag:a,part:l,level:u}=o,{video:c,text:d,id3:f,initSegment:p}=i,{details:h}=u,m=this.altAudio?void 0:i.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=F.PARSING,p){const g=p.tracks;if(g){const S=a.initSegment||a;if(this.unhandledEncryptionError(p,a))return;this._bufferInitSegment(u,g,S,s),r.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:t,tracks:g})}const v=p.initPTS,y=p.timescale,E=this.initPTS[a.cc];if(X(v)&&(!E||E.baseTime!==v||E.timescale!==y)){const S=p.trackId;this.initPTS[a.cc]={baseTime:v,timescale:y,trackId:S},r.trigger(x.INIT_PTS_FOUND,{frag:a,id:t,initPTS:v,timescale:y,trackId:S})}}if(c&&h){m&&c.type==="audiovideo"&&this.logMuxedErr(a);const g=h.fragments[a.sn-1-h.startSN],v=a.sn===h.startSN,y=!g||a.cc>g.cc;if(i.independent!==!1){const{startPTS:E,endPTS:S,startDTS:T,endDTS:L}=c;if(l)l.elementaryStreams[c.type]={startPTS:E,endPTS:S,startDTS:T,endDTS:L};else if(c.firstKeyFrame&&c.independent&&s.id===1&&!y&&(this.couldBacktrack=!0),c.dropped&&c.independent){const A=this.getMainFwdBufferInfo(),R=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,I=c.firstKeyFramePTS?c.firstKeyFramePTS:E;if(!v&&R<I-this.config.maxBufferHole&&!y){this.backtrack(a);return}else y&&(a.gap=!0);a.setElementaryStreamInfo(c.type,a.start,S,a.start,L,!0)}else v&&E-(h.appliedTimelineOffset||0)>pa&&(a.gap=!0);a.setElementaryStreamInfo(c.type,E,S,T,L),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,l,s,v||y)}else if(v||y)a.gap=!0;else{this.backtrack(a);return}}if(m){const{startPTS:g,endPTS:v,startDTS:y,endDTS:E}=m;l&&(l.elementaryStreams[ve.AUDIO]={startPTS:g,endPTS:v,startDTS:y,endDTS:E}),a.setElementaryStreamInfo(ve.AUDIO,g,v,y,E),this.bufferFragmentData(m,a,l,s)}if(h&&f!=null&&f.samples.length){const g={id:t,frag:a,details:h,samples:f.samples};r.trigger(x.FRAG_PARSING_METADATA,g)}if(h&&d){const g={id:t,frag:a,details:h,samples:d.samples};r.trigger(x.FRAG_PARSING_USERDATA,g)}}logMuxedErr(e){this.warn(`${Me(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,i){if(this.state!==F.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:s,video:o,audiovideo:a}=t;if(s){const u=e.audioCodec;let c=aa(s.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),s.levelCodec=c,s.id=Q.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=Q.MAIN;const u=o.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(x.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:u,data:d,frag:r,part:null,chunkMeta:i,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Q.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=F.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ae.isBuffered(e,r)?t=this.getAppendedFrag(r):ae.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return X(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(X(t)){const r=this.getLevelDetails(),i=this.currentFrag||(r?Sr(null,r.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const o=s+(t-i.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Xk extends wt{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=P.KEY_LOAD_ERROR,r,i,s){return new cn({type:te.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,s=t.length;i<s;i++){const o=t[i];if(e.cc<=o.cc&&(!Me(e)||!Me(o)||e.sn<o.sn)||!r&&i==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=ua(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const i=Zi(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,u))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=Ku(s);let l=this.keyIdToKeyInfo[a];if((r=l)!=null&&r.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(i=l)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return s.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+Ye(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const o=g_(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Ye(a)}`),Wn.setKeyIdForUri(e.decryptdata.uri,a)):(a=Wn.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Ye(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!Me(t))return Promise.resolve(r);const s=this.emeController.loadKey(r);return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,p,h,m)=>{const{frag:g,keyInfo:v}=h,y=Ku(v.decryptdata);if(!g.decryptdata||v!==this.keyIdToKeyInfo[y])return a(this.createKeyLoadError(g,P.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));v.decryptdata.key=g.decryptdata.key=new Uint8Array(f.data),g.keyLoader=null,v.loader=null,o({frag:g,keyInfo:v})},onError:(f,p,h,m)=>{this.resetLoader(p),a(this.createKeyLoadError(t,P.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),h,pe({url:l.url,data:void 0},f)))},onTimeout:(f,p,h)=>{this.resetLoader(p),a(this.createKeyLoadError(t,P.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),h))},onAbort:(f,p,h)=>{this.resetLoader(p),a(this.createKeyLoadError(t,P.INTERNAL_ABORTED,new Error("key loading aborted"),h))}};s.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null);const o=Ku(r.decryptdata)||i;delete this.keyIdToKeyInfo[o],s&&s.destroy()}}function Ku(n){if(n.keyFormat!==Xe.FAIRPLAY){const e=n.keyId;if(e)return Ye(e)}return n.uri}function v0(n){const{type:e}=n;switch(e){case ce.AUDIO_TRACK:return Q.AUDIO;case ce.SUBTITLE_TRACK:return Q.SUBTITLE;default:return Q.MAIN}}function ju(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Qk{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ce.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:ce.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:ce.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:ce.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const r=this.loaders[ce.LEVEL];if(r){const i=r.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(r.abort(),delete this.loaders[ce.LEVEL])}}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===ce.MANIFEST?s=r.manifestLoadPolicy.default:s=me({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),X((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===ce.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===ce.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===ce.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=me({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const p=this.getInternalLoader(d);this.resetInternalLoader(d.type);const h=u.data;c.parsing.start=performance.now(),Zt.isMediaPlaylist(h)||d.type!==ce.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,f||null,p):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};i.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,i){const s=this.hls,o=e.data,a=ju(e,r),l=Zt.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,l.playlistParsingError,i,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:p,variableList:h}=l;this.variableList=h,c.forEach(y=>{const{unknownCodecs:E}=y;if(E){const{preferManagedMediaSource:S}=this.hls.config;let{audioCodec:T,videoCodec:L}=y;for(let A=E.length;A--;){const R=E[A];Ks(R,"audio",S)?(y.audioCodec=T=T?`${T},${R}`:R,vi.audio[T.substring(0,4)]=2,E.splice(A,1)):Ks(R,"video",S)&&(y.videoCodec=L=L?`${L},${R}`:R,vi.video[L.substring(0,4)]=2,E.splice(A,1))}}});const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":v}=Zt.parseMasterPlaylistMedia(o,a,l);m.length&&!m.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Re({}),bitrate:0,url:""})),s.trigger(x.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:g,captions:v,contentSteering:u,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:f,startTimeOffset:p,variableList:h})}handleTrackOrLevelPlaylist(e,t,r,i,s){const o=this.hls,{id:a,level:l,type:u}=r,c=ju(e,r),d=X(l)?l:X(a)?a:0,f=v0(r),p=Zt.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(u===ce.MANIFEST){const h={attrs:new Re({}),bitrate:0,details:p,name:"",url:c};p.requestScheduled=t.loading.start+_x(p,0),o.trigger(x.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=p,this.handlePlaylistLoaded(p,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:P.MANIFEST_PARSING_ERROR,fatal:t.type===ce.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let o=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===ce.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ce.AUDIO_TRACK||e.type===ce.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=P.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case ce.MANIFEST:l=r?P.MANIFEST_LOAD_TIMEOUT:P.MANIFEST_LOAD_ERROR,u=!0;break;case ce.LEVEL:l=r?P.LEVEL_LOAD_TIMEOUT:P.LEVEL_LOAD_ERROR,u=!1;break;case ce.AUDIO_TRACK:l=r?P.AUDIO_TRACK_LOAD_TIMEOUT:P.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case ce.SUBTITLE_TRACK:l=r?P.SUBTITLE_TRACK_LOAD_TIMEOUT:P.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:te.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:s};if(i){const f=(t==null?void 0:t.url)||e.url;d.response=pe({url:f,data:void 0},i)}this.hls.trigger(x.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,o){const a=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:f,deliveryDirectives:p}=i,h=ju(t,i),m=v0(i);let g=typeof i.level=="number"&&m===Q.MAIN?u:void 0;const v=e.playlistParsingError;if(v){if(this.hls.logger.warn(`${v} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:P.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:v,reason:v.message,response:t,context:i,level:g,parent:m,networkDetails:s,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:P.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:y,reason:y.message,response:t,context:i,level:g,parent:m,networkDetails:s,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ce.MANIFEST:case ce.LEVEL:if(g){if(!c)g=0;else if(c!==a.levels[g]){const y=a.levels.indexOf(c);y>-1&&(g=y)}}a.trigger(x.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:g||0,id:d||0,stats:r,networkDetails:s,deliveryDirectives:p,withoutMultiVariant:l===ce.MANIFEST});break;case ce.AUDIO_TRACK:a.trigger(x.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:r,networkDetails:s,deliveryDirectives:p});break;case ce.SUBTITLE_TRACK:a.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:r,networkDetails:s,deliveryDirectives:p});break}}}class zt{static get version(){return Ws}static isMSESupported(){return CS()}static isSupported(){return Wk()}static getMediaSource(){return Zn()}static get Events(){return x}static get MetadataSchema(){return vt}static get ErrorTypes(){return te}static get ErrorDetails(){return P}static get DefaultConfig(){return zt.defaultConfig?zt.defaultConfig:Ok}static set DefaultConfig(e){zt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new nh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=r_(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=Fk(zt.DefaultConfig,e,t);this.userConfig=e,r.progressive&&Nk(r,t);const{abrController:i,bufferController:s,capLevelController:o,errorController:a,fpsController:l}=r,u=new a(this),c=this.abrController=new i(this),d=new Z_(this),f=r.interstitialsController,p=f?this.interstitialsController=new f(this,zt):null,h=this.bufferController=new s(this,d),m=this.capLevelController=new o(this),g=new l(this),v=new Qk(this),y=r.contentSteeringController,E=y?new y(this):null,S=this.levelController=new Hk(this,E),T=new Kk(this),L=new Xk(this.config,this.logger),A=this.streamController=new qk(this,d,L),R=this.gapController=new Vk(this,d);m.setStreamController(A),g.setStreamController(A);const I=[v,S,A];p&&I.splice(1,0,p),E&&I.splice(1,0,E),this.networkControllers=I;const b=[c,h,R,m,g,T,d];this.audioTrackController=this.createController(r.audioTrackController,I);const O=r.audioStreamController;O&&I.push(this.audioStreamController=new O(this,d,L)),this.subtitleTrackController=this.createController(r.subtitleTrackController,I);const B=r.subtitleStreamController;B&&I.push(this.subtititleStreamController=new B(this,d,L)),this.createController(r.timelineController,b),L.emeController=this.emeController=this.createController(r.emeController,b),this.cmcdController=this.createController(r.cmcdController,b),this.latencyController=this.createController(jk,b),this.coreComponents=b,I.push(u);const K=u.onErrorOut;typeof K=="function"&&this.on(x.ERROR,K,u),this.on(x.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===x.ERROR;this.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(x.ERROR,{type:te.OTHER_ERROR,details:P.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,i=t?e:{media:r};this._media=r,this.trigger(x.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,i=this._url=Hf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Q.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Q.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Q.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=VD()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){F_(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=px(t);return fx(e,r,navigator.mediaCapabilities)}}zt.defaultConfig=void 0;const Zk=()=>{const{id:n}=my(),e=br(),{mediaGroups:t,watched:r,updateWatchedStatus:i}=Rl(),s=C.exports.useRef(null),o=C.exports.useRef(null),a=C.exports.useRef(null),l=decodeURIComponent(n),u=l.startsWith("tg_");let c=null,d=[],f="",p="";if(u){const ne=l.split("_");if(ne.length>=3){const re=ne[1];p=ne[2];const Ie=re.replace(/-/g,"+").replace(/_/g,"/");try{f=atob(Ie),c={id:l,name:"Telegram Video",isTelegram:!0}}catch(Ve){console.error("Failed to decode telegram link",Ve)}}}!u&&t&&Object.values(t).forEach(ne=>{const re=ne.find(Ie=>Ie.id===l);re&&(c=re,d=ne)});const[h,m]=C.exports.useState(!1),[g,v]=C.exports.useState(0),[y,E]=C.exports.useState(0),[S,T]=C.exports.useState(1),[L,A]=C.exports.useState(!1),[R,I]=C.exports.useState(!0),[b,O]=C.exports.useState(!1),[B,K]=C.exports.useState([]),[q,j]=C.exports.useState([]),[G,M]=C.exports.useState(null),[$,z]=C.exports.useState(null),[J,w]=C.exports.useState(!1);C.exports.useEffect(()=>{c&&!u?(K([]),j([]),r[c.id]||i(c.id,!0),fetch(`/api/metadata?id=${encodeURIComponent(c.id)}`).then(ne=>ne.json()).then(ne=>{K(ne.audio||[]),j(ne.subtitles||[])}).catch(ne=>console.error("Failed to fetch metadata",ne))):u&&c&&(r[c.id]||i(c.id,!0))},[c]);const k=()=>{s.current&&s.current.currentTime>0&&c&&i(c.id,void 0,s.current.currentTime)};C.exports.useEffect(()=>{var ne;if(c&&s.current){const re=s.current,Ie=((ne=r[c.id])==null?void 0:ne.currentTime)||0;if(o.current&&(o.current.destroy(),o.current=null),u){re.preload="auto",re.src=`/api/telegram/stream?link=${encodeURIComponent(f)}&id=${p}`,re.load(),Ie>0&&(re.currentTime=Ie);{const Pt=re.play();Pt!==void 0&&Pt.catch(()=>{re.muted=!0,re.play(),A(!0)})}return}let Ve=`/api/stream?id=${encodeURIComponent(c.id)}`;G!==null&&(Ve+=`&audioStream=${G}`),$!==null&&(Ve+=`&subtitleStream=${$}`),fetch(Ve).then(Pt=>Pt.json()).then(Pt=>{if(re.preload="auto",Pt.type==="hls"){if(zt.isSupported()){const le=new zt({enableWorker:!0,lowLatencyMode:!0,startLevel:-1,fragLoadingMaxRetry:5});o.current=le,le.loadSource(Pt.url),le.attachMedia(re),le.on(zt.Events.MANIFEST_PARSED,()=>{Ie>5&&(re.currentTime=Ie-2);const Oe=re.play();Oe!==void 0&&Oe.catch(Ze=>{console.warn("Autoplay block, trying muted...",Ze),re.muted=!0,A(!0),re.play().catch(on=>console.error("Final autoplay failure:",on))})})}}else{re.src=Pt.url,re.load(),Ie>5&&(re.currentTime=Ie-2);const le=re.play();le!==void 0&&le.catch(Oe=>{console.warn("Autoplay block, trying muted...",Oe),re.muted=!0,A(!0),re.play().catch(Ze=>console.error("Final autoplay failure:",Ze))})}}).catch(Pt=>console.error("Stream error",Pt))}},[c,G,$]),C.exports.useEffect(()=>{if(!c)return;const ne=setInterval(()=>{h&&k()},5e3),re=()=>k();return window.addEventListener("beforeunload",re),()=>{clearInterval(ne),window.removeEventListener("beforeunload",re),k()}},[c,h]),C.exports.useEffect(()=>{let ne;const re=()=>{I(!0),clearTimeout(ne),h&&(ne=setTimeout(()=>I(!1),3e3))};return window.addEventListener("mousemove",re),window.addEventListener("mousedown",re),window.addEventListener("keydown",re),()=>{window.removeEventListener("mousemove",re),window.removeEventListener("mousedown",re),window.removeEventListener("keydown",re)}},[h]);const U=()=>{s.current.paused?(s.current.play(),m(!0)):(s.current.pause(),m(!1))},N=()=>{v(s.current.currentTime),E(s.current.duration)},V=ne=>{const re=ne.target.value/100*y;s.current.currentTime=re,v(re),i(c.id,void 0,re)},ee=()=>{const ne=!L;A(ne),s.current.muted=ne},fe=ne=>{const re=parseFloat(ne.target.value);T(re),s.current.volume=re,A(re===0)},he=()=>{document.fullscreenElement?(document.exitFullscreen(),O(!1)):(a.current.requestFullscreen(),O(!0))},Ee=ne=>{if(isNaN(ne))return"0:00";const re=Math.floor(ne/3600),Ie=Math.floor(ne%3600/60),Ve=Math.floor(ne%60);return re>0?`${re}:${Ie.toString().padStart(2,"0")}:${Ve.toString().padStart(2,"0")}`:`${Ie}:${Ve.toString().padStart(2,"0")}`},St=()=>{if(!c||!d)return;i(c.id,!0,0);const ne=d.findIndex(re=>re.id===c.id);ne!==-1&&ne<d.length-1&&(e(`/watch/${encodeURIComponent(d[ne+1].id)}`),w(!1))};return c?H("div",{ref:a,className:"player-overlay",style:{cursor:R?"default":"none"},children:[D("video",{ref:s,onTimeUpdate:N,onPlay:()=>m(!0),onPause:()=>m(!1),onEnded:()=>i(c.id,!0,0),onClick:U,autoPlay:!0,style:{width:"100%",height:"100%",outline:"none"}}),D(Qa,{children:R&&H(je.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",justifyContent:"space-between",padding:"24px"},children:[H("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[D("button",{className:"back-button",onClick:()=>e("/"),children:D(Ay,{size:20})}),H("div",{style:{textAlign:"center"},children:[D("div",{style:{fontSize:"0.8rem",color:"#aaa",textTransform:"uppercase",letterSpacing:"1px"},children:c.group}),D("div",{style:{fontWeight:"600",fontSize:"1.1rem"},children:c.name})]}),D("div",{style:{width:"40px"}})," "]}),H("div",{style:{width:"100%"},children:[H("div",{style:{position:"relative",marginBottom:"16px",display:"flex",alignItems:"center",gap:"15px"},children:[D("span",{style:{fontSize:"0.85rem",width:"45px",textAlign:"right"},children:Ee(g)}),D("div",{style:{flex:1,position:"relative",height:"6px",display:"flex",alignItems:"center"},children:D("input",{type:"range",min:"0",max:"100",value:g/y*100||0,onChange:V,style:{width:"100%",cursor:"pointer",accentColor:"var(--accent)",height:"4px",WebkitAppearance:"none",background:"#333",borderRadius:"2px"}})}),D("span",{style:{fontSize:"0.85rem",width:"45px"},children:Ee(y)})]}),H("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[H("div",{style:{display:"flex",alignItems:"center",gap:"30px"},children:[D("button",{onClick:U,style:{background:"transparent",border:"none",color:"white",cursor:"pointer"},children:h?D(eL,{size:32,fill:"white"}):D(bl,{size:32,fill:"white"})}),H("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[D("button",{onClick:ee,style:{background:"transparent",border:"none",color:"white",cursor:"pointer"},children:L?D(aL,{size:24}):D(oL,{size:24})}),D("input",{type:"range",min:"0",max:"1",step:"0.1",value:S,onChange:fe,style:{width:"80px",accentColor:"white",cursor:"pointer"}})]})]}),H("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[H("button",{onClick:St,style:{background:"transparent",border:"none",color:"white",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontWeight:"bold"},children:["Siguiente ",D(sL,{size:24})]}),D("button",{onClick:()=>w(!J),style:{background:"transparent",border:"none",color:"white",cursor:"pointer"},children:D(iL,{size:24})}),D("button",{onClick:he,style:{background:"transparent",border:"none",color:"white",cursor:"pointer"},children:D(ZA,{size:24})})]})]})]})]})}),D(Qa,{children:J&&H(Oc,{children:[D(je.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>w(!1),style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)",zIndex:100}}),H(je.div,{initial:{x:300},animate:{x:0},exit:{x:300},style:{position:"absolute",top:0,right:0,bottom:0,width:"350px",background:"#111",zIndex:101,padding:"40px 30px",borderLeft:"1px solid #222",display:"flex",flexDirection:"column"},children:[D("h2",{style:{marginBottom:"30px"},children:"Configuraci\xF3n"}),H("div",{style:{marginBottom:"30px"},children:[D("h4",{style:{color:"#666",textTransform:"uppercase",fontSize:"0.8rem",letterSpacing:"2px",marginBottom:"15px"},children:"Audio"}),H("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[B.length===0&&D("div",{style:{opacity:.5},children:"\xDAnica pista disponible"}),B.map((ne,re)=>{var Ie,Ve;return H("button",{onClick:()=>{M(ne.index),w(!1)},style:{background:G===ne.index?"var(--accent)":"rgba(255,255,255,0.03)",border:"none",color:"white",padding:"12px 15px",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px"},children:[D(JA,{size:16}),H("span",{children:[((Ie=ne.tags)==null?void 0:Ie.language)||"Desconocido"," - ",((Ve=ne.tags)==null?void 0:Ve.title)||`Track ${re+1}`]})]},re)})]})]}),H("div",{children:[D("h4",{style:{color:"#666",textTransform:"uppercase",fontSize:"0.8rem",letterSpacing:"2px",marginBottom:"15px"},children:"Subt\xEDtulos"}),H("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[H("button",{onClick:()=>{z(null),w(!1)},style:{background:$===null?"var(--accent)":"rgba(255,255,255,0.03)",border:"none",color:"white",padding:"12px 15px",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px"},children:[D(qp,{size:16})," Ninguno"]}),q.map((ne,re)=>{var Ie,Ve;return H("button",{onClick:()=>{z(ne.index),w(!1)},style:{background:$===ne.index?"var(--accent)":"rgba(255,255,255,0.03)",border:"none",color:"white",padding:"12px 15px",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px"},children:[D(qp,{size:16}),H("span",{children:[((Ie=ne.tags)==null?void 0:Ie.language)||"Desconocido"," - ",((Ve=ne.tags)==null?void 0:Ve.title)||`Track ${re+1}`]})]},re)})]})]})]})]})})]}):D("div",{style:{background:"#000",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:"Cargando..."})},Jk=()=>{const n=br(),[e,t]=C.exports.useState("loading"),[r,i]=C.exports.useState({apiId:"",apiHash:""}),[s,o]=C.exports.useState(""),[a,l]=C.exports.useState(""),[u,c]=C.exports.useState(""),[d,f]=C.exports.useState(""),[p,h]=C.exports.useState([]),[m,g]=C.exports.useState([]),[v,y]=C.exports.useState("channels"),[E,S]=C.exports.useState(!1),[T,L]=C.exports.useState({text:"",type:""});C.exports.useEffect(()=>{A()},[]);const A=async()=>{try{const $=await(await fetch("/api/telegram/status")).json();$.connected?(t("logged-in"),O()):$.isConfigured?t("logging-in"):t("unconfigured")}catch{t("unconfigured")}},R=async M=>{M.preventDefault(),S(!0);try{const z=await(await fetch("/api/telegram/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();z.connected&&(z.isLogged?t("logged-in"):t("logging-in"))}catch($){L({text:"Error al inicializar: "+$.message,type:"error"})}S(!1)},I=async M=>{M.preventDefault(),S(!0);try{await fetch("/api/telegram/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:s})}),t("need-code")}catch($){L({text:"Error al enviar c\xF3digo: "+$.message,type:"error"})}S(!1)},b=async M=>{M.preventDefault(),S(!0);try{const z=await(await fetch("/api/telegram/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:a,password:u})})).json();z.success?(t("logged-in"),L({text:"\xA1Conectado con \xE9xito!",type:"success"}),O()):L({text:"Error: "+z.error,type:"error"})}catch($){L({text:"Error de login: "+$.message,type:"error"})}S(!1)},O=async()=>{S(!0);try{const $=await(await fetch("/api/telegram/my-channels")).json();g($)}catch(M){console.error("Error fetching channels:",M)}S(!1)},B=M=>{f(M),y("videos"),K(M)},K=async M=>{const $=M||d;if(!!$){S(!0);try{const J=await(await fetch(`/api/telegram/channel?link=${encodeURIComponent($)}`)).json();if(Array.isArray(J))h(J);else throw new Error(J.error||"Error desconocido")}catch(z){L({text:"Error al obtener v\xEDdeos: "+z.message,type:"error"})}S(!1)}},q=async M=>{L({text:"Iniciando descarga...",type:"info"});try{(await(await fetch("/api/telegram/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:d,messageId:M})})).json()).success&&L({text:"Descarga completada correctamente.",type:"success"})}catch($){L({text:"Fallo en la descarga: "+$.message,type:"error"})}},j=M=>{const $=btoa(d).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");n(`/watch/tg_${$}_${M.id}`)},G=()=>H("div",{style:{marginBottom:"40px"},children:[D("h1",{style:{fontSize:"2.5rem",fontWeight:"800",marginBottom:"10px",background:"linear-gradient(to right, #24A1DE, #A2D8F2)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Telegram Integration"}),D("p",{style:{color:"#aaa",fontSize:"1.1rem"},children:"Streaming y descarga directa desde canales de Telegram."})]});return D("div",{style:{padding:"40px",maxWidth:"1000px",margin:"0 auto",minHeight:"80vh"},children:H(je.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[G(),T.text&&H("div",{style:{padding:"15px 20px",borderRadius:"12px",marginBottom:"30px",background:T.type==="error"?"rgba(255, 71, 71, 0.1)":"rgba(36, 161, 222, 0.1)",border:`1px solid ${T.type==="error"?"#ff4747":"#24A1DE"}`,display:"flex",alignItems:"center",gap:"12px",color:T.type==="error"?"#ff4747":"#24A1DE"},children:[T.type==="error"?D(YA,{size:20}):D(Qi,{size:20}),T.text]}),H(Qa,{mode:"wait",children:[e==="unconfigured"&&H(je.form,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onSubmit:R,style:{background:"rgba(255,255,255,0.03)",padding:"40px",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.05)"},children:[D("h3",{style:{marginBottom:"20px"},children:"Paso 1: Configurar API"}),H("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[D("input",{type:"text",placeholder:"API ID",value:r.apiId,onChange:M=>i({...r,apiId:M.target.value}),style:{background:"rgba(0,0,0,0.2)",border:"1px solid #333",padding:"15px",borderRadius:"10px",color:"white"},required:!0}),D("input",{type:"text",placeholder:"API HASH",value:r.apiHash,onChange:M=>i({...r,apiHash:M.target.value}),style:{background:"rgba(0,0,0,0.2)",border:"1px solid #333",padding:"15px",borderRadius:"10px",color:"white"},required:!0}),H("button",{type:"submit",disabled:E,style:{background:"#24A1DE",color:"white",padding:"15px",borderRadius:"10px",fontWeight:"bold",cursor:"pointer",border:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[E?D(uu,{className:"animate-spin"}):D(Yp,{})," Siguiente"]})]})]},"init"),e==="logging-in"&&H(je.form,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onSubmit:I,style:{background:"rgba(255,255,255,0.03)",padding:"40px",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.05)"},children:[D("h3",{style:{marginBottom:"20px"},children:"Paso 2: Mi Tel\xE9fono"}),H("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[H("div",{style:{display:"flex",alignItems:"center",background:"rgba(0,0,0,0.2)",border:"1px solid #333",borderRadius:"10px",padding:"5px 15px"},children:[D(tL,{size:20,color:"#666"}),D("input",{type:"text",placeholder:"+34 600000000",value:s,onChange:M=>o(M.target.value),style:{background:"transparent",border:"none",padding:"12px",color:"white",flex:1,outline:"none"},required:!0})]}),H("button",{type:"submit",disabled:E,style:{background:"#24A1DE",color:"white",padding:"15px",borderRadius:"10px",fontWeight:"bold",cursor:"pointer",border:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[E?D(uu,{className:"animate-spin"}):D(rL,{})," Enviar C\xF3digo"]})]})]},"phone"),e==="need-code"&&H(je.form,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onSubmit:b,style:{background:"rgba(255,255,255,0.03)",padding:"40px",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.05)"},children:[D("h3",{style:{marginBottom:"20px"},children:"Paso 3: Verificaci\xF3n"}),H("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[D("input",{type:"text",placeholder:"C\xF3digo de 5 d\xEDgitos",value:a,onChange:M=>l(M.target.value),style:{background:"rgba(0,0,0,0.2)",border:"1px solid #333",padding:"15px",borderRadius:"10px",color:"white",fontSize:"1.2rem",textAlign:"center",letterSpacing:"5px"},required:!0}),D("input",{type:"password",placeholder:"Contrase\xF1a 2FA (si tienes)",value:u,onChange:M=>c(M.target.value),style:{background:"rgba(0,0,0,0.2)",border:"1px solid #333",padding:"15px",borderRadius:"10px",color:"white"}}),H("button",{type:"submit",disabled:E,style:{background:"#24A1DE",color:"white",padding:"15px",borderRadius:"10px",fontWeight:"bold",cursor:"pointer",border:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[E?D(uu,{className:"animate-spin"}):D(QA,{})," Entrar"]})]})]},"code"),e==="logged-in"&&D(je.div,{initial:{opacity:0},animate:{opacity:1},children:v==="channels"?H(Oc,{children:[H("div",{style:{background:"rgba(255,255,255,0.03)",padding:"30px",borderRadius:"24px",border:"1px solid rgba(255,255,255,0.05)",marginBottom:"40px"},children:[H("h3",{style:{marginBottom:"20px",display:"flex",alignItems:"center",gap:"10px"},children:[D(XA,{size:20,color:"#24A1DE"})," Entrada Manual"]}),H("div",{style:{display:"flex",gap:"10px"},children:[D("input",{type:"text",placeholder:"https://t.me/nombre_canal",value:d,onChange:M=>f(M.target.value),style:{background:"rgba(0,0,0,0.2)",border:"1px solid #333",padding:"12px 15px",borderRadius:"10px",color:"white",flex:1}}),D("button",{onClick:()=>B(d),disabled:E,style:{background:"white",color:"black",padding:"0 25px",borderRadius:"10px",fontWeight:"bold",cursor:"pointer",border:"none"},children:E?"...":"Buscar"})]})]}),D("h3",{style:{marginBottom:"20px"},children:"Mis Canales y Grupos"}),D("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"15px"},children:m.map(M=>H(je.div,{whileHover:{scale:1.02,background:"rgba(36, 161, 222, 0.1)"},onClick:()=>B(M.link),style:{cursor:"pointer",padding:"20px",background:"rgba(255,255,255,0.03)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.05)",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",textAlign:"center"},children:[D("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"#24A1DE",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",fontWeight:"bold"},children:M.title.substring(0,1).toUpperCase()}),D("div",{style:{fontWeight:"500",fontSize:"0.9rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:M.title}),M.unreadCount>0&&D("span",{style:{background:"#24A1DE",padding:"2px 8px",borderRadius:"10px",fontSize:"0.7rem"},children:M.unreadCount})]},M.id))})]}):H(Oc,{children:[H("div",{style:{marginBottom:"20px",display:"flex",alignItems:"center",gap:"15px"},children:[H("button",{onClick:()=>y("channels"),style:{background:"rgba(255,255,255,0.05)",border:"none",color:"white",padding:"8px 15px",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[D(Yp,{style:{transform:"rotate(180deg)"},size:18})," Volver"]}),D("h3",{style:{margin:0},children:"V\xEDdeos encontrados"})]}),D("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px"},children:p.map(M=>H(je.div,{whileHover:{y:-5},style:{background:"rgba(255,255,255,0.03)",padding:"20px",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.05)",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[H("div",{style:{marginBottom:"20px"},children:[H("div",{style:{color:"#24A1DE",fontSize:"0.8rem",fontWeight:"bold",marginBottom:"5px"},children:[(M.size/(1024*1024)).toFixed(1)," MB"]}),D("div",{style:{fontWeight:"500",fontSize:"1rem",wordBreak:"break-all",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:M.name})]}),H("div",{style:{display:"flex",gap:"10px"},children:[H("button",{onClick:()=>j(M),style:{flex:1,padding:"10px",borderRadius:"10px",background:"#24A1DE",color:"white",fontWeight:"bold",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[D(bl,{size:18,fill:"currentColor"})," Ver"]}),D("button",{onClick:()=>q(M.id),title:"Descargar",style:{padding:"10px",borderRadius:"10px",background:"rgba(255,255,255,0.1)",color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:D(qA,{size:18})})]})]},M.id))})]})},"browser")]})]})})},eO=()=>{const{searchQuery:n,setSearchQuery:e}=Rl(),t=ro(),r=br();return H("div",{className:"search-container",style:{position:"relative",display:"flex",alignItems:"center",background:"rgba(255,255,255,0.1)",borderRadius:"20px",padding:"4px 12px",width:"300px",transition:"all 0.3s"},children:[D(nL,{size:18,color:"#aaa"}),D("input",{type:"text",placeholder:"Buscar pel\xEDculas o series...",value:n,onChange:s=>{e(s.target.value),t.pathname!=="/"&&s.target.value.length>0&&r("/")},style:{background:"transparent",border:"none",color:"white",padding:"6px 10px",fontSize:"0.9rem",width:"100%",outline:"none"}}),n&&D(lL,{size:18,color:"#aaa",style:{cursor:"pointer"},onClick:()=>e("")})]})};function tO(){return D(KA,{children:D(MA,{children:H("div",{className:"app",children:[H("header",{children:[H("div",{style:{display:"flex",alignItems:"center",gap:"40px"},children:[D(ra,{to:"/",style:{textDecoration:"none"},children:D("div",{className:"logo",children:"STREAMWEB"})}),H("nav",{className:"header-nav",children:[D(ra,{to:"/",className:"nav-link",children:"Inicio"}),H(ra,{to:"/telegram",className:"nav-link telegram-link",children:["Telegram ",D("span",{className:"beta-tag",children:"Nuevo"})]})]})]}),D(eO,{})]}),D("main",{children:H(RA,{children:[D(Xi,{path:"/",element:D(zC,{})}),D(Xi,{path:"/details/:group",element:D(YC,{})}),D(Xi,{path:"/watch/:id",element:D(Zk,{})}),D(Xi,{path:"/telegram",element:D(Jk,{})})]})})]})})})}uy.render(D(ul.StrictMode,{children:D(tO,{})}),document.getElementById("root"));
